<!DOCTYPE html>
<html lang="en" class="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OWASP API Security Testing Checklist</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        },
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'bounce-slow': 'bounce 2s infinite',
                        'slide-in': 'slideIn 0.5s ease-out',
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'scale-in': 'scaleIn 0.3s ease-out',
                    },
                    keyframes: {
                        slideIn: {
                            '0%': { transform: 'translateY(20px)', opacity: 0 },
                            '100%': { transform: 'translateY(0)', opacity: 1 },
                        },
                        fadeIn: {
                            '0%': { opacity: 0 },
                            '100%': { opacity: 1 },
                        },
                        scaleIn: {
                            '0%': { transform: 'scale(0.95)', opacity: 0 },
                            '100%': { transform: 'scale(1)', opacity: 1 },
                        },
                    },
                },
            },
        }
    </script>
   
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tippy.js@6.3.7/dist/tippy.css">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tippy.js@6.3.7/dist/tippy.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.2.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>
    <style>
        /* Risk Level Backgrounds */
        .risk-critical { background-color: #f87171; /* red-400 */ color: #450a0a; /* red-950 */ }
        .risk-high { background-color: #fb923c; /* orange-400 */ color: #7c2d12; /* orange-950 */ }
        .risk-medium { background-color: #facc15; /* yellow-400 */ color: #713f12; /* yellow-950 */ }
        .risk-low { background-color: #4ade80; /* green-400 */ color: #14532d; /* green-950 */ }

        /* Dark Mode Risk Levels */
        .dark .risk-critical { background-color: #b91c1c; /* red-700 */ color: #fef2f2; /* red-50 */ }
        .dark .risk-high { background-color: #c2410c; /* orange-700 */ color: #fff7ed; /* orange-50 */ }
        .dark .risk-medium { background-color: #a16207; /* yellow-700 */ color: #fefce8; /* yellow-50 */ }
        .dark .risk-low { background-color: #15803d; /* green-700 */ color: #f0fdf4; /* green-50 */ }

        .category-card {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .category-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .category-card.risk-critical::before { background-color: #ef4444; /* red-500 */ }
        .category-card.risk-high::before { background-color: #f97316; /* orange-500 */ }
        .category-card.risk-medium::before { background-color: #eab308; /* yellow-500 */ }
        .category-card.risk-low::before { background-color: #22c55e; /* green-500 */ }

        .category-card:hover::before {
            opacity: 1;
        }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); /* shadow-lg */
        }

        /* Tab Content Fade-in */
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Task Item Hover */
        .task-item { transition: all 0.2s ease; }
        .task-item:hover { background-color: #f9fafb; /* gray-50 */ }
        .dark .task-item:hover { background-color: #1f2937; /* gray-800 */ }

        /* Task Checkbox Strikethrough */
        .task-checkbox:checked + label { text-decoration: line-through; color: #6b7280; /* gray-500 */ }
        .dark .task-checkbox:checked + label { color: #9ca3af; /* gray-400 */ }

        /* Modal Transitions & Base Styles */
        .modal { transition: opacity 0.3s ease-out; }
        .modal > div { transition: transform 0.3s ease-out; }
        .modal.show > div { transform: scale(1); } /* Start visible slightly scaled down */
        .modal:not(.show) > div { transform: scale(0.95); } /* Scale down when closing */

        /* Toast Notification */
        .toast {
            position: fixed; bottom: 20px; right: 20px;
            padding: 12px 20px; border-radius: 8px; color: white;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); /* shadow-md */
            z-index: 1050; /* Ensure above modals */
            opacity: 0; transition: opacity 0.3s ease, transform 0.3s ease;
            transform: translateY(20px);
        }
        .toast.show { opacity: 1; transform: translateY(0); }

        /* Print Styles */
        @media print {
            .no-print { display: none !important; }
            .print-break { page-break-before: always; }
            body { font-size: 10pt; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            h1, h2, h3, h4 { page-break-after: avoid; }
            table, .finding { page-break-inside: avoid; }
            a { text-decoration: none; color: inherit; }
            pre { background-color: #f8f9fa !important; border: 1px solid #dee2e6; padding: 10px; white-space: pre-wrap; word-wrap: break-word; }
            .header-print { display: block !important; text-align: center; margin-bottom: 20px; border-bottom: 1px solid #ccc; padding-bottom: 10px; }
            .print-section { margin-bottom: 30px; }
            .print-category { page-break-before: always; margin-top: 20px; }
            .risk-critical, .risk-high, .risk-medium, .risk-low { background-color: transparent !important; border-left: 5px solid; padding-left: 10px; margin-bottom: 5px; font-weight: bold; }
            .risk-critical { border-color: #f87171; color: #dc2626 !important; }
            .risk-high { border-color: #fb923c; color: #ea580c !important; }
            .risk-medium { border-color: #facc15; color: #ca8a04 !important; }
            .risk-low { border-color: #4ade80; color: #16a34a !important; }
            #category-details { box-shadow: none; border: 1px solid #eee; }
            #tabNavigation, #btn-back-to-categories { display: none; }
            .tab-content { display: block !important; animation: none !important; } /* Show all tabs */
            #notes-content { display: block !important; } /* Ensure notes print */
            .task-checkbox { display: inline-block; margin-right: 5px; } /* Make checkbox visible */
            .task-checkbox::before { content: '\2610'; /* Unchecked box character */ font-size: 1.2em; line-height: 1; vertical-align: middle; }
            .task-checkbox:checked::before { content: '\2611'; /* Checked box character */ }
            .task-checkbox:checked + label { text-decoration: none; color: #333; } /* Remove strike/color */
            .finding { border: 1px solid #ddd; padding: 10px; }
            .finding-title span { display: inline-block; padding: 2px 5px; border-radius: 3px; font-size: 0.9em; color: #fff !important; }
            .finding-high .finding-title span { background-color: #f87171 !important; }
            .finding-medium .finding-title span { background-color: #fb923c !important; }
            .finding-low .finding-title span { background-color: #facc15 !important; color: #333 !important; }
            .finding-info .finding-title span { background-color: #60a5fa !important; }
        }
        .header-print { display: none; }

        /* Circular Progress */
        .circular-progress {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            position: relative;
            color: #1f2937;
            background: #f3f4f6;
        }
        
        .circular-progress::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(var(--progress-color) var(--progress-percent), transparent var(--progress-percent));
            mask: radial-gradient(transparent 55%, black 55%);
            -webkit-mask: radial-gradient(transparent 55%, black 55%);
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }
        
        .dark ::-webkit-scrollbar-track {
            background: #2d3748;
        }
        
        .dark ::-webkit-scrollbar-thumb {
            background: #4a5568;
        }
        
        .dark ::-webkit-scrollbar-thumb:hover {
            background: #718096;
        }

        /* Quick Jump Navigation */
        .quick-jump {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 30px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 10px 20px;
            z-index: 40;
            display: flex;
            gap: 12px;
            transition: all 0.3s ease;
            opacity: 0;
            pointer-events: none;
        }
        
        .quick-jump.visible {
            opacity: 1;
            pointer-events: auto;
        }
        
        .dark .quick-jump {
            background-color: rgba(31, 41, 55, 0.9);
        }
        
        .quick-jump-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #4B5563;
            background-color: #F3F4F6;
            transition: all 0.2s ease;
        }
        
        .quick-jump-btn:hover {
            background-color: #E5E7EB;
            color: #1F2937;
            transform: translateY(-2px);
        }
        
        .dark .quick-jump-btn {
            background-color: #374151;
            color: #D1D5DB;
        }
        
        .dark .quick-jump-btn:hover {
            background-color: #4B5563;
            color: #F9FAFB;
        }
        
        /* Keyboard shortcut indicators */
        .kbd {
            display: inline-block;
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 3px;
            box-shadow: 0 1px 1px rgba(0,0,0,.2);
            font-size: 0.65rem;
            font-weight: 600;
            line-height: 1;
            padding: 3px 5px;
            white-space: nowrap;
            margin-left: 4px;
            vertical-align: middle;
        }
        
        .dark .kbd {
            background: #4b5563;
            border-color: #6b7280;
            color: #f9fafb;
        }
        
        /* Tour highlight */
        .tour-highlight {
            position: relative;
            z-index: 1052 !important;
            animation: pulse 2s infinite;
            box-shadow: 0 0 0 8px rgba(59, 130, 246, 0.3);
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.6); }
            70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }
        
        /* Floating Action Button */
        .fab {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background-color: #3b82f6;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            z-index: 999;
            transition: all 0.3s ease;
        }
        
        .fab:hover {
            transform: scale(1.05);
            background-color: #2563eb;
        }
        
        .fab-menu {
            position: fixed;
            bottom: 85px;
            right: 30px;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 15px;
            z-index: 998;
        }
        
        .fab-item {
            display: flex;
            align-items: center;
            gap: 10px;
            transform: scale(0);
            transform-origin: center right;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            opacity: 0;
        }
        
        .fab-menu.active .fab-item {
            transform: scale(1);
            opacity: 1;
        }
        
        .fab-menu.active .fab-item:nth-child(1) {
            transition-delay: 0s;
        }
        
        .fab-menu.active .fab-item:nth-child(2) {
            transition-delay: 0.05s;
        }
        
        .fab-menu.active .fab-item:nth-child(3) {
            transition-delay: 0.1s;
        }
        
        .fab-menu.active .fab-item:nth-child(4) {
            transition-delay: 0.15s;
        }
        
        .fab-label {
            background-color: #1f2937;
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 0.875rem;
            white-space: nowrap;
        }
        
        .fab-button {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #3b82f6;
            color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        /* Visual confetti effect for achievements */
        @keyframes confetti-slow {
            0% { transform: translate3d(0, 0, 0) rotateX(0) rotateY(0); }
            100% { transform: translate3d(25px, 105vh, 0) rotateX(360deg) rotateY(180deg); }
        }
        
        @keyframes confetti-medium {
            0% { transform: translate3d(0, 0, 0) rotateX(0) rotateY(0); }
            100% { transform: translate3d(100px, 105vh, 0) rotateX(100deg) rotateY(360deg); }
        }
        
        @keyframes confetti-fast {
            0% { transform: translate3d(0, 0, 0) rotateX(0) rotateY(0); }
            100% { transform: translate3d(-50px, 105vh, 0) rotateX(10deg) rotateY(250deg); }
        }
        
        .confetti {
            position: fixed;
            top: -10px;
            left: 0;
            width: 100%;
            height: 0;
            perspective: 700px;
            pointer-events: none;
            z-index: 1060;
        }
        
        .confetti--container {
            position: absolute;
            left: 50%;
            height: 100%;
        }
        
        .confetti-piece {
            position: absolute;
            width: 10px;
            height: 10px;
            opacity: 0.7;
            backface-visibility: hidden;
        }
        
        .confetti-piece:nth-child(odd) {
            background-color: #3b82f6;
        }
        
        .confetti-piece:nth-child(even) {
            background-color: #10b981;
        }
        
        .confetti-piece:nth-child(3n) {
            background-color: #ef4444;
        }
        
        .confetti-piece:nth-child(4n) {
            background-color: #f59e0b;
        }
        
        .confetti-piece:nth-child(5n) {
            background-color: #8b5cf6;
        }
        
        .slow {
            animation: confetti-slow 3.5s linear 1 forwards;
        }
        
        .medium {
            animation: confetti-medium 2.5s linear 1 forwards;
        }
        
        .fast {
            animation: confetti-fast 1.5s linear 1 forwards;
        }
        
        /* Sorting indicators for tables */
        .sort-arrow {
            display: inline-block;
            width: 0;
            height: 0;
            margin-left: 6px;
            vertical-align: middle;
        }
        
        .sort-arrow.up {
            border-left: 4px solid transparent;
            border-right: 4px solid transparent;
            border-bottom: 4px solid currentColor;
        }
        
        .sort-arrow.down {
            border-left: 4px solid transparent;
            border-right: 4px solid transparent;
            border-top: 4px solid currentColor;
        }
        
        /* Badge counter */
        .badge-counter {
            position: absolute;
            top: -6px;
            right: -6px;
            font-size: 0.675rem;
            min-width: 18px;
            height: 18px;
            border-radius: 9px;
            background-color: #ef4444;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 5px;
            line-height: 1;
            font-weight: 600;
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        
        /* Switch toggle styles */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #3b82f6;
        }
        
        .toggle-checkbox:checked + .toggle-label {
            background-color: #3b82f6;
        }
        
        /* Tip indicator */
        .tip-indicator {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background-color: #3b82f6;
            color: white;
            font-size: 11px;
            font-weight: bold;
            margin-left: 4px;
            cursor: help;
            vertical-align: middle;
        }
        
        /* Custom focus styles */
        button:focus, a:focus, input:focus, textarea:focus, select:focus, [tabindex]:focus {
            outline: 2px solid transparent;
            outline-offset: 2px;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
        }
    </style>
</head>

<body class="bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200 transition-colors duration-300">
    <header class="header-print">
        <h1 id="print-project-name" class="text-3xl font-bold"></h1>
        <p id="print-project-target"></p>
        <p id="print-project-date"></p>
        <p id="print-project-tester"></p>
    </header>

    <header class="bg-gradient-to-r from-blue-800 to-indigo-900 dark:from-blue-900 dark:to-indigo-950 text-white shadow-lg no-print sticky top-0 z-40 transition-all duration-300">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0 text-center md:text-left">
                    <h1 class="text-2xl lg:text-3xl font-bold tracking-tight flex items-center">
                        <i class="fas fa-plug mr-2"></i>
                        OWASP API Security Checklist
                        <span class="ml-3 text-xs inline-flex items-center px-2.5 py-0.5 rounded-full bg-blue-200 text-blue-800 dark:bg-blue-800 dark:text-blue-200">
                            <span class="relative flex h-2 w-2 mr-1">
                                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span>
                                <span class="relative inline-flex rounded-full h-2 w-2 bg-blue-500"></span>
                            </span>
                            2023 Edition
                        </span>
                    </h1>
                    <p class="text-sm text-blue-200 dark:text-blue-300">Based on the OWASP API Security Top 10 with enhanced visualization & reporting</p>
                </div>
                <div class="flex flex-col sm:flex-row items-center gap-4">
                    <span class="font-semibold text-center hidden md:inline-block">Project: <span id="current-project-name" class="font-bold text-blue-100 dark:text-blue-200"></span></span>
                    <div class="flex flex-wrap justify-center gap-2">
                        <button id="projects-button" class="bg-blue-600 dark:bg-blue-700 text-white px-3 py-1.5 rounded-md hover:bg-blue-700 dark:hover:bg-blue-800 transition text-sm shadow-sm inline-flex items-center gap-1">
                            <i class="fas fa-folder"></i>Projects
                            <span class="kbd">P</span>
                        </button>
                        <div class="relative">
                            <button id="btn-print" class="bg-white dark:bg-gray-800 text-blue-800 dark:text-blue-300 px-3 py-1.5 rounded-md hover:bg-blue-100 dark:hover:bg-gray-700 transition text-sm shadow-sm inline-flex items-center gap-1">
                                <i class="fas fa-print"></i>Print
                            </button>
                        </div>
                        <button id="btn-export" class="bg-green-600 dark:bg-green-700 text-white px-3 py-1.5 rounded-md hover:bg-green-700 dark:hover:bg-green-800 transition text-sm shadow-sm inline-flex items-center gap-1">
                            <i class="fas fa-file-export"></i>Export
                        </button>
                        <button id="btn-import" class="bg-yellow-500 dark:bg-yellow-600 text-white px-3 py-1.5 rounded-md hover:bg-yellow-600 dark:hover:bg-yellow-700 transition text-sm shadow-sm inline-flex items-center gap-1">
                            <i class="fas fa-file-import"></i>Import
                        </button>
                        <button id="theme-toggle" class="bg-gray-700 dark:bg-gray-600 text-white p-1.5 rounded-md hover:bg-gray-600 dark:hover:bg-gray-500 transition text-sm shadow-sm">
                            <i class="fas fa-sun dark:hidden"></i>
                            <i class="fas fa-moon hidden dark:inline-block"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <section aria-labelledby="project-info-heading" class="mb-8 no-print animate-fade-in">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 transition-all duration-300">
                <div class="flex justify-between items-center mb-4">
                    <h2 id="project-info-heading" class="text-xl font-semibold text-gray-800 dark:text-gray-200 flex items-center">
                        <i class="fas fa-clipboard-list mr-2 text-blue-600 dark:text-blue-400"></i>
                        Project Information
                    </h2>
                    <button id="btn-edit-project" class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 text-sm font-medium inline-flex items-center gap-1">
                        <i class="fas fa-edit"></i>Edit
                        <span class="kbd">E</span>
                    </button>
                </div>
                <dl class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-x-6 gap-y-4">
                    <div class="bg-gray-50 dark:bg-gray-700 p-3 rounded-lg transition-all duration-300">
                        <dt class="text-sm text-gray-500 dark:text-gray-400 mb-1 flex items-center">
                            <i class="fas fa-project-diagram mr-1 text-blue-500 dark:text-blue-400"></i>
                            Project Name
                        </dt>
                        <dd id="project-name" class="font-medium text-gray-900 dark:text-gray-100 break-words"></dd>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-700 p-3 rounded-lg transition-all duration-300">
                        <dt class="text-sm text-gray-500 dark:text-gray-400 mb-1 flex items-center">
                            <i class="fas fa-crosshairs mr-1 text-blue-500 dark:text-blue-400"></i>
                            API Target
                        </dt>
                        <dd id="project-target" class="font-medium text-gray-900 dark:text-gray-100 break-words"></dd>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-700 p-3 rounded-lg transition-all duration-300">
                        <dt class="text-sm text-gray-500 dark:text-gray-400 mb-1 flex items-center">
                            <i class="fas fa-calendar-alt mr-1 text-blue-500 dark:text-blue-400"></i>
                            Start Date
                        </dt>
                        <dd id="project-date" class="font-medium text-gray-900 dark:text-gray-100"></dd>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-700 p-3 rounded-lg transition-all duration-300">
                        <dt class="text-sm text-gray-500 dark:text-gray-400 mb-1 flex items-center">
                            <i class="fas fa-user-shield mr-1 text-blue-500 dark:text-blue-400"></i>
                            Tester
                        </dt>
                        <dd id="project-tester" class="font-medium text-gray-900 dark:text-gray-100 break-words"></dd>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-700 p-3 rounded-lg transition-all duration-300 sm:col-span-1 lg:col-span-1">
                        <dt class="text-sm text-gray-500 dark:text-gray-400 mb-1 flex items-center">
                            <i class="fas fa-bullseye mr-1 text-blue-500 dark:text-blue-400"></i>
                            Scope
                        </dt>
                        <dd id="project-scope" class="font-medium text-gray-900 dark:text-gray-100 break-words"></dd>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-700 p-3 rounded-lg transition-all duration-300">
                        <dt class="text-sm text-gray-500 dark:text-gray-400 mb-1 flex items-center">
                            <i class="fas fa-history mr-1 text-blue-500 dark:text-blue-400"></i>
                            Last Updated
                        </dt>
                        <dd id="project-updated" class="font-medium text-gray-900 dark:text-gray-100"></dd>
                    </div>
                </dl>
            </div>




        </section>
































































<!-- OWASP API Security Overview Section - Add this as the first main section -->
<section aria-labelledby="owasp-overview-heading" class="mb-8 no-print animate-fade-in">
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 transition-all duration-300">
        <div class="flex justify-between items-center mb-4">
            <h2 id="owasp-overview-heading" class="text-xl font-semibold text-gray-800 dark:text-gray-200 flex items-center">
                <i class="fas fa-shield-alt mr-2 text-blue-600 dark:text-blue-400"></i>
                OWASP API Security Framework
            </h2>
            <button id="btn-expand-owasp" class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 text-sm font-medium inline-flex items-center gap-1">
                <i class="fas fa-expand-alt"></i>Expand All
                <span class="kbd">O</span>
            </button>
        </div>

        <!-- Overview cards grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
            <!-- About OWASP Card -->
            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/30 dark:to-indigo-900/30 rounded-lg overflow-hidden shadow-sm border border-blue-100 dark:border-blue-900 transition-all duration-300 hover:shadow-md">
                <div class="p-5">
                    <h3 class="text-lg font-semibold text-blue-800 dark:text-blue-300 mb-3 flex items-center">
                        <i class="fas fa-info-circle mr-2 text-blue-600 dark:text-blue-400"></i>About OWASP
                    </h3>
                    <p class="text-gray-700 dark:text-gray-300 text-sm mb-4">
                        The <strong>Open Web Application Security Project® (OWASP)</strong> is a nonprofit foundation dedicated to improving software security. Through community-led projects, hundreds of chapters worldwide, tens of thousands of members, and leading educational and training conferences, the OWASP Foundation is the source for developers and technologists to secure the web.
                    </p>
                    <div class="flex justify-between items-center">
                        <a href="https://owasp.org/" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-sm inline-flex items-center gap-1">
                            Visit OWASP <i class="fas fa-external-link-alt text-xs"></i>
                        </a>
                        <span class="text-gray-500 dark:text-gray-400 text-xs">Est. 2001</span>
                    </div>
                </div>
            </div>

            <!-- API Security Top 10 Card -->
            <div class="bg-gradient-to-br from-emerald-50 to-teal-50 dark:from-emerald-900/30 dark:to-teal-900/30 rounded-lg overflow-hidden shadow-sm border border-emerald-100 dark:border-emerald-900 transition-all duration-300 hover:shadow-md">
                <div class="p-5">
                    <h3 class="text-lg font-semibold text-emerald-800 dark:text-emerald-300 mb-3 flex items-center">
                        <i class="fas fa-list-ol mr-2 text-emerald-600 dark:text-emerald-400"></i>API Security Top 10
                    </h3>
                    <p class="text-gray-700 dark:text-gray-300 text-sm mb-4">
                        The <strong>OWASP API Security Top 10</strong> identifies the most critical security risks to API implementations. Updated in 2023, this list helps organizations build and maintain secure APIs by focusing on the most impactful vulnerabilities currently affecting the API ecosystem.
                    </p>
                    <div class="flex justify-between items-center">
                        <a href="https://owasp.org/API-Security/editions/2023/en/0x00-toc/" target="_blank" rel="noopener noreferrer" class="text-emerald-600 dark:text-emerald-400 hover:underline text-sm inline-flex items-center gap-1">
                            Read Top 10 <i class="fas fa-external-link-alt text-xs"></i>
                        </a>
                        <span class="text-gray-500 dark:text-gray-400 text-xs">Updated 2023</span>
                    </div>
                </div>
            </div>

            <!-- About This Tool Card -->
            <div class="bg-gradient-to-br from-purple-50 to-fuchsia-50 dark:from-purple-900/30 dark:to-fuchsia-900/30 rounded-lg overflow-hidden shadow-sm border border-purple-100 dark:border-purple-900 transition-all duration-300 hover:shadow-md">
                <div class="p-5">
                    <h3 class="text-lg font-semibold text-purple-800 dark:text-purple-300 mb-3 flex items-center">
                        <i class="fas fa-tools mr-2 text-purple-600 dark:text-purple-400"></i>About This Tool
                    </h3>
                    <p class="text-gray-700 dark:text-gray-300 text-sm mb-4">
                        This <strong>API Security Testing Checklist</strong> provides a structured approach to evaluating API security based on the OWASP Top 10. Track your testing progress, document findings, take notes, and generate comprehensive reports—all in one interactive tool that runs entirely in your browser.
                    </p>
                    <div class="flex justify-between items-center">
                        <button id="btn-take-tour" class="text-purple-600 dark:text-purple-400 hover:underline text-sm inline-flex items-center gap-1">
                            Take Tour <i class="fas fa-route text-xs"></i>
                        </button>
                        <span class="text-gray-500 dark:text-gray-400 text-xs">Local Storage Only</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Collapsible Sections -->
        <div class="space-y-4">
            <!-- OWASP API Security Top 10 Accordion -->
            <div class="border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden transition-all duration-300 shadow-sm">
                <button class="w-full px-6 py-4 text-left bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 transition-all duration-300 flex justify-between items-center" id="accordion-top10-header">
                    <span class="font-medium text-gray-800 dark:text-gray-200 flex items-center">
                        <i class="fas fa-shield-virus mr-2 text-blue-600 dark:text-blue-400"></i>OWASP API Security Top 10 (2023)
                    </span>
                    <i class="fas fa-chevron-down text-gray-500 dark:text-gray-400 transform transition-transform duration-300"></i>
                </button>
                <div class="hidden overflow-hidden transition-all duration-300 bg-white dark:bg-gray-800 p-6" id="accordion-top10-content">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                        <div class="flex gap-3">
                            <div class="flex-shrink-0 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 rounded-lg h-10 w-10 flex items-center justify-center">
                                <i class="fas fa-user-lock"></i>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-900 dark:text-gray-100">API1:2023 Broken Object Level Authorization</h4>
                                <p class="text-gray-600 dark:text-gray-400 text-sm">APIs exposing endpoints that handle object identifiers, creating wide attack surfaces.</p>
                            </div>
                        </div>
                        
                        <div class="flex gap-3">
                            <div class="flex-shrink-0 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 rounded-lg h-10 w-10 flex items-center justify-center">
                                <i class="fas fa-key"></i>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-900 dark:text-gray-100">API2:2023 Broken Authentication</h4>
                                <p class="text-gray-600 dark:text-gray-400 text-sm">Flawed implementations allowing attackers to compromise authentication mechanisms.</p>
                            </div>
                        </div>
                        
                        <div class="flex gap-3">
                            <div class="flex-shrink-0 bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 rounded-lg h-10 w-10 flex items-center justify-center">
                                <i class="fas fa-file-shield"></i>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-900 dark:text-gray-100">API3:2023 Broken Object Property Level Authorization</h4>
                                <p class="text-gray-600 dark:text-gray-400 text-sm">Improperly protected sensitive object properties leading to data exposure.</p>
                            </div>
                        </div>
                        
                        <div class="flex gap-3">
                            <div class="flex-shrink-0 bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 rounded-lg h-10 w-10 flex items-center justify-center">
                                <i class="fas fa-memory"></i>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-900 dark:text-gray-100">API4:2023 Unrestricted Resource Consumption</h4>
                                <p class="text-gray-600 dark:text-gray-400 text-sm">Lack of resource limitations enabling denial-of-service attacks or increased costs.</p>
                            </div>
                        </div>
                        
                        <div class="flex gap-3">
                            <div class="flex-shrink-0 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 rounded-lg h-10 w-10 flex items-center justify-center">
                                <i class="fas fa-lock"></i>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-900 dark:text-gray-100">API5:2023 Broken Function Level Authorization</h4>
                                <p class="text-gray-600 dark:text-gray-400 text-sm">Complex access control policies with permissions gaps enabling unauthorized access.</p>
                            </div>
                        </div>
                        
                        <div class="flex gap-3">
                            <div class="flex-shrink-0 bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 rounded-lg h-10 w-10 flex items-center justify-center">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-900 dark:text-gray-100">API6:2023 Unrestricted Access to Business Flows</h4>
                                <p class="text-gray-600 dark:text-gray-400 text-sm">Exposed business flows allowing attackers to abuse critical functionality.</p>
                            </div>
                        </div>
                        
                        <div class="flex gap-3">
                            <div class="flex-shrink-0 bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 rounded-lg h-10 w-10 flex items-center justify-center">
                                <i class="fas fa-server"></i>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-900 dark:text-gray-100">API7:2023 Server-Side Request Forgery</h4>
                                <p class="text-gray-600 dark:text-gray-400 text-sm">APIs fetching remote resources without validation, enabling malicious requests.</p>
                            </div>
                        </div>
                        
                        <div class="flex gap-3">
                            <div class="flex-shrink-0 bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 rounded-lg h-10 w-10 flex items-center justify-center">
                                <i class="fas fa-cogs"></i>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-900 dark:text-gray-100">API8:2023 Security Misconfiguration</h4>
                                <p class="text-gray-600 dark:text-gray-400 text-sm">Improper configuration of APIs or supporting systems introducing vulnerabilities.</p>
                            </div>
                        </div>
                        
                        <div class="flex gap-3">
                            <div class="flex-shrink-0 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300 rounded-lg h-10 w-10 flex items-center justify-center">
                                <i class="fas fa-clipboard-list"></i>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-900 dark:text-gray-100">API9:2023 Improper Inventory Management</h4>
                                <p class="text-gray-600 dark:text-gray-400 text-sm">Inadequate API documentation and versioning leading to exposed vulnerabilities.</p>
                            </div>
                        </div>
                        
                        <div class="flex gap-3">
                            <div class="flex-shrink-0 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300 rounded-lg h-10 w-10 flex items-center justify-center">
                                <i class="fas fa-cloud-download-alt"></i>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-900 dark:text-gray-100">API10:2023 Unsafe Consumption of APIs</h4>
                                <p class="text-gray-600 dark:text-gray-400 text-sm">Lack of response validation when consuming third-party APIs, introducing vulnerabilities.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Testing Methodology Accordion -->
            <div class="border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden transition-all duration-300 shadow-sm">
                <button class="w-full px-6 py-4 text-left bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 transition-all duration-300 flex justify-between items-center" id="accordion-methodology-header">
                    <span class="font-medium text-gray-800 dark:text-gray-200 flex items-center">
                        <i class="fas fa-microscope mr-2 text-green-600 dark:text-green-400"></i>API Security Testing Methodology
                    </span>
                    <i class="fas fa-chevron-down text-gray-500 dark:text-gray-400 transform transition-transform duration-300"></i>
                </button>
                <div class="hidden overflow-hidden transition-all duration-300 bg-white dark:bg-gray-800 p-6" id="accordion-methodology-content">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-5 border border-gray-200 dark:border-gray-600">
                            <h4 class="font-medium text-gray-900 dark:text-gray-100 mb-3 flex items-center">
                                <div class="bg-green-100 dark:bg-green-900/50 text-green-700 dark:text-green-300 rounded-full h-7 w-7 flex items-center justify-center mr-2">1</div>
                                Discovery Phase
                            </h4>
                            <ul class="space-y-2 text-gray-600 dark:text-gray-400 text-sm">
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check-circle text-green-500 mt-0.5 flex-shrink-0"></i>
                                    <span>Map all API endpoints and parameters</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check-circle text-green-500 mt-0.5 flex-shrink-0"></i>
                                    <span>Document authentication mechanisms</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check-circle text-green-500 mt-0.5 flex-shrink-0"></i>
                                    <span>Identify data types and structures</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check-circle text-green-500 mt-0.5 flex-shrink-0"></i>
                                    <span>Analyze API documentation and specifications</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check-circle text-green-500 mt-0.5 flex-shrink-0"></i>
                                    <span>Identify business flows and critical functionality</span>
                                </li>
                            </ul>
                        </div>
                        
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-5 border border-gray-200 dark:border-gray-600">
                            <h4 class="font-medium text-gray-900 dark:text-gray-100 mb-3 flex items-center">
                                <div class="bg-green-100 dark:bg-green-900/50 text-green-700 dark:text-green-300 rounded-full h-7 w-7 flex items-center justify-center mr-2">2</div>
                                Analysis Phase
                            </h4>
                            <ul class="space-y-2 text-gray-600 dark:text-gray-400 text-sm">
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check-circle text-green-500 mt-0.5 flex-shrink-0"></i>
                                    <span>Test authorization controls for all objects and functions</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check-circle text-green-500 mt-0.5 flex-shrink-0"></i>
                                    <span>Evaluate authentication mechanisms and token handling</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check-circle text-green-500 mt-0.5 flex-shrink-0"></i>
                                    <span>Check for rate limiting and resource consumption controls</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check-circle text-green-500 mt-0.5 flex-shrink-0"></i>
                                    <span>Test for business logic flaws in API workflows</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check-circle text-green-500 mt-0.5 flex-shrink-0"></i>
                                    <span>Evaluate input handling and validation mechanisms</span>
                                </li>
                            </ul>
                        </div>
                        
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-5 border border-gray-200 dark:border-gray-600">
                            <h4 class="font-medium text-gray-900 dark:text-gray-100 mb-3 flex items-center">
                                <div class="bg-green-100 dark:bg-green-900/50 text-green-700 dark:text-green-300 rounded-full h-7 w-7 flex items-center justify-center mr-2">3</div>
                                Reporting Phase
                            </h4>
                            <ul class="space-y-2 text-gray-600 dark:text-gray-400 text-sm">
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check-circle text-green-500 mt-0.5 flex-shrink-0"></i>
                                    <span>Document all identified vulnerabilities with clear evidence</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check-circle text-green-500 mt-0.5 flex-shrink-0"></i>
                                    <span>Assess risk levels based on impact and exploitability</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check-circle text-green-500 mt-0.5 flex-shrink-0"></i>
                                    <span>Provide clear remediation steps for each finding</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check-circle text-green-500 mt-0.5 flex-shrink-0"></i>
                                    <span>Prioritize fixes based on security risk assessment</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-check-circle text-green-500 mt-0.5 flex-shrink-0"></i>
                                    <span>Create executive summary with actionable insights</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Best Practices Accordion -->
            <div class="border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden transition-all duration-300 shadow-sm">
                <button class="w-full px-6 py-4 text-left bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 transition-all duration-300 flex justify-between items-center" id="accordion-practices-header">
                    <span class="font-medium text-gray-800 dark:text-gray-200 flex items-center">
                        <i class="fas fa-check-double mr-2 text-indigo-600 dark:text-indigo-400"></i>API Security Best Practices
                    </span>
                    <i class="fas fa-chevron-down text-gray-500 dark:text-gray-400 transform transition-transform duration-300"></i>
                </button>
                <div class="hidden overflow-hidden transition-all duration-300 bg-white dark:bg-gray-800 p-6" id="accordion-practices-content">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-medium text-gray-900 dark:text-gray-100 mb-3 flex items-center">
                                <i class="fas fa-shield-alt text-indigo-600 dark:text-indigo-400 mr-2"></i>Authentication & Authorization
                            </h4>
                            <ul class="space-y-2 text-gray-600 dark:text-gray-400 text-sm pl-5 list-disc">
                                <li>Use industry-standard protocols like OAuth 2.0 and OpenID Connect</li>
                                <li>Implement strong, layered authorization (RBAC, ABAC)</li>
                                <li>Enforce proper token validation and secure handling</li>
                                <li>Implement short token lifetimes and secure renewal mechanisms</li>
                                <li>Use strong, adaptive authentication with MFA where appropriate</li>
                            </ul>
                        </div>
                        
                        <div>
                            <h4 class="font-medium text-gray-900 dark:text-gray-100 mb-3 flex items-center">
                                <i class="fas fa-filter text-indigo-600 dark:text-indigo-400 mr-2"></i>Input Validation & Output Encoding
                            </h4>
                            <ul class="space-y-2 text-gray-600 dark:text-gray-400 text-sm pl-5 list-disc">
                                <li>Validate all input parameters (type, format, length, range)</li>
                                <li>Implement schema validation for API requests and responses</li>
                                <li>Use allowlists rather than denylists for validation</li>
                                <li>Sanitize and encode data before using in different contexts</li>
                                <li>Validate content types and encoding in both directions</li>
                            </ul>
                        </div>
                        
                        <div>
                            <h4 class="font-medium text-gray-900 dark:text-gray-100 mb-3 flex items-center">
                                <i class="fas fa-tachometer-alt text-indigo-600 dark:text-indigo-400 mr-2"></i>Rate Limiting & Resource Management
                            </h4>
                            <ul class="space-y-2 text-gray-600 dark:text-gray-400 text-sm pl-5 list-disc">
                                <li>Implement rate limiting on all API endpoints</li>
                                <li>Set reasonable defaults for pagination and result limits</li>
                                <li>Apply timeouts for long-running operations</li>
                                <li>Monitor and alert on abnormal API usage patterns</li>
                                <li>Implement circuit breakers for failing dependencies</li>
                            </ul>
                        </div>
                        
                        <div>
                            <h4 class="font-medium text-gray-900 dark:text-gray-100 mb-3 flex items-center">
                                <i class="fas fa-cog text-indigo-600 dark:text-indigo-400 mr-2"></i>Security Infrastructure
                            </h4>
                            <ul class="space-y-2 text-gray-600 dark:text-gray-400 text-sm pl-5 list-disc">
                                <li>Use TLS 1.2+ with strong cipher configurations</li>
                                <li>Implement proper security headers (CORS, CSP, etc.)</li>
                                <li>Deploy a Web Application Firewall for API protection</li>
                                <li>Implement robust logging and monitoring systems</li>
                                <li>Regularly update and patch all API dependencies</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>// --- OWASP Overview Section functionality ---
document.addEventListener('DOMContentLoaded', function() {
    // Set up accordion functionality
    setupAccordion('accordion-top10-header', 'accordion-top10-content');
    setupAccordion('accordion-methodology-header', 'accordion-methodology-content');
    setupAccordion('accordion-practices-header', 'accordion-practices-content');
    
    // Expand All button
    document.getElementById('btn-expand-owasp')?.addEventListener('click', function() {
        const button = this;
        const isExpanded = button.innerHTML.includes('Collapse');
        
        // Toggle all accordions
        const accordions = [
            'accordion-top10-content',
            'accordion-methodology-content',
            'accordion-practices-content'
        ];
        
        accordions.forEach(id => {
            const content = document.getElementById(id);
            const header = document.getElementById(id.replace('content', 'header'));
            const icon = header.querySelector('i.fa-chevron-down');
            
            if (isExpanded) {
                // Collapse all
                content.classList.add('hidden');
                icon.classList.remove('rotate-180');
            } else {
                // Expand all
                content.classList.remove('hidden');
                icon.classList.add('rotate-180');
            }
        });
        
        // Update button text
        if (isExpanded) {
            button.innerHTML = '<i class="fas fa-expand-alt"></i>Expand All<span class="kbd">O</span>';
        } else {
            button.innerHTML = '<i class="fas fa-compress-alt"></i>Collapse All<span class="kbd">O</span>';
        }
    });
    
    // Add Take Tour button functionality
    document.getElementById('btn-take-tour')?.addEventListener('click', function() {
        // If you have a tour function, call it here
        showToast('Tour feature coming soon!', 'info');
    });
    
    // Add keyboard shortcut for expand/collapse
    document.addEventListener('keydown', function(e) {
        // Don't trigger in inputs or textareas
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
        
        if (e.key === 'o' || e.key === 'O') {
            document.getElementById('btn-expand-owasp')?.click();
            e.preventDefault();
        }
    });
});

function setupAccordion(headerId, contentId) {
    const header = document.getElementById(headerId);
    const content = document.getElementById(contentId);
    
    if (!header || !content) return;
    
    header.addEventListener('click', function() {
        // Toggle content visibility
        content.classList.toggle('hidden');
        
        // Animate the chevron icon
        const icon = this.querySelector('i.fa-chevron-down');
        icon.classList.toggle('rotate-180');
        
        // Add activity tracking
        const isExpanded = !content.classList.contains('hidden');
        const sectionName = this.querySelector('span').textContent.trim();
        if (typeof addActivity === 'function') {
            addActivity(`${isExpanded ? 'Expanded' : 'Collapsed'} section: ${sectionName}`);
        }
    });
}</script>















        <section aria-labelledby="intro-heading" class="mb-8 no-print animate-fade-in" style="animation-delay: 0.1s;">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 transition-all duration-300">
                <h2 id="intro-heading" class="text-xl font-semibold text-gray-800 dark:text-gray-200 mb-3 flex items-center">
                    <i class="fas fa-info-circle mr-2 text-blue-600 dark:text-blue-400"></i>
                    OWASP API Security Testing Checklist
                </h2>
                <div class="flex flex-col md:flex-row gap-6">
                    <div class="md:w-3/4">
                        <p class="text-gray-600 dark:text-gray-300 mb-3">
                            This interactive tool helps track progress against the OWASP API Security Top 10 (2023). It covers essential testing areas for finding and mitigating API security vulnerabilities.
                        </p>
                        <p class="text-gray-600 dark:text-gray-300 mb-4">
                            Use the cards below to navigate categories, track completed tests, manage findings, and take notes. Data is saved locally in your browser.
                        </p>
                        <div class="flex flex-wrap gap-x-4 gap-y-2">
                            <span class="inline-flex items-center gap-1.5 rounded-full px-2 py-1 text-xs font-medium risk-critical"><span class="h-1.5 w-1.5 rounded-full bg-red-700"></span>Critical</span>
                            <span class="inline-flex items-center gap-1.5 rounded-full px-2 py-1 text-xs font-medium risk-high"><span class="h-1.5 w-1.5 rounded-full bg-orange-700"></span>High</span>
                            <span class="inline-flex items-center gap-1.5 rounded-full px-2 py-1 text-xs font-medium risk-medium"><span class="h-1.5 w-1.5 rounded-full bg-yellow-700"></span>Medium</span>
                            <span class="inline-flex items-center gap-1.5 rounded-full px-2 py-1 text-xs font-medium risk-low"><span class="h-1.5 w-1.5 rounded-full bg-green-700"></span>Low</span>
                        </div>
                    </div>
                    <div class="md:w-1/4 flex flex-col justify-center">
                        <div class="bg-blue-50 dark:bg-blue-900/30 rounded-lg p-4 border border-blue-200 dark:border-blue-800">
                            <h3 class="font-semibold text-blue-800 dark:text-blue-300 text-sm mb-2 flex items-center">
                                <i class="fas fa-keyboard mr-1"></i> Keyboard Shortcuts
                            </h3>
                            <ul class="text-sm text-blue-700 dark:text-blue-400 space-y-1">
                                <li><span class="kbd">P</span> Open Projects</li>
                                <li><span class="kbd">E</span> Edit Project Details</li>
                                <li><span class="kbd">F</span> Add Finding</li>
                                <li><span class="kbd">T</span> Toggle Dark Mode</li>
                                <li><span class="kbd">?</span> Launch Tour</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section aria-labelledby="progress-heading" class="mb-8 no-print animate-fade-in" style="animation-delay: 0.2s;">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 transition-all duration-300">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-3">
                    <h2 id="progress-heading" class="text-xl font-semibold text-gray-800 dark:text-gray-200 flex items-center">
                        <i class="fas fa-chart-pie mr-2 text-blue-600 dark:text-blue-400"></i>
                        Testing Progress
                    </h2>
                    <div class="flex gap-3">
                        <button id="btn-sort-priority" class="bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-2.5 py-1.5 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 transition text-xs shadow-sm inline-flex items-center gap-1">
                            <i class="fas fa-sort-amount-down"></i>
                            Sort by Priority
                        </button>
                        <button id="btn-sort-progress" class="bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-2.5 py-1.5 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 transition text-xs shadow-sm inline-flex items-center gap-1">
                            <i class="fas fa-sort-amount-up"></i>
                            Sort by Progress
                        </button>
                    </div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <div class="bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-800 rounded-lg p-4 transition-all duration-300">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-sm font-semibold text-blue-800 dark:text-blue-300">Overall Progress</h3>
                            <span id="overall-progress" class="text-sm text-blue-800 dark:text-blue-300 font-bold">0%</span>
                        </div>
                        <div class="w-full bg-blue-100 dark:bg-blue-900 rounded-full h-2.5">
                            <div id="overall-progress-bar" class="bg-blue-600 dark:bg-blue-500 h-2.5 rounded-full transition-all duration-1000 ease-in-out" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-lg p-4 transition-all duration-300">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-sm font-semibold text-red-800 dark:text-red-300">Critical Items</h3>
                            <span id="critical-progress" class="text-sm text-red-800 dark:text-red-300 font-bold">0/0</span>
                        </div>
                        <div class="w-full bg-red-100 dark:bg-red-900 rounded-full h-2.5">
                            <div id="critical-progress-bar" class="bg-red-600 dark:bg-red-500 h-2.5 rounded-full transition-all duration-1000 ease-in-out" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="bg-orange-50 dark:bg-orange-900/30 border border-orange-200 dark:border-orange-800 rounded-lg p-4 transition-all duration-300">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-sm font-semibold text-orange-800 dark:text-orange-300">High Priority</h3>
                            <span id="high-progress" class="text-sm text-orange-800 dark:text-orange-300 font-bold">0/0</span>
                        </div>
                        <div class="w-full bg-orange-100 dark:bg-orange-900 rounded-full h-2.5">
                            <div id="high-progress-bar" class="bg-orange-500 dark:bg-orange-500 h-2.5 rounded-full transition-all duration-1000 ease-in-out" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4 transition-all duration-300">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-sm font-semibold text-yellow-800 dark:text-yellow-300">Medium Priority</h3>
                            <span id="medium-progress" class="text-sm text-yellow-800 dark:text-yellow-300 font-bold">0/0</span>
                        </div>
                        <div class="w-full bg-yellow-100 dark:bg-yellow-900 rounded-full h-2.5">
                            <div id="medium-progress-bar" class="bg-yellow-500 dark:bg-yellow-400 h-2.5 rounded-full transition-all duration-1000 ease-in-out" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                
                <div class="flex flex-col md:flex-row gap-6">
                    <div class="md:w-2/3">
                        <canvas id="progress-chart" height="200"></canvas>
                    </div>
                    <div class="md:w-1/3">
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-3 mb-3 transition-all duration-300">
                            <h3 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Recent Activity</h3>
                            <ul id="recent-activity" class="text-xs text-gray-600 dark:text-gray-400 space-y-2">
                                <li class="flex items-start gap-2">
                                    <span class="text-blue-500 mt-0.5"><i class="fas fa-clock"></i></span>
                                    <span>Project loaded</span>
                                </li>
                            </ul>
                        </div>
                        <div class="bg-indigo-50 dark:bg-indigo-900/30 border border-indigo-200 dark:border-indigo-800 rounded-lg p-3 transition-all duration-300">
                            <h3 class="text-sm font-medium text-indigo-700 dark:text-indigo-300 mb-2">Completion Estimate</h3>
                            <div id="completion-estimate" class="text-sm text-indigo-600 dark:text-indigo-400">
                                Based on your current pace, you'll complete all critical items in <strong>2 days</strong>.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section aria-label="Testing Categories" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12 no-print animate-fade-in" id="category-grid" style="animation-delay: 0.3s;">
            <!-- Category 1: Broken Object Level Authorization -->
            <div class="category-card bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden cursor-pointer transition-all duration-300" data-category="broken-object-level-auth">
                <div class="risk-critical px-4 py-1 text-center text-xs font-bold uppercase tracking-wider">Critical Priority</div>
                <div class="p-5">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center">
                            <div class="bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded-full h-10 w-10 flex items-center justify-center mr-3 flex-shrink-0">
                                <i class="fas fa-user-lock"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 leading-tight">API1:2023 Broken Object Level Authorization</h3>
                        </div>
                        <div class="circular-progress" id="broken-object-level-auth-progress-circle" style="--progress-color: #ef4444; --progress-percent: 0%;">0%</div>
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4 line-clamp-2">APIs tend to expose endpoints that handle object identifiers, creating a wide attack surface of Object Level Access Control issues.</p>
                    <div class="flex justify-between items-center text-sm">
                        <span id="broken-object-level-auth-progress" class="text-gray-500 dark:text-gray-400">0% complete</span>
                        <span class="font-medium text-blue-600 dark:text-blue-400 group-hover:text-blue-800 inline-flex items-center">View tests <i class="fas fa-arrow-right ml-1 text-xs"></i></span>
                    </div>
                    <div class="mt-3 grid grid-cols-3 gap-1">
                        <div class="bg-gray-100 dark:bg-gray-700 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-red-500 h-full" style="width: 0%"></div>
                        </div>
                        <div class="bg-gray-100 dark:bg-gray-700 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-yellow-500 h-full" style="width: 0%"></div>
                        </div>
                        <div class="bg-gray-100 dark:bg-gray-700 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-green-500 h-full" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Category 2: Broken Authentication -->
            <div class="category-card bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden cursor-pointer transition-all duration-300" data-category="broken-authentication">
                <div class="risk-critical px-4 py-1 text-center text-xs font-bold uppercase tracking-wider">Critical Priority</div>
                <div class="p-5">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center">
                            <div class="bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded-full h-10 w-10 flex items-center justify-center mr-3 flex-shrink-0">
                                <i class="fas fa-key"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 leading-tight">API2:2023 Broken Authentication</h3>
                        </div>
                        <div class="circular-progress" id="broken-authentication-progress-circle" style="--progress-color: #ef4444; --progress-percent: 0%;">0%</div>
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4 line-clamp-2">Authentication mechanisms are often implemented incorrectly, allowing attackers to compromise tokens or exploit implementation flaws.</p>
                    <div class="flex justify-between items-center text-sm">
                        <span id="broken-authentication-progress" class="text-gray-500 dark:text-gray-400">0% complete</span>
                        <span class="font-medium text-blue-600 dark:text-blue-400 group-hover:text-blue-800 inline-flex items-center">View tests <i class="fas fa-arrow-right ml-1 text-xs"></i></span>
                    </div>
                    <div class="mt-3 grid grid-cols-3 gap-1">
                        <div class="bg-gray-100 dark:bg-gray-700 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-red-500 h-full" style="width: 0%"></div>
                        </div>
                        <div class="bg-gray-100 dark:bg-gray-700 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-yellow-500 h-full" style="width: 0%"></div>
                        </div>
                        <div class="bg-gray-100 dark:bg-gray-700 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-green-500 h-full" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Category 3: Broken Object Property Level Authorization -->
            <div class="category-card bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden cursor-pointer transition-all duration-300" data-category="broken-object-property-level-auth">
                <div class="risk-high px-4 py-1 text-center text-xs font-bold uppercase tracking-wider">High Priority</div>
                <div class="p-5">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center">
                            <div class="bg-orange-100 dark:bg-orange-900 text-orange-700 dark:text-orange-300 rounded-full h-10 w-10 flex items-center justify-center mr-3 flex-shrink-0">
                                <i class="fas fa-file-shield"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 leading-tight">API3:2023 Broken Object Property Level Authorization</h3>
                        </div>
                        <div class="circular-progress" id="broken-object-property-level-auth-progress-circle" style="--progress-color: #f97316; --progress-percent: 0%;">0%</div>
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4 line-clamp-2">APIs don't properly protect sensitive object properties, leading to information disclosure or manipulation.</p>
                    <div class="flex justify-between items-center text-sm">
                        <span id="broken-object-property-level-auth-progress" class="text-gray-500 dark:text-gray-400">0% complete</span>
                        <span class="font-medium text-blue-600 dark:text-blue-400 group-hover:text-blue-800 inline-flex items-center">View tests <i class="fas fa-arrow-right ml-1 text-xs"></i></span>
                    </div>
                    <div class="mt-3 grid grid-cols-3 gap-1">
                        <div class="bg-gray-100 dark:bg-gray-700 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-red-500 h-full" style="width: 0%"></div>
                        </div>
                        <div class="bg-gray-100 dark:bg-gray-700 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-yellow-500 h-full" style="width: 0%"></div>
                        </div>
                        <div class="bg-gray-100 dark:bg-gray-700 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-green-500 h-full" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Category 4: Unrestricted Resource Consumption -->
            <div class="category-card bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden cursor-pointer transition-all duration-300" data-category="unrestricted-resource-consumption">
                <div class="risk-high px-4 py-1 text-center text-xs font-bold uppercase tracking-wider">High Priority</div>
                <div class="p-5">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center">
                            <div class="bg-orange-100 dark:bg-orange-900 text-orange-700 dark:text-orange-300 rounded-full h-10 w-10 flex items-center justify-center mr-3 flex-shrink-0">
                                <i class="fas fa-memory"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 leading-tight">API4:2023 Unrestricted Resource Consumption</h3>
                        </div>
                        <div class="circular-progress" id="unrestricted-resource-consumption-progress-circle" style="--progress-color: #f97316; --progress-percent: 0%;">0%</div>
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4 line-clamp-2">APIs not properly limiting resource consumption can lead to DoS attacks or increased operational costs.</p>
                    <div class="flex justify-between items-center text-sm">
                        <span id="unrestricted-resource-consumption-progress" class="text-gray-500 dark:text-gray-400">0% complete</span>
                        <span class="font-medium text-blue-600 dark:text-blue-400 group-hover:text-blue-800 inline-flex items-center">View tests <i class="fas fa-arrow-right ml-1 text-xs"></i></span>
                    </div>
                    <div class="mt-3 grid grid-cols-3 gap-1">
                        <div class="bg-gray-100 dark:bg-gray-700 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-red-500 h-full" style="width: 0%"></div>
                        </div>
                        <div class="bg-gray-100 dark:bg-gray-700 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-yellow-500 h-full" style="width: 0%"></div>
                        </div>
                        <div class="bg-gray-100 dark:bg-gray-700 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-green-500 h-full" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Category 5: Broken Function Level Authorization -->
            <div class="category-card bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden cursor-pointer transition-all duration-300" data-category="broken-function-level-auth">
                <div class="risk-critical px-4 py-1 text-center text-xs font-bold uppercase tracking-wider">Critical Priority</div>
                <div class="p-5">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center">
                            <div class="bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded-full h-10 w-10 flex items-center justify-center mr-3 flex-shrink-0">
                                <i class="fas fa-lock"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 leading-tight">API5:2023 Broken Function Level Authorization</h3>
                        </div>
                        <div class="circular-progress" id="broken-function-level-auth-progress-circle" style="--progress-color: #ef4444; --progress-percent: 0%;">0%</div>
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4 line-clamp-2">Complex access control policies with unclear permissions can lead to unauthorized access to admin functions.</p>
                    <div class="flex justify-between items-center text-sm">
                        <span id="broken-function-level-auth-progress" class="text-gray-500 dark:text-gray-400">0% complete</span>
                        <span class="font-medium text-blue-600 dark:text-blue-400 group-hover:text-blue-800 inline-flex items-center">View tests <i class="fas fa-arrow-right ml-1 text-xs"></i></span>
                    </div>
                    <div class="mt-3 grid grid-cols-3 gap-1">
                        <div class="bg-gray-100 dark:bg-gray-700 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-red-500 h-full" style="width: 0%"></div>
                        </div>
                        <div class="bg-gray-100 dark:bg-gray-700 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-yellow-500 h-full" style="width: 0%"></div>
                        </div>
                        <div class="bg-gray-100 dark:bg-gray-700 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-green-500 h-full" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Category 6: Unrestricted Access to Sensitive Business Flows -->
            <div class="category-card bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden cursor-pointer transition-all duration-300" data-category="unrestricted-access-to-business-flows">
                <div class="risk-high px-4 py-1 text-center text-xs font-bold uppercase tracking-wider">High Priority</div>
                <div class="p-5">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center">
                            <div class="bg-orange-100 dark:bg-orange-900 text-orange-700 dark:text-orange-300 rounded-full h-10 w-10 flex items-center justify-center mr-3 flex-shrink-0">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 leading-tight">API6:2023 Unrestricted Access to Business Flows</h3>
                        </div>
                        <div class="circular-progress" id="unrestricted-access-to-business-flows-progress-circle" style="--progress-color: #f97316; --progress-percent: 0%;">0%</div>
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4 line-clamp-2">APIs exposing business flows without proper protection enable attackers to abuse functionality or perform actions repeatedly.</p>
                    <div class="flex justify-between items-center text-sm">
                        <span id="unrestricted-access-to-business-flows-progress" class="text-gray-500 dark:text-gray-400">0% complete</span>
                        <span class="font-medium text-blue-600 dark:text-blue-400 group-hover:text-blue-800 inline-flex items-center">View tests <i class="fas fa-arrow-right ml-1 text-xs"></i></span>
                    </div>
                    <div class="mt-3 grid grid-cols-3 gap-1">
                        <div class="bg-gray-100 dark:bg-gray-700 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-red-500 h-full" style="width: 0%"></div>
                        </div>
                        <div class="bg-gray-100 dark:bg-gray-700 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-yellow-500 h-full" style="width: 0%"></div>
                        </div>
                        <div class="bg-gray-100 dark:bg-gray-700 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-green-500 h-full" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Category 7: Server-Side Request Forgery -->
            <div class="category-card bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden cursor-pointer transition-all duration-300" data-category="server-side-request-forgery">
                <div class="risk-high px-4 py-1 text-center text-xs font-bold uppercase tracking-wider">High Priority</div>
                <div class="p-5">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center">
                            <div class="bg-orange-100 dark:bg-orange-900 text-orange-700 dark:text-orange-300 rounded-full h-10 w-10 flex items-center justify-center mr-3 flex-shrink-0">
                                <i class="fas fa-server"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 leading-tight">API7:2023 Server-Side Request Forgery</h3>
                        </div>
                        <div class="circular-progress" id="server-side-request-forgery-progress-circle" style="--progress-color: #f97316; --progress-percent: 0%;">0%</div>
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4 line-clamp-2">APIs that fetch remote resources without proper validation allow attackers to force the server to send crafted requests.</p>
                    <div class="flex justify-between items-center text-sm">
                        <span id="server-side-request-forgery-progress" class="text-gray-500 dark:text-gray-400">0% complete</span>
                        <span class="font-medium text-blue-600 dark:text-blue-400 group-hover:text-blue-800 inline-flex items-center">View tests <i class="fas fa-arrow-right ml-1 text-xs"></i></span>
                    </div>
                    <div class="mt-3 grid grid-cols-3 gap-1">
                        <div class="bg-gray-100 dark:bg-gray-700 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-red-500 h-full" style="width: 0%"></div>
                        </div>
                        <div class="bg-gray-100 dark:bg-gray-700 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-yellow-500 h-full" style="width: 0%"></div>
                        </div>
                        <div class="bg-gray-100 dark:bg-gray-700 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-green-500 h-full" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Category 8: Security Misconfiguration -->
            <div class="category-card bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden cursor-pointer transition-all duration-300" data-category="security-misconfiguration">
                <div class="risk-high px-4 py-1 text-center text-xs font-bold uppercase tracking-wider">High Priority</div>
                <div class="p-5">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center">
                            <div class="bg-orange-100 dark:bg-orange-900 text-orange-700 dark:text-orange-300 rounded-full h-10 w-10 flex items-center justify-center mr-3 flex-shrink-0">
                                <i class="fas fa-cogs"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 leading-tight">API8:2023 Security Misconfiguration</h3>
                        </div>
                        <div class="circular-progress" id="security-misconfiguration-progress-circle" style="--progress-color: #f97316; --progress-percent: 0%;">0%</div>
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4 line-clamp-2">Improper security configuration of the API or supporting systems can lead to various vulnerabilities.</p>
                    <div class="flex justify-between items-center text-sm">
                        <span id="security-misconfiguration-progress" class="text-gray-500 dark:text-gray-400">0% complete</span>
                        <span class="font-medium text-blue-600 dark:text-blue-400 group-hover:text-blue-800 inline-flex items-center">View tests <i class="fas fa-arrow-right ml-1 text-xs"></i></span>
                    </div>
                    <div class="mt-3 grid grid-cols-3 gap-1">
                        <div class="bg-gray-100 dark:bg-gray-700 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-red-500 h-full" style="width: 0%"></div>
                        </div>
                        <div class="bg-gray-100 dark:bg-gray-700 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-yellow-500 h-full" style="width: 0%"></div>
                        </div>
                        <div class="bg-gray-100 dark:bg-gray-700 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-green-500 h-full" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Category 9: Improper Inventory Management -->
            <div class="category-card bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden cursor-pointer transition-all duration-300" data-category="improper-inventory-management">
                <div class="risk-medium px-4 py-1 text-center text-xs font-bold uppercase tracking-wider">Medium Priority</div>
                <div class="p-5">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center">
                            <div class="bg-yellow-100 dark:bg-yellow-900 text-yellow-700 dark:text-yellow-300 rounded-full h-10 w-10 flex items-center justify-center mr-3 flex-shrink-0">
                                <i class="fas fa-clipboard-list"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 leading-tight">API9:2023 Improper Inventory Management</h3>
                        </div>
                        <div class="circular-progress" id="improper-inventory-management-progress-circle" style="--progress-color: #eab308; --progress-percent: 0%;">0%</div>
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4 line-clamp-2">Lack of proper API inventory, documentation, and versioning leads to exposed endpoints and potential vulnerabilities.</p>
                    <div class="flex justify-between items-center text-sm">
                        <span id="improper-inventory-management-progress" class="text-gray-500 dark:text-gray-400">0% complete</span>
                        <span class="font-medium text-blue-600 dark:text-blue-400 group-hover:text-blue-800 inline-flex items-center">View tests <i class="fas fa-arrow-right ml-1 text-xs"></i></span>
                    </div>
                    <div class="mt-3 grid grid-cols-3 gap-1">
                        <div class="bg-gray-100 dark:bg-gray-700 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-red-500 h-full" style="width: 0%"></div>
                        </div>
                        <div class="bg-gray-100 dark:bg-gray-700 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-yellow-500 h-full" style="width: 0%"></div>
                        </div>
                        <div class="bg-gray-100 dark:bg-gray-700 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-green-500 h-full" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Category 10: Unsafe Consumption of APIs -->
            <div class="category-card bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden cursor-pointer transition-all duration-300" data-category="unsafe-consumption-of-apis">
                <div class="risk-medium px-4 py-1 text-center text-xs font-bold uppercase tracking-wider">Medium Priority</div>
                <div class="p-5">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center">
                            <div class="bg-yellow-100 dark:bg-yellow-900 text-yellow-700 dark:text-yellow-300 rounded-full h-10 w-10 flex items-center justify-center mr-3 flex-shrink-0">
                                <i class="fas fa-cloud-download-alt"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 leading-tight">API10:2023 Unsafe Consumption of APIs</h3>
                        </div>
                        <div class="circular-progress" id="unsafe-consumption-of-apis-progress-circle" style="--progress-color: #eab308; --progress-percent: 0%;">0%</div>
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4 line-clamp-2">Consuming third-party APIs without validating responses can introduce vulnerabilities to dependent applications.</p>
                    <div class="flex justify-between items-center text-sm">
                        <span id="unsafe-consumption-of-apis-progress" class="text-gray-500 dark:text-gray-400">0% complete</span>
                        <span class="font-medium text-blue-600 dark:text-blue-400 group-hover:text-blue-800 inline-flex items-center">View tests <i class="fas fa-arrow-right ml-1 text-xs"></i></span>
                    </div>
                    <div class="mt-3 grid grid-cols-3 gap-1">
                        <div class="bg-gray-100 dark:bg-gray-700 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-red-500 h-full" style="width: 0%"></div>
                        </div>
                        <div class="bg-gray-100 dark:bg-gray-700 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-yellow-500 h-full" style="width: 0%"></div>
                        </div>
                        <div class="bg-gray-100 dark:bg-gray-700 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-green-500 h-full" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="category-details" class="bg-white dark:bg-gray-800 rounded-xl shadow-lg mb-12 overflow-hidden hidden print-section print-category transition-all duration-300">
            <div class="bg-gradient-to-r from-blue-700 to-indigo-800 dark:from-blue-900 dark:to-indigo-950 p-6">
                <button id="btn-back-to-categories" class="text-white hover:text-blue-200 mb-4 no-print inline-flex items-center text-sm">
                    <i class="fas fa-arrow-left mr-2"></i> Back to all categories
                </button>
                <h2 id="category-title" class="text-2xl font-bold text-white"></h2>
                <p id="category-subtitle" class="text-blue-100 dark:text-blue-200"></p>
            </div>

            <div class="p-6">
                <div class="border-b border-gray-200 dark:border-gray-700 mb-6 no-print">
                    <nav class="-mb-px flex space-x-6" aria-label="Tabs" id="tabNavigation">
                        <a href="#" data-tab="checklist" class="whitespace-nowrap py-3 px-1 border-b-2 border-blue-600 text-blue-700 dark:border-blue-500 dark:text-blue-400 font-medium text-sm transition-all duration-300">
                           <i class="fas fa-tasks mr-1"></i> Checklist
                        </a>
                        <a href="#" data-tab="techniques" class="whitespace-nowrap py-3 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 dark:hover:border-gray-600 font-medium text-sm transition-all duration-300">
                           <i class="fas fa-lightbulb mr-1"></i> Techniques
                        </a>
                        <a href="#" data-tab="tools" class="whitespace-nowrap py-3 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 dark:hover:border-gray-600 font-medium text-sm transition-all duration-300">
                           <i class="fas fa-tools mr-1"></i> Tools
                        </a>
                        <a href="#" data-tab="notes" class="whitespace-nowrap py-3 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 dark:hover:border-gray-600 font-medium text-sm transition-all duration-300">
                           <i class="fas fa-sticky-note mr-1"></i> Notes
                        </a>
                        <a href="#" data-tab="findings" class="whitespace-nowrap py-3 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 dark:hover:border-gray-600 font-medium text-sm transition-all duration-300">
                           <i class="fas fa-bug mr-1"></i> Findings <span id="tab-findings-count" class="inline-flex items-center justify-center w-5 h-5 ml-1 text-xs font-semibold text-blue-800 bg-blue-100 rounded-full dark:bg-blue-900 dark:text-blue-300">0</span>
                        </a>
                    </nav>
                </div>

                <div id="tabContents">
                    <div id="checklist-content" class="tab-content active">
                        <div class="flex justify-between items-center mb-4 no-print">
                            <div class="flex items-center gap-2">
                                <div class="relative">
                                    <input type="text" id="task-search" placeholder="Search tasks..." class="pl-8 pr-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded-md text-sm w-64 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-blue-500 focus:border-blue-500">
                                    <div class="absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-400">
                                        <i class="fas fa-search"></i>
                                    </div>
                                </div>
                                <button id="btn-mark-all" class="bg-blue-100 text-blue-700 hover:bg-blue-200 dark:bg-blue-900 dark:text-blue-300 dark:hover:bg-blue-800 transition px-3 py-1.5 rounded-md text-sm font-medium inline-flex items-center gap-1">
                                    <i class="fas fa-check-double"></i> Mark All
                                </button>
                                <button id="btn-unmark-all" class="bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 transition px-3 py-1.5 rounded-md text-sm font-medium inline-flex items-center gap-1">
                                    <i class="fas fa-times"></i> Unmark All
                                </button>
                            </div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">
                                Progress: <span id="category-progress-stat" class="font-semibold text-blue-600 dark:text-blue-400">0/0</span>
                            </div>
                        </div>
                        <!-- Checklist content will be dynamically added here -->
                    </div>
                    <div id="techniques-content" class="tab-content prose prose-sm max-w-none dark:prose-invert">
                        <!-- Techniques content will be dynamically added here -->
                    </div>
                    <div id="tools-content" class="tab-content prose prose-sm max-w-none dark:prose-invert">
                        <!-- Tools content will be dynamically added here -->
                    </div>
                    <div id="notes-content" class="tab-content no-print">
                        <div class="mb-4">
                            <label for="category-notes" class="block mb-2 text-sm font-medium text-gray-900 dark:text-gray-100">Testing Notes for this Category</label>
                            <textarea id="category-notes" rows="6" class="block p-2.5 w-full text-sm text-gray-900 dark:text-gray-100 bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-300 dark:border-gray-600 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300" placeholder="Add specific findings, observations, or commands used..."></textarea>
                        </div>
                        <div class="flex gap-3">
                            <button type="button" class="text-white bg-blue-700 hover:bg-blue-800 dark:bg-blue-600 dark:hover:bg-blue-700 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 focus:outline-none transition-all duration-300" id="btn-save-notes">
                                <i class="fas fa-save mr-1"></i> Save Notes
                            </button>
                            <button type="button" class="text-gray-900 dark:text-gray-100 bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 focus:ring-4 focus:ring-gray-300 font-medium rounded-lg text-sm px-5 py-2.5 focus:outline-none transition-all duration-300" id="btn-copy-notes">
                                <i class="fas fa-copy mr-1"></i> Copy to Clipboard
                            </button>
                        </div>
                    </div>
                    <div id="findings-tab-content" class="tab-content no-print">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200">Category Findings</h3>
                           <button type="button" class="text-white bg-green-600 hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-800 focus:ring-4 focus:ring-green-300 font-medium rounded-lg text-sm px-4 py-2 focus:outline-none inline-flex items-center gap-1" id="btn-add-category-finding">
                                <i class="fas fa-plus"></i> Add Finding
                            </button>
                        </div>
                        <div id="category-findings-list" class="space-y-4">
                            <!-- Category findings will be dynamically loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </section>
























<!-- Timeline Activity Section - Add this after the findings section -->
<section aria-labelledby="timeline-heading" class="mb-12 no-print animate-fade-in" style="animation-delay: 0.5s;">
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 transition-all duration-300">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-3">
            <h2 id="timeline-heading" class="text-xl font-semibold text-gray-800 dark:text-gray-200 flex items-center">
                <i class="fas fa-history mr-2 text-blue-600 dark:text-blue-400"></i>
                Activity Timeline
            </h2>
            <div class="flex gap-2">
                <button type="button" class="text-white bg-blue-700 hover:bg-blue-800 dark:bg-blue-600 dark:hover:bg-blue-700 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-4 py-2 focus:outline-none inline-flex items-center gap-1" id="open-full-timeline-btn">
                    <i class="fas fa-expand-alt"></i>Full Timeline
                </button>
                <button type="button" class="text-gray-700 dark:text-gray-200 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 focus:ring-4 focus:ring-gray-300 font-medium rounded-lg text-sm px-4 py-2 focus:outline-none inline-flex items-center gap-1" id="export-timeline-data-btn">
                    <i class="fas fa-file-export"></i>Export Data
                </button>
            </div>
        </div>
        
        <!-- Timeline Preview Section -->
        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600 mb-4">
            <div class="flex justify-between items-center mb-3">
                <h3 class="text-sm font-medium text-gray-700 dark:text-gray-300">Recent Activities</h3>
                <span class="text-xs text-gray-500 dark:text-gray-400" id="timeline-total-count">0 total activities</span>
            </div>
            
            <!-- Timeline Strip - Visual representation -->
            <div class="relative h-16 mb-4">
                <div class="absolute inset-0 bg-gray-200 dark:bg-gray-600 rounded-full h-1 top-1/2 transform -translate-y-1/2"></div>
                <div id="timeline-dots-container" class="absolute inset-0">
                    <!-- Timeline dots will be added here dynamically -->
                </div>
            </div>
            
            <!-- Recent Activity Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-3" id="recent-activity-cards">
                <!-- Loading placeholder -->
                <div class="bg-white dark:bg-gray-800 rounded-lg p-3 shadow-sm border border-gray-200 dark:border-gray-700 animate-pulse">
                    <div class="h-4 bg-gray-200 dark:bg-gray-600 rounded w-3/4 mb-2"></div>
                    <div class="h-3 bg-gray-200 dark:bg-gray-600 rounded w-1/2"></div>
                </div>
                <div class="bg-white dark:bg-gray-800 rounded-lg p-3 shadow-sm border border-gray-200 dark:border-gray-700 animate-pulse">
                    <div class="h-4 bg-gray-200 dark:bg-gray-600 rounded w-3/4 mb-2"></div>
                    <div class="h-3 bg-gray-200 dark:bg-gray-600 rounded w-1/2"></div>
                </div>
                <div class="bg-white dark:bg-gray-800 rounded-lg p-3 shadow-sm border border-gray-200 dark:border-gray-700 animate-pulse">
                    <div class="h-4 bg-gray-200 dark:bg-gray-600 rounded w-3/4 mb-2"></div>
                    <div class="h-3 bg-gray-200 dark:bg-gray-600 rounded w-1/2"></div>
                </div>
            </div>
        </div>
        
        <!-- Activity Analytics -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4">
                <h3 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Activity by Category</h3>
                <div class="h-60">
                    <canvas id="activity-category-chart"></canvas>
                </div>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4">
                <h3 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Activity Over Time</h3>
                <div class="h-60">
                    <canvas id="activity-time-chart"></canvas>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Timeline Modal/Popup -->
<div id="timeline-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 dark:bg-gray-900 dark:bg-opacity-80 flex items-center justify-center z-50 no-print modal p-4" style="display: none;">
    <div class="relative bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-5xl w-full max-h-[90vh] flex flex-col">
        <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700 flex-shrink-0">
            <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100">
                <i class="fas fa-history mr-2 text-blue-600 dark:text-blue-400"></i>
                Complete Activity Timeline
            </h3>
            <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-gray-100 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center btn-close" aria-label="Close modal">
                <i class="fas fa-times fa-lg"></i>
            </button>
        </div>
        
        <div class="p-6 flex-grow overflow-y-auto">
            <div class="mb-4 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3">
                <div class="flex flex-wrap items-center gap-3">
                    <div class="relative">
                        <input type="text" id="timeline-search" placeholder="Search activities..." class="pl-8 pr-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded-md text-sm bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-blue-500 focus:border-blue-500 w-64">
                        <div class="absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-400">
                            <i class="fas fa-search"></i>
                        </div>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        <button class="timeline-filter-btn bg-blue-100 text-blue-700 hover:bg-blue-200 dark:bg-blue-900 dark:text-blue-300 dark:hover:bg-blue-800 transition px-2 py-1 rounded-md text-xs font-medium inline-flex items-center gap-1 active" data-filter="all">
                            <i class="fas fa-list"></i> All
                        </button>
                        <button class="timeline-filter-btn bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 transition px-2 py-1 rounded-md text-xs font-medium inline-flex items-center gap-1" data-filter="task">
                            <i class="fas fa-tasks"></i> Tasks
                        </button>
                        <button class="timeline-filter-btn bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 transition px-2 py-1 rounded-md text-xs font-medium inline-flex items-center gap-1" data-filter="finding">
                            <i class="fas fa-bug"></i> Findings
                        </button>
                        <button class="timeline-filter-btn bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 transition px-2 py-1 rounded-md text-xs font-medium inline-flex items-center gap-1" data-filter="note">
                            <i class="fas fa-sticky-note"></i> Notes
                        </button>
                        <button class="timeline-filter-btn bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 transition px-2 py-1 rounded-md text-xs font-medium inline-flex items-center gap-1" data-filter="project">
                            <i class="fas fa-folder"></i> Projects
                        </button>
                    </div>
                </div>
                <div>
                    <button id="export-timeline-csv" class="bg-green-600 text-white px-3 py-1.5 rounded-md hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-800 transition text-sm shadow-sm inline-flex items-center gap-1">
                        <i class="fas fa-file-csv"></i> Export CSV
                    </button>
                </div>
            </div>
            
            <div class="relative">
                <!-- Timeline track -->
                <div class="absolute top-0 bottom-0 left-[19px] border-l-2 border-gray-300 dark:border-gray-600"></div>
                
                <!-- Timeline content -->
                <div id="timeline-content" class="space-y-4 pb-4">
                    <!-- Timeline entries will be dynamically populated -->
                </div>
            </div>
        </div>
        
        <div class="p-4 border-t border-gray-200 dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-gray-700">
            <div class="text-xs text-gray-500 dark:text-gray-400">
                <span id="timeline-visible-count">0</span> of <span id="timeline-total">0</span> activities displayed
            </div>
            <div>
                <button id="load-more-activities" class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 text-sm font-medium inline-flex items-center gap-1">
                    <i class="fas fa-sync"></i> Load more activities
                </button>
            </div>
        </div>
    </div>
</div>








        <section aria-labelledby="findings-heading" class="mb-12 no-print animate-fade-in" style="animation-delay: 0.4s;">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6 transition-all duration-300">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-3">
                    <h2 id="findings-heading" class="text-xl font-semibold text-gray-800 dark:text-gray-200 flex items-center">
                        <i class="fas fa-bug mr-2 text-red-600 dark:text-red-400"></i>
                        Vulnerability Findings
                    </h2>
                    <div class="flex gap-2">
                        <div class="relative">
                            <input type="text" id="findings-search" placeholder="Search findings..." class="pl-8 pr-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded-md text-sm bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-blue-500 focus:border-blue-500 w-48">
                            <div class="absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-400">
                                <i class="fas fa-search"></i>
                            </div>
                        </div>
                        <button type="button" class="text-white bg-green-600 hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-800 focus:ring-4 focus:ring-green-300 font-medium rounded-lg text-sm px-4 py-2 focus:outline-none inline-flex items-center gap-1" id="btn-add-finding">
                            <i class="fas fa-plus"></i>Add Finding
                            <span class="kbd">F</span>
                        </button>
                        <button type="button" class="text-white bg-blue-700 hover:bg-blue-800 dark:bg-blue-600 dark:hover:bg-blue-700 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-4 py-2 focus:outline-none inline-flex items-center gap-1" id="btn-generate-report">
                             <i class="fas fa-file-alt"></i>Generate Report
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto relative shadow-sm rounded-lg border border-gray-200 dark:border-gray-700">
                    <table class="w-full text-sm text-left text-gray-600 dark:text-gray-400">
                        <thead class="text-xs text-gray-700 dark:text-gray-300 uppercase bg-gray-50 dark:bg-gray-700">
                            <tr>
                                <th scope="col" class="px-6 py-3 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600" id="sort-category">
                                    Category <span class="sort-arrow"></span>
                                </th>
                                <th scope="col" class="px-4 py-3 text-center cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600" id="sort-high">
                                    High <span class="sort-arrow"></span>
                                </th>
                                <th scope="col" class="px-4 py-3 text-center cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600" id="sort-medium">
                                    Medium <span class="sort-arrow"></span>
                                </th>
                                <th scope="col" class="px-4 py-3 text-center cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600" id="sort-low">
                                    Low <span class="sort-arrow"></span>
                                </th>
                                <th scope="col" class="px-4 py-3 text-center cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600" id="sort-info">
                                    Info <span class="sort-arrow"></span>
                                </th>
                                <th scope="col" class="px-4 py-3 text-center cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600" id="sort-total">
                                    Total <span class="sort-arrow"></span>
                                </th>
                                <th scope="col" class="px-6 py-3">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="findings-table" class="divide-y divide-gray-200 dark:divide-gray-700">
                            <tr><td colspan="7" class="text-center p-4 text-gray-500 dark:text-gray-400">Loading findings...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>

    <!-- Quick Jump Navigation -->
    <div class="quick-jump" id="quick-jump">
        <button class="quick-jump-btn" id="jump-to-top" title="Jump to top">
            <i class="fas fa-arrow-up"></i>
        </button>
        <button class="quick-jump-btn" id="jump-to-progress" title="Jump to progress">
            <i class="fas fa-chart-line"></i>
        </button>
        <button class="quick-jump-btn" id="jump-to-categories" title="Jump to categories">
            <i class="fas fa-th-large"></i>
        </button>
        <button class="quick-jump-btn" id="jump-to-findings" title="Jump to findings">
            <i class="fas fa-bug"></i>
        </button>
        <button class="quick-jump-btn" id="toggle-help" title="Help">
            <i class="fas fa-question"></i>
        </button>
</div>

    <!-- Floating Action Button -->
    <div class="fab no-print" id="fab-main">
        <i class="fas fa-plus"></i>
    </div>

    <div class="fab-menu no-print" id="fab-menu">
        <div class="fab-item">
            <div class="fab-label">Add Finding</div>
            <button class="fab-button bg-green-600 hover:bg-green-700" id="fab-add-finding">
                <i class="fas fa-bug"></i>
            </button>
        </div>
        <div class="fab-item">
            <div class="fab-label">Projects</div>
            <button class="fab-button bg-blue-600 hover:bg-blue-700" id="fab-projects">
                <i class="fas fa-folder"></i>
            </button>
        </div>
        <div class="fab-item">
            <div class="fab-label">Generate Report</div>
            <button class="fab-button bg-purple-600 hover:bg-purple-700" id="fab-generate-report">
                <i class="fas fa-file-alt"></i>
            </button>
        </div>
        <div class="fab-item">
            <div class="fab-label">Export Project</div>
            <button class="fab-button bg-teal-600 hover:bg-teal-700" id="fab-export">
                <i class="fas fa-file-export"></i>
            </button>
        </div>
    </div>

    <!-- Confetti container for achievements -->
    <div class="confetti no-print" id="confetti-container"></div>

    <!-- Finding Modal -->
    <div id="finding-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 dark:bg-gray-900 dark:bg-opacity-80 flex items-center justify-center z-50 no-print modal p-4" style="display: none;">
        <div class="relative bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-xl w-full max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700 sticky top-0 bg-white dark:bg-gray-800 z-10">
                <h3 id="finding-modal-title" class="text-xl font-semibold text-gray-900 dark:text-gray-100">Finding Details</h3>
                <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-gray-100 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center btn-close" aria-label="Close modal">
                    <i class="fas fa-times fa-lg"></i>
                </button>
            </div>
            <div class="p-6">
                <form id="finding-form" class="space-y-4">
                    <div>
                        <label for="finding-category" class="block mb-1 text-sm font-medium text-gray-900 dark:text-gray-100">Category</label>
                        <select id="finding-category" class="bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 transition-all duration-300">
                            <!-- Categories will be dynamically added here -->
                        </select>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label for="finding-title" class="block mb-1 text-sm font-medium text-gray-900 dark:text-gray-100">Title</label>
                            <input type="text" id="finding-title" class="bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 transition-all duration-300" required>
                        </div>
                        <div>
                            <label for="finding-severity" class="block mb-1 text-sm font-medium text-gray-900 dark:text-gray-100">Severity</label>
                            <select id="finding-severity" class="bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 transition-all duration-300">
                                <option value="critical">Critical</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                                <option value="info">Informational</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label for="finding-description" class="block mb-1 text-sm font-medium text-gray-900 dark:text-gray-100">Description</label>
                        <textarea id="finding-description" rows="4" class="bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 transition-all duration-300" required></textarea>
                    </div>
                    <div>
                        <label for="finding-steps" class="block mb-1 text-sm font-medium text-gray-900 dark:text-gray-100">Steps to Reproduce</label>
                        <textarea id="finding-steps" rows="4" class="bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 transition-all duration-300"></textarea>
                    </div>
                    <div>
                        <label for="finding-remediation" class="block mb-1 text-sm font-medium text-gray-900 dark:text-gray-100">Remediation</label>
                        <textarea id="finding-remediation" rows="4" class="bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 transition-all duration-300"></textarea>
                    </div>
                    <div>
                        <label for="finding-references" class="block mb-1 text-sm font-medium text-gray-900 dark:text-gray-100">References (Optional)</label>
                        <textarea id="finding-references" rows="2" class="bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 transition-all duration-300" placeholder="Enter URLs or reference materials, one per line"></textarea>
                    </div>
                    <div class="pt-4 border-t border-gray-200 dark:border-gray-700 flex justify-end">
                        <button type="button" class="w-full sm:w-auto text-white bg-blue-700 hover:bg-blue-800 dark:bg-blue-600 dark:hover:bg-blue-700 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 focus:outline-none transition-all duration-300" id="btn-save-finding">Save Finding</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Project Edit Modal -->
    <div id="project-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 dark:bg-gray-900 dark:bg-opacity-80 flex items-center justify-center z-50 no-print modal p-4" style="display: none;">
        <div class="relative bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full">
            <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
                <h3 id="project-modal-title" class="text-xl font-semibold text-gray-900 dark:text-gray-100">Edit Project Details</h3>
                <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-gray-100 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center btn-close" aria-label="Close modal">
                    <i class="fas fa-times fa-lg"></i>
                </button>
            </div>
            <div class="p-6">
                <form id="project-form" class="space-y-4">
                    <div>
                        <label for="edit-project-name" class="block mb-1 text-sm font-medium text-gray-900 dark:text-gray-100">Project Name</label>
                        <input type="text" id="edit-project-name" class="bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 transition-all duration-300" required>
                    </div>
                    <div>
                        <label for="edit-project-target" class="block mb-1 text-sm font-medium text-gray-900 dark:text-gray-100">Target</label>
                        <input type="text" id="edit-project-target" class="bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 transition-all duration-300">
                    </div>
                    <div>
                        <label for="edit-project-date" class="block mb-1 text-sm font-medium text-gray-900 dark:text-gray-100">Start Date</label>
                        <input type="date" id="edit-project-date" class="bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 transition-all duration-300">
                    </div>
                    <div>
                        <label for="edit-project-tester" class="block mb-1 text-sm font-medium text-gray-900 dark:text-gray-100">Tester</label>
                        <input type="text" id="edit-project-tester" class="bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 transition-all duration-300">
                    </div>
                    <div>
                        <label for="edit-project-scope" class="block mb-1 text-sm font-medium text-gray-900 dark:text-gray-100">Scope</label>
                        <textarea id="edit-project-scope" rows="3" class="bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 transition-all duration-300"></textarea>
                    </div>
                    <div class="pt-4 border-t border-gray-200 dark:border-gray-700 flex justify-end">
                        <button type="button" class="w-full sm:w-auto text-white bg-blue-700 hover:bg-blue-800 dark:bg-blue-600 dark:hover:bg-blue-700 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 focus:outline-none transition-all duration-300" id="btn-save-project">Save Project Details</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Projects Modal -->
    <div id="projects-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 dark:bg-gray-900 dark:bg-opacity-80 flex items-center justify-center z-50 no-print modal p-4" style="display: none;">
        <div class="relative bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] flex flex-col">
            <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700 flex-shrink-0">
                <h3 id="projects-modal-title" class="text-xl font-semibold text-gray-900 dark:text-gray-100">Manage Projects</h3>
                <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-gray-100 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center btn-close" aria-label="Close modal">
                    <i class="fas fa-times fa-lg"></i>
                </button>
            </div>
            <div class="p-6 flex-shrink-0">
                <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mb-4">
                    <button type="button" class="w-full sm:w-auto text-white bg-blue-700 hover:bg-blue-800 dark:bg-blue-600 dark:hover:bg-blue-700 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-4 py-2 focus:outline-none inline-flex items-center justify-center gap-2 transition-all duration-300" id="btn-create-project">
                        <i class="fas fa-plus"></i>New Project
                    </button>
                    <div class="relative w-full sm:w-auto">
                        <input type="text" id="project-search" class="bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5 transition-all duration-300" placeholder="Search projects...">
                        <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                            <i class="fas fa-search text-gray-500 dark:text-gray-400"></i>
                        </div>
                    </div>
                </div>
            </div>
            <div class="overflow-y-auto px-6 pb-6 flex-grow">
                <ul id="projects-list" class="divide-y divide-gray-200 dark:divide-gray-700">
                    <li class="py-4 text-center text-gray-500 dark:text-gray-400">Loading projects...</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- New Project Modal -->
    <div id="new-project-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 dark:bg-gray-900 dark:bg-opacity-80 flex items-center justify-center z-50 no-print modal p-4" style="display: none;">
        <div class="relative bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full">
            <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
                <h3 id="new-project-modal-title" class="text-xl font-semibold text-gray-900 dark:text-gray-100">Create New Project</h3>
                <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-gray-100 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center btn-close" aria-label="Close modal">
                    <i class="fas fa-times fa-lg"></i>
                </button>
            </div>
            <div class="p-6">
                <form id="new-project-form" class="space-y-4">
                    <div>
                        <label for="new-project-name" class="block mb-1 text-sm font-medium text-gray-900 dark:text-gray-100">Project Name</label>
                        <input type="text" id="new-project-name" class="bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 transition-all duration-300" required>
                    </div>
                    <div>
                        <label for="new-project-target" class="block mb-1 text-sm font-medium text-gray-900 dark:text-gray-100">API Target</label>
                        <input type="text" id="new-project-target" class="bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 transition-all duration-300" placeholder="e.g., api.example.com/v1">
                    </div>
                    <div>
                        <label for="new-project-date" class="block mb-1 text-sm font-medium text-gray-900 dark:text-gray-100">Start Date</label>
                        <input type="date" id="new-project-date" class="bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 transition-all duration-300">
                    </div>
                    <div>
                        <label for="new-project-tester" class="block mb-1 text-sm font-medium text-gray-900 dark:text-gray-100">Tester</label>
                        <input type="text" id="new-project-tester" class="bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 transition-all duration-300">
                    </div>
                    <div>
                        <label for="new-project-scope" class="block mb-1 text-sm font-medium text-gray-900 dark:text-gray-100">Scope</label>
                        <textarea id="new-project-scope" rows="3" class="bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 transition-all duration-300" placeholder="Define the API testing scope..."></textarea>
                    </div>
                    <fieldset class="space-y-2">
                        <legend class="block mb-1 text-sm font-medium text-gray-900 dark:text-gray-100">Initial Progress</legend>
                        <div class="flex space-x-4">
                            <div class="flex items-center">
                                <input type="radio" id="template-empty" name="project-template" value="empty" class="w-4 h-4 text-blue-600 bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 focus:ring-blue-500" checked>
                                <label for="template-empty" class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-100">Empty (0% complete)</label>
                            </div>
                            <div class="flex items-center">
                                <input type="radio" id="template-starter" name="project-template" value="starter" class="w-4 h-4 text-blue-600 bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 focus:ring-blue-500">
                                <label for="template-starter" class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-100">Starter (Basic checks)</label>
                            </div>
                        </div>
                    </fieldset>
                    <div class="pt-4 border-t border-gray-200 dark:border-gray-700 flex justify-end">
                        <button type="button" class="w-full sm:w-auto text-white bg-blue-700 hover:bg-blue-800 dark:bg-blue-600 dark:hover:bg-blue-700 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 focus:outline-none transition-all duration-300" id="btn-save-new-project">Create Project</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div id="import-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 dark:bg-gray-900 dark:bg-opacity-80 flex items-center justify-center z-50 no-print modal p-4" style="display: none;">
        <div class="relative bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full">
            <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
                <h3 id="import-modal-title" class="text-xl font-semibold text-gray-900 dark:text-gray-100">Import Project</h3>
                <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-gray-100 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center btn-close" aria-label="Close modal">
                    <i class="fas fa-times fa-lg"></i>
                </button>
            </div>
            <div class="p-6 space-y-4">
                <div>
                    <label for="import-file" class="block mb-1 text-sm font-medium text-gray-900 dark:text-gray-100">Select Project File (.json)</label>
                    <input type="file" id="import-file" class="block w-full text-sm text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer bg-gray-50 dark:bg-gray-700 focus:outline-none file:mr-4 file:py-2 file:px-4 file:rounded-l-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 dark:file:bg-blue-900 dark:file:text-blue-300 hover:file:bg-blue-100 dark:hover:file:bg-blue-800 transition-all duration-300" accept=".json">
                </div>
                <div id="import-preview" class="hidden">
                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600 transition-all duration-300">
                        <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">Import Preview</h4>
                        <p id="import-project-name" class="text-sm text-gray-700 dark:text-gray-300"></p>
                        <p id="import-project-date" class="text-sm text-gray-700 dark:text-gray-300"></p>
                        <p id="import-project-items" class="text-sm text-gray-700 dark:text-gray-300"></p>
                    </div>
                </div>
                <div class="pt-4 border-t border-gray-200 dark:border-gray-700 flex justify-end">
                    <button type="button" class="w-full sm:w-auto text-white bg-blue-700 hover:bg-blue-800 dark:bg-blue-600 dark:hover:bg-blue-700 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 focus:outline-none disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300" id="btn-confirm-import" disabled>Import Project</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirm Modal -->
    <div id="confirm-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 dark:bg-gray-900 dark:bg-opacity-80 flex items-center justify-center z-[1060] no-print modal p-4" style="display: none;">
        <div class="relative bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full">
            <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
                <h3 id="confirm-title" class="text-xl font-semibold text-gray-900 dark:text-gray-100">Confirmation</h3>
                <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-gray-100 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center btn-close" aria-label="Close modal">
                    <i class="fas fa-times fa-lg"></i>
                </button>
            </div>
            <div class="p-6">
                <p class="text-gray-700 dark:text-gray-300 mb-6" id="confirm-message">Are you sure?</p>
                <div class="flex space-x-4">
                    <button type="button" class="flex-1 text-white bg-red-600 hover:bg-red-700 dark:bg-red-700 dark:hover:bg-red-800 focus:ring-4 focus:ring-red-300 font-medium rounded-lg text-sm px-5 py-2.5 focus:outline-none transition-all duration-300" id="confirm-yes">Yes</button>
                    <button type="button" class="flex-1 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 focus:ring-4 focus:ring-gray-300 rounded-lg border border-gray-300 dark:border-gray-600 text-sm font-medium px-5 py-2.5 hover:text-gray-900 dark:hover:text-gray-100 focus:outline-none transition-all duration-300 btn-close">No</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Finding Modal -->
    <div id="view-finding-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 dark:bg-gray-900 dark:bg-opacity-80 flex items-center justify-center z-50 no-print modal p-4" style="display: none;">
        <div class="relative bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700 sticky top-0 bg-white dark:bg-gray-800 z-10">
                <h3 id="view-finding-title" class="text-xl font-semibold text-gray-900 dark:text-gray-100">Finding Details</h3>
                <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-gray-100 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center btn-close" aria-label="Close modal">
                    <i class="fas fa-times fa-lg"></i>
                </button>
            </div>
            <div class="p-6 space-y-4" id="view-finding-content">
                <!-- Finding details will be populated here -->
            </div>
            <div class="flex justify-end space-x-3 p-6 pt-0">
                <button type="button" id="btn-edit-finding" class="text-white bg-yellow-500 hover:bg-yellow-600 dark:bg-yellow-600 dark:hover:bg-yellow-700 focus:ring-4 focus:ring-yellow-300 font-medium rounded-lg text-sm px-4 py-2 focus:outline-none inline-flex items-center gap-1 transition-all duration-300">
                    <i class="fas fa-edit"></i> Edit
                </button>
                <button type="button" id="btn-delete-finding" class="text-white bg-red-600 hover:bg-red-700 dark:bg-red-700 dark:hover:bg-red-800 focus:ring-4 focus:ring-red-300 font-medium rounded-lg text-sm px-4 py-2 focus:outline-none inline-flex items-center gap-1 transition-all duration-300">
                    <i class="fas fa-trash"></i> Delete
                </button>
                <button type="button" class="text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 focus:ring-4 focus:ring-gray-300 rounded-lg border border-gray-300 dark:border-gray-600 text-sm font-medium px-4 py-2 hover:text-gray-900 dark:hover:text-gray-100 focus:outline-none transition-all duration-300 btn-close">Close</button>
            </div>
        </div>
    </div>

    <!-- Export Options Modal -->
    <div id="export-options-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 dark:bg-gray-900 dark:bg-opacity-80 flex items-center justify-center z-[1060] no-print modal p-4" style="display: none;">
        <div class="relative bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full">
            <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
                <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100">Export Options</h3>
                <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-gray-100 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center btn-close" aria-label="Close modal">
                    <i class="fas fa-times fa-lg"></i>
                </button>
            </div>
            <div class="p-6 space-y-4">
                <div>
                    <h4 class="text-sm font-medium text-gray-900 dark:text-gray-100 mb-2">Export Format</h4>
                    <div class="space-y-2">
                        <div class="flex items-center">
                            <input type="radio" id="export-json" name="export-format" value="json" class="w-4 h-4 text-blue-600 bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 focus:ring-blue-500" checked>
                            <label for="export-json" class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-100">Project Data (.json)</label>
                            <span class="tip-indicator" title="Full project data that can be imported later">?</span>
                        </div>
                        <div class="flex items-center">
                            <input type="radio" id="export-pdf" name="export-format" value="pdf" class="w-4 h-4 text-blue-600 bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 focus:ring-blue-500">
                            <label for="export-pdf" class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-100">Report (.pdf)</label>
                            <span class="tip-indicator" title="Generate a formatted PDF report">?</span>
                        </div>
                        <div class="flex items-center">
                            <input type="radio" id="export-csv" name="export-format" value="csv" class="w-4 h-4 text-blue-600 bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 focus:ring-blue-500">
                            <label for="export-csv" class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-100">Findings (.csv)</label>
                            <span class="tip-indicator" title="Export findings as CSV for spreadsheet import">?</span>
                        </div>
                    </div>
                </div>
                
                <div id="pdf-options" class="hidden">
                    <h4 class="text-sm font-medium text-gray-900 dark:text-gray-100 mb-2">PDF Options</h4>
                    <div class="space-y-2">
                        <div class="flex items-center">
                            <input type="checkbox" id="include-progress" checked class="w-4 h-4 text-blue-600 bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 focus:ring-blue-500">
                            <label for="include-progress" class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-100">Include Progress Charts</label>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="include-checklist" class="w-4 h-4 text-blue-600 bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 focus:ring-blue-500">
                            <label for="include-checklist" class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-100">Include Checklist Items</label>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="include-notes" checked class="w-4 h-4 text-blue-600 bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 focus:ring-blue-500">
                            <label for="include-notes" class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-100">Include Category Notes</label>
                        </div>
                    </div>
                </div>
                
                <div class="pt-4 border-t border-gray-200 dark:border-gray-700 flex justify-end">
                    <button type="button" class="w-full sm:w-auto text-white bg-blue-700 hover:bg-blue-800 dark:bg-blue-600 dark:hover:bg-blue-700 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 focus:outline-none transition-all duration-300" id="btn-confirm-export">Export</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="help-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 dark:bg-gray-900 dark:bg-opacity-80 flex items-center justify-center z-[1070] no-print modal p-4" style="display: none;">
        <div class="relative bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700 sticky top-0 bg-white dark:bg-gray-800 z-10">
                <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100">Help & Keyboard Shortcuts</h3>
                <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-gray-100 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center btn-close" aria-label="Close modal">
                    <i class="fas fa-times fa-lg"></i>
                </button>
            </div>
            <div class="p-6 space-y-6">
                <div>
                    <h4 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-3">Keyboard Shortcuts</h4>
                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 transition-all duration-300">
                        <table class="w-full text-sm">
                            <tbody class="divide-y divide-gray-200 dark:divide-gray-600">
                                <tr>
                                    <td class="py-2 font-medium text-gray-900 dark:text-gray-100"><span class="kbd">P</span></td>
                                    <td class="py-2 text-gray-700 dark:text-gray-300">Open Projects Panel</td>
                                </tr>
                                <tr>
                                    <td class="py-2 font-medium text-gray-900 dark:text-gray-100"><span class="kbd">E</span></td>
                                    <td class="py-2 text-gray-700 dark:text-gray-300">Edit Project Details</td>
                                </tr>
                                <tr>
                                    <td class="py-2 font-medium text-gray-900 dark:text-gray-100"><span class="kbd">F</span></td>
                                    <td class="py-2 text-gray-700 dark:text-gray-300">Add Finding</td>
                                </tr>
                                <tr>
                                    <td class="py-2 font-medium text-gray-900 dark:text-gray-100"><span class="kbd">T</span></td>
                                    <td class="py-2 text-gray-700 dark:text-gray-300">Toggle Dark Mode</td>
                                </tr>
                                <tr>
                                    <td class="py-2 font-medium text-gray-900 dark:text-gray-100"><span class="kbd">?</span></td>
                                    <td class="py-2 text-gray-700 dark:text-gray-300">Open This Help Panel</td>
                                </tr>
                                <tr>
                                    <td class="py-2 font-medium text-gray-900 dark:text-gray-100"><span class="kbd">Esc</span></td>
                                    <td class="py-2 text-gray-700 dark:text-gray-300">Close Modal / Panel</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div>
                    <h4 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-3">Quick Tips</h4>
                    <ul class="space-y-2 text-gray-700 dark:text-gray-300">
                        <li class="flex items-start gap-2">
                            <span class="text-blue-500 mt-1"><i class="fas fa-info-circle"></i></span>
                            <span>Use the <strong>circular progress indicators</strong> on each category card to quickly see completion status.</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="text-blue-500 mt-1"><i class="fas fa-info-circle"></i></span>
                            <span>The <strong>Quick Jump Navigation</strong> at the bottom of the screen helps you navigate between sections.</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="text-blue-500 mt-1"><i class="fas fa-info-circle"></i></span>
                            <span>Use the <strong>Floating Action Button</strong> for quick access to common actions from anywhere on the page.</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="text-blue-500 mt-1"><i class="fas fa-info-circle"></i></span>
                            <span>All data is stored locally in your browser. Use <strong>Export/Import</strong> to backup or transfer your projects.</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" role="alert" aria-live="assertive" class="toast">
        <div class="flex items-center">
            <i id="toast-icon" class="fas fa-check-circle mr-3"></i>
            <span id="toast-message">Action completed.</span>
        </div>
    </div>

    <footer class="bg-gray-800 dark:bg-gray-900 text-gray-300 dark:text-gray-400 no-print mt-16 transition-all duration-300">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="md:col-span-1">
                    <h3 class="text-lg font-semibold text-white mb-2">OWASP API Security Checklist</h3>
                    <p class="text-sm text-gray-400">An interactive framework based on the OWASP API Security Top 10 (2023). Helps track API security assessment progress.</p>
                </div>
                <div>
                    <h4 class="text-base font-semibold text-white mb-2">OWASP Resources</h4>
                    <ul class="text-sm space-y-1">
                        <li><a href="https://owasp.org/API-Security/editions/2023/en/0x00-toc/" target="_blank" rel="noopener noreferrer" class="hover:text-white hover:underline">OWASP API Security Top 10</a></li>
                        <li><a href="https://owasp.org/www-project-web-security-testing-guide/" target="_blank" rel="noopener noreferrer" class="hover:text-white hover:underline">OWASP Testing Guide (WSTG)</a></li>
                        <li><a href="https://github.com/OWASP/API-Security" target="_blank" rel="noopener noreferrer" class="hover:text-white hover:underline">OWASP API Security GitHub</a></li>
                        <li><a href="https://cheatsheetseries.owasp.org/" target="_blank" rel="noopener noreferrer" class="hover:text-white hover:underline">OWASP Cheat Sheet Series</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-base font-semibold text-white mb-2">About This Tool</h4>
                    <p class="text-sm text-gray-400">Data is saved locally in your browser via LocalStorage. No data is sent externally. Use Export/Import for backup or transfer.</p>
                    <div class="flex items-center space-x-4 mt-4">
                        <button id="btn-show-help" class="text-sm text-blue-400 hover:text-blue-300 flex items-center gap-1">
                            <i class="fas fa-question-circle"></i> Help
                        </button>
                        <a href="https://github.com/owasp" target="_blank" rel="noopener noreferrer" class="text-sm text-blue-400 hover:text-blue-300 flex items-center gap-1">
                            <i class="fab fa-github"></i> GitHub
                        </a>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-6 text-center text-sm text-gray-500">
                <p>&copy; 2023 OWASP API Security Checklist. Tool provided as-is.</p>
            </div>
        </div>
    </footer>

    <script>
        // --- Category Data ---
        const categories = {
            'broken-object-level-auth': {
                title: 'API1:2023 Broken Object Level Authorization',
                subtitle: 'APIs tend to expose endpoints that handle object identifiers, creating a wide attack surface of Object Level Access Control issues.',
                priority: 'critical',
                checklistItems: [
                    { groupTitle: 'Resource Access Controls' },
                    { id: 'bola-1', text: 'Test for access to resources belonging to other users via ID manipulation in URLs or parameters' },
                    { id: 'bola-2', text: 'Verify that resource identifiers are not predictable or easily guessable' },
                    { id: 'bola-3', text: 'Check for IDOR vulnerabilities in GET, POST, PUT, PATCH and DELETE methods' },
                    { id: 'bola-4', text: 'Test if mass assignment can bypass object-level authorization' },
                    { groupTitle: 'Authorization Implementation' },
                    { id: 'bola-5', text: 'Verify authorization checks are performed at the object level for all CRUD operations' },
                    { id: 'bola-6', text: 'Test if authorization controls can be bypassed by using different API endpoints or methods' },
                    { id: 'bola-7', text: 'Check if applying non-standard operations bypasses object level checks' },
                    { id: 'bola-8', text: 'Verify that child/nested resource operations enforce parent object authorization' },
                    { groupTitle: 'Additional BOLA Tests' },
                    { id: 'bola-9', text: 'Test GraphQL queries for broken access controls across nested objects and relations' },
                    { id: 'bola-10', text: 'Check if metadata or alternative representations of objects bypass object level authorization' },
                    { id: 'bola-11', text: 'Test if referencing objects indirectly (e.g., via files, URLs) bypasses authorization checks' },
                    { id: 'bola-12', text: 'Verify proper access controls for API endpoint and object discovery' },
                ],
                techniquesHTML: `<div class="space-y-6">
                    <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
                        <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">IDOR Testing Methodology</h4>
                        <p class="text-gray-600 dark:text-gray-300 mb-2">Identifying and exploiting Insecure Direct Object References:</p>
                        <ol class="list-decimal list-inside text-gray-600 dark:text-gray-300 space-y-1 pl-2">
                            <li>Map all API endpoints that accept object identifiers</li>
                            <li>Identify all methods of referencing objects (numeric IDs, UUIDs, slugs, etc.)</li>
                            <li>Create multiple test accounts to obtain valid object references</li>
                            <li>Attempt cross-account access by manipulating object references</li>
                            <li>Test vertical access escalation (e.g., regular user accessing admin resources)</li>
                            <li>Test horizontal access escalation (e.g., user A accessing user B's objects)</li>
                            <li>Test pattern manipulation for non-numeric IDs (e.g., changing values in JWTs or encoded identifiers)</li>
                        </ol>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
                        <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">Testing All HTTP Methods</h4>
                        <p class="text-gray-600 dark:text-gray-300 mb-2">Authorization bypass often occurs through alternative methods:</p>
                        <pre class="bg-gray-100 dark:bg-gray-800 p-2 rounded text-xs overflow-auto">
# Example: If GET /api/resources/123 is properly protected but other methods aren't
GET /api/resources/123      # Access denied (proper)
POST /api/resources/123     # May allow access (bypass)
PUT /api/resources/123      # May allow access (bypass)
PATCH /api/resources/123    # May allow access (bypass)
DELETE /api/resources/123   # May allow access (bypass)
OPTIONS /api/resources/123  # May reveal vulnerable methods</pre>
                        <p class="text-gray-600 dark:text-gray-300 mt-2">Always test all HTTP methods on each endpoint, even if they're not documented or expected.</p>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
                        <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">GraphQL-Specific BOLA Testing</h4>
                        <p class="text-gray-600 dark:text-gray-300 mb-2">GraphQL adds complexity with nested resources:</p>
                        <ul class="list-disc list-inside text-gray-600 dark:text-gray-300 space-y-1 pl-2">
                            <li>Use introspection to discover data models and relations</li>
                            <li>Test access controls across nested object queries</li>
                            <li>Check if field-level permissions are properly enforced</li>
                            <li>Test if batched queries bypass authorization</li>
                            <li>Check if mutations have proper authorization checks</li>
                        </ul>
                        <p class="text-gray-600 dark:text-gray-300 mt-2">GraphQL endpoints may implement inconsistent authorization between different operations or nesting levels.</p>
                    </div>
                </div>`,
                toolsHTML: `<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
                        <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                            <i class="fas fa-random text-blue-600 dark:text-blue-400"></i>Autorize (Burp Extension)
                        </h4>
                        <p class="text-gray-600 dark:text-gray-300 mb-2">Automates testing of authorization issues by comparing responses between different users.</p>
                        <a href="https://github.com/PortSwigger/autorize" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">GitHub <i class="fas fa-external-link-alt"></i></a>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
                        <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                            <i class="fas fa-exchange-alt text-blue-600 dark:text-blue-400"></i>AuthMatrix
                        </h4>
                        <p class="text-gray-600 dark:text-gray-300 mb-2">Burp Suite extension for assessing authorization in applications with complex role-based access control.</p>
                        <a href="https://github.com/SecurityInnovation/AuthMatrix" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">GitHub <i class="fas fa-external-link-alt"></i></a>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
                        <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                            <i class="fas fa-id-card text-blue-600 dark:text-blue-400"></i>IDOR Scanner
                        </h4>
                        <p class="text-gray-600 dark:text-gray-300 mb-2">Tool for detecting and exploiting insecure direct object reference vulnerabilities.</p>
                        <a href="https://github.com/Fdawgs/ydh-fhir-api/wiki" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">GitHub <i class="fas fa-external-link-alt"></i></a>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
                        <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                            <i class="fas fa-project-diagram text-blue-600 dark:text-blue-400"></i>GraphQL Voyager & InQL
                        </h4>
                        <p class="text-gray-600 dark:text-gray-300 mb-2">Tools for visualizing and testing GraphQL API endpoints and relationships.</p>
                        <a href="https://github.com/APIs-guru/graphql-voyager" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1 mr-2">Voyager <i class="fas fa-external-link-alt"></i></a>
                        <a href="https://github.com/doyensec/inql" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">InQL <i class="fas fa-external-link-alt"></i></a>
                    </div>
                </div>`
            },
            'broken-authentication': {
                title: 'API2:2023 Broken Authentication',
                subtitle: 'Authentication mechanisms are often implemented incorrectly, allowing attackers to compromise tokens or exploit implementation flaws.',
                priority: 'critical',
                checklistItems: [
                    { groupTitle: 'Authentication Implementation' },
                    { id: 'auth-1', text: 'Test for weak password policies and brute force protection' },
                    { id: 'auth-2', text: 'Verify JWT tokens are correctly signed and validated' },
                    { id: 'auth-3', text: 'Test for JWT algorithm confusion attacks' },
                    { id: 'auth-4', text: 'Check for weak encryption or improper storage of credentials and tokens' },
                    { groupTitle: 'Token Management' },
                    { id: 'auth-5', text: 'Verify proper token expiration and rotation policies' },
                    { id: 'auth-6', text: 'Test for client-side token storage vulnerabilities' },
                    { id: 'auth-7', text: 'Check if API accepts tokens from unintended sources (token binding issues)' },
                    { id: 'auth-8', text: 'Test if tokens remain valid after logout or password change' },
                    { groupTitle: 'Authentication Flows' },
                    { id: 'auth-9', text: 'Test OAuth flows for implementation vulnerabilities (redirect_uri validation, PKCE)' },
                    { id: 'auth-10', text: 'Check for insecure distribution of API keys or credentials' },
                    { id: 'auth-11', text: 'Verify multi-factor authentication implementation (if available)' },
                    { id: 'auth-12', text: 'Test password reset functionality for authentication bypass' },
                ],
                techniquesHTML: `<div class="space-y-6">
                    <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
                        <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">JWT Token Analysis</h4>
                        <p class="text-gray-600 dark:text-gray-300 mb-2">Common JWT security vulnerabilities to test:</p>
                        <ul class="list-disc list-inside text-gray-600 dark:text-gray-300 space-y-1 pl-2">
                            <li>Test "alg:none" bypass: Modify JWT to have no algorithm</li>
                            <li>Try algorithm confusion: Change RS256 to HS256 and sign with public key</li>
                            <li>Check for weak signing keys</li>
                            <li>Test for missing signature validation</li>
                            <li>Modify token payload claims to elevate privileges</li>
                            <li>Examine if token validation is performed properly</li>
                            <li>Test for missing expiration checks or too long-lived tokens</li>
                        </ul>
                        <p class="text-gray-600 dark:text-gray-300 mt-2">Use tools like jwt.io to decode and analyze token structure and claims.</p>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
                        <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">OAuth Flow Testing</h4>
                        <p class="text-gray-600 dark:text-gray-300 mb-2">Common OAuth implementation vulnerabilities:</p>
                        <ul class="list-disc list-inside text-gray-600 dark:text-gray-300 space-y-1 pl-2">
                            <li>Verify redirect_uri validation is strict (no open redirects)</li>
                            <li>Test CSRF protection on authorization endpoints</li>
                            <li>Check for PKCE implementation in OAuth flows</li>
                            <li>Test state parameter validation and implementation</li>
                            <li>Verify proper handling of authorization codes (single use, time limited)</li>
                            <li>Test client_id and client_secret management</li>
                            <li>Check for token leakage in logs, URLs, or referrer headers</li>
                        </ul>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
                        <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">API Key Authentication Tests</h4>
                        <p class="text-gray-600 dark:text-gray-300 mb-2">Security assessment for API key implementations:</p>
                        <ul class="list-disc list-inside text-gray-600 dark:text-gray-300 space-y-1 pl-2">
                            <li>Check if API keys are transmitted securely (not in URLs)</li>
                            <li>Test API key rotation and revocation mechanisms</li>
                            <li>Verify proper entropy and format of generated API keys</li>
                            <li>Check for granular permissions on API keys</li>
                            <li>Test rate limiting and monitoring for API key usage</li>
                            <li>Verify API keys aren't leaked in error messages or logs</li>
                        </ul>
                    </div>
                </div>`,
                toolsHTML: `<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
                        <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                            <i class="fas fa-key text-blue-600 dark:text-blue-400"></i>JWT_Tool
                        </h4>
                        <p class="text-gray-600 dark:text-gray-300 mb-2">Toolkit for testing, tweaking and cracking JWTs.</p>
                        <a href="https://github.com/ticarpi/jwt_tool" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">GitHub <i class="fas fa-external-link-alt"></i></a>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
                        <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                            <i class="fas fa-hammer text-blue-600 dark:text-blue-400"></i>Hydra
                        </h4>
                        <p class="text-gray-600 dark:text-gray-300 mb-2">Fast and flexible online password cracking tool.</p>
                        <a href="https://github.com/vanhauser-thc/thc-hydra" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">GitHub <i class="fas fa-external-link-alt"></i></a>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
                        <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                            <i class="fas fa-route text-blue-600 dark:text-blue-400"></i>OAuthScan
                        </h4>
                        <p class="text-gray-600 dark:text-gray-300 mb-2">Tool for testing OAuth implementations for vulnerabilities.</p>
                        <a href="https://github.com/road-runner-beep-beep/oauth-scan-website" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">GitHub <i class="fas fa-external-link-alt"></i></a>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
                        <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                            <i class="fas fa-user-secret text-blue-600 dark:text-blue-400"></i>Burp Suite Auth Analyzer
                        </h4>
                        <p class="text-gray-600 dark:text-gray-300 mb-2">Burp extension for automating authentication testing.</p>
                        <a href="https://portswigger.net/bappstore/18ac5940afcb4a73a4dc4483e8d6c1ba" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">BApp Store <i class="fas fa-external-link-alt"></i></a>
                    </div>
                </div>`
            },
            
            // More categories following the same pattern..
            'broken-object-property-level-auth': {
                title: 'API3:2023 Broken Object Property Level Authorization',
                subtitle: 'APIs don\'t properly protect sensitive object properties, leading to information disclosure or manipulation.',
                priority: 'high',
                checklistItems: [
                    { groupTitle: 'Object Property Access Controls' },
                    { id: 'bopla-1', text: 'Test for sensitive properties exposed in API responses' },
                    { id: 'bopla-2', text: 'Verify property-level access controls on different HTTP methods (GET vs PUT/PATCH)' },
                    { id: 'bopla-3', text: 'Check for excessive data exposure (overly verbose responses)' },
                    { id: 'bopla-4', text: 'Test if hidden/private fields can be accessed via direct property references' },
                    { groupTitle: 'Object Manipulation' },
                    { id: 'bopla-5', text: 'Test for mass assignment vulnerabilities allowing property manipulation' },
                    { id: 'bopla-6', text: 'Verify protections against modifying read-only properties' },
                    { id: 'bopla-7', text: 'Test if property-level controls can be bypassed via different API routes' },
                    { id: 'bopla-8', text: 'Check if different serialization formats allow access to restricted properties' },
                    { groupTitle: 'Advanced Property Techniques' },
                    { id: 'bopla-9', text: 'Test GraphQL APIs for property-level access control issues across query types' },
                    { id: 'bopla-10', text: 'Check if properties can be accessed by reference in nested objects' },
                    { id: 'bopla-11', text: 'Verify property-level controls for array items and collection members' },
                    { id: 'bopla-12', text: 'Test for leaked property metadata that reveals sensitive information' }
                ],
                techniquesHTML: `<div class="space-y-6">
                    <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
                        <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">Mass Assignment Testing</h4>
                        <p class="text-gray-600 dark:text-gray-300 mb-2">Testing for mass assignment vulnerabilities:</p>
                        <ol class="list-decimal list-inside text-gray-600 dark:text-gray-300 space-y-1 pl-2">
                            <li>Create a baseline object through normal API usage</li>
                            <li>Examine all object properties returned from APIs</li>
                            <li>Identify sensitive or seemingly internal properties</li>
                            <li>Send a PUT/PATCH/POST request with modified versions of these properties</li>
                            <li>Attempt to modify properties that should be read-only</li>
                            <li>Try adding undocumented properties like <code>is_admin</code>, <code>role</code>, <code>permissions</code></li>
                            <li>Test for property overwrite of security-critical values</li>
                        </ol>
                        <p class="text-gray-600 dark:text-gray-300 mt-2">Many frameworks bind client-provided JSON directly to internal objects, allowing attackers to set unexpected properties.</p>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
                        <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">Object Property Enumeration</h4>
                        <p class="text-gray-600 dark:text-gray-300 mb-2">Techniques to discover hidden properties:</p>
                        <ul class="list-disc list-inside text-gray-600 dark:text-gray-300 space-y-1 pl-2">
                            <li>Compare responses across different roles/permissions</li>
                            <li>Test for verbose error messages revealing property schemas</li>
                            <li>Examine API documentation and SDK client code for property hints</li>
                            <li>Compare production vs. development environments for differences in exposed properties</li>
                            <li>Use GraphQL introspection to discover all object fields</li>
                            <li>Analyze client-side code for references to hidden API properties</li>
                        </ul>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
                        <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">GraphQL Property Access Tests</h4>
                        <p class="text-gray-600 dark:text-gray-300 mb-2">GraphQL-specific property testing:</p>
                        <ul class="list-disc list-inside text-gray-600 dark:text-gray-300 space-y-1 pl-2">
                            <li>Use introspection to identify all available fields on types</li>
                            <li>Test access controls on sensitive fields across different queries/mutations</li>
                            <li>Check if property-level permissions are consistently enforced</li>
                            <li>Test nested queries for property access control bypasses</li>
                            <li>Verify field-level authorization in fragments</li>
                            <li>Check if batched queries can access restricted properties</li>
                        </ul>
                    </div>
                </div>`,
                toolsHTML: `<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
                        <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                            <i class="fas fa-bomb text-blue-600 dark:text-blue-400"></i>Param Miner
                        </h4>
                        <p class="text-gray-600 dark:text-gray-300 mb-2">Burp extension for discovering hidden parameters and properties.</p>
                        <a href="https://github.com/PortSwigger/param-miner" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">GitHub <i class="fas fa-external-link-alt"></i></a>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
                        <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                            <i class="fas fa-microscope text-blue-600 dark:text-blue-400"></i>JSON Web Token Toolkit
                        </h4>
                        <p class="text-gray-600 dark:text-gray-300 mb-2">Tool for analyzing and manipulating JSON objects and tokens.</p>
                        <a href="https://github.com/ticarpi/jwt_tool" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">GitHub <i class="fas fa-external-link-alt"></i></a>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
                        <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                            <i class="fas fa-project-diagram text-blue-600 dark:text-blue-400"></i>GraphQL Voyager
                        </h4>
                        <p class="text-gray-600 dark:text-gray-300 mb-2">Visualization tool for GraphQL API schemas and relationships.</p>
                        <a href="https://github.com/APIs-guru/graphql-voyager" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">GitHub <i class="fas fa-external-link-alt"></i></a>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
                        <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                            <i class="fas fa-exchange-alt text-blue-600 dark:text-blue-400"></i>JSON Comparator Tools
                        </h4>
                        <p class="text-gray-600 dark:text-gray-300 mb-2">Tools for comparing JSON responses to spot property differences.</p>
                        <a href="https://jsoncompare.org/" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">JSONCompare <i class="fas fa-external-link-alt"></i></a>
                    </div>
                </div>`
            },

            // Add remaining categories in the same pattern
            // (I'll include just brief examples of each remaining category structure)

            'unrestricted-resource-consumption': {
                title: 'API4:2023 Unrestricted Resource Consumption',
                subtitle: 'APIs not properly limiting resource consumption can lead to DoS attacks or increased operational costs.',
                priority: 'high',
                checklistItems: [
                    // Add checklist items for this category
                    { groupTitle: 'Rate Limiting Implementation' },
                    { id: 'urc-1', text: 'Test for missing or insufficient rate limiting' },
                    { id: 'urc-2', text: 'Verify rate limiting mechanisms have appropriate thresholds' },
                    { id: 'urc-3', text: 'Test if rate limits can be bypassed (IP rotation, user account switching)' },
                    { id: 'urc-4', text: 'Check if rate-limiting headers provide excessive information' },
                    { groupTitle: 'Resource Allocation Controls' },
                    { id: 'urc-5', text: 'Test APIs for resource-intensive operations that can be abused' },
                    { id: 'urc-6', text: 'Verify limits on payload size, query complexity, and resource allocation' },
                    { id: 'urc-7', text: 'Test pagination limits and default values for list operations' },
                    { id: 'urc-8', text: 'Check if APIs implement timeouts on long-running operations' },
                    { groupTitle: 'API-Specific Consumption Tests' },
                    { id: 'urc-9', text: 'Test GraphQL query complexity and nested query limitations' },
                    { id: 'urc-10', text: 'Check for transaction or process limits in business operations' },
                    { id: 'urc-11', text: 'Test upload functionality for file size and type restrictions' },
                    { id: 'urc-12', text: 'Verify proper resource allocation in batch operations' }
                ],
                // Add techniquesHTML and toolsHTML
                techniquesHTML: `<div class="space-y-6">
                    <!-- Add techniques content -->
                </div>`,
                toolsHTML: `<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Add tools content -->
                </div>`
            },

           'unrestricted-resource-consumption': {
    title: 'API4:2023 Unrestricted Resource Consumption',
    subtitle: 'APIs not properly limiting resource consumption can lead to DoS attacks or increased operational costs.',
    priority: 'high',
    checklistItems: [
        { groupTitle: 'Rate Limiting Implementation' },
        { id: 'urc-1', text: 'Test for missing or insufficient rate limiting' },
        { id: 'urc-2', text: 'Verify rate limiting mechanisms have appropriate thresholds' },
        { id: 'urc-3', text: 'Test if rate limits can be bypassed (IP rotation, user account switching)' },
        { id: 'urc-4', text: 'Check if rate-limiting headers provide excessive information' },
        { groupTitle: 'Resource Allocation Controls' },
        { id: 'urc-5', text: 'Test APIs for resource-intensive operations that can be abused' },
        { id: 'urc-6', text: 'Verify limits on payload size, query complexity, and resource allocation' },
        { id: 'urc-7', text: 'Test pagination limits and default values for list operations' },
        { id: 'urc-8', text: 'Check if APIs implement timeouts on long-running operations' },
        { groupTitle: 'API-Specific Consumption Tests' },
        { id: 'urc-9', text: 'Test GraphQL query complexity and nested query limitations' },
        { id: 'urc-10', text: 'Check for transaction or process limits in business operations' },
        { id: 'urc-11', text: 'Test upload functionality for file size and type restrictions' },
        { id: 'urc-12', text: 'Verify proper resource allocation in batch operations' }
    ],
    techniquesHTML: `<div class="space-y-6">
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">Rate Limiting Bypass Techniques</h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Methodologies to test rate limit effectiveness:</p>
            <ul class="list-disc list-inside text-gray-600 dark:text-gray-300 space-y-1 pl-2">
                <li>Rotate or spoof IP addresses using proxies or VPNs</li>
                <li>Manipulate or forge X-Forwarded-For or similar headers</li>
                <li>Distribute requests across multiple user accounts</li>
                <li>Test for race conditions in rate limiting implementations</li>
                <li>Use multiple API keys if the system allows them</li>
                <li>Try adding random or varying request parameters to bypass caching-based rate limiting</li>
                <li>Test for rate limit resets on specific API operations</li>
            </ul>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">Resource Exhaustion Testing</h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Methods to identify resource consumption vulnerabilities:</p>
            <ul class="list-disc list-inside text-gray-600 dark:text-gray-300 space-y-1 pl-2">
                <li>Send extremely large JSON or XML payloads to test size limits</li>
                <li>Create deeply nested objects to test parser recursion limits</li>
                <li>Request large result sets by manipulating pagination parameters</li>
                <li>Test for N+1 query vulnerabilities in API endpoints that return collections</li>
                <li>Trigger computationally expensive operations repeatedly</li>
                <li>Test file upload functionality with large files or zipbombs</li>
            </ul>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">GraphQL Query Complexity Analysis</h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">GraphQL-specific techniques:</p>
            <pre class="bg-gray-100 dark:bg-gray-800 p-2 rounded text-xs overflow-auto">
# Example of a deeply nested GraphQL query that could cause performance issues
query {
  users(first: 100) {
    edges {
      node {
        posts(first: 100) {
          edges {
            node {
              comments(first: 100) {
                edges {
                  node {
                    replies(first: 100) {
                      edges {
                        node {
                          author {
                            profile {
                              ...AllUserFields
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}</pre>
            <p class="text-gray-600 dark:text-gray-300 mt-2">Look for limits on query depth, complexity, number of objects returned, and field-level constraints.</p>
        </div>
    </div>`,
    toolsHTML: `<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                <i class="fas fa-tachometer-alt text-blue-600 dark:text-blue-400"></i>API Fuzzer
            </h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Automated testing tool that identifies API limits and potential DoS vulnerabilities.</p>
            <a href="https://github.com/KissPeter/APIFuzzer" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">GitHub <i class="fas fa-external-link-alt"></i></a>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                <i class="fas fa-server text-blue-600 dark:text-blue-400"></i>Gatling
            </h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Load testing tool useful for resource consumption evaluation and performance testing.</p>
            <a href="https://gatling.io/" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">Website <i class="fas fa-external-link-alt"></i></a>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                <i class="fas fa-project-diagram text-blue-600 dark:text-blue-400"></i>GraphQL Query Cost Analysis
            </h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Tools for analyzing and measuring GraphQL query complexity and performance impact.</p>
            <a href="https://github.com/slicknode/graphql-query-complexity" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">GitHub <i class="fas fa-external-link-alt"></i></a>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                <i class="fas fa-shower text-blue-600 dark:text-blue-400"></i>Slowloris
            </h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Tool for testing low-and-slow HTTP DoS attacks on web servers and APIs.</p>
            <a href="https://github.com/gkbrk/slowloris" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">GitHub <i class="fas fa-external-link-alt"></i></a>
        </div>
    </div>`
},

'broken-function-level-auth': {
    title: 'API5:2023 Broken Function Level Authorization',
    subtitle: 'Complex access control policies with unclear permissions can lead to unauthorized access to admin functions.',
    priority: 'critical',
    checklistItems: [
        { groupTitle: 'Function Access Control Testing' },
        { id: 'bfla-1', text: 'Test administrative functions from unprivileged user accounts' },
        { id: 'bfla-2', text: 'Verify API endpoints enforce consistent authorization checks' },
        { id: 'bfla-3', text: 'Check for authorization bypasses by directly accessing API endpoints' },
        { id: 'bfla-4', text: 'Test horizontal privilege escalation between same-level user accounts' },
        { groupTitle: 'Endpoint Discovery and Analysis' },
        { id: 'bfla-5', text: 'Identify hidden or undocumented API endpoints through enumeration' },
        { id: 'bfla-6', text: 'Test beta or deprecated API endpoints for authorization weaknesses' },
        { id: 'bfla-7', text: 'Verify effective access control on API endpoints that modify data' },
        { id: 'bfla-8', text: 'Check APIs that serve different clients for inconsistent permissions' },
        { groupTitle: 'Advanced Authorization Tests' },
        { id: 'bfla-9', text: 'Test multi-step workflows for authorization checks at each stage' },
        { id: 'bfla-10', text: 'Verify authorization model effectiveness across microservices' },
        { id: 'bfla-11', text: 'Test if changes in account attributes affect existing authorization' },
        { id: 'bfla-12', text: 'Check for access control implementation flaws on server-side' }
    ],
    techniquesHTML: `<div class="space-y-6">
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">Function Enumeration Strategy</h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">How to discover and test administrative functions:</p>
            <ol class="list-decimal list-inside text-gray-600 dark:text-gray-300 space-y-1 pl-2">
                <li>Create accounts with various permission levels</li>
                <li>Monitor API calls made by the frontend when using admin functions</li>
                <li>Analyze URLs, parameters, and HTTP methods used by administrative interfaces</li>
                <li>Attempt to access admin endpoints directly with non-admin credentials</li>
                <li>Analyze JavaScript files for hidden endpoint references</li>
                <li>Check for horizontal access (accessing other users' functions)</li>
                <li>Test for forced browsing to administrative endpoints</li>
            </ol>
            <p class="text-gray-600 dark:text-gray-300 mt-2">Pay special attention to endpoints containing "admin", "manage", "internal", or similar terms.</p>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">API Parameter Testing</h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Testing for parameter-based bypasses:</p>
            <ul class="list-disc list-inside text-gray-600 dark:text-gray-300 space-y-1 pl-2">
                <li>Try modifying or adding role-based parameters to requests</li>
                <li>Test if hidden parameters can be used to bypass authorization</li>
                <li>Check if APIs accept outdated authentication tokens with higher privileges</li>
                <li>Experiment with modifying referer or origin headers</li>
                <li>Test if switching HTTP methods (POST→GET) affects authorization checks</li>
                <li>Check if authorization can be bypassed using debug parameters</li>
            </ul>
            <pre class="bg-gray-100 dark:bg-gray-800 p-2 rounded text-xs overflow-auto mt-2">
# Example: Adding parameters that might bypass authorization
GET /api/users/123/profile              # Normal user access
GET /api/users/123/profile?role=admin   # Testing for role parameter bypass
GET /api/users/123/profile?debug=true   # Testing for debug-mode bypass
GET /api/users/123/profile?internal=1   # Testing for internal flag bypass</pre>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">Authorization Matrix Testing</h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Creating and using authorization test matrices:</p>
            <p class="text-gray-600 dark:text-gray-300">Create a comprehensive matrix mapping user roles to API functions, then methodically test each combination to identify authorization gaps. Example matrix structure:</p>
            <table class="border-collapse w-full mt-3 text-sm">
                <thead class="bg-gray-100 dark:bg-gray-800">
                    <tr>
                        <th class="border border-gray-300 dark:border-gray-600 p-2 text-left">API Endpoint</th>
                        <th class="border border-gray-300 dark:border-gray-600 p-2 text-left">Anonymous</th>
                        <th class="border border-gray-300 dark:border-gray-600 p-2 text-left">User</th>
                        <th class="border border-gray-300 dark:border-gray-600 p-2 text-left">Manager</th>
                        <th class="border border-gray-300 dark:border-gray-600 p-2 text-left">Admin</th>
                    </tr>
                </thead>
                <tbody class="text-gray-600 dark:text-gray-300">
                    <tr>
                        <td class="border border-gray-300 dark:border-gray-600 p-2">/api/users/list</td>
                        <td class="border border-gray-300 dark:border-gray-600 p-2">❌</td>
                        <td class="border border-gray-300 dark:border-gray-600 p-2">❌</td>
                        <td class="border border-gray-300 dark:border-gray-600 p-2">✅</td>
                        <td class="border border-gray-300 dark:border-gray-600 p-2">✅</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>`,
    toolsHTML: `<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                <i class="fas fa-layer-group text-blue-600 dark:text-blue-400"></i>AuthMatrix
            </h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Burp Suite extension for systematically testing authorization in APIs.</p>
            <a href="https://github.com/SecurityInnovation/AuthMatrix" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">GitHub <i class="fas fa-external-link-alt"></i></a>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                <i class="fas fa-key text-blue-600 dark:text-blue-400"></i>Autorize
            </h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Burp Suite extension that automatically detects authorization issues.</p>
            <a href="https://github.com/Quitten/Autorize" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">GitHub <i class="fas fa-external-link-alt"></i></a>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                <i class="fas fa-dice-d20 text-blue-600 dark:text-blue-400"></i>API Endpoints Discovery
            </h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Tools for discovering hidden API endpoints and functions.</p>
            <a href="https://github.com/assetnote/kiterunner" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">Kiterunner <i class="fas fa-external-link-alt"></i></a>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                <i class="fas fa-users-cog text-blue-600 dark:text-blue-400"></i>RBAC Visualization Tools
            </h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Tools for mapping and visualizing role-based access controls in APIs.</p>
            <a href="https://github.com/ermetic-research/access-undenied" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">Access Undenied <i class="fas fa-external-link-alt"></i></a>
        </div>
    </div>`
},

'unrestricted-access-to-business-flows': {
    title: 'API6:2023 Unrestricted Access to Business Flows',
    subtitle: 'APIs exposing business flows without proper protection enable attackers to abuse functionality or perform actions repeatedly.',
    priority: 'high',
    checklistItems: [
        { groupTitle: 'Business Flow Analysis' },
        { id: 'uabf-1', text: 'Identify critical business flows and map their API call sequences' },
        { id: 'uabf-2', text: 'Test for missing rate limits on key business operations' },
        { id: 'uabf-3', text: 'Check if sensitive operations can be repeated or automated excessively' },
        { id: 'uabf-4', text: 'Test for business flow manipulation by changing transaction order' },
        { groupTitle: 'Protection Mechanism Testing' },
        { id: 'uabf-5', text: 'Verify anti-automation defenses on critical functions' },
        { id: 'uabf-6', text: 'Test CAPTCHA or other anti-bot measures for bypasses' },
        { id: 'uabf-7', text: 'Check for secure implementation of financial or high-value operations' },
        { id: 'uabf-8', text: 'Verify proper transaction limits are enforced' },
        { groupTitle: 'Advanced Business Flow Testing' },
        { id: 'uabf-9', text: 'Test for fraud detection and prevention mechanisms' },
        { id: 'uabf-10', text: 'Check if multi-step flows validate parameters across all steps' },
        { id: 'uabf-11', text: 'Verify defenses against price manipulation in purchase flows' },
        { id: 'uabf-12', text: 'Test for time-of-check to time-of-use (TOCTOU) vulnerabilities' }
    ],
    techniquesHTML: `<div class="space-y-6">
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">Business Flow Mapping</h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">How to identify and document business flows:</p>
            <ol class="list-decimal list-inside text-gray-600 dark:text-gray-300 space-y-1 pl-2">
                <li>Identify and document the complete API call sequence for key business flows</li>
                <li>Map dependencies between API calls (what data flows from one call to another)</li>
                <li>Identify client-enforced restrictions that might be bypassed server-side</li>
                <li>Note what business limits are advertised or expected by the application</li>
                <li>Create accounts with different roles to understand authorization differences</li>
            </ol>
            <p class="text-gray-600 dark:text-gray-300 mt-2">Common critical business flows include: registration, purchasing, discount application, account upgrades, resource allocation, and sensitive data access.</p>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">Automation and Rate Limit Testing</h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Testing business logic automation defenses:</p>
            <ul class="list-disc list-inside text-gray-600 dark:text-gray-300 space-y-1 pl-2">
                <li>Create scripts to automate repetitive business operations</li>
                <li>Test high-frequency API calls to critical business endpoints</li>
                <li>Check if operations can be parallelized to bypass sequential checks</li>
                <li>Test if business limits are enforced per user, per IP, or globally</li>
                <li>Verify if rate limits scale with account privileges or payment tier</li>
                <li>Test if rate limiting resets can be forced or manipulated</li>
            </ul>
            <pre class="bg-gray-100 dark:bg-gray-800 p-2 rounded text-xs overflow-auto mt-2">
# Example test script approach
for i in range(1000):
    # 1. Create coupon code
    response1 = api.create_coupon(discount=10)
    coupon_id = response1.json()['coupon_id']
    
    # 2. Apply coupon to order
    response2 = api.apply_coupon(order_id=123, coupon_id=coupon_id)
    
    # 3. Check if any business limits were enforced</pre>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">Business Logic Manipulation</h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Techniques for finding business logic flaws:</p>
            <ul class="list-disc list-inside text-gray-600 dark:text-gray-300 space-y-1 pl-2">
                <li>Change the sequence of operations in multi-step business flows</li>
                <li>Submit duplicate requests at critical transaction points</li>
                <li>Identify and manipulate price calculation operations</li>
                <li>Test for race conditions by sending near-simultaneous requests</li>
                <li>Try to circumvent step validation by jumping directly to later steps</li>
                <li>Mix legitimate and malicious requests to avoid detection</li>
                <li>Test how the system handles partial completion of business flows</li>
            </ul>
            <p class="text-gray-600 dark:text-gray-300 mt-2">Focus on financial flows, quantity limitations, and premium feature access.</p>
        </div>
    </div>`,
    toolsHTML: `<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                <i class="fas fa-robot text-blue-600 dark:text-blue-400"></i>Turbo Intruder
            </h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Burp Suite extension for sending many HTTP requests and testing rate limits and race conditions.</p>
            <a href="https://github.com/PortSwigger/turbo-intruder" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">GitHub <i class="fas fa-external-link-alt"></i></a>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                <i class="fas fa-chart-line text-blue-600 dark:text-blue-400"></i>Business Logic Data Mining
            </h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Tools for analyzing API logs and responses to identify business logic patterns.</p>
            <a href="https://github.com/BugBountyHub/apimonitor" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">API Monitor <i class="fas fa-external-link-alt"></i></a>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                <i class="fas fa-stopwatch text-blue-600 dark:text-blue-400"></i>Race Condition Tester
            </h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Tool for identifying race conditions in business flows and transactions.</p>
            <a href="https://github.com/gteissier/race-the-web" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">Race The Web <i class="fas fa-external-link-alt"></i></a>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                <i class="fas fa-sitemap text-blue-600 dark:text-blue-400"></i>Workflow Analyzers
            </h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Tools for mapping and visualizing multi-step API workflows and dependencies.</p>
            <a href="https://github.com/flipkart-incubator/Astra" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">Astra <i class="fas fa-external-link-alt"></i></a>
        </div>
    </div>`
},

'server-side-request-forgery': {
    title: 'API7:2023 Server-Side Request Forgery',
    subtitle: 'APIs that fetch remote resources without proper validation allow attackers to force the server to send crafted requests.',
    priority: 'high',
    checklistItems: [
        { groupTitle: 'SSRF Entry Points' },
        { id: 'ssrf-1', text: 'Identify API endpoints that accept URLs or resource identifiers as input' },
        { id: 'ssrf-2', text: 'Test URL parameters for SSRF vulnerabilities' },
        { id: 'ssrf-3', text: 'Check for SSRF in file upload functionality (metadata processing)' },
        { id: 'ssrf-4', text: 'Test webhook configuration endpoints for SSRF vulnerabilities' },
        { groupTitle: 'Bypass Techniques' },
        { id: 'ssrf-5', text: 'Try using different URL schemas (file://, dict://, gopher://, etc.)' },
        { id: 'ssrf-6', text: 'Test for URL redirection or open redirect that could lead to SSRF' },
        { id: 'ssrf-7', text: 'Attempt bypass of hostname validation using DNS or URL tricks' },
        { id: 'ssrf-8', text: 'Check for IPv6 address, CIDR, or decimal notation bypass techniques' },
        { groupTitle: 'Advanced SSRF Testing' },
        { id: 'ssrf-9', text: 'Test for blind SSRF vulnerabilities using out-of-band techniques' },
        { id: 'ssrf-10', text: 'Verify SSRF protection against cloud metadata endpoints' },
        { id: 'ssrf-11', text: 'Check for second-order SSRF vulnerabilities in API integrations' },
        { id: 'ssrf-12', text: 'Test XML parsers for XXE vulnerabilities that enable SSRF' }
    ],
    techniquesHTML: `<div class="space-y-6">
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">Entry Point Identification</h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Common SSRF entry points in APIs:</p>
            <ul class="list-disc list-inside text-gray-600 dark:text-gray-300 space-y-1 pl-2">
                <li>URL/URI input fields (file fetching, external resource loading)</li>
                <li>Webhook configuration endpoints</li>
                <li>PDF generators that accept HTML/URL inputs</li>
                <li>Image processors or media handlers</li>
                <li>Import/export functionality with remote file options</li>
                <li>API integrations with third-party services</li>
                <li>Document/media parsers that process remote references</li>
                <li>Health check or connectivity test endpoints</li>
            </ul>
            <p class="text-gray-600 dark:text-gray-300 mt-2">Carefully examine any API endpoint that takes a URL, URI, or path as input.</p>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">SSRF Bypass Techniques</h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Methods to bypass SSRF protections:</p>
            <pre class="bg-gray-100 dark:bg-gray-800 p-2 rounded text-xs overflow-auto">
# Common URL schemas to test
http://internal-service
https://internal-service
file:///etc/passwd
dict://internal-service:11211/
gopher://internal-service:25/
ftp://internal-service
ldap://internal-service

# DNS/hostname bypass techniques
http://127.0.0.1
http://localhost
http://[::1]
http://2130706433 (decimal IP for 127.0.0.1)
http://0x7f000001 (hex IP)
http://017700000001 (octal IP)
http://host.docker.internal

# Cloud metadata endpoints to test
http://169.254.169.254/latest/meta-data/ (AWS)
http://metadata.google.internal/ (GCP)
http://169.254.169.254/metadata/v1/ (DigitalOcean)
http://169.254.169.254/metadata (Azure)</pre>
            <p class="text-gray-600 dark:text-gray-300 mt-2">Always use these techniques responsibly within the scope of your testing.</p>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">Blind SSRF Detection</h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Techniques for detecting blind SSRF vulnerabilities:</p>
            <ol class="list-decimal list-inside text-gray-600 dark:text-gray-300 space-y-1 pl-2">
                <li>Set up an external server to capture DNS and HTTP requests</li>
                <li>Use unique identifiers for each test to track interactions</li>
                <li>Try time-delayed requests to identify asynchronous processing</li>
                <li>Create custom DNS names that encode test data in the hostname</li>
                <li>Monitor for signs of port scanning or internal network access</li>
                <li>Test URLs in different API request components (headers, body, etc.)</li>
                <li>Use domain fronting techniques if DNS filtering is detected</li>
            </ol>
            <p class="text-gray-600 dark:text-gray-300 mt-2">Tools like Burp Collaborator or custom servers are useful for this testing.</p>
        </div>
    </div>`,
    toolsHTML: `<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                <i class="fas fa-bullseye text-blue-600 dark:text-blue-400"></i>SSRFmap
            </h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Automatic SSRF scanner and exploitation tool.</p>
            <a href="https://github.com/swisskyrepo/SSRFmap" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">GitHub <i class="fas fa-external-link-alt"></i></a>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                <i class="fas fa-external-link-alt text-blue-600 dark:text-blue-400"></i>Burp Collaborator
            </h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Tool for detecting out-of-band interactions from blind SSRF vulnerabilities.</p>
            <a href="https://portswigger.net/burp/documentation/collaborator" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">Documentation <i class="fas fa-external-link-alt"></i></a>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                <i class="fas fa-network-wired text-blue-600 dark:text-blue-400"></i>Interactsh
            </h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Open-source tool for detecting out-of-band application security testing.</p>
            <a href="https://github.com/projectdiscovery/interactsh" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">GitHub <i class="fas fa-external-link-alt"></i></a>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                <i class="fas fa-filter text-blue-600 dark:text-blue-400"></i>SSRF Proxy
            </h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Tool that facilitates exploiting SSRF vulnerabilities by providing a proxy interface.</p>
            <a href="https://github.com/bcoles/ssrf_proxy" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">GitHub <i class="fas fa-external-link-alt"></i></a>
        </div>
    </div>`
},

'security-misconfiguration': {
    title: 'API8:2023 Security Misconfiguration',
    subtitle: 'Improper security configuration of the API or supporting systems can lead to various vulnerabilities.',
    priority: 'high',
    checklistItems: [
        { groupTitle: 'Security Headers and Configurations' },
        { id: 'sm-1', text: 'Verify proper implementation of CORS policy and headers' },
        { id: 'sm-2', text: 'Check for security headers (Content-Security-Policy, X-XSS-Protection, etc.)' },
        { id: 'sm-3', text: 'Test for verbose error messages that reveal sensitive information' },
        { id: 'sm-4', text: 'Verify TLS/SSL configuration for proper cipher usage' },
        { groupTitle: 'Server and Platform Settings' },
        { id: 'sm-5', text: 'Check for unnecessary HTTP methods enabled on API endpoints' },
        { id: 'sm-6', text: 'Test for default credentials on API management platforms' },
        { id: 'sm-7', text: 'Verify server configurations for information disclosure' },
        { id: 'sm-8', text: 'Check for exposed API documentation with sensitive information' },
        { groupTitle: 'Infrastructure and Deployment' },
        { id: 'sm-9', text: 'Test for development or debug endpoints in production' },
        { id: 'sm-10', text: 'Verify proper network segmentation and firewall rules' },
        { id: 'sm-11', text: 'Check cloud configuration for excessive permissions' },
        { id: 'sm-12', text: 'Test for container security misconfigurations' }
    ],
    techniquesHTML: `<div class="space-y-6">
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">Security Headers Analysis</h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Critical security headers to check for APIs:</p>
            <pre class="bg-gray-100 dark:bg-gray-800 p-2 rounded text-xs overflow-auto">
# Essential Security Headers to Check
Access-Control-Allow-Origin: * (too permissive?)
Access-Control-Allow-Methods: (check for unnecessary methods)
Access-Control-Allow-Headers: (excessive headers allowed?)
Access-Control-Allow-Credentials: true (with broad CORS policy?)
Content-Security-Policy: (missing or too permissive?)
X-Content-Type-Options: nosniff (present?)
Strict-Transport-Security: (missing or short duration?)
Cache-Control: (sensitive data cacheable?)
X-Frame-Options: (missing for browser-accessible APIs?)
X-XSS-Protection: (configured correctly?)</pre>
            <p class="text-gray-600 dark:text-gray-300 mt-2">Verify these headers are properly configured and appropriate for the API's security requirements.</p>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">Environment Detection Techniques</h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Identify environment misconfigurations:</p>
            <ul class="list-disc list-inside text-gray-600 dark:text-gray-300 space-y-1 pl-2">
                <li>Test for different responses by altering host headers</li>
                <li>Check for debug or development parameters in documentation</li>
                <li>Look for environment-specific headers or cookies</li>
                <li>Test if DEBUG=true or similar parameters enable verbose mode</li>
                <li>Try common development endpoints (e.g., /api/debug, /dev, /test)</li>
                <li>Check for configuration files exposed in web roots</li>
                <li>Look for commented-out code in client-side scripts</li>
                <li>Test for stack traces by causing deliberate errors</li>
            </ul>
            <p class="text-gray-600 dark:text-gray-300 mt-2">Focus on identifying differences between development and production environments.</p>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">Cloud Configuration Testing</h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Common cloud misconfigurations that affect APIs:</p>
            <ul class="list-disc list-inside text-gray-600 dark:text-gray-300 space-y-1 pl-2">
                <li>Over-privileged IAM roles for API services</li>
                <li>Misconfigured S3 buckets or storage containers</li>
                <li>Publicly accessible management interfaces</li>
                <li>Misconfigured API gateways or load balancers</li>
                <li>Improper network ACLs allowing broad access</li>
                <li>Lack of encryption for data at rest</li>
                <li>Unpatched container vulnerabilities</li>
                <li>Missing monitoring or logging configurations</li>
            </ul>
            <p class="text-gray-600 dark:text-gray-300 mt-2">Use tools specific to the cloud provider (AWS, Azure, GCP) to assess configuration.</p>
        </div>
    </div>`,
    toolsHTML: `<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                <i class="fas fa-shield-alt text-blue-600 dark:text-blue-400"></i>OWASP ZAP
            </h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Security testing tool with API scanning and misconfiguration detection capabilities.</p>
            <a href="https://www.zaproxy.org/" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">Website <i class="fas fa-external-link-alt"></i></a>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                <i class="fas fa-cloud text-blue-600 dark:text-blue-400"></i>CloudSploit
            </h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Cloud security configuration scanner for AWS, Azure, GCP, and Oracle.</p>
            <a href="https://github.com/aquasecurity/cloudsploit" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">GitHub <i class="fas fa-external-link-alt"></i></a>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                <i class="fas fa-lock text-blue-600 dark:text-blue-400"></i>SSL Labs Scanner
            </h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Tests SSL/TLS configurations for web servers and APIs.</p>
            <a href="https://www.ssllabs.com/ssltest/" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">Website <i class="fas fa-external-link-alt"></i></a>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                <i class="fas fa-box text-blue-600 dark:text-blue-400"></i>Trivy
            </h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Container and infrastructure scanning tool for vulnerabilities and misconfigurations.</p>
            <a href="https://github.com/aquasecurity/trivy" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">GitHub <i class="fas fa-external-link-alt"></i></a>
        </div>
    </div>`
},

'improper-inventory-management': {
    title: 'API9:2023 Improper Inventory Management',
    subtitle: 'Lack of proper API inventory, documentation, and versioning leads to exposed endpoints and potential vulnerabilities.',
    priority: 'medium',
    checklistItems: [
        { groupTitle: 'API Discovery and Documentation' },
        { id: 'iim-1', text: 'Identify all API versions both current and deprecated' },
        { id: 'iim-2', text: 'Verify proper documentation for all API endpoints' },
        { id: 'iim-3', text: 'Discover hidden or undocumented API endpoints' },
        { id: 'iim-4', text: 'Check for test or development APIs exposed in production' },
        { groupTitle: 'Version Management' },
        { id: 'iim-5', text: 'Test for version-based security discrepancies across API endpoints' },
        { id: 'iim-6', text: 'Verify deprecation processes for outdated API versions' },
        { id: 'iim-7', text: 'Check for security vulnerabilities in legacy API versions' },
        { id: 'iim-8', text: 'Verify API gateways properly manage all API versions' },
        { groupTitle: 'Environment and Host Management' },
        { id: 'iim-9', text: 'Identify hosted API documentation and information leakage' },
        { id: 'iim-10', text: 'Check for subdomains hosting unknown or unpatched API endpoints' },
        { id: 'iim-11', text: 'Test for differences in security controls across API environments' },
        { id: 'iim-12', text: 'Verify complete API inventory matches actual exposed endpoints' }
    ],
    techniquesHTML: `<div class="space-y-6">
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">API Discovery Methodology</h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Comprehensive approaches to discover undocumented APIs:</p>
            <ol class="list-decimal list-inside text-gray-600 dark:text-gray-300 space-y-1 pl-2">
                <li>Analyze client-side code for API references (JavaScript, mobile apps)</li>
                <li>Look for API documentation platforms (Swagger, Redoc, Apigee)</li>
                <li>Use subdomain enumeration to find API hosts</li>
                <li>Search for API keys or endpoints in public code repositories</li>
                <li>Test common API paths and naming conventions</li>
                <li>Monitor network traffic from applications to identify API calls</li>
                <li>Check for version patterns in known endpoints</li>
                <li>Review robots.txt and sitemap files for API paths</li>
            </ol>
            <p class="text-gray-600 dark:text-gray-300 mt-2">Create a comprehensive inventory of discovered endpoints for testing.</p>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">Version Testing Techniques</h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">How to identify and test multiple API versions:</p>
            <ul class="list-disc list-inside text-gray-600 dark:text-gray-300 space-y-1 pl-2">
                <li>Test different version identifiers in URLs (/v1/, /v2/, etc.)</li>
                <li>Try version headers (Accept-Version, API-Version, etc.)</li>
                <li>Check for version parameters (?version=1.0, ?api_version=2)</li>
                <li>Compare security controls between versions</li>
                <li>Test for deprecated but still accessible versions</li>
                <li>Check if newer security patches are missing from older versions</li>
                <li>Test if authentication can be bypassed using older versions</li>
            </ul>
            <pre class="bg-gray-100 dark:bg-gray-800 p-2 rounded text-xs overflow-auto mt-2">
# Common version testing patterns
GET /api/v1/users
GET /api/v2/users
GET /api/users   # May default to a specific version

# Version headers
GET /api/users
Accept-Version: 1.0

# Version parameters
GET /api/users?version=1.0
GET /api/users?v=2
GET /api/users?api-version=2019-12-01   # Azure style</pre>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">API Documentation Analysis</h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Techniques for finding and analyzing API documentation:</p>
            <ul class="list-disc list-inside text-gray-600 dark:text-gray-300 space-y-1 pl-2">
                <li>Search for common API documentation paths</li>
                <li>Extract OpenAPI/Swagger specifications</li>
                <li>Compare documented endpoints with discovered endpoints</li>
                <li>Check if documentation exposes sensitive information</li>
                <li>Look for deprecated endpoints still mentioned in documentation</li>
                <li>Verify if API documentation is accessible without authentication</li>
            </ul>
            <p class="text-gray-600 dark:text-gray-300 mt-2">Common documentation paths to check: /api/docs, /swagger, /api-docs, /openapi.json, /swagger.json</p>
        </div>
    </div>`,
    toolsHTML: `<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                <i class="fas fa-search text-blue-600 dark:text-blue-400"></i>Kiterunner
            </h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">API discovery tool that can find undocumented API endpoints.</p>
            <a href="https://github.com/assetnote/kiterunner" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">GitHub <i class="fas fa-external-link-alt"></i></a>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                <i class="fas fa-book text-blue-600 dark:text-blue-400"></i>OpenAPI Directory
            </h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Collection of OpenAPI specifications for popular APIs to compare against.</p>
            <a href="https://github.com/APIs-guru/openapi-directory" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">GitHub <i class="fas fa-external-link-alt"></i></a>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                <i class="fas fa-sitemap text-blue-600 dark:text-blue-400"></i>Amass
            </h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Network mapping and subdomain discovery tool useful for API inventory.</p>
            <a href="https://github.com/OWASP/Amass" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">GitHub <i class="fas fa-external-link-alt"></i></a>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                <i class="fas fa-spider text-blue-600 dark:text-blue-400"></i>OWASP APICheck
            </h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Toolset for API testing including version management testing tools.</p>
            <a href="https://github.com/BBVA/apicheck" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">GitHub <i class="fas fa-external-link-alt"></i></a>
        </div>
    </div>`
},

'unsafe-consumption-of-apis': {
    title: 'API10:2023 Unsafe Consumption of APIs',
    subtitle: 'Consuming third-party APIs without validating responses can introduce vulnerabilities to dependent applications.',
    priority: 'medium',
    checklistItems: [
        { groupTitle: 'API Response Validation' },
        { id: 'uca-1', text: 'Test if client applications validate API responses before processing' },
        { id: 'uca-2', text: 'Check for JSON/XML parsers with known vulnerabilities' },
        { id: 'uca-3', text: 'Verify proper content type and encoding validation' },
        { id: 'uca-4', text: 'Test for cross-site scripting in displayed API responses' },
        { groupTitle: 'Third-Party API Security' },
        { id: 'uca-5', text: 'Verify secure transmission of credentials to third-party APIs' },
        { id: 'uca-6', text: 'Check for proper certificate validation for external API calls' },
        { id: 'uca-7', text: 'Test for sensitive data exposure in API integrations' },
        { id: 'uca-8', text: 'Verify API access tokens are securely managed' },
        { groupTitle: 'Advanced API Consumption Testing' },
        { id: 'uca-9', text: 'Test for server-side request forgery in API integrations' },
        { id: 'uca-10', text: 'Check for business logic flaws using manipulated API responses' },
        { id: 'uca-11', text: 'Verify proper handling of API outages and failures' },
        { id: 'uca-12', text: 'Test for race conditions in multi-API integration flows' }
    ],
    techniquesHTML: `<div class="space-y-6">
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">Response Injection Testing</h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Testing for client-side vulnerabilities in API consumption:</p>
            <ol class="list-decimal list-inside text-gray-600 dark:text-gray-300 space-y-1 pl-2">
                <li>Identify all points where the application consumes external API data</li>
                <li>Map how response data flows through the application</li>
                <li>Intercept and modify API responses (using proxy tools)</li>
                <li>Test for XSS by injecting malicious payloads in API responses</li>
                <li>Check for template injection in rendered API data</li>
                <li>Test if unexpected data types or structures are properly handled</li>
                <li>Verify the application validates response size and structure</li>
            </ol>
            <p class="text-gray-600 dark:text-gray-300 mt-2">Focus on manipulating API responses to trigger vulnerabilities in the consuming application.</p>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">API Integration Security</h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Evaluating secure consumption of third-party APIs:</p>
            <ul class="list-disc list-inside text-gray-600 dark:text-gray-300 space-y-1 pl-2">
                <li>Identify all third-party API integrations used by the application</li>
                <li>Review how API keys and credentials are stored and transmitted</li>
                <li>Check for proper TLS certificate validation (avoid certificate pinning bypasses)</li>
                <li>Test the application's behavior when APIs return error responses</li>
                <li>Verify if the application implements proper rate limiting handling</li>
                <li>Check how API outages are handled</li>
                <li>Test for sensitive data caching from API responses</li>
            </ul>
            <pre class="bg-gray-100 dark:bg-gray-800 p-2 rounded text-xs overflow-auto mt-2">
# Common API integration vulnerabilities
- Hardcoded API keys in client-side code
- Failure to validate server certificates (allows MITM)
- Absence of response validation
- Insecure handling of webhook payloads
- Unvalidated redirects from API responses
- Improper storage of API tokens
- Insufficient error handling</pre>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">Response Parser Testing</h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Testing API response parsers for vulnerabilities:</p>
            <ul class="list-disc list-inside text-gray-600 dark:text-gray-300 space-y-1 pl-2">
                <li>Test for XML parsing vulnerabilities (XXE, billion laughs)</li>
                <li>Check for deserialization vulnerabilities in JSON parsing</li>
                <li>Test parser behavior with malformed or oversized responses</li>
                <li>Verify how unexpected content types are handled</li>
                <li>Check for prototype pollution vulnerabilities</li>
                <li>Test parser behavior with unexpected character encodings</li>
                <li>Verify content type validation before parsing</li>
            </ul>
            <p class="text-gray-600 dark:text-gray-300 mt-2">Parser vulnerabilities can lead to remote code execution, denial of service, or data exfiltration.</p>
        </div>
    </div>`,
    toolsHTML: `<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                <i class="fas fa-edit text-blue-600 dark:text-blue-400"></i>Burp Match and Replace
            </h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Burp Suite tool for modifying API responses to test client-side handling.</p>
            <a href="https://portswigger.net/burp/documentation/desktop/tools/proxy/options/match-replace" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">Documentation <i class="fas fa-external-link-alt"></i></a>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                <i class="fas fa-code text-blue-600 dark:text-blue-400"></i>API Mock Server
            </h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Tools to create mock API responses for testing client handling.</p>
            <a href="https://wiremock.org/" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">WireMock <i class="fas fa-external-link-alt"></i></a>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                <i class="fas fa-bug text-blue-600 dark:text-blue-400"></i>OWASP ZAP API Scanner
            </h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Tool for testing API consumption vulnerabilities and response handling.</p>
            <a href="https://www.zaproxy.org/docs/desktop/addons/openapi-support/" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">Documentation <i class="fas fa-external-link-alt"></i></a>
        </div>
        
        <div class="bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 shadow-sm">
            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1 flex items-center gap-2">
                <i class="fas fa-shield-alt text-blue-600 dark:text-blue-400"></i>Dependency Scanners
            </h4>
            <p class="text-gray-600 dark:text-gray-300 mb-2">Tools for identifying vulnerable dependencies in API clients.</p>
            <a href="https://owasp.org/www-project-dependency-check/" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline text-xs inline-flex items-center gap-1">OWASP Dependency Check <i class="fas fa-external-link-alt"></i></a>
        </div>
    </div>`
}
        };

        // --- Global State ---
        let currentCategory = '';
        let currentProject = null; // Will be loaded from storage
        let projects = {};
        let confirmCallback = null;
        let currentEditingFindingId = null;
        let progressChart = null;
        let recentActivities = [];
        let currentSort = 'none'; // none, priority, progress
        let isDarkMode = false;
        let fabMenuOpen = false;

        // --- Main JavaScript Code ---
        document.addEventListener('DOMContentLoaded', initApp);

        function initApp() {
            // Check for dark mode preference
            if (localStorage.getItem('darkMode') === 'enabled' || 
                (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches && 
                 localStorage.getItem('darkMode') !== 'disabled')) {
                document.documentElement.classList.add('dark');
                isDarkMode = true;
            }
            
            loadProjectsFromStorage(); // Load or create default project
            setupEventListeners();
            updateProjectUI(); // Initial UI update based on loaded project
            initFindingsTable();
            updateProgressIndicators(); // Calculate and display initial progress
            initProgressChart();
            initCategoryCircleProgress();
            
            console.log("OWASP API Security Checklist Initialized. Current Project:", currentProject.name);
        }

        // --- Event Listeners Setup ---
        function setupEventListeners() {
            // Category cards
            document.querySelectorAll('.category-card').forEach(card => {
                card.addEventListener('click', function() {
                    const categoryId = this.getAttribute('data-category');
                    openCategory(categoryId);
                });
            });

            // Tab navigation
            document.querySelectorAll('#tabNavigation a').forEach(tab => {
                tab.addEventListener('click', function(e) {
                    e.preventDefault();
                    const tabId = this.getAttribute('data-tab');
                    changeTab(tabId);
                });
            });

            // Button event listeners
            document.getElementById('btn-back-to-categories').addEventListener('click', closeCategory);
            document.getElementById('btn-print').addEventListener('click', printChecklist);
            document.getElementById('btn-export').addEventListener('click', showExportOptions);
            document.getElementById('btn-import').addEventListener('click', showImportModal);
            document.getElementById('theme-toggle').addEventListener('click', toggleDarkMode);
            document.getElementById('btn-edit-project').addEventListener('click', editProjectDetails);
            
            // Finding actions
            document.getElementById('btn-add-finding').addEventListener('click', () => addFinding());
            document.getElementById('btn-add-category-finding').addEventListener('click', () => addFinding(currentCategory));
            document.getElementById('btn-save-finding').addEventListener('click', saveFinding);
            
            // Close buttons for modals
            document.querySelectorAll('.btn-close').forEach(btn => {
                btn.addEventListener('click', function() {
                    hideAllModals();
                });
            });

            // Sorting buttons
            document.getElementById('btn-sort-priority').addEventListener('click', () => sortCategories('priority'));
            document.getElementById('btn-sort-progress').addEventListener('click', () => sortCategories('progress'));
            
            // Notes management
            document.getElementById('btn-save-notes').addEventListener('click', saveNotes);
            document.getElementById('btn-copy-notes').addEventListener('click', copyNotes);
            
            // Checklist actions
            document.getElementById('btn-mark-all').addEventListener('click', markAllTasks);
            document.getElementById('btn-unmark-all').addEventListener('click', unmarkAllTasks);
            document.getElementById('task-search').addEventListener('input', searchTasks);
            
            // Project management
            document.getElementById('projects-button').addEventListener('click', showProjectsModal);
            document.getElementById('btn-create-project').addEventListener('click', showNewProjectModal);
            document.getElementById('btn-save-project').addEventListener('click', saveProjectDetails);
            document.getElementById('btn-save-new-project').addEventListener('click', saveNewProject);
            
            // Import/Export
            document.getElementById('import-file').addEventListener('change', handleImportFile);
            document.getElementById('btn-confirm-import').addEventListener('click', confirmImport);
            document.getElementById('btn-confirm-export').addEventListener('click', handleExport);
            document.querySelectorAll('input[name="export-format"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    const pdfOptions = document.getElementById('pdf-options');
                    if (this.value === 'pdf') {
                        pdfOptions.classList.remove('hidden');
                    } else {
                        pdfOptions.classList.add('hidden');
                    }
                });
            });
            
            // Findings detail actions
            document.getElementById('btn-edit-finding').addEventListener('click', function() {
                const findingId = this.getAttribute('data-finding-id');
                hideAllModals();
                addFinding(null, findingId);
            });
            
            document.getElementById('btn-delete-finding').addEventListener('click', function() {
                const findingId = this.getAttribute('data-finding-id');
                confirmDeleteFinding(findingId);
            });
            
            // Finding search
            document.getElementById('findings-search').addEventListener('input', searchFindings);
            
            // Report generation
            document.getElementById('btn-generate-report').addEventListener('click', generateReport);
            
            // Floating Action Button
            document.getElementById('fab-main').addEventListener('click', toggleFabMenu);
            document.getElementById('fab-add-finding').addEventListener('click', () => { 
                toggleFabMenu(); 
                addFinding(); 
            });
            document.getElementById('fab-projects').addEventListener('click', () => { 
                toggleFabMenu(); 
                showProjectsModal(); 
            });
            document.getElementById('fab-generate-report').addEventListener('click', () => { 
                toggleFabMenu(); 
                generateReport(); 
            });
            document.getElementById('fab-export').addEventListener('click', () => { 
                toggleFabMenu(); 
                showExportOptions(); 
            });
            
            // Help button
            document.getElementById('btn-show-help').addEventListener('click', showHelpModal);
            
            // Quick Jump
            document.getElementById('jump-to-top').addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
            document.getElementById('jump-to-progress').addEventListener('click', () => {
                document.getElementById('progress-heading').scrollIntoView({ behavior: 'smooth' });
            });
            document.getElementById('jump-to-categories').addEventListener('click', () => {
                document.getElementById('category-grid').scrollIntoView({ behavior: 'smooth' });
            });
            document.getElementById('jump-to-findings').addEventListener('click', () => {
                document.getElementById('findings-heading').scrollIntoView({ behavior: 'smooth' });
            });
            document.getElementById('toggle-help').addEventListener('click', showHelpModal);
            
            // Window scroll for quick jump visibility
            window.addEventListener('scroll', function() {
                const quickJump = document.getElementById('quick-jump');
                if (window.scrollY > 300) {
                    quickJump.classList.add('visible');
                } else {
                    quickJump.classList.remove('visible');
                }
            });
            
            // Task checkboxes (delegated event)
            document.addEventListener('change', function(e) {
                if (e.target.matches('.task-checkbox')) {
                    handleCheckboxChange(e.target);
                }
            });
            
            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                // Don't trigger when typing in inputs or textareas
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
                
                if (e.key === 'p' || e.key === 'P') {
                    showProjectsModal();
                    e.preventDefault();
                } else if (e.key === 'e' || e.key === 'E') {
                    editProjectDetails();
                    e.preventDefault();
                } else if (e.key === 'f' || e.key === 'F') {
                    addFinding();
                    e.preventDefault();
                } else if (e.key === 't' || e.key === 'T') {
                    toggleDarkMode();
                    e.preventDefault();
                } else if (e.key === '?') {
                    showHelpModal();
                    e.preventDefault();
                } else if (e.key === 'Escape') {
                    hideAllModals();
                }
            });
        }

        // --- UI Functions ---
        
        function hideAllModals() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.style.display = 'none';
                modal.classList.remove('show');
            });
        }
        
        function showModal(id) {
            hideAllModals();
            const modal = document.getElementById(id);
            if (modal) {
                modal.style.display = 'flex';
                setTimeout(() => {
                    modal.classList.add('show');
                }, 10);
            }
        }
        
        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            if (isDarkMode) {
                document.documentElement.classList.add('dark');
                localStorage.setItem('darkMode', 'enabled');
            } else {
                document.documentElement.classList.remove('dark');
                localStorage.setItem('darkMode', 'disabled');
            }
            
            // Update chart if exists
            if (progressChart) {
                progressChart.update();
            }
            
            showToast('Theme changed', 'info');
        }
        
     function showToast(message, type = 'success') {
    const toast = document.getElementById('toast');
    const toastMessage = document.getElementById('toast-message');
    const toastIcon = document.getElementById('toast-icon');
    
    toastMessage.textContent = message;
    
    let bgColor = 'bg-green-600 dark:bg-green-700';
    let iconClass = 'fas fa-check-circle';
    
    switch (type) {
        case 'error': 
            bgColor = 'bg-red-600 dark:bg-red-700'; 
            iconClass = 'fas fa-exclamation-circle'; 
            break;
        case 'warning': 
            bgColor = 'bg-yellow-500 dark:bg-yellow-600'; 
            iconClass = 'fas fa-exclamation-triangle'; 
            break;
        case 'info': 
            bgColor = 'bg-blue-600 dark:bg-blue-700'; 
            iconClass = 'fas fa-info-circle'; 
            break;
    }
    
    // Clear existing background classes
    toast.className = toast.className.replace(/bg-(red|green|yellow|blue)-[0-9]+(\s+dark:bg-(red|green|yellow|blue)-[0-9]+)?/g, '');
    
    // Add toast class if not already present
    if (!toast.classList.contains('toast')) {
        toast.classList.add('toast');
    }
    
    // Add background color classes individually by splitting the string
    bgColor.split(' ').forEach(cls => {
        toast.classList.add(cls);
    });
    
    // Set icon classes
    toastIcon.className = `${iconClass} mr-3`;
    
    toast.classList.add('show');
    setTimeout(() => {
        toast.classList.remove('show');
    }, 3000);
    
    // Add to recent activity
    addActivity(`Notification: ${message}`);
}
        
        function showConfirmation(title, message, callback) {
            const titleEl = document.getElementById('confirm-title');
            const messageEl = document.getElementById('confirm-message');
            const yesButton = document.getElementById('confirm-yes');
            
            titleEl.textContent = title;
            messageEl.innerHTML = message;
            confirmCallback = callback;
            
            const newYesButton = yesButton.cloneNode(true);
            yesButton.parentNode.replaceChild(newYesButton, yesButton);
            
            newYesButton.addEventListener('click', function() {
                if (confirmCallback) {
                    try {
                        confirmCallback();
                    } catch (e) {
                        console.error("Error executing confirmation callback:", e);
                        showToast("An error occurred.", 'error');
                    } finally {
                        confirmCallback = null;
                        hideAllModals();
                    }
                }
            }, { once: true });
            
            showModal('confirm-modal');
        }
        
        function toggleFabMenu() {
            fabMenuOpen = !fabMenuOpen;
            const fabMenu = document.getElementById('fab-menu');
            const fabMain = document.getElementById('fab-main');
            
            if (fabMenuOpen) {
                fabMenu.classList.add('active');
                fabMain.innerHTML = '<i class="fas fa-times"></i>';
            } else {
                fabMenu.classList.remove('active');
                fabMain.innerHTML = '<i class="fas fa-plus"></i>';
            }
        }
        
        function showExportOptions() {
            showModal('export-options-modal');
        }
        
        function showImportModal() {
            const fileInput = document.getElementById('import-file');
            const previewEl = document.getElementById('import-preview');
            const confirmBtn = document.getElementById('btn-confirm-import');
            
            // Reset the import form
            if (fileInput) fileInput.value = '';
            if (previewEl) previewEl.classList.add('hidden');
            if (confirmBtn) {
                confirmBtn.disabled = true;
                confirmBtn.removeAttribute('data-import');
            }
            
            showModal('import-modal');
        }
        
        function showHelpModal() {
            showModal('help-modal');
        }
        
        function showProjectsModal() {
            populateProjectsList();
            showModal('projects-modal');
        }
        
        function showNewProjectModal() {
            hideAllModals();
            
            // Reset the form
            const form = document.getElementById('new-project-form');
            if (form) form.reset();
            
            // Set today's date as default
            const dateInput = document.getElementById('new-project-date');
            if (dateInput) dateInput.value = new Date().toISOString().split('T')[0];
            
            // Set empty template as default
            const emptyTemplate = document.getElementById('template-empty');
            if (emptyTemplate) emptyTemplate.checked = true;
            
            showModal('new-project-modal');
        }
        
        // --- Category Management ---
        
        function openCategory(categoryId) {
            currentCategory = categoryId;
            const categoryData = categories[categoryId];
            if (!categoryData) {
                console.error("Category not found:", categoryId);
                showToast("Failed to load category data.", "error");
                return;
            }

            const detailsSection = document.getElementById('category-details');
            const titleEl = document.getElementById('category-title');
            const subtitleEl = document.getElementById('category-subtitle');
            const checklistContentEl = document.getElementById('checklist-content');
            const techniquesContentEl = document.getElementById('techniques-content');
            const toolsContentEl = document.getElementById('tools-content');
            const notesTextarea = document.getElementById('category-notes');
            const findingsCountEl = document.getElementById('tab-findings-count');

            titleEl.textContent = categoryData.title || 'Untitled Category';
            subtitleEl.textContent = categoryData.subtitle || '';

            // Generate checklist HTML
            checklistContentEl.innerHTML = categoryData.checklistItems ? generateChecklistHTML(categoryData.checklistItems) : '<p class="text-gray-500 dark:text-gray-400">No checklist items defined for this category.</p>';
            
            // Load techniques and tools HTML
            techniquesContentEl.innerHTML = categoryData.techniquesHTML || '<p class="text-gray-500 dark:text-gray-400">No specific techniques are documented for this category.</p>';
            toolsContentEl.innerHTML = categoryData.toolsHTML || '<p class="text-gray-500 dark:text-gray-400">No specific tools are documented for this category.</p>';

            // Load notes
            notesTextarea.value = currentProject.notes?.[categoryId] || '';
            
            // Count findings for this category
            const categoryFindings = currentProject.findingDetails?.filter(f => f.category === categoryId) || [];
            findingsCountEl.textContent = categoryFindings.length;
            
            // Populate the category findings list
            populateCategoryFindings(categoryId);

            // Apply checkbox states
            applyCheckboxStates();
            
            // Update category progress stats
            updateCategoryProgressStats();

            // Show the section and scroll into view
            detailsSection.classList.remove('hidden');
            detailsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });

            // Set active tab to checklist
            changeTab('checklist');
            
            // Add to recent activity
            addActivity(`Opened category: ${categoryData.title}`);
        }
        
        function closeCategory() {
            document.getElementById('category-details').classList.add('hidden');
            currentCategory = '';
            document.getElementById('category-grid')?.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        function changeTab(tabId) {
            // Update tab navigation
            document.querySelectorAll('#tabNavigation a').forEach(tab => {
                const isActive = tab.getAttribute('data-tab') === tabId;
                
                // Remove all classes first
                tab.classList.remove('border-blue-600', 'text-blue-700', 'dark:border-blue-500', 'dark:text-blue-400', 'border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300', 'dark:text-gray-400', 'dark:hover:text-gray-300', 'dark:hover:border-gray-600');
                
                // Add appropriate classes
                if (isActive) {
                    tab.classList.add('border-blue-600', 'text-blue-700', 'dark:border-blue-500', 'dark:text-blue-400');
                } else {
                    tab.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300', 'dark:text-gray-400', 'dark:hover:text-gray-300', 'dark:hover:border-gray-600');
                }
            });
            
            // Update content visibility
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            const activeContent = document.getElementById(`${tabId}-content`);
            if (activeContent) {
                activeContent.classList.add('active');
            }
        }
        
        function generateChecklistHTML(items) {
            let html = '';
            let currentGroupOpen = false;
            
            items.forEach(item => {
                if (item.groupTitle) {
                    if (currentGroupOpen) html += '</div></div>'; // Close previous group
                    html += `<div class="mb-6 print-break-inside-avoid">
                                <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-3 border-b border-gray-200 dark:border-gray-700 pb-1">${item.groupTitle}</h3>
                                <div class="space-y-2 pl-2">`;
                    currentGroupOpen = true;
                } else if (item.id && item.text) {
                    const taskId = `task-${item.id.replace(/\./g, '-')}`;
                    html += `<div class="task-item p-2 rounded-lg flex items-start hover:bg-gray-50 dark:hover:bg-gray-700 print-break-inside-avoid transition-all duration-300">
                                <input type="checkbox" class="task-checkbox mt-1 mr-3 h-4 w-4 rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500 flex-shrink-0 transition-all duration-300" data-task-id="${item.id}" id="${taskId}">
                                <label for="${taskId}" class="text-gray-700 dark:text-gray-300 cursor-pointer transition-all duration-300">${item.text}</label>
                             </div>`;
                }
            });
            
            if (currentGroupOpen) html += '</div></div>'; // Close the last group
            
            return html || '<p class="text-gray-500 dark:text-gray-400">No items found.</p>';
        }
        
        function populateCategoryFindings(categoryId) {
            const container = document.getElementById('category-findings-list');
            if (!container) return;
            
            const categoryFindings = currentProject.findingDetails?.filter(f => f.category === categoryId) || [];
            
            if (categoryFindings.length === 0) {
                container.innerHTML = `
                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 text-center transition-all duration-300">
                        <p class="text-gray-600 dark:text-gray-300 mb-3">No findings recorded for this category yet.</p>
                        <button type="button" onclick="addFinding('${categoryId}')" class="text-sm text-white bg-green-600 hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-800 focus:ring-4 focus:ring-green-300 font-medium rounded-lg px-4 py-2 focus:outline-none inline-flex items-center gap-1 transition-all duration-300">
                            <i class="fas fa-plus"></i> Add First Finding
                        </button>
                    </div>
                `;
                return;
            }
            
            // Sort findings by severity (critical first, then high, etc.)
            const sortedFindings = categoryFindings.slice().sort((a, b) => {
                const severityOrder = { 'critical': 0, 'high': 1, 'medium': 2, 'low': 3, 'info': 4 };
                return severityOrder[a.severity] - severityOrder[b.severity];
            });
            
            container.innerHTML = sortedFindings.map(finding => `
                <div class="finding bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm overflow-hidden transition-all duration-300">
                    <div class="finding-header px-4 py-3 bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                        <h3 class="text-sm font-semibold text-gray-800 dark:text-gray-200">
                            ${finding.title}
                        </h3>
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getSeverityClass(finding.severity)}">
                            ${finding.severity.charAt(0).toUpperCase() + finding.severity.slice(1)}
                        </span>
                    </div>
                    <div class="p-4">
                        <p class="text-sm text-gray-600 dark:text-gray-300 line-clamp-2 mb-3">${finding.description.substring(0, 150)}${finding.description.length > 150 ? '...' : ''}</p>
                        <div class="flex justify-end space-x-2">
                            <button type="button" class="text-xs text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 font-medium inline-flex items-center gap-1" onclick="viewFinding('${finding.id}')">
                                <i class="fas fa-eye"></i> View
                            </button>
                            <button type="button" class="text-xs text-yellow-600 hover:text-yellow-800 dark:text-yellow-400 dark:hover:text-yellow-300 font-medium inline-flex items-center gap-1" onclick="editFinding('${finding.id}')">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function getSeverityClass(severity) {
            switch (severity) {
                case 'critical':
                    return 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300';
                case 'high':
                    return 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300';
                case 'medium':
                    return 'bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-300';
                case 'low':
                    return 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300';
                case 'info':
                    return 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300';
                default:
                    return 'bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300';
            }
        }
        
        // --- Findings Management ---
        
        function addFinding(categoryId = null, findingId = null) {
            currentEditingFindingId = findingId;
            
            const modalTitleEl = document.getElementById('finding-modal-title');
            const saveButton = document.getElementById('btn-save-finding');
            const form = document.getElementById('finding-form');
            const categorySelect = document.getElementById('finding-category');
            
            // Populate category dropdown
            categorySelect.innerHTML = '';
            Object.keys(categories).forEach(catId => {
                const option = document.createElement('option');
                option.value = catId;
                option.textContent = categories[catId].title;
                categorySelect.appendChild(option);
            });

            if (findingId) {
                // EDIT Mode
                const finding = currentProject.findingDetails?.find(f => f.id === findingId);
                if (finding) {
                    modalTitleEl.textContent = 'Edit Vulnerability Finding';
                    saveButton.textContent = 'Save Changes';
                    categorySelect.value = finding.category;
                    document.getElementById('finding-title').value = finding.title;
                    document.getElementById('finding-severity').value = finding.severity;
                    document.getElementById('finding-description').value = finding.description;
                    document.getElementById('finding-steps').value = finding.steps || '';
                    document.getElementById('finding-remediation').value = finding.remediation || '';
                    document.getElementById('finding-references').value = finding.references || '';
                } else {
                    showToast('Finding not found for editing.', 'error');
                    currentEditingFindingId = null;
                    return; // Don't open modal if finding not found
                }
            } else {
                // ADD Mode
                modalTitleEl.textContent = 'Add Vulnerability Finding';
                saveButton.textContent = 'Save Finding';
                form.reset(); // Clear form
                if (categoryId) {
                    categorySelect.value = categoryId; // Pre-select if adding from category row
                }
                document.getElementById('finding-severity').value = 'high'; // Default
            }

            showModal('finding-modal');
        }
        
        function saveFinding() {
            const categoryId = document.getElementById('finding-category').value;
            const severity = document.getElementById('finding-severity').value;
            const title = document.getElementById('finding-title').value.trim();
            const description = document.getElementById('finding-description').value.trim();
            const steps = document.getElementById('finding-steps').value.trim();
            const remediation = document.getElementById('finding-remediation').value.trim();
            const references = document.getElementById('finding-references').value.trim();

            if (!title || !description) {
                showToast('Please provide a title and description.', 'warning');
                return;
            }

            if (!currentProject.findingDetails) currentProject.findingDetails = [];

            if (currentEditingFindingId) {
                // UPDATE existing finding
                const index = currentProject.findingDetails.findIndex(f => f.id === currentEditingFindingId);
                if (index > -1) {
                    currentProject.findingDetails[index] = {
                        ...currentProject.findingDetails[index], // Keep original ID and date
                        category: categoryId,
                        severity: severity,
                        title: title,
                        description: description,
                        steps: steps || null, // Store as null if empty
                        remediation: remediation || null,
                        references: references || null,
                        lastEdited: new Date().toISOString()
                    };
                    showToast('Finding updated successfully', 'success');
                    addActivity(`Updated finding: ${title}`);
                } else {
                    showToast('Error: Finding to update not found.', 'error');
                    hideAllModals();
                    currentEditingFindingId = null;
                    return;
                }
            } else {
                // ADD new finding
                currentProject.findingDetails.push({
                    id: 'finding_' + Date.now() + Math.random().toString(16).slice(2), // More unique ID
                    category: categoryId,
                    severity: severity,
                    title: title,
                    description: description,
                    steps: steps || null,
                    remediation: remediation || null,
                    references: references || null,
                    date: new Date().toISOString()
                });
                showToast('Finding added successfully', 'success');
                addActivity(`Added new finding: ${title}`);
                
                // Show confetti for first finding
                if (currentProject.findingDetails.length === 1) {
                    showConfetti();
                }
            }

            currentEditingFindingId = null; // Reset editing state
            saveProjectToStorage();
            initFindingsTable(); // Refresh the summary table
            hideAllModals(); // Close modal
            
            // If we're in a category view, refresh the findings tab
            if (currentCategory) {
                populateCategoryFindings(currentCategory);
                
                // Update the findings count badge
                const badge = document.getElementById('tab-findings-count');
                if (badge) {
                    const count = currentProject.findingDetails.filter(f => f.category === currentCategory).length;
                    badge.textContent = count;
                }
            }
        }
        
        function viewFinding(findingId) {
            const finding = currentProject.findingDetails?.find(f => f.id === findingId);
            if (!finding) {
                showToast('Finding details not found.', 'error');
                return;
            }
            
            // Set up the edit and delete buttons
            document.getElementById('btn-edit-finding').setAttribute('data-finding-id', findingId);
            document.getElementById('btn-delete-finding').setAttribute('data-finding-id', findingId);
            
            // Build severity display class
            let severityClass = '';
            switch(finding.severity) {
                case 'critical':
                case 'high':
                    severityClass = 'text-red-600 dark:text-red-400';
                    break;
                case 'medium':
                    severityClass = 'text-orange-600 dark:text-orange-400';
                    break;
                case 'low':
                    severityClass = 'text-yellow-600 dark:text-yellow-400';
                    break;
                case 'info':
                    severityClass = 'text-blue-600 dark:text-blue-400';
                    break;
            }
            
            // Format references as links if they are URLs
            const formattedReferences = finding.references ? finding.references.split('\n').map(line => {
                line = line.trim();
                if (!line) return '';
                if (line.match(/^https?:\/\//i)) {
                    return `<a href="${line}" class="text-blue-600 dark:text-blue-400 hover:underline" target="_blank" rel="noopener noreferrer">${line}</a><br>`;
                } else {
                    return `${line}<br>`;
                }
            }).join('') : '';
            
            // Update modal title and content
            document.getElementById('view-finding-title').textContent = `Finding: ${finding.title}`;
            
            const content = document.getElementById('view-finding-content');
            content.innerHTML = `
                <div class="space-y-3">
                    <div class="flex flex-wrap gap-x-6 gap-y-2 text-sm bg-gray-50 dark:bg-gray-700 p-3 rounded-lg transition-all duration-300">
                        <div><strong class="text-gray-600 dark:text-gray-400">Severity:</strong> 
                            <span class="${severityClass}">${finding.severity.charAt(0).toUpperCase() + finding.severity.slice(1)}</span>
                        </div>
                        <div><strong class="text-gray-600 dark:text-gray-400">Category:</strong> <span>${categories[finding.category]?.title || finding.category}</span></div>
                        <div><strong class="text-gray-600 dark:text-gray-400">Discovered:</strong> <span>${finding.date ? new Date(finding.date).toLocaleDateString() : 'N/A'}</span></div>
                        ${finding.lastEdited ? `<div><strong class="text-gray-600 dark:text-gray-400">Updated:</strong> <span>${new Date(finding.lastEdited).toLocaleDateString()}</span></div>` : ''}
                    </div>

                    <div>
                        <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1">Description</h4>
                        <div class="prose prose-sm max-w-none p-3 bg-gray-50 dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600 dark:prose-invert transition-all duration-300">${finding.description.replace(/\n/g, '<br>')}</div>
                    </div>
                    ${finding.steps ? `
                    <div>
                        <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1">Steps to Reproduce</h4>
                        <pre class="prose prose-sm max-w-none p-3 bg-gray-50 dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600 text-xs dark:prose-invert transition-all duration-300">${finding.steps}</pre>
                    </div>` : ''}
                    ${finding.remediation ? `
                    <div>
                        <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1">Remediation</h4>
                        <pre class="prose prose-sm max-w-none p-3 bg-gray-50 dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600 text-xs dark:prose-invert transition-all duration-300">${finding.remediation}</pre>
                    </div>` : ''}
                    ${finding.references ? `
                    <div>
                        <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1">References</h4>
                        <div class="prose prose-sm max-w-none p-3 bg-gray-50 dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600 text-xs dark:prose-invert transition-all duration-300">${formattedReferences}</div>
                    </div>` : ''}
                </div>
            `;
            
            showModal('view-finding-modal');
        }
        
        function editFinding(findingId) {
            hideAllModals();
            addFinding(null, findingId);
        }
        
        function confirmDeleteFinding(findingId) {
            const finding = currentProject.findingDetails?.find(f => f.id === findingId);
            if (!finding) {
                showToast('Finding not found for deletion.', 'error');
                return;
            }
            
            showConfirmation(
                'Delete Finding',
                `Are you sure you want to delete the finding: <br><strong>"${finding.title}"</strong>?<br>This action cannot be undone.`,
                () => {
                    deleteFinding(findingId);
                }
            );
        }
        
        function deleteFinding(findingId) {
            const findingIndex = currentProject.findingDetails?.findIndex(f => f.id === findingId);
            if (findingIndex > -1) {
                const findingTitle = currentProject.findingDetails[findingIndex].title;
                currentProject.findingDetails.splice(findingIndex, 1); // Remove from array
                saveProjectToStorage();
                initFindingsTable(); // Refresh summary
                hideAllModals(); // Close view modal
                showToast('Finding deleted.', 'info');
                addActivity(`Deleted finding: ${findingTitle}`);
                
                // If a category-specific view is open, update it too
                if (currentCategory) {
                    populateCategoryFindings(currentCategory);
                    
                    // Update the findings count badge
                    const badge = document.getElementById('tab-findings-count');
                    if (badge) {
                        const count = currentProject.findingDetails.filter(f => f.category === currentCategory).length;
                        badge.textContent = count;
                    }
                }
            } else {
                showToast('Finding not found for deletion.', 'error');
            }
        }
        
        function initFindingsTable() {
            const tableBody = document.getElementById('findings-table');
            if (!tableBody) return;
            tableBody.innerHTML = ''; // Clear existing rows

            let totals = { high: 0, medium: 0, low: 0, info: 0, total: 0 };

            // Ensure findingDetails exists
            if (!currentProject.findingDetails) currentProject.findingDetails = [];

            Object.keys(categories).forEach(categoryId => {
                const category = categories[categoryId];
                const findingsInCategory = currentProject.findingDetails.filter(f => f.category === categoryId);

                const counts = { high: 0, medium: 0, low: 0, info: 0 };
                findingsInCategory.forEach(f => {
                    if (counts[f.severity] !== undefined) {
                        counts[f.severity]++;
                    } else if (f.severity === 'critical') { // Map critical to high for summary
                        counts['high']++;
                    }
                });
                const categoryTotal = findingsInCategory.length;

                totals.high += counts.high + (findingsInCategory.filter(f => f.severity === 'critical').length); // Add critical to high total
                totals.medium += counts.medium;
                totals.low += counts.low;
                totals.info += counts.info;
                totals.total += categoryTotal;

                const row = tableBody.insertRow();
                row.className = 'bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 border-b border-gray-200 dark:border-gray-700 transition-all duration-300 print-break-inside-avoid';
                row.innerHTML = `
                    <td class="px-6 py-3 font-medium text-gray-900 dark:text-gray-100 whitespace-nowrap">${category.title}</td>
                    <td class="px-4 py-3 text-center ${counts.high > 0 ? 'text-red-600 dark:text-red-400 font-semibold' : 'text-gray-500 dark:text-gray-400'}">${counts.high + (findingsInCategory.filter(f => f.severity === 'critical').length)}</td>
                    <td class="px-4 py-3 text-center ${counts.medium > 0 ? 'text-orange-600 dark:text-orange-400 font-semibold' : 'text-gray-500 dark:text-gray-400'}">${counts.medium}</td>
                    <td class="px-4 py-3 text-center ${counts.low > 0 ? 'text-yellow-600 dark:text-yellow-400 font-semibold' : 'text-gray-500 dark:text-gray-400'}">${counts.low}</td>
                    <td class="px-4 py-3 text-center ${counts.info > 0 ? 'text-blue-600 dark:text-blue-400 font-semibold' : 'text-gray-500 dark:text-gray-400'}">${counts.info}</td>
                    <td class="px-4 py-3 text-center font-bold text-gray-900 dark:text-gray-100">${categoryTotal}</td>
                    <td class="px-6 py-3 space-x-3 whitespace-nowrap">
                        <button class="font-medium text-green-600 dark:text-green-400 hover:text-green-800 dark:hover:text-green-300" onclick="addFinding('${categoryId}')" title="Add Finding to ${category.title}">
                            <i class="fas fa-plus fa-fw"></i> <span class="hidden sm:inline">Add</span>
                        </button>
                        ${categoryTotal > 0 ? `
                        <button class="font-medium text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300" onclick="viewCategoryFindings('${categoryId}')" title="View Findings for ${category.title}">
                            <i class="fas fa-eye fa-fw"></i> <span class="hidden sm:inline">View (${categoryTotal})</span>
                        </button>
                        ` : ''}
                    </td>
                `;
            });

            // Add Total Row
            const totalRow = tableBody.insertRow();
            totalRow.className = 'bg-gray-100 dark:bg-gray-700 border-t-2 border-gray-300 dark:border-gray-600 font-bold text-gray-800 dark:text-gray-200 print-break-inside-avoid';
            totalRow.innerHTML = `
                <td class="px-6 py-3">Total</td>
                <td class="px-4 py-3 text-center text-red-700 dark:text-red-400">${totals.high}</td>
                <td class="px-4 py-3 text-center text-orange-700 dark:text-orange-400">${totals.medium}</td>
                <td class="px-4 py-3 text-center text-yellow-700 dark:text-yellow-400">${totals.low}</td>
                <td class="px-4 py-3 text-center text-blue-700 dark:text-blue-400">${totals.info}</td>
                <td class="px-4 py-3 text-center">${totals.total}</td>
                <td class="px-6 py-3"></td>
            `;
        }
        
        function viewCategoryFindings(categoryId) {
            const findings = currentProject.findingDetails?.filter(f => f.category === categoryId) || [];
            const categoryTitle = categories[categoryId]?.title || 'Unknown Category';
            
            if (findings.length > 0) {
                // Open this category and switch to findings tab
                openCategory(categoryId);
                
                // Switch to findings tab
                changeTab('findings');
            } else {
                showToast(`No findings recorded for ${categoryTitle}`, 'info');
            }
        }
        
        function searchFindings() {
            const searchTerm = document.getElementById('findings-search').value.toLowerCase();
            const table = document.getElementById('findings-table');
            if (!table) return;
            
            // Skip the last row (totals)
            const rows = Array.from(table.querySelectorAll('tr:not(:last-child)'));
            
            rows.forEach(row => {
                const categoryText = row.cells[0].textContent.toLowerCase();
                const hasMatch = categoryText.includes(searchTerm);
                
                if (hasMatch) {
                    row.classList.remove('hidden');
                } else {
                    row.classList.add('hidden');
                }
            });
        }
        
        // --- Progress Visualization and Tracking ---
        
        function initProgressChart() {
            const ctx = document.getElementById('progress-chart').getContext('2d');
            
            // Calculate data for each category
            const labels = [];
            const data = [];
            const bgColors = [];
            
            Object.entries(categories).forEach(([categoryId, category]) => {
                labels.push(category.title.split(' ').shift()); // Use the API# part
                
                // Calculate completion percentage
                const categoryData = calculateCategoryProgress(categoryId);
                data.push(categoryData.percentage);
                
                // Set color based on priority
                switch(category.priority) {
                    case 'critical':
                        bgColors.push(isDarkMode ? 'rgba(220, 38, 38, 0.7)' : 'rgba(239, 68, 68, 0.7)'); // red-600/700
                        break;
                    case 'high':
                        bgColors.push(isDarkMode ? 'rgba(234, 88, 12, 0.7)' : 'rgba(249, 115, 22, 0.7)'); // orange-600/700
                        break;
                    case 'medium':
                        bgColors.push(isDarkMode ? 'rgba(202, 138, 4, 0.7)' : 'rgba(234, 179, 8, 0.7)'); // yellow-600/700
                        break;
                    case 'low':
                        bgColors.push(isDarkMode ? 'rgba(22, 163, 74, 0.7)' : 'rgba(34, 197, 94, 0.7)'); // green-600/700
                        break;
                    default:
                        bgColors.push(isDarkMode ? 'rgba(37, 99, 235, 0.7)' : 'rgba(59, 130, 246, 0.7)'); // blue-600/700
                }
            });
            
            progressChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Completion %',
                        data: data,
                        backgroundColor: bgColors,
                        borderColor: bgColors.map(color => color.replace('0.7', '1')),
                        borderWidth: 1,
                        borderRadius: 4,
                        barThickness: 15,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                title: function(tooltipItems) {
                                    const index = tooltipItems[0].dataIndex;
                                    const categoryId = Object.keys(categories)[index];
                                    return categories[categoryId].title;
                                },
                                label: function(context) {
                                    return `Progress: ${context.raw}%`;
                                }
                            },
                            backgroundColor: isDarkMode ? 'rgba(30, 41, 59, 0.9)' : 'rgba(255, 255, 255, 0.9)',
                            titleColor: isDarkMode ? '#e2e8f0' : '#1f2937',
                            bodyColor: isDarkMode ? '#e2e8f0' : '#1f2937',
                            borderColor: isDarkMode ? 'rgba(71, 85, 105, 0.5)' : 'rgba(203, 213, 225, 0.5)',
                            borderWidth: 1,
                            padding: 10,
                            displayColors: false,
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: {
                                color: isDarkMode ? 'rgba(71, 85, 105, 0.2)' : 'rgba(203, 213, 225, 0.2)'
                            },
                            ticks: {
                                color: isDarkMode ? '#cbd5e1' : '#475569'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: isDarkMode ? '#cbd5e1' : '#475569'
                            }
                        }
                    }
                }
            });
            
            // Calculate estimated completion time
            updateCompletionEstimate();
        }
        
        function updateProgressChart() {
            if (!progressChart) return;
            
            const data = [];
            
            Object.keys(categories).forEach(categoryId => {
                const categoryData = calculateCategoryProgress(categoryId);
                data.push(categoryData.percentage);
            });
            
            progressChart.data.datasets[0].data = data;
            progressChart.update();
        }
        
        // Create and update circular progress indicators
        function initCategoryCircleProgress() {
            Object.keys(categories).forEach(categoryId => {
                updateCategoryCircleProgress(categoryId);
            });
        }
        
        function updateCategoryCircleProgress(categoryId) {
            const circleEl = document.getElementById(`${categoryId}-progress-circle`);
            if (!circleEl) return;
            
            const categoryData = calculateCategoryProgress(categoryId);
            const percent = `${categoryData.percentage}%`;
            
            circleEl.style.setProperty('--progress-percent', percent);
            circleEl.textContent = percent;
            
            // Set the progress color based on completion level
            let progressColor = '#3b82f6'; // Default blue
            
            if (categoryData.percentage < 25) {
                progressColor = '#ef4444'; // Red for low progress
            } else if (categoryData.percentage < 50) {
                progressColor = '#f97316'; // Orange for fair progress
            } else if (categoryData.percentage < 75) {
                progressColor = '#eab308'; // Yellow for good progress
            } else {
                progressColor = '#10b981'; // Green for excellent progress
            }
            
            circleEl.style.setProperty('--progress-color', progressColor);
            
            // Update mini bar charts in the category cards
            const card = document.querySelector(`.category-card[data-category="${categoryId}"]`);
            if (card) {
                const barContainers = card.querySelectorAll('.bg-gray-100.dark\\:bg-gray-700.h-1\\.5');
                
                if (barContainers.length === 3) {
                    // Critical/high tasks (red)
                    const criticalItems = categoryData.critical || 0;
                    barContainers[0].querySelector('div').style.width = `${criticalItems}%`;
                    
                    // Medium tasks (yellow)
                    const inProgressItems = categoryData.inProgress || 0;
                    barContainers[1].querySelector('div').style.width = `${inProgressItems}%`;
                    
                    // Completed tasks (green)
                    const completedItems = categoryData.percentage || 0;
                    barContainers[2].querySelector('div').style.width = `${completedItems}%`;
                }
            }
        }
        
        // Calculate completion statistics for a specific category
        function calculateCategoryProgress(categoryId) {
            const categoryData = categories[categoryId];
            if (!categoryData || !categoryData.checklistItems) {
                return { checked: 0, total: 0, percentage: 0 };
            }
            
            let totalItems = 0;
            let checkedItems = 0;
            let criticalItems = 0; // Critical items not yet completed
            let inProgressItems = 0; // Items started but not fully completed
            
            categoryData.checklistItems.forEach(item => {
                if (item.id) {
                    totalItems++;
                    if (currentProject.progress?.[item.id]) {
                        checkedItems++;
                    } else {
                        // If not completed, count as critical or in-progress based on category priority
                        if (categoryData.priority === 'critical') {
                            criticalItems++;
                        } else {
                            inProgressItems++;
                        }
                    }
                }
            });
            
            const percentage = totalItems > 0 ? Math.round((checkedItems / totalItems) * 100) : 0;
            
            // Calculate normalized percentages (0-100) for the mini bars
            const normalizedCritical = totalItems > 0 ? Math.round((criticalItems / totalItems) * 100) : 0;
            const normalizedInProgress = totalItems > 0 ? Math.round((inProgressItems / totalItems) * 100) : 0;
            
            return { 
                checked: checkedItems, 
                total: totalItems, 
                percentage: percentage,
                critical: normalizedCritical,
                inProgress: normalizedInProgress
            };
        }
        
        function updateCompletionEstimate() {
            const estimateEl = document.getElementById('completion-estimate');
            if (!estimateEl) return;
            
            // Calculate overall progress
            let totalTasks = 0;
            let completedTasks = 0;
            let criticalTasks = 0;
            let completedCriticalTasks = 0;
            
            Object.entries(categories).forEach(([categoryId, category]) => {
                const items = category.checklistItems.filter(item => item.id); // Only actual tasks
                
                totalTasks += items.length;
                completedTasks += items.filter(item => currentProject.progress?.[item.id]).length;
                
                if (category.priority === 'critical') {
                    criticalTasks += items.length;
                    completedCriticalTasks += items.filter(item => currentProject.progress?.[item.id]).length;
                }
            });
            
            const overallPercentage = totalTasks > 0 ? (completedTasks / totalTasks) * 100 : 0;
            const criticalPercentage = criticalTasks > 0 ? (completedCriticalTasks / criticalTasks) * 100 : 0;
            
            // Estimate completion time based on progress
            let estimateText = '';
            
            if (totalTasks === completedTasks) {
                estimateText = '<strong>All tasks are complete!</strong> You can generate your report now.';
            } else if (completedTasks === 0) {
                estimateText = 'Start checking off some tasks to get an estimate of completion time.';
            } else {
                // Calculate remaining critical tasks
                const remainingCritical = criticalTasks - completedCriticalTasks;
                
                if (criticalPercentage < 100) {
                    // Estimate days to complete critical items
                    const criticalDaysEstimate = Math.ceil(remainingCritical / 2); // Assume 2 critical items per day
                    estimateText = `Based on your current pace, you'll complete all critical items in <strong>${criticalDaysEstimate} ${criticalDaysEstimate === 1 ? 'day' : 'days'}</strong>.`;
                } else {
                    // All critical done, estimate for the rest
                    const remainingTasks = totalTasks - completedTasks;
                    const daysEstimate = Math.ceil(remainingTasks / 5); // Assume 5 normal items per day
                    estimateText = `All critical items are complete! You'll finish the remaining items in <strong>${daysEstimate} ${daysEstimate === 1 ? 'day' : 'days'}</strong>.`;
                }
            }
            
            estimateEl.innerHTML = estimateText;
        }
        
        function updateProgressIndicators() {
            // Calculate Overall Progress
            let totalDefinedTasks = 0;
            let totalCheckedTasks = 0;
            Object.values(categories).forEach(cat => {
                if (cat.checklistItems) {
                    cat.checklistItems.forEach(item => {
                        if (item.id) {
                            totalDefinedTasks++;
                            if (currentProject.progress?.[item.id]) {
                                totalCheckedTasks++;
                            }
                        }
                    });
                }
            });
            const overallPercent = totalDefinedTasks > 0 ? Math.round((totalCheckedTasks / totalDefinedTasks) * 100) : 0;
            document.getElementById('overall-progress').textContent = overallPercent + '%';
            document.getElementById('overall-progress-bar').style.width = overallPercent + '%';
        
            // Calculate Priority Progress
            updatePriorityProgressFromState();
        
            // Update Category Card Progress
            updateCategoryProgressCards();
            
            // Update Category Circle Progress
            initCategoryCircleProgress();
            
            // Update Progress Chart
            updateProgressChart();
            
            // Update Completion Estimate
            updateCompletionEstimate();
        
            // Update Last Updated Time
            currentProject.lastUpdated = new Date().toISOString();
            const updatedEl = document.getElementById('project-updated');
            if (updatedEl) updatedEl.textContent = new Date(currentProject.lastUpdated).toLocaleString();
        }
        
        function updatePriorityProgressFromState() {
            let counts = { critical: { checked: 0, total: 0 }, high: { checked: 0, total: 0 }, medium: { checked: 0, total: 0 } };
        
            Object.entries(categories).forEach(([catId, catData]) => {
                const priority = catData.priority;
                if (counts[priority] && catData.checklistItems) {
                    catData.checklistItems.forEach(item => {
                        if (item.id) {
                            counts[priority].total++;
                            if (currentProject.progress?.[item.id]) {
                                counts[priority].checked++;
                            }
                        }
                    });
                }
            });
        
            // Update Critical
            const critPercent = counts.critical.total > 0 ? Math.round((counts.critical.checked / counts.critical.total) * 100) : 0;
            document.getElementById('critical-progress').textContent = `${counts.critical.checked}/${counts.critical.total}`;
            document.getElementById('critical-progress-bar').style.width = critPercent + '%';
        
            // Update High
            const highPercent = counts.high.total > 0 ? Math.round((counts.high.checked / counts.high.total) * 100) : 0;
            document.getElementById('high-progress').textContent = `${counts.high.checked}/${counts.high.total}`;
            document.getElementById('high-progress-bar').style.width = highPercent + '%';
        
            // Update Medium
            const medPercent = counts.medium.total > 0 ? Math.round((counts.medium.checked / counts.medium.total) * 100) : 0;
            document.getElementById('medium-progress').textContent = `${counts.medium.checked}/${counts.medium.total}`;
            document.getElementById('medium-progress-bar').style.width = medPercent + '%';
        }
        
        function updateCategoryProgressCards() {
            Object.keys(categories).forEach(categoryId => {
                const categoryData = categories[categoryId];
                const progressElement = document.getElementById(`${categoryId}-progress`);
                if (!progressElement || !categoryData.checklistItems) return;
        
                const categoryProgress = calculateCategoryProgress(categoryId);
                progressElement.textContent = categoryProgress.percentage + '% complete';
            });
        }
        
        function handleCheckboxChange(checkbox) {
            const taskId = checkbox.getAttribute('data-task-id');
            if (!taskId) return;
        
            if (!currentProject.progress) currentProject.progress = {};
            currentProject.progress[taskId] = checkbox.checked;
        
            updateProgressIndicators(); // Update all progress displays
            updateCategoryProgressStats();
            addActivity(`Task ${checkbox.checked ? 'completed' : 'unmarked'}: ${checkbox.nextElementSibling.textContent.substring(0, 30)}...`);
            saveProjectToStorage();     // Save changes immediately
        }
        
        function applyCheckboxStates() {
            const checklistContainer = document.getElementById('checklist-content');
            if (!checklistContainer || !currentProject.progress) return;
       
           checklistContainer.querySelectorAll('.task-checkbox').forEach(checkbox => {
               const taskId = checkbox.getAttribute('data-task-id');
               checkbox.checked = taskId ? (currentProject.progress[taskId] || false) : false;
           });
        }
        
        function sortCategories(sortBy) {
            if (currentSort === sortBy) {
                // Toggle sort order if clicking the same button
                sortBy = 'none';
            }
            
            currentSort = sortBy;
            const categoryGrid = document.getElementById('category-grid');
            const cards = Array.from(categoryGrid.querySelectorAll('.category-card'));
            
            if (sortBy === 'none') {
                // Reset to original order
                cards.sort((a, b) => {
                    const aIndex = Object.keys(categories).indexOf(a.getAttribute('data-category'));
                    const bIndex = Object.keys(categories).indexOf(b.getAttribute('data-category'));
                    return aIndex - bIndex;
                });
            } else if (sortBy === 'priority') {
                // Sort by priority (critical first, then high, medium, low)
                const priorityOrder = { 'critical': 0, 'high': 1, 'medium': 2, 'low': 3 };
                cards.sort((a, b) => {
                    const aCat = categories[a.getAttribute('data-category')];
                    const bCat = categories[b.getAttribute('data-category')];
                    return priorityOrder[aCat.priority] - priorityOrder[bCat.priority];
                });
                
                showToast('Categories sorted by priority', 'info');
            } else if (sortBy === 'progress') {
                // Sort by progress (lowest progress first)
                cards.sort((a, b) => {
                    const aCat = a.getAttribute('data-category');
                    const bCat = b.getAttribute('data-category');
                    const aProgress = calculateCategoryProgress(aCat).percentage;
                    const bProgress = calculateCategoryProgress(bCat).percentage;
                    return aProgress - bProgress;
                });
                
                showToast('Categories sorted by completion progress', 'info');
            }
            
            // Reorder the DOM elements
            cards.forEach(card => {
                categoryGrid.appendChild(card);
            });
            
            // Update sort button indicators
            document.getElementById('btn-sort-priority').classList.toggle('bg-blue-200', sortBy === 'priority');
            document.getElementById('btn-sort-progress').classList.toggle('bg-blue-200', sortBy === 'progress');
        }
        
        function updateCategoryProgressStats() {
            if (!currentCategory) return;
            
            const statEl = document.getElementById('category-progress-stat');
            if (!statEl) return;
            
            // Only count visible tasks if search is active
            const searchTerm = document.getElementById('task-search')?.value;
            const tasks = document.querySelectorAll('#checklist-content .task-item:not(.hidden) .task-checkbox');
            
            let total = tasks.length;
            let checked = Array.from(tasks).filter(checkbox => checkbox.checked).length;
            
            statEl.textContent = `${checked}/${total}`;
        }
        
        function markAllTasks() {
            if (!currentCategory) return;
            
            const tasks = document.querySelectorAll('#checklist-content .task-item:not(.hidden) .task-checkbox');
            tasks.forEach(checkbox => {
                if (!checkbox.checked) {
                    checkbox.checked = true;
                    handleCheckboxChange(checkbox);
                }
            });
            
            showToast('All visible tasks marked as complete', 'success');
        }
        
        function unmarkAllTasks() {
            if (!currentCategory) return;
            
            const tasks = document.querySelectorAll('#checklist-content .task-item:not(.hidden) .task-checkbox');
            tasks.forEach(checkbox => {
                if (checkbox.checked) {
                    checkbox.checked = false;
                    handleCheckboxChange(checkbox);
                }
            });
            
            showToast('All visible tasks unmarked', 'info');
        }
        
        function searchTasks() {
            const searchTerm = document.getElementById('task-search').value.toLowerCase();
            const tasks = document.querySelectorAll('.task-item');
            
            tasks.forEach(task => {
                const text = task.querySelector('label').textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    task.classList.remove('hidden');
                } else {
                    task.classList.add('hidden');
                }
            });
            
            // Update the category progress stats to reflect visible items
            updateCategoryProgressStats();
        }
        
        // --- Activity Tracking ---
        function addActivity(message) {
            const now = new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            recentActivities.unshift({
                time: timeString,
                message: message
            });
            
            // Keep only last 10 activities
            if (recentActivities.length > 10) {
                recentActivities.pop();
            }
            
            updateActivityDisplay();
        }
        
        function updateActivityDisplay() {
            const activityList = document.getElementById('recent-activity');
            if (!activityList) return;
            
            activityList.innerHTML = '';
            
            if (recentActivities.length === 0) {
                activityList.innerHTML = '<li class="flex items-start gap-2"><span class="text-blue-500 mt-0.5"><i class="fas fa-info-circle"></i></span><span>No recent activity</span></li>';
                return;
            }
            
            recentActivities.forEach(activity => {
                const li = document.createElement('li');
                li.className = 'flex items-start gap-2';
                li.innerHTML = `
                    <span class="text-blue-500 mt-0.5"><i class="fas fa-clock"></i></span>
                    <span><span class="text-xs font-semibold">${activity.time}</span> - ${activity.message}</span>
                `;
                activityList.appendChild(li);
            });
        }
        
        function showConfetti() {
            const confettiContainer = document.getElementById('confetti-container');
            if (!confettiContainer) return;
            
            // Clear any existing confetti
            confettiContainer.innerHTML = '';
            
            // Create confetti pieces
            const confettiCount = 100;
            const confettiHTML = Array.from({ length: confettiCount }).map((_, i) => {
                const randomX = Math.random() * 100; // Random X position (0-100%)
                const randomDelay = Math.random() * 2; // Random delay (0-2s)
                const speed = ['slow', 'medium', 'fast'][Math.floor(Math.random() * 3)]; // Random speed
                
                return `<div class="confetti--container" style="left: ${randomX}%">
                    <div class="confetti-piece ${speed}" style="animation-delay: ${randomDelay}s;"></div>
                </div>`;
            }).join('');
            
            confettiContainer.innerHTML = confettiHTML;
            
            // Remove confetti after animation completes
            setTimeout(() => {
                confettiContainer.innerHTML = '';
            }, 5000);
        }
        
        // --- Notes Management ---
        
        function saveNotes() {
            if (currentCategory && categories[currentCategory]) {
                if (!currentProject.notes) currentProject.notes = {};
                const notesValue = document.getElementById('category-notes')?.value;
                if (notesValue !== undefined) {
                    currentProject.notes[currentCategory] = notesValue;
                    saveProjectToStorage();
                    showToast('Notes saved successfully', 'success');
                    addActivity(`Updated notes for ${categories[currentCategory].title}`);
                }
            } else {
                showToast('Cannot save notes: No category selected.', 'error');
            }
        }
        
        function copyNotes() {
            const notesTextarea = document.getElementById('category-notes');
            if (!notesTextarea) return;
            
            notesTextarea.select();
            document.execCommand('copy');
            showToast('Notes copied to clipboard', 'success');
        }
        
        // --- Project Management ---
        
        function editProjectDetails() {
            const nameEl = document.getElementById('edit-project-name');
            const targetEl = document.getElementById('edit-project-target');
            const dateEl = document.getElementById('edit-project-date');
            const testerEl = document.getElementById('edit-project-tester');
            const scopeEl = document.getElementById('edit-project-scope');
            
            if (!currentProject) return;
            
            nameEl.value = currentProject.name || '';
            targetEl.value = currentProject.target || '';
            dateEl.value = currentProject.date ? new Date(currentProject.date).toISOString().split('T')[0] : '';
            testerEl.value = currentProject.tester || '';
            scopeEl.value = currentProject.scope || '';
            
            showModal('project-modal');
        }
        
        function saveProjectDetails() {
            const projectName = document.getElementById('edit-project-name')?.value.trim();
            if (!projectName) {
                showToast('Project name cannot be empty.', 'error');
                return;
            }
            
            currentProject.name = projectName;
            currentProject.target = document.getElementById('edit-project-target')?.value.trim() || '';
            currentProject.date = document.getElementById('edit-project-date')?.value || '';
            currentProject.tester = document.getElementById('edit-project-tester')?.value.trim() || '';
            currentProject.scope = document.getElementById('edit-project-scope')?.value.trim() || '';
            currentProject.lastUpdated = new Date().toISOString();
            
            saveProjectToStorage();
            updateProjectUI();
            hideAllModals();
            showToast('Project details updated.', 'success');
            addActivity(`Updated project details: ${projectName}`);
        }
        
        function populateProjectsList() {
            const projectsList = document.getElementById('projects-list');
            if (!projectsList) return;
            projectsList.innerHTML = '';
            
            if (Object.keys(projects).length === 0) {
                projectsList.innerHTML = '<li class="py-4 text-center text-gray-500 dark:text-gray-400">No projects found.</li>';
                return;
            }
            
            Object.values(projects).sort((a, b) => new Date(b.lastUpdated) - new Date(a.lastUpdated)).forEach(project => {
                // Calculate project stats
                let totalTasks = 0, completedTasks = 0, findingsCount = 0;
                
                Object.values(categories).forEach(cat => {
                    if (cat.checklistItems) {
                        cat.checklistItems.forEach(item => {
                            if (item.id) {
                                totalTasks++;
                                if (project.progress?.[item.id]) {
                                    completedTasks++;
                                }
                            }
                        });
                    }
                });
                
                findingsCount = project.findingDetails?.length || 0;
                const progressPercent = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
                
                const li = document.createElement('li');
                li.className = `py-3 px-4 flex justify-between items-center hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-300 ${project.id === currentProject.id ? 'bg-blue-50 dark:bg-blue-900/30 border-l-4 border-blue-500 dark:border-blue-700' : ''}`;
                
                li.innerHTML = `
                    <div class="flex-grow mr-4 overflow-hidden">
                        <h3 class="text-sm font-medium text-gray-900 dark:text-gray-100 truncate" title="${project.name}">${project.name}</h3>
                        <div class="flex items-center text-xs text-gray-500 dark:text-gray-400 mt-1">
                            <span class="mr-2">Progress: ${progressPercent}%</span>
                            <span class="mr-2">|</span>
                            <span>Findings: ${findingsCount}</span>
                            <span class="ml-auto">Updated: ${formatTimeAgo(new Date(project.lastUpdated))}</span>
                        </div>
                        <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-1.5 mt-2">
                            <div class="bg-blue-600 h-1.5 rounded-full" style="width: ${progressPercent}%"></div>
                        </div>
                    </div>
                    <div class="flex-shrink-0 flex space-x-3">
                        <button class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 btn-load-project" data-project-id="${project.id}" title="Load Project">
                            <i class="fas fa-folder-open fa-fw"></i>
                        </button>
                        ${project.id !== 'default' ? `
                        <button class="text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 btn-delete-project" data-project-id="${project.id}" title="Delete Project">
                            <i class="fas fa-trash fa-fw"></i>
                        </button>
                        ` : `
                        <button class="text-gray-400 dark:text-gray-600 cursor-not-allowed" title="Cannot delete default project">
                            <i class="fas fa-trash fa-fw"></i>
                        </button>
                        `}
                    </div>
                `;
                
                // Add event listeners
                li.querySelector('.btn-load-project').addEventListener('click', function() {
                    loadProject(this.getAttribute('data-project-id'));
                });
                
                const deleteBtn = li.querySelector('.btn-delete-project');
                if (deleteBtn) {
                    deleteBtn.addEventListener('click', function() {
                        deleteProject(this.getAttribute('data-project-id'));
                    });
                }
                
                projectsList.appendChild(li);
            });
        }
        
        function formatTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffSec = Math.floor(diffMs / 1000);
            const diffMin = Math.floor(diffSec / 60);
            const diffHour = Math.floor(diffMin / 60);
            const diffDay = Math.floor(diffHour / 24);
            
            if (diffDay > 30) {
                return date.toLocaleDateString();
            } else if (diffDay > 0) {
                return `${diffDay} ${diffDay === 1 ? 'day' : 'days'} ago`;
            } else if (diffHour > 0) {
                return `${diffHour} ${diffHour === 1 ? 'hour' : 'hours'} ago`;
            } else if (diffMin > 0) {
                return `${diffMin} ${diffMin === 1 ? 'minute' : 'minutes'} ago`;
            } else {
                return 'Just now';
            }
        }
        
        function loadProject(projectId) {
            if (projects[projectId]) {
                currentProject = projects[projectId];
                // Ensure essential properties exist
                currentProject.progress = currentProject.progress || {};
                currentProject.notes = currentProject.notes || {};
                currentProject.findings = currentProject.findings || {}; // Old summary counts, less critical now
                currentProject.findingDetails = currentProject.findingDetails || [];
    
                updateProjectUI();
                initFindingsTable();
                updateProgressIndicators();
                closeCategory(); // Close any open category detail view
                hideAllModals();
                showToast(`Project "${currentProject.name}" loaded.`, 'success');
                addActivity(`Loaded project: ${currentProject.name}`);
            } else {
                showToast(`Project ID "${projectId}" not found.`, 'error');
            }
        }
        
        function deleteProject(projectId) {
            if (projectId === 'default') {
                showToast('The default project cannot be deleted.', 'warning');
                return;
            }
            if (!projects[projectId]) {
                 showToast('Project not found.', 'error');
                 return;
            }
    
            showConfirmation(
                'Delete Project',
                `Delete project: <strong>"${projects[projectId].name}"</strong>?<br>This action cannot be undone.`,
                () => {
                    const projectName = projects[projectId].name;
                    delete projects[projectId];
                    saveAllProjectsToStorage(); // Save the updated projects object
    
                    if (currentProject.id === projectId) {
                        loadProject('default'); // Load default if current was deleted
                    }
    
                    populateProjectsList(); // Refresh the list in the already open modal
                    showToast('Project deleted.', 'info');
                    addActivity(`Deleted project: ${projectName}`);
                }
            );
        }
        
        function saveNewProject() {
            const projectName = document.getElementById('new-project-name')?.value.trim();
            if (!projectName) {
                showToast('Project name is required.', 'error');
                return;
            }
    
            const projectId = 'project_' + Date.now() + Math.random().toString(16).slice(2);
            const templateType = document.querySelector('input[name="project-template"]:checked')?.value || 'empty';
    
            const newProject = {
                id: projectId,
                name: projectName,
                target: document.getElementById('new-project-target')?.value.trim() || '',
                date: document.getElementById('new-project-date')?.value || '',
                tester: document.getElementById('new-project-tester')?.value.trim() || '',
                scope: document.getElementById('new-project-scope')?.value.trim() || '',
                lastUpdated: new Date().toISOString(),
                findings: {}, // Legacy summary counts
                findingDetails: [], // Array for detailed findings
                notes: {},
                progress: {} // Start empty, template option removed for simplicity for now
            };
    
            // If starter template selected, add some basic tasks
            if (templateType === 'starter') {
                // Set some basic tasks as completed for starter template
                const starterTasks = ['bola-1', 'bola-2', 'auth-1', 'auth-2'];
                starterTasks.forEach(taskId => {
                    newProject.progress[taskId] = true;
                });
                
                // Add a sample note
                newProject.notes['broken-object-level-auth'] = 'Initial testing identified several endpoints that may have BOLA vulnerabilities. Need to test more thoroughly.';
            }
    
            projects[projectId] = newProject;
            saveAllProjectsToStorage(); // Save all projects
            loadProject(projectId); // Load the newly created project
    
            hideAllModals();
            showToast(`Project "${projectName}" created.`, 'success');
            showConfetti(); // Celebrate new project creation
            addActivity(`Created new project: ${projectName}`);
        }
        
        function updateProjectUI() {
            if (!currentProject) return;
    
            document.getElementById('current-project-name').textContent = currentProject.name || '...';
            document.getElementById('project-name').textContent = currentProject.name || 'Default Project';
            document.getElementById('project-target').textContent = currentProject.target || 'Not specified';
            document.getElementById('project-date').textContent = currentProject.date ? new Date(currentProject.date + 'T00:00:00').toLocaleDateString() : 'Not specified'; // Ensure date is interpreted correctly
            document.getElementById('project-tester').textContent = currentProject.tester || 'Not specified';
            document.getElementById('project-scope').textContent = currentProject.scope || 'Not specified';
            document.getElementById('project-updated').textContent = currentProject.lastUpdated ? new Date(currentProject.lastUpdated).toLocaleString() : 'Not specified';
    
            // Update print header details
            const printDate = currentProject.date ? new Date(currentProject.date + 'T00:00:00').toLocaleDateString() : 'N/A';
            document.getElementById('print-project-name').textContent = `Project: ${currentProject.name || 'N/A'}`;
            document.getElementById('print-project-target').textContent = `API Target: ${currentProject.target || 'N/A'}`;
            document.getElementById('print-project-date').textContent = `Date: ${printDate}`;
            document.getElementById('print-project-tester').textContent = `Tester: ${currentProject.tester || 'N/A'}`;
        }
        
        // --- Local Storage Management ---
        
        function loadProjectsFromStorage() {
            try {
                const projectsData = localStorage.getItem('owasp-api-projects');
                if (projectsData) {
                    projects = JSON.parse(projectsData);
                    
                    // Try to load the last active project if possible
                    const lastActiveId = localStorage.getItem('owasp-api-last-active-project');
                    
                    // Find default or first project
                    const projectIdToLoad = (lastActiveId && projects[lastActiveId]) ? lastActiveId : 
                                           (projects['default'] ? 'default' : (Object.keys(projects)[0] || null));
                     
                    if (projectIdToLoad && projects[projectIdToLoad]) {
                        currentProject = projects[projectIdToLoad];
                        // Ensure structures exist after loading
                        currentProject.progress = currentProject.progress || {};
                        currentProject.notes = currentProject.notes || {};
                        currentProject.findings = currentProject.findings || {};
                        currentProject.findingDetails = currentProject.findingDetails || [];
                    } else {
                        console.warn("No valid project found in storage, creating default.");
                        createDefaultProject();
                    }
                } else {
                    console.log("No projects found in storage, creating default.");
                    createDefaultProject();
                }
            } catch (error) {
                console.error("Failed to load projects from storage:", error);
                showToast("Error loading projects. Creating default.", "error");
                createDefaultProject();
            }
        }
        
        function createDefaultProject() {
            currentProject = {
                id: 'default',
                name: 'Default Project',
                target: '', date: '', tester: '', scope: '',
                lastUpdated: new Date().toISOString(),
                findings: {}, findingDetails: [], notes: {}, progress: {}
            };
            projects = { 'default': currentProject };
            saveAllProjectsToStorage();
        }
        
        function saveProjectToStorage() {
            if (currentProject && currentProject.id) {
                projects[currentProject.id] = currentProject; // Update the project in the main projects object
                saveAllProjectsToStorage(); // Save the entire projects object
                
                // Also save the last active project ID
                localStorage.setItem('owasp-api-last-active-project', currentProject.id);
            } else {
                console.error("Cannot save: currentProject is invalid.");
            }
        }
        
        function saveAllProjectsToStorage() {
            try {
                localStorage.setItem('owasp-api-projects', JSON.stringify(projects));
            } catch (error) {
                console.error("Failed to save projects to storage:", error);
                showToast("Error saving project data. Storage might be full.", "error");
            }
        }
        
        // --- Import/Export ---
        
        function handleImportFile(event) {
            const file = event.target.files?.[0];
            const previewEl = document.getElementById('import-preview');
            const confirmBtn = document.getElementById('btn-confirm-import');
            if (!file || !previewEl || !confirmBtn) return;
        
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importContent = e.target.result;
                    const importData = JSON.parse(importContent);
        
                    // Basic validation
                    if (!importData.project || !importData.project.id || !importData.project.name) {
                        throw new Error('Invalid format: Missing essential project data.');
                    }
        
                    // Show preview
                    document.getElementById('import-project-name').textContent = `Project: ${importData.project.name}`;
                    document.getElementById('import-project-date').textContent = `Exported: ${importData.exportDate ? new Date(importData.exportDate).toLocaleString() : 'Unknown'}`;
                    const findingsCount = importData.project.findingDetails?.length || 0;
                    const progressCount = Object.keys(importData.project.progress || {}).length;
                    document.getElementById('import-project-items').textContent = `Data: ${findingsCount} findings, ${progressCount} progress items`;
        
                    previewEl.classList.remove('hidden');
                    confirmBtn.disabled = false;
                    confirmBtn.setAttribute('data-import', importContent); // Store content for confirmation step
        
                } catch (error) {
                    console.error("Import file read error:", error);
                    showToast(`Error reading file: ${error.message}`, 'error');
                    previewEl.classList.add('hidden');
                    confirmBtn.disabled = true;
                    confirmBtn.removeAttribute('data-import');
                }
            };
            reader.onerror = function() {
                showToast('Failed to read the selected file.', 'error');
                previewEl.classList.add('hidden');
                confirmBtn.disabled = true;
                confirmBtn.removeAttribute('data-import');
            };
            reader.readAsText(file);
        }
        
        function confirmImport() {
            const confirmBtn = document.getElementById('btn-confirm-import');
            const importContent = confirmBtn?.getAttribute('data-import');
            if (!importContent) {
                showToast("No import data found.", "error");
                return;
            }
        
            try {
                const importData = JSON.parse(importContent);
                const importedProject = importData.project;
        
                // Check for existing ID - potentially overwrite or ask user?
                if (projects[importedProject.id]) {
                    showToast(`Project ID "${importedProject.id}" already exists. Renaming imported project.`, 'warning');
                    importedProject.id = 'project_' + Date.now() + Math.random().toString(16).slice(2);
                }
                // Ensure essential structures exist on import
                importedProject.progress = importedProject.progress || {};
                importedProject.notes = importedProject.notes || {};
                importedProject.findings = importedProject.findings || {};
                importedProject.findingDetails = importedProject.findingDetails || [];
                importedProject.lastUpdated = new Date().toISOString(); // Update timestamp on import
        
                // Add to projects and save
                projects[importedProject.id] = importedProject;
                saveAllProjectsToStorage();
        
                // Load the imported project
                loadProject(importedProject.id);
        
                hideAllModals();
                showToast(`Project "${importedProject.name}" imported successfully.`, 'success');
                addActivity(`Imported project: ${importedProject.name}`);
        
            } catch (error) {
                console.error("Import confirmation failed:", error);
                showToast(`Import failed: ${error.message}`, 'error');
            } finally {
                // Clean up button attribute
                confirmBtn.removeAttribute('data-import');
                confirmBtn.disabled = true;
            }
        }
        
        function handleExport() {
            const format = document.querySelector('input[name="export-format"]:checked')?.value;
            hideAllModals();
            
            if (format === 'json') {
                exportProject();
            } else if (format === 'pdf') {
                const includeProgress = document.getElementById('include-progress')?.checked || false;
                const includeChecklist = document.getElementById('include-checklist')?.checked || false;
                const includeNotes = document.getElementById('include-notes')?.checked || false;
                
                generatePdfReport(includeProgress, includeChecklist, includeNotes);
            } else if (format === 'csv') {
                exportFindingsCSV();
            }
        }
        
        function exportProject() {
            if (!currentProject) {
                showToast("No project loaded to export.", "warning");
                return;
            }
            // Prune potentially large techniques/tools HTML before export? Optional.
            // const projectToExport = JSON.parse(JSON.stringify(currentProject)); // Deep clone
            const exportData = {
                exportFormatVersion: '1.0', // Identify format
                exportDate: new Date().toISOString(),
                project: currentProject // Export current project data
            };
        
            try {
                const dataStr = "data:application/json;charset=utf-8," + encodeURIComponent(JSON.stringify(exportData, null, 2));
                const downloadAnchorNode = document.createElement('a');
                const fileName = (currentProject.name || 'owasp_api_project').replace(/[^a-z0-9]/gi, '_').toLowerCase() + `_${new Date().toISOString().split('T')[0]}.json`;
        
                downloadAnchorNode.setAttribute("href", dataStr);
                downloadAnchorNode.setAttribute("download", fileName);
                document.body.appendChild(downloadAnchorNode);
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
                showToast('Project exported successfully.', 'success');
                addActivity("Exported project as JSON");
            } catch (error) {
                console.error("Export failed:", error);
                showToast('Project export failed.', 'error');
            }
        }
        
        function exportFindingsCSV() {
            if (!currentProject || !currentProject.findingDetails || currentProject.findingDetails.length === 0) {
                showToast("No findings to export as CSV.", "warning");
                return;
            }
            
            const headers = [
                "Title", "Severity", "Category", "Description", 
                "Steps to Reproduce", "Remediation", "Date Found", "Last Edited"
            ];
            
            let csvContent = headers.join(",") + "\r\n";
            
            currentProject.findingDetails.forEach(finding => {
                // Escape fields with quotes and handle commas
                const safeField = (field) => {
                    if (field === null || field === undefined) return '""';
                    return `"${String(field).replace(/"/g, '""')}"`;
                };
                
                const row = [
                    safeField(finding.title),
                    safeField(finding.severity),
                    safeField(categories[finding.category]?.title || finding.category),
                    safeField(finding.description),
                    safeField(finding.steps),
                    safeField(finding.remediation),
                    safeField(finding.date ? new Date(finding.date).toLocaleDateString() : ''),
                    safeField(finding.lastEdited ? new Date(finding.lastEdited).toLocaleDateString() : '')
                ];
                
                csvContent += row.join(",") + "\r\n";
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            const fileName = (currentProject.name || 'owasp_api_findings').replace(/[^a-z0-9]/gi, '_').toLowerCase() + `_findings_${new Date().toISOString().split('T')[0]}.csv`;
            
            link.setAttribute("href", url);
            link.setAttribute("download", fileName);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast("Findings exported as CSV", "success");
            addActivity("Exported findings as CSV");
        }
        
        function generatePdfReport(includeProgress, includeChecklist, includeNotes) {
            if (!currentProject) {
                showToast("No project loaded to export as PDF.", "warning");
                return;
            }
            
            showToast("Generating PDF report...", "info");
            
            // Create an element to render the report
            const reportContainer = document.createElement('div');
            reportContainer.className = 'pdf-report';
            reportContainer.style.width = '8.5in';
            reportContainer.style.padding = '0.5in';
            reportContainer.style.backgroundColor = 'white';
            reportContainer.style.color = 'black';
            reportContainer.style.fontFamily = 'Arial, sans-serif';
            
            // Append to document temporarily but hide it
            reportContainer.style.position = 'absolute';
            reportContainer.style.left = '-9999px';
            document.body.appendChild(reportContainer);
            
            // Fill with report content
            reportContainer.innerHTML = generateReportHTML(includeProgress, includeChecklist, includeNotes);
            
            // Use html2pdf to convert to PDF
            const opt = {
                margin: 10,
                filename: `${currentProject.name.replace(/[^a-z0-9]/gi, '_').toLowerCase()}_api_report.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            
            html2pdf().set(opt).from(reportContainer).save().then(() => {
                // Remove the temporary element
                document.body.removeChild(reportContainer);
                showToast("PDF report generated successfully", "success");
                addActivity("Generated PDF report");
            }).catch(error => {
                console.error("PDF generation failed:", error);
                document.body.removeChild(reportContainer);
                showToast("Failed to generate PDF report", "error");
            });
        }
        
        function generateReportHTML(includeProgress, includeChecklist, includeNotes) {
            // Calculate various statistics
            let totalFindings = currentProject.findingDetails?.length || 0;
            let criticalFindings = currentProject.findingDetails?.filter(f => f.severity === 'critical').length || 0;
            let highFindings = currentProject.findingDetails?.filter(f => f.severity === 'high').length || 0;
            let mediumFindings = currentProject.findingDetails?.filter(f => f.severity === 'medium').length || 0;
            let lowFindings = currentProject.findingDetails?.filter(f => f.severity === 'low').length || 0;
            let infoFindings = currentProject.findingDetails?.filter(f => f.severity === 'info').length || 0;
            
            let totalChecks = 0;
            let completedChecks = 0;
            
            Object.values(categories).forEach(cat => {
                if (cat.checklistItems) {
                    cat.checklistItems.forEach(item => {
                        if (item.id) {
                            totalChecks++;
                            if (currentProject.progress?.[item.id]) {
                                completedChecks++;
                            }
                        }
                    });
                }
            });
            
            const completionPercent = totalChecks > 0 ? Math.round((completedChecks / totalChecks) * 100) : 0;
            
            // Build the HTML for the PDF report
            return `
                <div style="font-family: Arial, sans-serif; color: #333;">
                    <div style="text-align: center; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 2px solid #e0e0e0;">
                        <h1 style="color: #1a56db; font-size: 28px; margin-bottom: 5px;">OWASP API Security Assessment Report</h1>
                        <p style="font-size: 16px; color: #666; margin: 0;">${new Date().toLocaleDateString()}</p>
                    </div>
                    
                    <div style="margin-bottom: 30px;">
                        <h2 style="color: #1e40af; border-bottom: 1px solid #e0e0e0; padding-bottom: 8px;">Project Information</h2>
                        <table style="width: 100%; border-collapse: collapse;">
                            <tr>
                                <td style="padding: 8px 0; font-weight: bold; width: 150px;">Project Name:</td>
                                <td style="padding: 8px 0;">${currentProject.name || 'N/A'}</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px 0; font-weight: bold;">API Target:</td>
                                <td style="padding: 8px 0;">${currentProject.target || 'N/A'}</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px 0; font-weight: bold;">Assessment Date:</td>
                                <td style="padding: 8px 0;">${currentProject.date ? new Date(currentProject.date + 'T00:00:00').toLocaleDateString() : 'N/A'}</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px 0; font-weight: bold;">Tester:</td>
                                <td style="padding: 8px 0;">${currentProject.tester || 'N/A'}</td>
                            </tr>
                        </table>
                        ${currentProject.scope ? `
                        <h3 style="color: #2563eb; margin-top: 15px; margin-bottom: 5px;">Scope</h3>
                        <p style="margin-top: 0; line-height: 1.5;">${currentProject.scope.replace(/\n/g, '<br>')}</p>
                        ` : ''}
                    </div>
                    
                    <div style="margin-bottom: 30px;">
                        <h2 style="color: #1e40af; border-bottom: 1px solid #e0e0e0; padding-bottom: 8px;">Executive Summary</h2>
                        <p style="line-height: 1.5;">
                            This report presents the findings from an API security assessment based on the OWASP API Security Top 10 framework. 
                            The assessment identified <strong>${totalFindings}</strong> total findings across different severity levels.
                            ${completionPercent < 100 ? `The assessment is approximately <strong>${completionPercent}%</strong> complete.` : 'The assessment is complete.'}
                        </p>
                        
                        ${includeProgress ? `
                        <h3 style="color: #2563eb; margin-top: 20px; margin-bottom: 10px;">Assessment Progress</h3>
                        <div style="background-color: #f3f4f6; height: 24px; border-radius: 12px; overflow: hidden; margin-bottom: 5px;">
                            <div style="background-color: #3b82f6; height: 100%; width: ${completionPercent}%; text-align: center; color: white; line-height: 24px; font-weight: bold; font-size: 12px;">
                                ${completionPercent}%
                            </div>
                        </div>
                        <p style="margin-top: 5px; font-size: 14px; color: #6b7280; text-align: right;">
                            ${completedChecks} of ${totalChecks} security checks completed
                        </p>
                        ` : ''}
                    </div>
                    
                    <div style="margin-bottom: 30px;">
                        <h2 style="color: #1e40af; border-bottom: 1px solid #e0e0e0; padding-bottom: 8px;">Finding Summary</h2>
                        
                        <table style="width: 100%; border-collapse: collapse; margin: 15px 0; border: 1px solid #e5e7eb;">
                            <thead>
                                <tr style="background-color: #f9fafb;">
                                    <th style="padding: 12px; text-align: left; border: 1px solid #e5e7eb;">Severity</th>
                                    <th style="padding: 12px; text-align: center; border: 1px solid #e5e7eb;">Count</th>
                                    <th style="padding: 12px; text-align: left; border: 1px solid #e5e7eb;">Risk Level</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 12px; border: 1px solid #e5e7eb; font-weight: bold; color: #dc2626;">Critical</td>
                                    <td style="padding: 12px; text-align: center; border: 1px solid #e5e7eb;">${criticalFindings}</td>
                                    <td style="padding: 12px; border: 1px solid #e5e7eb;">Immediate attention required. Allows full compromise.</td>
                                </tr>
                                <tr>
                                    <td style="padding: 12px; border: 1px solid #e5e7eb; font-weight: bold; color: #ea580c;">High</td>
                                    <td style="padding: 12px; text-align: center; border: 1px solid #e5e7eb;">${highFindings}</td>
                                    <td style="padding: 12px; border: 1px solid #e5e7eb;">Significant security issue that should be addressed quickly.</td>
                                </tr>
                                <tr>
                                    <td style="padding: 12px; border: 1px solid #e5e7eb; font-weight: bold; color: #d97706;">Medium</td>
                                    <td style="padding: 12px; text-align: center; border: 1px solid #e5e7eb;">${mediumFindings}</td>
                                    <td style="padding: 12px; border: 1px solid #e5e7eb;">Security issue that should be planned for remediation.</td>
                                </tr>
                                <tr>
                                    <td style="padding: 12px; border: 1px solid #e5e7eb; font-weight: bold; color: #65a30d;">Low</td>
                                    <td style="padding: 12px; text-align: center; border: 1px solid #e5e7eb;">${lowFindings}</td>
                                    <td style="padding: 12px; border: 1px solid #e5e7eb;">Minor security issues with limited impact.</td>
                                </tr>
                                <tr>
                                    <td style="padding: 12px; border: 1px solid #e5e7eb; font-weight: bold; color: #2563eb;">Informational</td>
                                    <td style="padding: 12px; text-align: center; border: 1px solid #e5e7eb;">${infoFindings}</td>
                                    <td style="padding: 12px; border: 1px solid #e5e7eb;">Potential security improvements, not vulnerabilities.</td>
                                </tr>
                                <tr style="background-color: #f9fafb;">
                                    <td style="padding: 12px; border: 1px solid #e5e7eb; font-weight: bold;">Total</td>
                                    <td style="padding: 12px; text-align: center; border: 1px solid #e5e7eb; font-weight: bold;">${totalFindings}</td>
                                    <td style="padding: 12px; border: 1px solid #e5e7eb;"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    ${currentProject.findingDetails && currentProject.findingDetails.length > 0 ? `
                    <div style="margin-bottom: 30px;">
                        <h2 style="color: #1e40af; border-bottom: 1px solid #e0e0e0; padding-bottom: 8px;">Detailed Findings</h2>
                        
                        ${currentProject.findingDetails
                            .sort((a, b) => {
                                const severityOrder = { 'critical': 5, 'high': 4, 'medium': 3, 'low': 2, 'info': 1 };
                                return (severityOrder[b.severity] || 0) - (severityOrder[a.severity] || 0);
                            })
                            .map((finding, index) => `
                            <div style="margin-bottom: 25px; padding: 15px; border: 1px solid #e5e7eb; border-left: 5px solid ${
                                finding.severity === 'critical' || finding.severity === 'high' ? '#dc2626' : 
                                finding.severity === 'medium' ? '#ea580c' : 
                                finding.severity === 'low' ? '#d97706' : '#2563eb'
                            }; border-radius: 4px;">
                                <h3 style="margin: 0; font-size: 16px;">${finding.title}</h3>
<span style="padding: 4px 8px; background-color: ${
    finding.severity === 'critical' ? '#fee2e2' : 
    finding.severity === 'high' ? '#fee2e2' : 
    finding.severity === 'medium' ? '#ffedd5' : 
    finding.severity === 'low' ? '#fef9c3' : '#dbeafe'
}; color: ${
    finding.severity === 'critical' ? '#b91c1c' : 
    finding.severity === 'high' ? '#b91c1c' : 
    finding.severity === 'medium' ? '#c2410c' : 
    finding.severity === 'low' ? '#a16207' : '#1e40af'
}; border-radius: 12px; font-size: 12px; font-weight: bold;">
    ${finding.severity.charAt(0).toUpperCase() + finding.severity.slice(1)}
</span>
</div>

<div style="margin-bottom: 10px;">
    <strong style="font-size: 14px; color: #4b5563;">Category:</strong> 
    <span>${categories[finding.category]?.title || finding.category}</span>
</div>

<div style="margin-bottom: 10px;">
    <strong style="font-size: 14px; color: #4b5563;">Description:</strong>
    <p style="margin-top: 5px; margin-bottom: 0; line-height: 1.5;">${finding.description.replace(/\n/g, '<br>')}</p>
</div>

${finding.steps ? `
<div style="margin-bottom: 10px;">
    <strong style="font-size: 14px; color: #4b5563;">Steps to Reproduce:</strong>
    <p style="margin-top: 5px; margin-bottom: 0; line-height: 1.5; font-family: monospace; white-space: pre-wrap; background-color: #f8fafc; padding: 10px; border-radius: 4px;">${finding.steps}</p>
</div>
` : ''}

${finding.remediation ? `
<div style="margin-bottom: 10px;">
    <strong style="font-size: 14px; color: #4b5563;">Remediation:</strong>
    <p style="margin-top: 5px; margin-bottom: 0; line-height: 1.5;">${finding.remediation.replace(/\n/g, '<br>')}</p>
</div>
` : ''}

<div style="color: #6b7280; font-size: 12px; margin-top: 10px;">
    Found: ${finding.date ? new Date(finding.date).toLocaleDateString() : 'N/A'}
    ${finding.lastEdited ? ` | Last updated: ${new Date(finding.lastEdited).toLocaleDateString()}` : ''}
</div>
</div>
                            `).join('')}
                    </div>
                    ` : `
                    <div style="margin-bottom: 30px; padding: 15px; background-color: #f9fafb; border-radius: 4px; text-align: center;">
                        <p style="color: #6b7280;">No findings have been recorded for this project.</p>
                    </div>
                    `}
                    
                    ${includeChecklist ? `
                    <div style="margin-bottom: 30px;">
                        <h2 style="color: #1e40af; border-bottom: 1px solid #e0e0e0; padding-bottom: 8px;">Security Test Checklist</h2>
                        
                        ${Object.entries(categories).map(([categoryId, category]) => {
                            const categoryProgress = calculateCategoryProgress(categoryId);
                            return `
                            <div style="margin-bottom: 20px;">
                                <h3 style="color: #2563eb; margin-bottom: 5px; padding-bottom: 5px; border-bottom: 1px dashed #e0e0e0;">
                                    ${category.title} (${categoryProgress.percentage}% Complete)
                                </h3>
                                
                                ${category.checklistItems ? `
                                <ul style="margin-top: 10px; padding-left: 20px;">
                                    ${category.checklistItems.filter(item => item.id).map(item => `
                                    <li style="margin-bottom: 5px; color: ${currentProject.progress?.[item.id] ? '#10b981' : '#6b7280'};">
                                        ${item.text} ${currentProject.progress?.[item.id] ? '✓' : ''}
                                    </li>
                                    `).join('')}
                                </ul>
                                ` : '<p style="color: #6b7280;">No checklist items defined.</p>'}
                            </div>
                            `;
                        }).join('')}
                    </div>
                    ` : ''}
                    
                    ${includeNotes && Object.keys(currentProject.notes || {}).length > 0 ? `
                    <div style="margin-bottom: 30px;">
                        <h2 style="color: #1e40af; border-bottom: 1px solid #e0e0e0; padding-bottom: 8px;">Assessment Notes</h2>
                        
                        ${Object.entries(currentProject.notes).map(([categoryId, notes]) => {
                            if (!notes) return '';
                            const categoryTitle = categories[categoryId]?.title || 'Unknown Category';
                            return `
                            <div style="margin-bottom: 15px;">
                                <h3 style="color: #2563eb; margin-bottom: 5px;">${categoryTitle}</h3>
                                <div style="background-color: #f9fafb; padding: 10px; border-radius: 4px; border-left: 3px solid #3b82f6;">
                                    <p style="margin: 0; line-height: 1.5; white-space: pre-wrap;">${notes}</p>
                                </div>
                            </div>
                            `;
                        }).join('')}
                    </div>
                    ` : ''}
                    
                    <div style="text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid #e0e0e0; color: #6b7280; font-size: 12px;">
                        <p>Generated with OWASP API Security Testing Checklist | ${new Date().toLocaleString()}</p>
                    </div>
                </div>
            `;
        }

        // Missing functions to complete the application
        function printChecklist() {
            window.print();
            addActivity("Printed project checklist");
        }

        function generateReport() {
            if (!currentProject?.findingDetails || currentProject.findingDetails.length === 0) {
                showToast("No findings to include in the report.", "warning");
                // Still show the export options in case they want to export progress anyway
            }
            
            showExportOptions();
            // Default to PDF for report generation
            document.getElementById('export-pdf').checked = true;
            
            // Show PDF options
            document.getElementById('pdf-options').classList.remove('hidden');
        }

        // Table sorting functionality
        document.getElementById('sort-category').addEventListener('click', function() {
            sortFindingsTable('category');
        });

        document.getElementById('sort-high').addEventListener('click', function() {
            sortFindingsTable('high');
        });

        document.getElementById('sort-medium').addEventListener('click', function() {
            sortFindingsTable('medium');
        });

        document.getElementById('sort-low').addEventListener('click', function() {
            sortFindingsTable('low');
        });

        document.getElementById('sort-info').addEventListener('click', function() {
            sortFindingsTable('info');
        });

        document.getElementById('sort-total').addEventListener('click', function() {
            sortFindingsTable('total');
        });

        function sortFindingsTable(column) {
            const table = document.getElementById('findings-table');
            if (!table) return;
            
            // Get all rows except the total row at the bottom
            const rows = Array.from(table.querySelectorAll('tr:not(:last-child)'));
            if (rows.length <= 1) return; // Nothing to sort
            
            // Get the sort arrow for the clicked column
            const arrow = document.querySelector(`#sort-${column} .sort-arrow`);
            
            // Toggle sort direction
            const ascending = !arrow.classList.contains('up');
            
            // Update all sort arrows - remove all classes
            document.querySelectorAll('.sort-arrow').forEach(a => {
                a.classList.remove('up', 'down');
            });
            
            // Set arrow direction
            arrow.classList.add(ascending ? 'up' : 'down');
            
            // Get index for the column to sort by
            let colIndex;
            switch (column) {
                case 'category':
                    colIndex = 0;
                    break;
                case 'high':
                    colIndex = 1;
                    break;
                case 'medium':
                    colIndex = 2;
                    break;
                case 'low':
                    colIndex = 3;
                    break;
                case 'info':
                    colIndex = 4;
                    break;
                case 'total':
                    colIndex = 5;
                    break;
                default:
                    return;
            }
            
            // Sort the rows
            rows.sort((a, b) => {
                let aValue, bValue;
                
                if (column === 'category') {
                    aValue = a.cells[colIndex].textContent.toLowerCase();
                    bValue = b.cells[colIndex].textContent.toLowerCase();
                    return ascending ? aValue.localeCompare(bValue) : bValue.localeCompare(aValue);
                } else {
                    aValue = parseInt(a.cells[colIndex].textContent) || 0;
                    bValue = parseInt(b.cells[colIndex].textContent) || 0;
                    return ascending ? aValue - bValue : bValue - aValue;
                }
            });
            
            // Remove all existing rows (except the total row)
            rows.forEach(row => row.remove());
            
            // Append the sorted rows before the total row
            const totalRow = table.querySelector('tr:last-child');
            rows.forEach(row => {
                table.insertBefore(row, totalRow);
            });
        }
        
     function viewCategoryFindingsDetails(categoryId) {
    // Open the category findings in the tab view
    openCategory(categoryId);
    changeTab('findings');
}
        
        // Function to edit a finding
        function editFinding(findingId) {
            hideAllModals();
            addFinding(null, findingId);
        }
    </script>

<script>// --- Timeline Section Implementation ---
document.addEventListener('DOMContentLoaded', function() {
    // Initialize the timeline section
    initializeTimelineSection();
    
    // Add event listeners for the timeline section buttons
    document.getElementById('open-full-timeline-btn')?.addEventListener('click', openTimelineModal);
    document.getElementById('export-timeline-data-btn')?.addEventListener('click', exportTimelineToCSV);
    
    // Set up the timeline modal functionality
    setupTimelineModal();
});

function initializeTimelineSection() {
    // Update the total activity count
    updateTimelineTotalCount();
    
    // Populate recent activity cards
    populateRecentActivityCards();
    
    // Create the timeline strip visualization
    createTimelineStrip();
    
    // Initialize the analytics charts
    initActivityCategoryChart();
    initActivityTimeChart();
}

function updateTimelineTotalCount() {
    const countElement = document.getElementById('timeline-total-count');
    if (countElement && recentActivities) {
        countElement.textContent = `${recentActivities.length} total activities`;
    }
}

function populateRecentActivityCards() {
    const container = document.getElementById('recent-activity-cards');
    if (!container || !recentActivities || recentActivities.length === 0) return;
    
    // Clear loading placeholders
    container.innerHTML = '';
    
    // Display up to 3 most recent activities
    const recentToShow = recentActivities.slice(0, 3);
    
    recentToShow.forEach((activity, index) => {
        // Determine the appropriate icon based on activity content
        let iconClass = 'fas fa-history text-blue-500';
        if (activity.message.includes('Finding')) iconClass = 'fas fa-bug text-red-500';
        else if (activity.message.includes('task') || activity.message.includes('completed')) iconClass = 'fas fa-check-circle text-green-500';
        else if (activity.message.includes('note') || activity.message.includes('Note')) iconClass = 'fas fa-sticky-note text-yellow-500';
        else if (activity.message.includes('Project')) iconClass = 'fas fa-folder text-indigo-500';
        
        const card = `
        <div class="bg-white dark:bg-gray-800 rounded-lg p-3 shadow-sm border border-gray-200 dark:border-gray-700 hover:shadow-md transition-all duration-300">
            <div class="flex items-start gap-3">
                <div class="h-8 w-8 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center flex-shrink-0">
                    <i class="${iconClass}"></i>
                </div>
                <div class="flex-grow min-w-0">
                    <p class="text-sm text-gray-700 dark:text-gray-300 truncate">${activity.message}</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">${activity.time}</p>
                </div>
            </div>
        </div>
        `;
        
        container.insertAdjacentHTML('beforeend', card);
    });
    
    // If we have fewer than 3 activities, add a placeholder for new activities
    if (recentToShow.length < 3) {
        const placeholderCard = `
        <div class="bg-blue-50 dark:bg-blue-900/30 rounded-lg p-3 shadow-sm border border-blue-200 dark:border-blue-800 text-center">
            <div class="flex flex-col items-center justify-center h-full">
                <div class="h-8 w-8 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center mb-2">
                    <i class="fas fa-plus text-blue-500"></i>
                </div>
                <p class="text-xs text-blue-700 dark:text-blue-300">Future activities will appear here</p>
            </div>
        </div>
        `;
        
        for (let i = 0; i < 3 - recentToShow.length; i++) {
            container.insertAdjacentHTML('beforeend', placeholderCard);
        }
    }
}

function createTimelineStrip() {
    const container = document.getElementById('timeline-dots-container');
    if (!container || !recentActivities || recentActivities.length === 0) return;
    
    // Clear the container
    container.innerHTML = '';
    
    // Calculate positions for dots - we'll show up to 15 most recent events
    const maxDots = Math.min(15, recentActivities.length);
    const dotsToShow = recentActivities.slice(0, maxDots);
    
    dotsToShow.forEach((activity, index) => {
        // Calculate position from right to left (most recent on the right)
        const position = 100 - (index * (100 / (maxDots - 1 || 1)));
        
        // Determine color based on activity type
        let dotColor = 'bg-blue-500';
        if (activity.message.includes('Finding')) dotColor = 'bg-red-500';
        else if (activity.message.includes('task') || activity.message.includes('completed')) dotColor = 'bg-green-500';
        else if (activity.message.includes('note') || activity.message.includes('Note')) dotColor = 'bg-yellow-500';
        else if (activity.message.includes('Project')) dotColor = 'bg-indigo-500';
        
        const dot = `
        <div class="absolute top-1/2 transform -translate-y-1/2 -translate-x-1/2" style="left: ${position}%;">
            <div class="h-4 w-4 rounded-full ${dotColor} shadow-sm cursor-pointer hover:scale-125 transition-transform" 
                 title="${activity.time}: ${activity.message}"
                 data-tippy-content="${activity.time}<br>${activity.message}"></div>
        </div>
        `;
        
        container.insertAdjacentHTML('beforeend', dot);
    });
    
    // Initialize tooltips if tippy.js is available
    if (typeof tippy === 'function') {
        tippy('[data-tippy-content]', {
            allowHTML: true,
            theme: document.documentElement.classList.contains('dark') ? 'dark' : 'light'
        });
    }
}

function initActivityCategoryChart() {
    const ctx = document.getElementById('activity-category-chart')?.getContext('2d');
    if (!ctx || !recentActivities || recentActivities.length === 0) return;
    
    // Count activities by category
    const categories = {};
    recentActivities.forEach(activity => {
        const category = getCategoryFromActivity(activity.message);
        categories[category] = (categories[category] || 0) + 1;
    });
    
    // Set up chart data
    const data = {
        labels: Object.keys(categories),
        datasets: [{
            data: Object.values(categories),
            backgroundColor: [
                '#3b82f6', // blue - general
                '#ef4444', // red - findings
                '#10b981', // green - tasks
                '#f59e0b', // yellow - notes
                '#8b5cf6', // purple - projects
                '#ec4899'  // pink - other
            ],
            borderWidth: 1
        }]
    };
    
    // Create doughnut chart
    new Chart(ctx, {
        type: 'doughnut',
        data: data,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        color: document.documentElement.classList.contains('dark') ? '#e2e8f0' : '#1f2937'
                    }
                },
                tooltip: {
                    backgroundColor: document.documentElement.classList.contains('dark') ? '#334155' : '#ffffff',
                    titleColor: document.documentElement.classList.contains('dark') ? '#e2e8f0' : '#1f2937',
                    bodyColor: document.documentElement.classList.contains('dark') ? '#e2e8f0' : '#1f2937',
                    borderColor: document.documentElement.classList.contains('dark') ? '#475569' : '#e2e8f0',
                    borderWidth: 1
                }
            }
        }
    });
}

function initActivityTimeChart() {
    const ctx = document.getElementById('activity-time-chart')?.getContext('2d');
    if (!ctx || !recentActivities || recentActivities.length === 0) return;
    
    // Group activities by hour (simplified for demo)
    const timeData = {};
    const now = new Date();
    
    // Create some sample time data for demonstration
    for (let i = 0; i < 24; i++) {
        const hour = new Date(now.getFullYear(), now.getMonth(), now.getDate(), i, 0, 0);
        const hourStr = hour.toLocaleTimeString([], { hour: '2-digit' });
        timeData[hourStr] = 0;
    }
    
    // Add actual activity data (using demo data since we don't have real timestamps)
    recentActivities.forEach((activity, index) => {
        // For demo, distribute activities across hours based on index
        const hour = new Date(now.getFullYear(), now.getMonth(), now.getDate(), (index % 12) + 8, 0, 0);
        const hourStr = hour.toLocaleTimeString([], { hour: '2-digit' });
        timeData[hourStr] = (timeData[hourStr] || 0) + 1;
    });
    
    // Create line chart
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: Object.keys(timeData),
            datasets: [{
                label: 'Activities',
                data: Object.values(timeData),
                borderColor: '#3b82f6',
                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        precision: 0,
                        color: document.documentElement.classList.contains('dark') ? '#e2e8f0' : '#1f2937'
                    },
                    grid: {
                        color: document.documentElement.classList.contains('dark') ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'
                    }
                },
                x: {
                    ticks: {
                        color: document.documentElement.classList.contains('dark') ? '#e2e8f0' : '#1f2937'
                    },
                    grid: {
                        display: false
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    backgroundColor: document.documentElement.classList.contains('dark') ? '#334155' : '#ffffff',
                    titleColor: document.documentElement.classList.contains('dark') ? '#e2e8f0' : '#1f2937',
                    bodyColor: document.documentElement.classList.contains('dark') ? '#e2e8f0' : '#1f2937',
                    borderColor: document.documentElement.classList.contains('dark') ? '#475569' : '#e2e8f0',
                    borderWidth: 1
                }
            }
        }
    });
}

function getCategoryFromActivity(activityMessage) {
    if (activityMessage.includes('Finding')) return 'Findings';
    if (activityMessage.includes('task') || activityMessage.includes('completed') || activityMessage.includes('unmarked')) return 'Tasks';
    if (activityMessage.includes('note') || activityMessage.includes('Note')) return 'Notes';
    if (activityMessage.includes('Project')) return 'Projects';
    if (activityMessage.includes('Category') || activityMessage.includes('opened')) return 'Navigation';
    return 'General';
}

function openTimelineModal() {
    populateTimelineModal();
    showModal('timeline-modal');
}

function setupTimelineModal() {
    // Set up filter buttons
    document.querySelectorAll('.timeline-filter-btn').forEach(button => {
        button.addEventListener('click', function() {
            // Update active state
            document.querySelectorAll('.timeline-filter-btn').forEach(btn => {
                btn.classList.remove('bg-blue-100', 'text-blue-700', 'dark:bg-blue-900', 'dark:text-blue-300', 'active');
                btn.classList.add('bg-gray-100', 'text-gray-700', 'dark:bg-gray-700', 'dark:text-gray-300');
            });
            
            this.classList.remove('bg-gray-100', 'text-gray-700', 'dark:bg-gray-700', 'dark:text-gray-300');
            this.classList.add('bg-blue-100', 'text-blue-700', 'dark:bg-blue-900', 'dark:text-blue-300', 'active');
            
            // Apply filter
            const filter = this.getAttribute('data-filter');
            filterTimelineItems(filter);
        });
    });
    
    // Set up search functionality
    document.getElementById('timeline-search')?.addEventListener('input', function() {
        filterTimelineItems();
    });
    
    // Set up export button
    document.getElementById('export-timeline-csv')?.addEventListener('click', exportTimelineToCSV);
}

function populateTimelineModal() {
    const timelineContent = document.getElementById('timeline-content');
    if (!timelineContent || !recentActivities) return;
    
    // Clear existing content
    timelineContent.innerHTML = '';
    
    // Update count elements
    document.getElementById('timeline-total').textContent = recentActivities.length;
    document.getElementById('timeline-visible-count').textContent = recentActivities.length;
    
    // Generate timeline items
    recentActivities.forEach((activity, index) => {
        // Determine icon and class based on activity type
        let iconClass, categoryClass, categoryName;
        
        if (activity.message.includes('Finding')) {
            iconClass = 'fas fa-bug';
            categoryClass = 'finding';
            categoryName = 'Finding';
        } else if (activity.message.includes('task') || activity.message.includes('completed') || activity.message.includes('unmarked')) {
            iconClass = 'fas fa-tasks';
            categoryClass = 'task';
            categoryName = 'Task';
        } else if (activity.message.includes('note') || activity.message.includes('Note')) {
            iconClass = 'fas fa-sticky-note';
            categoryClass = 'note';
            categoryName = 'Note';
        } else if (activity.message.includes('Project')) {
            iconClass = 'fas fa-folder';
            categoryClass = 'project';
            categoryName = 'Project';
        } else {
            iconClass = 'fas fa-history';
            categoryClass = 'general';
            categoryName = 'General';
        }
        
        // Create item HTML
        const itemHTML = `
        <div class="timeline-item flex gap-4 pl-10 relative animate-fade-in ${categoryClass}" style="animation-delay: ${index * 0.03}s;">
            <!-- Dot marker on the timeline -->
            <div class="absolute left-0 top-0 w-10 h-10 flex items-center justify-center">
                <div class="h-5 w-5 rounded-full bg-white dark:bg-gray-700 border-2 border-blue-500 z-10 flex items-center justify-center">
                    <i class="${iconClass} text-xs text-blue-500"></i>
                </div>
            </div>
            
            <!-- Activity card -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-3 w-full mb-6">
                <div class="flex items-start justify-between">
                    <div class="flex items-start gap-3">
                        <div>
                            <p class="text-sm text-gray-700 dark:text-gray-300">${activity.message}</p>
                            <div class="flex flex-wrap items-center gap-4 mt-2">
                                <span class="text-xs text-gray-500 dark:text-gray-400">${activity.time}</span>
                                <span class="px-2 py-0.5 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-full text-xs">
                                    ${categoryName}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        `;
        
        timelineContent.insertAdjacentHTML('beforeend', itemHTML);
    });
    
    // If no activities, show a message
    if (recentActivities.length === 0) {
        const emptyState = `
        <div class="flex flex-col items-center justify-center py-12">
            <div class="h-24 w-24 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center text-blue-500 dark:text-blue-400 mb-4">
                <i class="fas fa-history text-3xl"></i>
            </div>
            <h3 class="text-xl font-medium text-gray-900 dark:text-gray-100 mb-2">No activities yet</h3>
            <p class="text-gray-500 dark:text-gray-400 text-center max-w-md">
                Start interacting with the checklist by completing tasks, adding findings, or making notes to see your activity history.
            </p>
        </div>
        `;
        
        timelineContent.innerHTML = emptyState;
    }
}

function filterTimelineItems(filterType) {
    const searchQuery = document.getElementById('timeline-search')?.value.toLowerCase() || '';
    const activeFilter = filterType || document.querySelector('.timeline-filter-btn.active')?.getAttribute('data-filter') || 'all';
    
    const items = document.querySelectorAll('.timeline-item');
    let visibleCount = 0;
    
    items.forEach(item => {
        const itemText = item.textContent.toLowerCase();
        const matchesSearch = searchQuery === '' || itemText.includes(searchQuery);
        
        let matchesFilter = activeFilter === 'all';
        if (!matchesFilter) {
            matchesFilter = item.classList.contains(activeFilter);
        }
        
        const isVisible = matchesSearch && matchesFilter;
        item.classList.toggle('hidden', !isVisible);
        
        if (isVisible) visibleCount++;
    });
    
    // Update counter
    document.getElementById('timeline-visible-count').textContent = visibleCount;
}

function exportTimelineToCSV() {
    if (!recentActivities || recentActivities.length === 0) {
        showToast('No activities to export', 'warning');
        return;
    }
    
    const headers = ['Time', 'Activity', 'Category'];
    let csvContent = headers.join(',') + '\n';
    
    recentActivities.forEach(activity => {
        const time = activity.time;
        const activityText = `"${activity.message.replace(/"/g, '""')}"`;
        const category = getCategoryFromActivity(activity.message);
        
        csvContent += [time, activityText, category].join(',') + '\n';
    });
    
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    const fileName = `activity_timeline_${new Date().toISOString().split('T')[0]}.csv`;
    
    link.setAttribute('href', url);
    link.setAttribute('download', fileName);
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    showToast('Timeline exported successfully', 'success');
    addActivity('Exported activity timeline to CSV');
}

// Make sure this is called when activities are updated
function updateTimeline() {
    updateTimelineTotalCount();
    populateRecentActivityCards();
    createTimelineStrip();
    
    // Update charts if they exist
    // Note: In a real implementation, you might want to destroy and recreate
    // the charts to properly update with new data
    initActivityCategoryChart();
    initActivityTimeChart();
}

// Extend the addActivity function to update the timeline section
const originalAddActivity = addActivity;
addActivity = function(message) {
    // Call the original function
    originalAddActivity(message);
    
    // Update the timeline section
    updateTimeline();
}</script>
</body>
</html>